{"version":3,"sources":["main.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Object","defineProperty","value","Main","obj","_mainController","_mainController2","__esModule","default","this","controller","document","querySelector","fetchNeighborhoods","fetchCuisines","updateRestaurants","console","log","window","initMap","self","map","google","maps","Map","getElementById","zoom","center","lat","lng","scrollwheel","prototype","cSelect","nSelect","cIndex","selectedIndex","nIndex","cuisine","neighborhood","fetchRestaurants","main","./mainController","2","MainController","_util","_util2","container","markers","_container","_registerServiceWorker","dataWorker","Worker","navigator","checkConnection","onLine","error","requestAnimationFrame","snackbar","message","setTimeout","serviceWorker","register","scope","then","swReg","catch","err","postMessage","_ref","_this","action","input","onmessage","event","data","fillRestaurantsHTML","result","fillNeighborhoodsHTML","fillCuisinesHTML","restaurant","el","id","btnEl","is_favorite","classList","remove","add","innerHTML","neighborhoods","select","forEach","option","createElement","append","cuisines","resetRestaurants","restaurants","m","setMap","_this2","ul","createRestaurantHTML","imgLazyLoader","addMarkersToMap","_this3","li","setAttribute","name","cuisine_type","address","image","className","imageUrlForRestaurant","alt","isFavorite","src","more","href","urlForRestaurant","favorite","addEventListener","toggleFavorite","_this4","marker","Marker","position","latlng","title","url","animation","Animation","DROP","addListener","location","push","./util","3","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","Util","instance","TypeError","_classCallCheck","color","arguments","undefined","style","background","removeAttribute","imgs","querySelectorAll","IntersectionObserver","observer","entries","obsr","entry","intersectionRatio","unobserve","preloadImage","rootMargin","threshold","observe","img","nodeName","getAttribute","size","photograph"],"mappings":"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","file":"main.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nexports.Main = Main;\n\nvar _mainController = require('./mainController');\n\nvar _mainController2 = _interopRequireDefault(_mainController);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar map;\n\nfunction Main() {\n\tthis.controller = new _mainController2.default(document.querySelector('#app-main'));\n\tthis.controller.fetchNeighborhoods();\n\tthis.controller.fetchCuisines();\n\n\tthis.updateRestaurants();\n\n\t/**\n * Initialize Google map, called from HTML.\n */\n\t// window.addEventListener('load', (e) => {\n\tconsole.log('All resources finished loading!');\n\n\t// const script = document.createElement('script');\n\t// script.setAttribute('async', true);\n\t// script.setAttribute('defer', true);\n\t// script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyCAGI5xQ4PXUpi6HNhM7fwIVzSzTVVJz5E&libraries=places&callback=initMap';\n\t// document.getElementById('app-main').appendChild(script);\n\n\twindow.initMap = function () {\n\t\tvar loc = { lat: 40.722216, lng: -73.987501 };\n\t\tself.map = new google.maps.Map(document.getElementById('map'), {\n\t\t\tzoom: 12,\n\t\t\tcenter: loc,\n\t\t\tscrollwheel: false\n\t\t});\n\t};\n\n\t// });\n}\n\nMain.prototype.updateRestaurants = function () {\n\n\tvar cSelect = document.getElementById('cuisines-select');\n\tvar nSelect = document.getElementById('neighborhoods-select');\n\n\tvar cIndex = cSelect.selectedIndex;\n\tvar nIndex = nSelect.selectedIndex;\n\n\tvar cuisine = cSelect[cIndex].value;\n\tvar neighborhood = nSelect[nIndex].value;\n\n\tthis.controller.fetchRestaurants(cuisine, neighborhood);\n};\n\nwindow.main = new Main();\n\n},{\"./mainController\":2}],2:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nexports.default = MainController;\n\nvar _util = require('./util');\n\nvar _util2 = _interopRequireDefault(_util);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction MainController(container) {\n\tthis.markers = [];\n\tthis._container = container;\n\tthis._registerServiceWorker();\n\n\tthis.dataWorker = new Worker('./js/dataWorker.js');\n\n\tif (navigator) checkConnection();\n}\n\nMainController.prototype._registerServiceWorker = function () {\n\tif (navigator.serviceWorker) {\n\t\tif (navigator.serviceWorker.controller) return;\n\n\t\tnavigator.serviceWorker.register('/sw.js', { scope: '/' }).then(function (swReg) {\n\t\t\tconsole.log('\\nServiceWorker successfully registred. Scope\\n', swReg.scope);\n\t\t}).catch(function (err) {\n\t\t\tconsole.log('\\nServiceWorker swReg failed :(\\n', err.message);\n\t\t});\n\t}\n};\n\nMainController.prototype.postMessage = function (_ref) {\n\tvar _this = this;\n\n\tvar action = _ref.action,\n\t    input = _ref.input;\n\n\tthis.dataWorker.postMessage({ action: action, input: input });\n\tthis.dataWorker.onmessage = function (event) {\n\n\t\tif (!event.data) throw new Error('There is no data: ' + event);\n\n\t\tif (event.data.action === 'fetchRestaurantByCuisineAndNeighborhood') {\n\t\t\t// this.resetRestaurants();\n\t\t\trequestAnimationFrame(function () {\n\t\t\t\treturn _this.fillRestaurantsHTML(event.data.result);\n\t\t\t});\n\t\t}\n\n\t\tif (event.data.action === 'fetchNeighborhoods') {\n\t\t\trequestAnimationFrame(function () {\n\t\t\t\treturn _this.fillNeighborhoodsHTML(event.data.result);\n\t\t\t});\n\t\t}\n\n\t\tif (event.data.action === 'fetchCuisines') {\n\t\t\trequestAnimationFrame(function () {\n\t\t\t\treturn _this.fillCuisinesHTML(event.data.result);\n\t\t\t});\n\t\t}\n\n\t\tif (event.data.action === 'toggleFavorite') {\n\t\t\tvar restaurant = event.data.result;\n\t\t\tvar el = document.querySelector('#favorite-' + restaurant.id);\n\t\t\tvar btnEl = document.querySelector('#favorite-button-' + restaurant.id);\n\t\t\tif (restaurant.is_favorite === \"true\") {\n\t\t\t\tel.classList.remove('hidden');\n\t\t\t\tel.classList.add('visible');\n\t\t\t\tbtnEl.innerHTML = 'Remove from favorites';\n\t\t\t} else {\n\t\t\t\tel.classList.remove('visible');\n\t\t\t\tel.classList.add('hidden');\n\t\t\t\tbtnEl.innerHTML = 'Add to favorites';\n\t\t\t}\n\t\t}\n\t};\n};\n\nMainController.prototype.fetchRestaurants = function (cuisine, neighborhood) {\n\tthis.postMessage({\n\t\taction: 'fetchRestaurantByCuisineAndNeighborhood',\n\t\tinput: {\n\t\t\tcuisine: cuisine,\n\t\t\tneighborhood: neighborhood\n\t\t}\n\t});\n};\n\n/**\n * Fetch all neighborhoods and set their HTML.\n */\nMainController.prototype.fetchNeighborhoods = function () {\n\tthis.postMessage({\n\t\taction: 'fetchNeighborhoods',\n\t\tinput: null\n\t});\n};\n\n/**\n * Set neighborhoods HTML.\n */\nMainController.prototype.fillNeighborhoodsHTML = function (neighborhoods) {\n\tvar select = document.getElementById('neighborhoods-select');\n\tneighborhoods.forEach(function (neighborhood) {\n\t\tvar option = document.createElement('option');\n\t\toption.innerHTML = neighborhood;\n\t\toption.value = neighborhood;\n\t\tselect.append(option);\n\t});\n};\n\n/**\n * Fetch all cuisines and set their HTML.\n */\nMainController.prototype.fetchCuisines = function () {\n\tthis.postMessage({\n\t\taction: 'fetchCuisines',\n\t\tinput: null\n\t});\n};\n\n/**\n * Set cuisines HTML.\n */\nMainController.prototype.fillCuisinesHTML = function (cuisines) {\n\tvar select = document.getElementById('cuisines-select');\n\tcuisines.forEach(function (cuisine) {\n\t\tvar option = document.createElement('option');\n\t\toption.innerHTML = cuisine;\n\t\toption.value = cuisine;\n\t\tselect.append(option);\n\t});\n};\n\n/**\n * Clear current restaurants, their HTML and remove their map markers.\n */\nMainController.prototype.resetRestaurants = function (restaurants) {\n\t// Remove all restaurants\n\tvar ul = document.getElementById('restaurants-list');\n\tul.innerHTML = '';\n\n\t// Remove all map markers\n\tthis.markers.forEach(function (m) {\n\t\treturn m.setMap(null);\n\t});\n\tthis.markers = [];\n};\n\n/**\n * Create all restaurants HTML and add them to the webpage.\n */\nMainController.prototype.fillRestaurantsHTML = function (restaurants) {\n\tvar _this2 = this;\n\n\tvar animate = function animate() {\n\t\t_this2.resetRestaurants();\n\t\tvar ul = document.getElementById('restaurants-list');\n\t\trestaurants.forEach(function (restaurant) {\n\t\t\tul.append(_this2.createRestaurantHTML(restaurant));\n\t\t});\n\n\t\t_util2.default.imgLazyLoader('.img-lazy-load');\n\t\tif (self.initMap) _this2.addMarkersToMap(restaurants);\n\t};\n\n\trequestAnimationFrame(animate);\n};\n\n/**\n * Create restaurant HTML.\n */\nMainController.prototype.createRestaurantHTML = function (restaurant) {\n\tvar _this3 = this;\n\n\tvar li = document.createElement('li');\n\tli.setAttribute('id', 'restaurant-' + restaurant.id);\n\tli.setAttribute('aria-label', restaurant.name + ' - ' + restaurant.cuisine_type + ' - ' + restaurant.address);\n\n\tvar image = document.createElement('img');\n\timage.className = 'img-lazy-load restaurant-img';\n\timage.setAttribute('data-src', _util2.default.imageUrlForRestaurant(restaurant, 600));\n\timage.alt = restaurant.name + ' - ' + restaurant.cuisine_type + ' Cuisine';\n\n\tli.append(image);\n\n\tvar isFavorite = document.createElement('img');\n\tisFavorite.src = '/img/heart.svg';\n\tisFavorite.setAttribute('id', 'favorite-' + restaurant.id);\n\tisFavorite.classList.add('favorite-icon', 'hidden');\n\tif (restaurant.is_favorite === \"true\") {\n\t\tisFavorite.classList.remove('hidden');\n\t\tisFavorite.classList.add('visible');\n\t}\n\tli.append(isFavorite);\n\n\tvar name = document.createElement('h2');\n\tname.innerHTML = restaurant.name;\n\tli.append(name);\n\n\tvar cuisine = document.createElement('p');\n\tcuisine.className = 'cuisine-type';\n\tcuisine.innerHTML = restaurant.cuisine_type;\n\tli.append(cuisine);\n\n\tvar neighborhood = document.createElement('p');\n\tneighborhood.innerHTML = restaurant.neighborhood;\n\tli.append(neighborhood);\n\n\tvar address = document.createElement('p');\n\taddress.innerHTML = restaurant.address;\n\tli.append(address);\n\n\tvar more = document.createElement('a');\n\tmore.innerHTML = 'View Details';\n\tmore.classList.add('item-button');\n\tmore.setAttribute('role', 'button');\n\tmore.href = _util2.default.urlForRestaurant(restaurant);\n\tli.append(more);\n\n\tvar favorite = document.createElement('button');\n\tfavorite.setAttribute('id', 'favorite-button-' + restaurant.id);\n\tfavorite.innerHTML = restaurant.is_favorite === \"true\" ? 'Remove from favorites' : 'Add to favorites';\n\tfavorite.classList.add('item-button');\n\tfavorite.addEventListener('click', function () {\n\t\treturn _this3.toggleFavorite(restaurant);\n\t});\n\tli.append(favorite);\n\n\treturn li;\n};\n\n/**\n * Add markers for current restaurants to the map.\n */\nMainController.prototype.addMarkersToMap = function (restaurants) {\n\tvar _this4 = this;\n\n\tif (!google) return;\n\trestaurants.forEach(function (restaurant) {\n\t\tvar marker = new google.maps.Marker({\n\t\t\tposition: restaurant.latlng,\n\t\t\ttitle: restaurant.name,\n\t\t\turl: './restaurant.html?id=' + restaurant.id,\n\t\t\tmap: self.map,\n\t\t\tanimation: google.maps.Animation.DROP });\n\n\t\tgoogle.maps.event.addListener(marker, 'click', function () {\n\t\t\twindow.location.href = marker.url;\n\t\t});\n\t\t_this4.markers.push(marker);\n\t});\n};\n\nMainController.prototype.toggleFavorite = function (restaurant) {\n\tthis.postMessage({\n\t\taction: 'toggleFavorite',\n\t\tinput: { id: restaurant.id }\n\t});\n};\n\nfunction checkConnection() {\n\tif (!navigator.onLine) handleError(new Error('No Connection'));\n\t// check connetion every 5 seconds\n\tvar checkTimeout = setTimeout(function () {\n\t\tcheckConnection();\n\t}, 10000);\n}\n\nfunction handleError(error) {\n\trequestAnimationFrame(function () {\n\t\treturn _util2.default.snackbar(document.querySelector('#snackbar'), error.message);\n\t});\n}\n\n},{\"./util\":3}],3:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n// Utility functions\n\n\nvar Util = function () {\n\tfunction Util() {\n\t\t_classCallCheck(this, Util);\n\t}\n\n\t_createClass(Util, null, [{\n\t\tkey: 'snackbar',\n\n\n\t\t/**\n  *\n  */\n\t\tvalue: function snackbar(el, message) {\n\t\t\tvar color = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '#D9001F';\n\n\n\t\t\t// TODO\n\t\t\t// Create a element if the selected element does not existe\n\t\t\t// var newDiv = document.createElement(\"div\");\n\n\t\t\tif (!el) {\n\t\t\t\tconsole.log(new Error('Snackbar element not valid'));\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tel.innerHTML = message;\n\t\t\tel.setAttribute('class', 'showSnackbar');\n\t\t\tel.style.background = color;\n\t\t\tsetTimeout(function () {\n\t\t\t\tel.removeAttribute('class');\n\t\t\t}, 5500);\n\t\t}\n\n\t\t/**\n  *\n  */\n\n\t}, {\n\t\tkey: 'imgLazyLoader',\n\t\tvalue: function imgLazyLoader(target) {\n\t\t\tvar imgs = document.querySelectorAll(target);\n\n\t\t\tif (!window.IntersectionObserver) {\n\t\t\t\tconsole.log('No lazy loading for you :(');\n\t\t\t\timgs.forEach(function (img) {\n\t\t\t\t\treturn Util.preloadImage(img);\n\t\t\t\t});\n\t\t\t} else {\n\n\t\t\t\tvar onIntersection = function onIntersection(entries, obsr) {\n\t\t\t\t\tentries.forEach(function (entry) {\n\t\t\t\t\t\tif (entry.intersectionRatio > 0) {\n\t\t\t\t\t\t\tobsr.unobserve(entry.target);\n\t\t\t\t\t\t\trequestAnimationFrame(function () {\n\t\t\t\t\t\t\t\treturn Util.preloadImage(entry.target);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\tvar obsrOptions = {\n\t\t\t\t\trootMargin: '30px 0px',\n\t\t\t\t\tthreshold: [0.1]\n\t\t\t\t};\n\n\t\t\t\tvar observer = new IntersectionObserver(onIntersection, obsrOptions);\n\t\t\t\timgs.forEach(function (target) {\n\t\t\t\t\treturn observer.observe(target);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n  *\n  */\n\n\t}, {\n\t\tkey: 'preloadImage',\n\t\tvalue: function preloadImage(target) {\n\t\t\tif (!target.nodeName === 'IMG') return false;\n\t\t\ttarget.setAttribute('src', target.getAttribute('data-src'));\n\t\t\tconsole.log('Image loaded: ', target.getAttribute('data-src'));\n\t\t\treturn target;\n\t\t}\n\n\t\t/**\n   * Restaurant page URL.\n   */\n\n\t}, {\n\t\tkey: 'urlForRestaurant',\n\t\tvalue: function urlForRestaurant(restaurant) {\n\t\t\treturn './restaurant.html?id=' + restaurant.id;\n\t\t}\n\n\t\t/**\n   * Restaurant image URL.\n   */\n\n\t}, {\n\t\tkey: 'imageUrlForRestaurant',\n\t\tvalue: function imageUrlForRestaurant(restaurant, size) {\n\t\t\tvar img = restaurant.photograph;\n\t\t\treturn img ? '/img/' + img + '-' + size + '.jpg' : '/img/restaurant_placeholder.svg';\n\t\t}\n\t}]);\n\n\treturn Util;\n}();\n\nexports.default = Util;\n\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9tYWluLmpzIiwianMvbWFpbkNvbnRyb2xsZXIuanMiLCJqcy91dGlsLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7UUNJZ0IsSSxHQUFBLEk7O0FBSmhCOzs7Ozs7QUFFQSxJQUFJLEdBQUo7O0FBRU8sU0FBUyxJQUFULEdBQWdCO0FBQ3RCLE1BQUssVUFBTCxHQUFrQixJQUFJLHdCQUFKLENBQW1CLFNBQVMsYUFBVCxDQUF1QixXQUF2QixDQUFuQixDQUFsQjtBQUNBLE1BQUssVUFBTCxDQUFnQixrQkFBaEI7QUFDQSxNQUFLLFVBQUwsQ0FBZ0IsYUFBaEI7O0FBRUEsTUFBSyxpQkFBTDs7QUFFQTs7O0FBR0E7QUFDQyxTQUFRLEdBQVIsQ0FBWSxpQ0FBWjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFFBQU8sT0FBUCxHQUFpQixZQUFNO0FBQ3RCLE1BQUksTUFBTSxFQUFFLEtBQUssU0FBUCxFQUFrQixLQUFLLENBQUMsU0FBeEIsRUFBVjtBQUNBLE9BQUssR0FBTCxHQUFXLElBQUksT0FBTyxJQUFQLENBQVksR0FBaEIsQ0FBb0IsU0FBUyxjQUFULENBQXdCLEtBQXhCLENBQXBCLEVBQW9EO0FBQzlELFNBQU0sRUFEd0Q7QUFFOUQsV0FBUSxHQUZzRDtBQUc5RCxnQkFBYTtBQUhpRCxHQUFwRCxDQUFYO0FBS0EsRUFQRDs7QUFTRDtBQUVBOztBQUVELEtBQUssU0FBTCxDQUFlLGlCQUFmLEdBQW1DLFlBQVc7O0FBRTdDLEtBQU0sVUFBVSxTQUFTLGNBQVQsQ0FBd0IsaUJBQXhCLENBQWhCO0FBQ0EsS0FBTSxVQUFVLFNBQVMsY0FBVCxDQUF3QixzQkFBeEIsQ0FBaEI7O0FBRUEsS0FBTSxTQUFTLFFBQVEsYUFBdkI7QUFDQSxLQUFNLFNBQVMsUUFBUSxhQUF2Qjs7QUFFQSxLQUFNLFVBQVUsUUFBUSxNQUFSLEVBQWdCLEtBQWhDO0FBQ0EsS0FBTSxlQUFlLFFBQVEsTUFBUixFQUFnQixLQUFyQzs7QUFFQSxNQUFLLFVBQUwsQ0FBZ0IsZ0JBQWhCLENBQWlDLE9BQWpDLEVBQTBDLFlBQTFDO0FBQ0EsQ0FaRDs7QUFjQSxPQUFPLElBQVAsR0FBYyxJQUFJLElBQUosRUFBZDs7Ozs7Ozs7a0JDL0N3QixjOztBQUh4Qjs7Ozs7O0FBR2UsU0FBUyxjQUFULENBQXdCLFNBQXhCLEVBQW1DO0FBQ2pELE1BQUssT0FBTCxHQUFlLEVBQWY7QUFDQSxNQUFLLFVBQUwsR0FBa0IsU0FBbEI7QUFDQSxNQUFLLHNCQUFMOztBQUVBLE1BQUssVUFBTCxHQUFrQixJQUFJLE1BQUosQ0FBVyxvQkFBWCxDQUFsQjs7QUFFQSxLQUFJLFNBQUosRUFBZTtBQUNmOztBQUVELGVBQWUsU0FBZixDQUF5QixzQkFBekIsR0FBa0QsWUFBVztBQUM1RCxLQUFJLFVBQVUsYUFBZCxFQUE2QjtBQUM1QixNQUFJLFVBQVUsYUFBVixDQUF3QixVQUE1QixFQUF3Qzs7QUFFeEMsWUFBVSxhQUFWLENBQXdCLFFBQXhCLENBQWlDLFFBQWpDLEVBQTJDLEVBQUMsT0FBTyxHQUFSLEVBQTNDLEVBQXlELElBQXpELENBQThELFVBQUMsS0FBRCxFQUFXO0FBQ3hFLFdBQVEsR0FBUixDQUFZLGlEQUFaLEVBQStELE1BQU0sS0FBckU7QUFDQSxHQUZELEVBRUcsS0FGSCxDQUVTLFVBQUMsR0FBRCxFQUFTO0FBQ2pCLFdBQVEsR0FBUixDQUFZLG1DQUFaLEVBQWlELElBQUksT0FBckQ7QUFDQSxHQUpEO0FBTUE7QUFDRCxDQVhEOztBQWNBLGVBQWUsU0FBZixDQUF5QixXQUF6QixHQUF1QyxnQkFBNEI7QUFBQTs7QUFBQSxLQUFqQixNQUFpQixRQUFqQixNQUFpQjtBQUFBLEtBQVQsS0FBUyxRQUFULEtBQVM7O0FBQ2xFLE1BQUssVUFBTCxDQUFnQixXQUFoQixDQUE0QixFQUFFLGNBQUYsRUFBVSxZQUFWLEVBQTVCO0FBQ0EsTUFBSyxVQUFMLENBQWdCLFNBQWhCLEdBQTRCLFVBQUMsS0FBRCxFQUFXOztBQUV0QyxNQUFHLENBQUMsTUFBTSxJQUFWLEVBQWdCLE1BQU0sSUFBSSxLQUFKLHdCQUErQixLQUEvQixDQUFOOztBQUVoQixNQUFHLE1BQU0sSUFBTixDQUFXLE1BQVgsS0FBc0IseUNBQXpCLEVBQW9FO0FBQ25FO0FBQ0EseUJBQXNCO0FBQUEsV0FBTSxNQUFLLG1CQUFMLENBQXlCLE1BQU0sSUFBTixDQUFXLE1BQXBDLENBQU47QUFBQSxJQUF0QjtBQUNBOztBQUVELE1BQUcsTUFBTSxJQUFOLENBQVcsTUFBWCxLQUFzQixvQkFBekIsRUFBK0M7QUFDOUMseUJBQXNCO0FBQUEsV0FBTSxNQUFLLHFCQUFMLENBQTJCLE1BQU0sSUFBTixDQUFXLE1BQXRDLENBQU47QUFBQSxJQUF0QjtBQUNBOztBQUVELE1BQUcsTUFBTSxJQUFOLENBQVcsTUFBWCxLQUFzQixlQUF6QixFQUEwQztBQUN6Qyx5QkFBc0I7QUFBQSxXQUFNLE1BQUssZ0JBQUwsQ0FBc0IsTUFBTSxJQUFOLENBQVcsTUFBakMsQ0FBTjtBQUFBLElBQXRCO0FBQ0E7O0FBRUQsTUFBRyxNQUFNLElBQU4sQ0FBVyxNQUFYLEtBQXNCLGdCQUF6QixFQUEyQztBQUMxQyxPQUFNLGFBQWEsTUFBTSxJQUFOLENBQVcsTUFBOUI7QUFDQSxPQUFNLEtBQUssU0FBUyxhQUFULGdCQUFvQyxXQUFXLEVBQS9DLENBQVg7QUFDQSxPQUFNLFFBQVEsU0FBUyxhQUFULHVCQUEyQyxXQUFXLEVBQXRELENBQWQ7QUFDQSxPQUFHLFdBQVcsV0FBWCxLQUEyQixNQUE5QixFQUFzQztBQUNyQyxPQUFHLFNBQUgsQ0FBYSxNQUFiLENBQW9CLFFBQXBCO0FBQ0EsT0FBRyxTQUFILENBQWEsR0FBYixDQUFpQixTQUFqQjtBQUNBLFVBQU0sU0FBTixHQUFrQix1QkFBbEI7QUFDQSxJQUpELE1BSU87QUFDTixPQUFHLFNBQUgsQ0FBYSxNQUFiLENBQW9CLFNBQXBCO0FBQ0EsT0FBRyxTQUFILENBQWEsR0FBYixDQUFpQixRQUFqQjtBQUNBLFVBQU0sU0FBTixHQUFrQixrQkFBbEI7QUFDQTtBQUNEO0FBQ0QsRUEvQkQ7QUFnQ0EsQ0FsQ0Q7O0FBcUNBLGVBQWUsU0FBZixDQUF5QixnQkFBekIsR0FBNEMsVUFBUyxPQUFULEVBQWtCLFlBQWxCLEVBQWdDO0FBQzNFLE1BQUssV0FBTCxDQUFpQjtBQUNoQixVQUFRLHlDQURRO0FBRWhCLFNBQU87QUFDTixtQkFETTtBQUVOO0FBRk07QUFGUyxFQUFqQjtBQU9BLENBUkQ7O0FBV0E7OztBQUdBLGVBQWUsU0FBZixDQUF5QixrQkFBekIsR0FBOEMsWUFBVztBQUN4RCxNQUFLLFdBQUwsQ0FBaUI7QUFDaEIsVUFBUSxvQkFEUTtBQUVoQixTQUFPO0FBRlMsRUFBakI7QUFJQSxDQUxEOztBQVFBOzs7QUFHQSxlQUFlLFNBQWYsQ0FBeUIscUJBQXpCLEdBQWlELFVBQVMsYUFBVCxFQUF3QjtBQUN4RSxLQUFNLFNBQVMsU0FBUyxjQUFULENBQXdCLHNCQUF4QixDQUFmO0FBQ0EsZUFBYyxPQUFkLENBQXNCLHdCQUFnQjtBQUNyQyxNQUFNLFNBQVMsU0FBUyxhQUFULENBQXVCLFFBQXZCLENBQWY7QUFDQSxTQUFPLFNBQVAsR0FBbUIsWUFBbkI7QUFDQSxTQUFPLEtBQVAsR0FBZSxZQUFmO0FBQ0EsU0FBTyxNQUFQLENBQWMsTUFBZDtBQUNBLEVBTEQ7QUFNQSxDQVJEOztBQVVBOzs7QUFHQSxlQUFlLFNBQWYsQ0FBeUIsYUFBekIsR0FBeUMsWUFBVztBQUNuRCxNQUFLLFdBQUwsQ0FBaUI7QUFDaEIsVUFBUSxlQURRO0FBRWhCLFNBQU87QUFGUyxFQUFqQjtBQUlBLENBTEQ7O0FBT0E7OztBQUdBLGVBQWUsU0FBZixDQUF5QixnQkFBekIsR0FBNEMsVUFBUyxRQUFULEVBQW1CO0FBQzlELEtBQU0sU0FBUyxTQUFTLGNBQVQsQ0FBd0IsaUJBQXhCLENBQWY7QUFDQSxVQUFTLE9BQVQsQ0FBaUIsbUJBQVc7QUFDM0IsTUFBTSxTQUFTLFNBQVMsYUFBVCxDQUF1QixRQUF2QixDQUFmO0FBQ0EsU0FBTyxTQUFQLEdBQW1CLE9BQW5CO0FBQ0EsU0FBTyxLQUFQLEdBQWUsT0FBZjtBQUNBLFNBQU8sTUFBUCxDQUFjLE1BQWQ7QUFDQSxFQUxEO0FBTUEsQ0FSRDs7QUFVQTs7O0FBR0EsZUFBZSxTQUFmLENBQXlCLGdCQUF6QixHQUE0QyxVQUFTLFdBQVQsRUFBc0I7QUFDakU7QUFDQSxLQUFNLEtBQUssU0FBUyxjQUFULENBQXdCLGtCQUF4QixDQUFYO0FBQ0EsSUFBRyxTQUFILEdBQWUsRUFBZjs7QUFFQTtBQUNBLE1BQUssT0FBTCxDQUFhLE9BQWIsQ0FBcUI7QUFBQSxTQUFLLEVBQUUsTUFBRixDQUFTLElBQVQsQ0FBTDtBQUFBLEVBQXJCO0FBQ0EsTUFBSyxPQUFMLEdBQWUsRUFBZjtBQUNBLENBUkQ7O0FBVUE7OztBQUdBLGVBQWUsU0FBZixDQUF5QixtQkFBekIsR0FBK0MsVUFBUyxXQUFULEVBQXNCO0FBQUE7O0FBQ3BFLEtBQU0sVUFBVSxTQUFWLE9BQVUsR0FBTTtBQUNyQixTQUFLLGdCQUFMO0FBQ0EsTUFBTSxLQUFLLFNBQVMsY0FBVCxDQUF3QixrQkFBeEIsQ0FBWDtBQUNBLGNBQVksT0FBWixDQUFvQixzQkFBYztBQUNqQyxNQUFHLE1BQUgsQ0FBVSxPQUFLLG9CQUFMLENBQTBCLFVBQTFCLENBQVY7QUFDQSxHQUZEOztBQUlBLGlCQUFLLGFBQUwsQ0FBbUIsZ0JBQW5CO0FBQ0EsTUFBRyxLQUFLLE9BQVIsRUFBaUIsT0FBSyxlQUFMLENBQXFCLFdBQXJCO0FBQ2pCLEVBVEQ7O0FBV0EsdUJBQXNCLE9BQXRCO0FBQ0EsQ0FiRDs7QUFlQTs7O0FBR0EsZUFBZSxTQUFmLENBQXlCLG9CQUF6QixHQUFnRCxVQUFTLFVBQVQsRUFBcUI7QUFBQTs7QUFFcEUsS0FBTSxLQUFLLFNBQVMsYUFBVCxDQUF1QixJQUF2QixDQUFYO0FBQ0EsSUFBRyxZQUFILENBQWdCLElBQWhCLGtCQUFvQyxXQUFXLEVBQS9DO0FBQ0EsSUFBRyxZQUFILENBQWdCLFlBQWhCLEVBQWlDLFdBQVcsSUFBNUMsV0FBc0QsV0FBVyxZQUFqRSxXQUFtRixXQUFXLE9BQTlGOztBQUVBLEtBQU0sUUFBUSxTQUFTLGFBQVQsQ0FBdUIsS0FBdkIsQ0FBZDtBQUNBLE9BQU0sU0FBTixHQUFrQiw4QkFBbEI7QUFDQSxPQUFNLFlBQU4sQ0FBbUIsVUFBbkIsRUFBK0IsZUFBSyxxQkFBTCxDQUEyQixVQUEzQixFQUF1QyxHQUF2QyxDQUEvQjtBQUNBLE9BQU0sR0FBTixHQUFlLFdBQVcsSUFBMUIsV0FBb0MsV0FBVyxZQUEvQzs7QUFFQSxJQUFHLE1BQUgsQ0FBVSxLQUFWOztBQUVBLEtBQU0sYUFBYSxTQUFTLGFBQVQsQ0FBdUIsS0FBdkIsQ0FBbkI7QUFDQSxZQUFXLEdBQVgsR0FBaUIsZ0JBQWpCO0FBQ0EsWUFBVyxZQUFYLENBQXdCLElBQXhCLGdCQUEwQyxXQUFXLEVBQXJEO0FBQ0EsWUFBVyxTQUFYLENBQXFCLEdBQXJCLENBQXlCLGVBQXpCLEVBQTBDLFFBQTFDO0FBQ0EsS0FBRyxXQUFXLFdBQVgsS0FBMkIsTUFBOUIsRUFBc0M7QUFDckMsYUFBVyxTQUFYLENBQXFCLE1BQXJCLENBQTRCLFFBQTVCO0FBQ0EsYUFBVyxTQUFYLENBQXFCLEdBQXJCLENBQXlCLFNBQXpCO0FBQ0E7QUFDRCxJQUFHLE1BQUgsQ0FBVSxVQUFWOztBQUVBLEtBQU0sT0FBTyxTQUFTLGFBQVQsQ0FBdUIsSUFBdkIsQ0FBYjtBQUNBLE1BQUssU0FBTCxHQUFpQixXQUFXLElBQTVCO0FBQ0EsSUFBRyxNQUFILENBQVUsSUFBVjs7QUFFQSxLQUFNLFVBQVUsU0FBUyxhQUFULENBQXVCLEdBQXZCLENBQWhCO0FBQ0EsU0FBUSxTQUFSLEdBQW9CLGNBQXBCO0FBQ0EsU0FBUSxTQUFSLEdBQW9CLFdBQVcsWUFBL0I7QUFDQSxJQUFHLE1BQUgsQ0FBVSxPQUFWOztBQUVBLEtBQU0sZUFBZSxTQUFTLGFBQVQsQ0FBdUIsR0FBdkIsQ0FBckI7QUFDQSxjQUFhLFNBQWIsR0FBeUIsV0FBVyxZQUFwQztBQUNBLElBQUcsTUFBSCxDQUFVLFlBQVY7O0FBRUEsS0FBTSxVQUFVLFNBQVMsYUFBVCxDQUF1QixHQUF2QixDQUFoQjtBQUNBLFNBQVEsU0FBUixHQUFvQixXQUFXLE9BQS9CO0FBQ0EsSUFBRyxNQUFILENBQVUsT0FBVjs7QUFHQSxLQUFNLE9BQU8sU0FBUyxhQUFULENBQXVCLEdBQXZCLENBQWI7QUFDQSxNQUFLLFNBQUwsR0FBaUIsY0FBakI7QUFDQSxNQUFLLFNBQUwsQ0FBZSxHQUFmLENBQW1CLGFBQW5CO0FBQ0EsTUFBSyxZQUFMLENBQWtCLE1BQWxCLEVBQTBCLFFBQTFCO0FBQ0EsTUFBSyxJQUFMLEdBQVksZUFBSyxnQkFBTCxDQUFzQixVQUF0QixDQUFaO0FBQ0EsSUFBRyxNQUFILENBQVUsSUFBVjs7QUFFQSxLQUFNLFdBQVcsU0FBUyxhQUFULENBQXVCLFFBQXZCLENBQWpCO0FBQ0EsVUFBUyxZQUFULENBQXNCLElBQXRCLHVCQUErQyxXQUFXLEVBQTFEO0FBQ0EsVUFBUyxTQUFULEdBQXFCLFdBQVcsV0FBWCxLQUEyQixNQUEzQixHQUFvQyx1QkFBcEMsR0FBOEQsa0JBQW5GO0FBQ0EsVUFBUyxTQUFULENBQW1CLEdBQW5CLENBQXVCLGFBQXZCO0FBQ0EsVUFBUyxnQkFBVCxDQUEwQixPQUExQixFQUFtQztBQUFBLFNBQU0sT0FBSyxjQUFMLENBQW9CLFVBQXBCLENBQU47QUFBQSxFQUFuQztBQUNBLElBQUcsTUFBSCxDQUFVLFFBQVY7O0FBRUEsUUFBTyxFQUFQO0FBQ0EsQ0F4REQ7O0FBMERBOzs7QUFHQSxlQUFlLFNBQWYsQ0FBeUIsZUFBekIsR0FBMkMsVUFBUyxXQUFULEVBQXNCO0FBQUE7O0FBQ2hFLEtBQUcsQ0FBQyxNQUFKLEVBQVk7QUFDWixhQUFZLE9BQVosQ0FBb0Isc0JBQWM7QUFDakMsTUFBTSxTQUFTLElBQUksT0FBTyxJQUFQLENBQVksTUFBaEIsQ0FBdUI7QUFDckMsYUFBVSxXQUFXLE1BRGdCO0FBRXJDLFVBQU8sV0FBVyxJQUZtQjtBQUdyQyxrQ0FBNkIsV0FBVyxFQUhIO0FBSXJDLFFBQUssS0FBSyxHQUoyQjtBQUtyQyxjQUFXLE9BQU8sSUFBUCxDQUFZLFNBQVosQ0FBc0IsSUFMSSxFQUF2QixDQUFmOztBQVFBLFNBQU8sSUFBUCxDQUFZLEtBQVosQ0FBa0IsV0FBbEIsQ0FBOEIsTUFBOUIsRUFBc0MsT0FBdEMsRUFBK0MsWUFBTTtBQUNwRCxVQUFPLFFBQVAsQ0FBZ0IsSUFBaEIsR0FBdUIsT0FBTyxHQUE5QjtBQUNBLEdBRkQ7QUFHQSxTQUFLLE9BQUwsQ0FBYSxJQUFiLENBQWtCLE1BQWxCO0FBQ0EsRUFiRDtBQWNBLENBaEJEOztBQWtCQSxlQUFlLFNBQWYsQ0FBeUIsY0FBekIsR0FBMEMsVUFBUyxVQUFULEVBQXFCO0FBQzlELE1BQUssV0FBTCxDQUFpQjtBQUNoQixVQUFRLGdCQURRO0FBRWhCLFNBQU8sRUFBQyxJQUFJLFdBQVcsRUFBaEI7QUFGUyxFQUFqQjtBQUlBLENBTEQ7O0FBUUEsU0FBUyxlQUFULEdBQTJCO0FBQzFCLEtBQUcsQ0FBQyxVQUFVLE1BQWQsRUFBc0IsWUFBWSxJQUFJLEtBQUosQ0FBVSxlQUFWLENBQVo7QUFDdEI7QUFDQSxLQUFNLGVBQWUsV0FBVyxZQUFNO0FBQ3JDO0FBQ0MsRUFGbUIsRUFFakIsS0FGaUIsQ0FBckI7QUFHQTs7QUFFRCxTQUFTLFdBQVQsQ0FBcUIsS0FBckIsRUFBNEI7QUFDM0IsdUJBQXNCO0FBQUEsU0FBTSxlQUFLLFFBQUwsQ0FBYyxTQUFTLGFBQVQsQ0FBdUIsV0FBdkIsQ0FBZCxFQUFtRCxNQUFNLE9BQXpELENBQU47QUFBQSxFQUF0QjtBQUNBOzs7Ozs7Ozs7Ozs7O0FDN1BEOzs7SUFHcUIsSTs7Ozs7Ozs7O0FBRXBCOzs7MkJBR2dCLEUsRUFBSSxPLEVBQTRCO0FBQUEsT0FBbkIsS0FBbUIsdUVBQVgsU0FBVzs7O0FBRS9DO0FBQ0E7QUFDQTs7QUFFQSxPQUFHLENBQUMsRUFBSixFQUFRO0FBQ1AsWUFBUSxHQUFSLENBQVksSUFBSSxLQUFKLENBQVUsNEJBQVYsQ0FBWjtBQUNBLFdBQU8sS0FBUDtBQUNBOztBQUVELE1BQUcsU0FBSCxHQUFlLE9BQWY7QUFDQSxNQUFHLFlBQUgsQ0FBZ0IsT0FBaEIsRUFBeUIsY0FBekI7QUFDQSxNQUFHLEtBQUgsQ0FBUyxVQUFULEdBQXNCLEtBQXRCO0FBQ0EsY0FBVyxZQUFNO0FBQUUsT0FBRyxlQUFILENBQW1CLE9BQW5CO0FBQTZCLElBQWhELEVBQWtELElBQWxEO0FBQ0E7O0FBR0Q7Ozs7OztnQ0FHcUIsTSxFQUFRO0FBQzVCLE9BQU0sT0FBTyxTQUFTLGdCQUFULENBQTBCLE1BQTFCLENBQWI7O0FBRUEsT0FBRyxDQUFDLE9BQU8sb0JBQVgsRUFBaUM7QUFDaEMsWUFBUSxHQUFSLENBQVksNEJBQVo7QUFDQSxTQUFLLE9BQUwsQ0FBYTtBQUFBLFlBQU8sS0FBSyxZQUFMLENBQWtCLEdBQWxCLENBQVA7QUFBQSxLQUFiO0FBQ0EsSUFIRCxNQUdPOztBQUVOLFFBQU0saUJBQWlCLFNBQWpCLGNBQWlCLENBQVUsT0FBVixFQUFtQixJQUFuQixFQUF5QjtBQUMvQyxhQUFRLE9BQVIsQ0FBZ0IsaUJBQVM7QUFDeEIsVUFBSSxNQUFNLGlCQUFOLEdBQTBCLENBQTlCLEVBQWlDO0FBQ2hDLFlBQUssU0FBTCxDQUFlLE1BQU0sTUFBckI7QUFDQSw2QkFBc0I7QUFBQSxlQUFNLEtBQUssWUFBTCxDQUFrQixNQUFNLE1BQXhCLENBQU47QUFBQSxRQUF0QjtBQUNBO0FBQ0EsTUFMRjtBQU1BLEtBUEQ7O0FBU0EsUUFBTSxjQUFjO0FBQ25CLGlCQUFZLFVBRE87QUFFbEIsZ0JBQVcsQ0FBQyxHQUFEO0FBRk8sS0FBcEI7O0FBS0EsUUFBTSxXQUFXLElBQUksb0JBQUosQ0FBeUIsY0FBekIsRUFBeUMsV0FBekMsQ0FBakI7QUFDQSxTQUFLLE9BQUwsQ0FBYTtBQUFBLFlBQVUsU0FBUyxPQUFULENBQWlCLE1BQWpCLENBQVY7QUFBQSxLQUFiO0FBQ0E7QUFDRDs7QUFFRDs7Ozs7OytCQUdvQixNLEVBQVE7QUFDM0IsT0FBRyxDQUFDLE9BQU8sUUFBUixLQUFxQixLQUF4QixFQUErQixPQUFPLEtBQVA7QUFDL0IsVUFBTyxZQUFQLENBQW9CLEtBQXBCLEVBQTJCLE9BQU8sWUFBUCxDQUFvQixVQUFwQixDQUEzQjtBQUNBLFdBQVEsR0FBUixDQUFZLGdCQUFaLEVBQTZCLE9BQU8sWUFBUCxDQUFvQixVQUFwQixDQUE3QjtBQUNBLFVBQU8sTUFBUDtBQUNBOztBQUdEOzs7Ozs7bUNBR3dCLFUsRUFBWTtBQUNuQyxvQ0FBZ0MsV0FBVyxFQUEzQztBQUNBOztBQUVEOzs7Ozs7d0NBRzZCLFUsRUFBWSxJLEVBQU07QUFDOUMsT0FBSSxNQUFNLFdBQVcsVUFBckI7QUFDQSxVQUFPLGdCQUFlLEdBQWYsU0FBc0IsSUFBdEIsWUFBb0MsaUNBQTNDO0FBQ0E7Ozs7OztrQkE3RW1CLEkiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJpbXBvcnQgTWFpbkNvbnRyb2xsZXIgZnJvbSAnLi9tYWluQ29udHJvbGxlcic7XG5cbnZhciBtYXA7XG5cbmV4cG9ydCBmdW5jdGlvbiBNYWluKCkge1xuXHR0aGlzLmNvbnRyb2xsZXIgPSBuZXcgTWFpbkNvbnRyb2xsZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2FwcC1tYWluJykpO1xuXHR0aGlzLmNvbnRyb2xsZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XG5cdHRoaXMuY29udHJvbGxlci5mZXRjaEN1aXNpbmVzKCk7XG5cblx0dGhpcy51cGRhdGVSZXN0YXVyYW50cygpO1xuXG5cdC8qKlxuXHQqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cblx0Ki9cblx0Ly8gd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoZSkgPT4ge1xuXHRcdGNvbnNvbGUubG9nKCdBbGwgcmVzb3VyY2VzIGZpbmlzaGVkIGxvYWRpbmchJyk7XG5cblx0XHQvLyBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcblx0XHQvLyBzY3JpcHQuc2V0QXR0cmlidXRlKCdhc3luYycsIHRydWUpO1xuXHRcdC8vIHNjcmlwdC5zZXRBdHRyaWJ1dGUoJ2RlZmVyJywgdHJ1ZSk7XG5cdFx0Ly8gc2NyaXB0LnNyYyA9ICdodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvanM/a2V5PUFJemFTeUNBR0k1eFE0UFhVcGk2SE5oTTdmd0lWelN6VFZWSno1RSZsaWJyYXJpZXM9cGxhY2VzJmNhbGxiYWNrPWluaXRNYXAnO1xuXHRcdC8vIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHAtbWFpbicpLmFwcGVuZENoaWxkKHNjcmlwdCk7XG5cblx0XHR3aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcblx0XHRcdGxldCBsb2MgPSB7IGxhdDogNDAuNzIyMjE2LCBsbmc6IC03My45ODc1MDEgfTtcblx0XHRcdHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcblx0XHRcdFx0em9vbTogMTIsXG5cdFx0XHRcdGNlbnRlcjogbG9jLFxuXHRcdFx0XHRzY3JvbGx3aGVlbDogZmFsc2Vcblx0XHRcdH0pO1xuXHRcdH07XG5cblx0Ly8gfSk7XG5cbn1cblxuTWFpbi5wcm90b3R5cGUudXBkYXRlUmVzdGF1cmFudHMgPSBmdW5jdGlvbigpIHtcblxuXHRjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuXHRjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XG5cblx0Y29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xuXHRjb25zdCBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XG5cblx0Y29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcblx0Y29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdFtuSW5kZXhdLnZhbHVlO1xuXG5cdHRoaXMuY29udHJvbGxlci5mZXRjaFJlc3RhdXJhbnRzKGN1aXNpbmUsIG5laWdoYm9yaG9vZCk7XG59O1xuXG53aW5kb3cubWFpbiA9IG5ldyBNYWluKCk7XG4iLCJpbXBvcnQgVXRpbCBmcm9tICcuL3V0aWwnO1xuXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIE1haW5Db250cm9sbGVyKGNvbnRhaW5lcikge1xuXHR0aGlzLm1hcmtlcnMgPSBbXTtcblx0dGhpcy5fY29udGFpbmVyID0gY29udGFpbmVyO1xuXHR0aGlzLl9yZWdpc3RlclNlcnZpY2VXb3JrZXIoKTtcblxuXHR0aGlzLmRhdGFXb3JrZXIgPSBuZXcgV29ya2VyKCcuL2pzL2RhdGFXb3JrZXIuanMnKTtcblxuXHRpZiAobmF2aWdhdG9yKSBjaGVja0Nvbm5lY3Rpb24oKTtcbn1cblxuTWFpbkNvbnRyb2xsZXIucHJvdG90eXBlLl9yZWdpc3RlclNlcnZpY2VXb3JrZXIgPSBmdW5jdGlvbigpIHtcblx0aWYgKG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XG5cdFx0aWYgKG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmNvbnRyb2xsZXIpIHJldHVybjtcblxuXHRcdG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvc3cuanMnLCB7c2NvcGU6ICcvJ30pLnRoZW4oKHN3UmVnKSA9PiB7XG5cdFx0XHRjb25zb2xlLmxvZygnXFxuU2VydmljZVdvcmtlciBzdWNjZXNzZnVsbHkgcmVnaXN0cmVkLiBTY29wZVxcbicsIHN3UmVnLnNjb3BlKTtcblx0XHR9KS5jYXRjaCgoZXJyKSA9PiB7XG5cdFx0XHRjb25zb2xlLmxvZygnXFxuU2VydmljZVdvcmtlciBzd1JlZyBmYWlsZWQgOihcXG4nLCBlcnIubWVzc2FnZSk7XG5cdFx0fSk7XG5cblx0fVxufTtcblxuXG5NYWluQ29udHJvbGxlci5wcm90b3R5cGUucG9zdE1lc3NhZ2UgPSBmdW5jdGlvbih7IGFjdGlvbiwgaW5wdXQgfSkge1xuXHR0aGlzLmRhdGFXb3JrZXIucG9zdE1lc3NhZ2UoeyBhY3Rpb24sIGlucHV0IH0pO1xuXHR0aGlzLmRhdGFXb3JrZXIub25tZXNzYWdlID0gKGV2ZW50KSA9PiB7XG5cblx0XHRpZighZXZlbnQuZGF0YSkgdGhyb3cgbmV3IEVycm9yKGBUaGVyZSBpcyBubyBkYXRhOiAke2V2ZW50fWApO1xuXG5cdFx0aWYoZXZlbnQuZGF0YS5hY3Rpb24gPT09ICdmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QnKSB7XG5cdFx0XHQvLyB0aGlzLnJlc2V0UmVzdGF1cmFudHMoKTtcblx0XHRcdHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmZpbGxSZXN0YXVyYW50c0hUTUwoZXZlbnQuZGF0YS5yZXN1bHQpKTtcblx0XHR9XG5cblx0XHRpZihldmVudC5kYXRhLmFjdGlvbiA9PT0gJ2ZldGNoTmVpZ2hib3Job29kcycpIHtcblx0XHRcdHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmZpbGxOZWlnaGJvcmhvb2RzSFRNTChldmVudC5kYXRhLnJlc3VsdCkpO1xuXHRcdH1cblxuXHRcdGlmKGV2ZW50LmRhdGEuYWN0aW9uID09PSAnZmV0Y2hDdWlzaW5lcycpIHtcblx0XHRcdHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmZpbGxDdWlzaW5lc0hUTUwoZXZlbnQuZGF0YS5yZXN1bHQpKTtcblx0XHR9XG5cblx0XHRpZihldmVudC5kYXRhLmFjdGlvbiA9PT0gJ3RvZ2dsZUZhdm9yaXRlJykge1xuXHRcdFx0Y29uc3QgcmVzdGF1cmFudCA9IGV2ZW50LmRhdGEucmVzdWx0O1xuXHRcdFx0Y29uc3QgZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjZmF2b3JpdGUtJHtyZXN0YXVyYW50LmlkfWApO1xuXHRcdFx0Y29uc3QgYnRuRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjZmF2b3JpdGUtYnV0dG9uLSR7cmVzdGF1cmFudC5pZH1gKTtcblx0XHRcdGlmKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09IFwidHJ1ZVwiKSB7XG5cdFx0XHRcdGVsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuXHRcdFx0XHRlbC5jbGFzc0xpc3QuYWRkKCd2aXNpYmxlJyk7XG5cdFx0XHRcdGJ0bkVsLmlubmVySFRNTCA9ICdSZW1vdmUgZnJvbSBmYXZvcml0ZXMnO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZWwuY2xhc3NMaXN0LnJlbW92ZSgndmlzaWJsZScpO1xuXHRcdFx0XHRlbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcblx0XHRcdFx0YnRuRWwuaW5uZXJIVE1MID0gJ0FkZCB0byBmYXZvcml0ZXMnO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcbn1cblxuXG5NYWluQ29udHJvbGxlci5wcm90b3R5cGUuZmV0Y2hSZXN0YXVyYW50cyA9IGZ1bmN0aW9uKGN1aXNpbmUsIG5laWdoYm9yaG9vZCkge1xuXHR0aGlzLnBvc3RNZXNzYWdlKHtcblx0XHRhY3Rpb246ICdmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QnLFxuXHRcdGlucHV0OiB7XG5cdFx0XHRjdWlzaW5lLFxuXHRcdFx0bmVpZ2hib3Job29kXG5cdFx0fVxuXHR9KTtcbn1cblxuXG4vKipcbiAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIGFuZCBzZXQgdGhlaXIgSFRNTC5cbiAqL1xuTWFpbkNvbnRyb2xsZXIucHJvdG90eXBlLmZldGNoTmVpZ2hib3Job29kcyA9IGZ1bmN0aW9uKCkge1xuXHR0aGlzLnBvc3RNZXNzYWdlKHtcblx0XHRhY3Rpb246ICdmZXRjaE5laWdoYm9yaG9vZHMnLFxuXHRcdGlucHV0OiBudWxsXG5cdH0pO1xufTtcblxuXG4vKipcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXG4gKi9cbk1haW5Db250cm9sbGVyLnByb3RvdHlwZS5maWxsTmVpZ2hib3Job29kc0hUTUwgPSBmdW5jdGlvbihuZWlnaGJvcmhvb2RzKSB7XG5cdGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuXHRuZWlnaGJvcmhvb2RzLmZvckVhY2gobmVpZ2hib3Job29kID0+IHtcblx0XHRjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcblx0XHRvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xuXHRcdG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcblx0XHRzZWxlY3QuYXBwZW5kKG9wdGlvbik7XG5cdH0pO1xufTtcblxuLyoqXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxuICovXG5NYWluQ29udHJvbGxlci5wcm90b3R5cGUuZmV0Y2hDdWlzaW5lcyA9IGZ1bmN0aW9uKCkge1xuXHR0aGlzLnBvc3RNZXNzYWdlKHtcblx0XHRhY3Rpb246ICdmZXRjaEN1aXNpbmVzJyxcblx0XHRpbnB1dDogbnVsbFxuXHR9KTtcbn07XG5cbi8qKlxuICogU2V0IGN1aXNpbmVzIEhUTUwuXG4gKi9cbk1haW5Db250cm9sbGVyLnByb3RvdHlwZS5maWxsQ3Vpc2luZXNIVE1MID0gZnVuY3Rpb24oY3Vpc2luZXMpIHtcblx0Y29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuXHRjdWlzaW5lcy5mb3JFYWNoKGN1aXNpbmUgPT4ge1xuXHRcdGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuXHRcdG9wdGlvbi5pbm5lckhUTUwgPSBjdWlzaW5lO1xuXHRcdG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XG5cdFx0c2VsZWN0LmFwcGVuZChvcHRpb24pO1xuXHR9KTtcbn07XG5cbi8qKlxuICogQ2xlYXIgY3VycmVudCByZXN0YXVyYW50cywgdGhlaXIgSFRNTCBhbmQgcmVtb3ZlIHRoZWlyIG1hcCBtYXJrZXJzLlxuICovXG5NYWluQ29udHJvbGxlci5wcm90b3R5cGUucmVzZXRSZXN0YXVyYW50cyA9IGZ1bmN0aW9uKHJlc3RhdXJhbnRzKSB7XG5cdC8vIFJlbW92ZSBhbGwgcmVzdGF1cmFudHNcblx0Y29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuXHR1bC5pbm5lckhUTUwgPSAnJztcblxuXHQvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXG5cdHRoaXMubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xuXHR0aGlzLm1hcmtlcnMgPSBbXTtcbn07XG5cbi8qKlxuICogQ3JlYXRlIGFsbCByZXN0YXVyYW50cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cbiAqL1xuTWFpbkNvbnRyb2xsZXIucHJvdG90eXBlLmZpbGxSZXN0YXVyYW50c0hUTUwgPSBmdW5jdGlvbihyZXN0YXVyYW50cykge1xuXHRjb25zdCBhbmltYXRlID0gKCkgPT4ge1xuXHRcdHRoaXMucmVzZXRSZXN0YXVyYW50cygpO1xuXHRcdGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcblx0XHRyZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xuXHRcdFx0dWwuYXBwZW5kKHRoaXMuY3JlYXRlUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCkpO1xuXHRcdH0pO1xuXG5cdFx0VXRpbC5pbWdMYXp5TG9hZGVyKCcuaW1nLWxhenktbG9hZCcpO1xuXHRcdGlmKHNlbGYuaW5pdE1hcCkgdGhpcy5hZGRNYXJrZXJzVG9NYXAocmVzdGF1cmFudHMpO1xuXHR9XG5cblx0cmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxuICovXG5NYWluQ29udHJvbGxlci5wcm90b3R5cGUuY3JlYXRlUmVzdGF1cmFudEhUTUwgPSBmdW5jdGlvbihyZXN0YXVyYW50KSB7XG5cblx0Y29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXHRsaS5zZXRBdHRyaWJ1dGUoJ2lkJywgYHJlc3RhdXJhbnQtJHtyZXN0YXVyYW50LmlkfWApO1xuXHRsaS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBgJHtyZXN0YXVyYW50Lm5hbWV9IC0gJHtyZXN0YXVyYW50LmN1aXNpbmVfdHlwZX0gLSAke3Jlc3RhdXJhbnQuYWRkcmVzc31gKTtcblxuXHRjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuXHRpbWFnZS5jbGFzc05hbWUgPSAnaW1nLWxhenktbG9hZCByZXN0YXVyYW50LWltZyc7XG5cdGltYWdlLnNldEF0dHJpYnV0ZSgnZGF0YS1zcmMnLCBVdGlsLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCA2MDApKTtcblx0aW1hZ2UuYWx0ID0gYCR7cmVzdGF1cmFudC5uYW1lfSAtICR7cmVzdGF1cmFudC5jdWlzaW5lX3R5cGV9IEN1aXNpbmVgO1xuXG5cdGxpLmFwcGVuZChpbWFnZSk7XG5cblx0Y29uc3QgaXNGYXZvcml0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuXHRpc0Zhdm9yaXRlLnNyYyA9ICcvaW1nL2hlYXJ0LnN2Zyc7XG5cdGlzRmF2b3JpdGUuc2V0QXR0cmlidXRlKCdpZCcsIGBmYXZvcml0ZS0ke3Jlc3RhdXJhbnQuaWR9YCk7XG5cdGlzRmF2b3JpdGUuY2xhc3NMaXN0LmFkZCgnZmF2b3JpdGUtaWNvbicsICdoaWRkZW4nKTtcblx0aWYocmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gXCJ0cnVlXCIpIHtcblx0XHRpc0Zhdm9yaXRlLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuXHRcdGlzRmF2b3JpdGUuY2xhc3NMaXN0LmFkZCgndmlzaWJsZScpO1xuXHR9XG5cdGxpLmFwcGVuZChpc0Zhdm9yaXRlKTtcblxuXHRjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcblx0bmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG5cdGxpLmFwcGVuZChuYW1lKTtcblxuXHRjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHRjdWlzaW5lLmNsYXNzTmFtZSA9ICdjdWlzaW5lLXR5cGUnO1xuXHRjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xuXHRsaS5hcHBlbmQoY3Vpc2luZSk7XG5cblx0Y29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHRuZWlnaGJvcmhvb2QuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uZWlnaGJvcmhvb2Q7XG5cdGxpLmFwcGVuZChuZWlnaGJvcmhvb2QpO1xuXG5cdGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG5cdGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xuXHRsaS5hcHBlbmQoYWRkcmVzcyk7XG5cblxuXHRjb25zdCBtb3JlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuXHRtb3JlLmlubmVySFRNTCA9ICdWaWV3IERldGFpbHMnO1xuXHRtb3JlLmNsYXNzTGlzdC5hZGQoJ2l0ZW0tYnV0dG9uJyk7XG5cdG1vcmUuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2J1dHRvbicpO1xuXHRtb3JlLmhyZWYgPSBVdGlsLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG5cdGxpLmFwcGVuZChtb3JlKTtcblxuXHRjb25zdCBmYXZvcml0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuXHRmYXZvcml0ZS5zZXRBdHRyaWJ1dGUoJ2lkJywgYGZhdm9yaXRlLWJ1dHRvbi0ke3Jlc3RhdXJhbnQuaWR9YCk7XG5cdGZhdm9yaXRlLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09IFwidHJ1ZVwiID8gJ1JlbW92ZSBmcm9tIGZhdm9yaXRlcycgOiAnQWRkIHRvIGZhdm9yaXRlcyc7XG5cdGZhdm9yaXRlLmNsYXNzTGlzdC5hZGQoJ2l0ZW0tYnV0dG9uJyk7XG5cdGZhdm9yaXRlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy50b2dnbGVGYXZvcml0ZShyZXN0YXVyYW50KSk7XG5cdGxpLmFwcGVuZChmYXZvcml0ZSk7XG5cblx0cmV0dXJuIGxpO1xufTtcblxuLyoqXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxuICovXG5NYWluQ29udHJvbGxlci5wcm90b3R5cGUuYWRkTWFya2Vyc1RvTWFwID0gZnVuY3Rpb24ocmVzdGF1cmFudHMpIHtcblx0aWYoIWdvb2dsZSkgcmV0dXJuO1xuXHRyZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xuXHRcdGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuXHRcdFx0cG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxuXHRcdFx0dGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcblx0XHRcdHVybDogYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gLFxuXHRcdFx0bWFwOiBzZWxmLm1hcCxcblx0XHRcdGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1B9XG5cdFx0KTtcblxuXHRcdGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgKCkgPT4ge1xuXHRcdFx0d2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsO1xuXHRcdH0pO1xuXHRcdHRoaXMubWFya2Vycy5wdXNoKG1hcmtlcik7XG5cdH0pO1xufTtcblxuTWFpbkNvbnRyb2xsZXIucHJvdG90eXBlLnRvZ2dsZUZhdm9yaXRlID0gZnVuY3Rpb24ocmVzdGF1cmFudCkge1xuXHR0aGlzLnBvc3RNZXNzYWdlKHtcblx0XHRhY3Rpb246ICd0b2dnbGVGYXZvcml0ZScsXG5cdFx0aW5wdXQ6IHtpZDogcmVzdGF1cmFudC5pZH1cblx0fSk7XG59XG5cblxuZnVuY3Rpb24gY2hlY2tDb25uZWN0aW9uKCkge1xuXHRpZighbmF2aWdhdG9yLm9uTGluZSkgaGFuZGxlRXJyb3IobmV3IEVycm9yKCdObyBDb25uZWN0aW9uJykpO1xuXHQvLyBjaGVjayBjb25uZXRpb24gZXZlcnkgNSBzZWNvbmRzXG5cdGNvbnN0IGNoZWNrVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdGNoZWNrQ29ubmVjdGlvbigpO1xuICB9LCAxMDAwMCk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUVycm9yKGVycm9yKSB7XG5cdHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiBVdGlsLnNuYWNrYmFyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzbmFja2JhcicpLCBlcnJvci5tZXNzYWdlKSk7XG59XG4iLCIvLyBVdGlsaXR5IGZ1bmN0aW9uc1xuXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFV0aWwge1xuXG5cdC8qKlxuXHQqXG5cdCovXG5cdHN0YXRpYyBzbmFja2JhcihlbCwgbWVzc2FnZSwgY29sb3IgPSAnI0Q5MDAxRicpIHtcblxuXHRcdC8vIFRPRE9cblx0XHQvLyBDcmVhdGUgYSBlbGVtZW50IGlmIHRoZSBzZWxlY3RlZCBlbGVtZW50IGRvZXMgbm90IGV4aXN0ZVxuXHRcdC8vIHZhciBuZXdEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG5cdFx0aWYoIWVsKSB7XG5cdFx0XHRjb25zb2xlLmxvZyhuZXcgRXJyb3IoJ1NuYWNrYmFyIGVsZW1lbnQgbm90IHZhbGlkJykpO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdGVsLmlubmVySFRNTCA9IG1lc3NhZ2U7XG5cdFx0ZWwuc2V0QXR0cmlidXRlKCdjbGFzcycsICdzaG93U25hY2tiYXInKTtcblx0XHRlbC5zdHlsZS5iYWNrZ3JvdW5kID0gY29sb3I7XG5cdFx0c2V0VGltZW91dCgoKSA9PiB7IGVsLnJlbW92ZUF0dHJpYnV0ZSgnY2xhc3MnKSB9LCA1NTAwKTtcblx0fVxuXG5cblx0LyoqXG5cdCpcblx0Ki9cblx0c3RhdGljIGltZ0xhenlMb2FkZXIodGFyZ2V0KSB7XG5cdFx0Y29uc3QgaW1ncyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGFyZ2V0KTtcblxuXHRcdGlmKCF3aW5kb3cuSW50ZXJzZWN0aW9uT2JzZXJ2ZXIpIHtcblx0XHRcdGNvbnNvbGUubG9nKCdObyBsYXp5IGxvYWRpbmcgZm9yIHlvdSA6KCcpO1xuXHRcdFx0aW1ncy5mb3JFYWNoKGltZyA9PiBVdGlsLnByZWxvYWRJbWFnZShpbWcpKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRjb25zdCBvbkludGVyc2VjdGlvbiA9IGZ1bmN0aW9uIChlbnRyaWVzLCBvYnNyKSB7XG5cdFx0XHRcdGVudHJpZXMuZm9yRWFjaChlbnRyeSA9PiB7XG5cdFx0XHRcdFx0aWYgKGVudHJ5LmludGVyc2VjdGlvblJhdGlvID4gMCkge1xuXHRcdFx0XHRcdFx0b2Jzci51bm9ic2VydmUoZW50cnkudGFyZ2V0KTtcblx0XHRcdFx0XHRcdHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiBVdGlsLnByZWxvYWRJbWFnZShlbnRyeS50YXJnZXQpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHQgIH0pO1xuXHRcdFx0fTtcblxuXHRcdFx0Y29uc3Qgb2Jzck9wdGlvbnMgPSB7XG5cdFx0XHRcdHJvb3RNYXJnaW46ICczMHB4IDBweCcsXG5cdCAgXHRcdHRocmVzaG9sZDogWzAuMV1cblx0XHRcdH1cblxuXHRcdFx0Y29uc3Qgb2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIob25JbnRlcnNlY3Rpb24sIG9ic3JPcHRpb25zKTtcblx0XHRcdGltZ3MuZm9yRWFjaCh0YXJnZXQgPT4gb2JzZXJ2ZXIub2JzZXJ2ZSh0YXJnZXQpKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0KlxuXHQqL1xuXHRzdGF0aWMgcHJlbG9hZEltYWdlKHRhcmdldCkge1xuXHRcdGlmKCF0YXJnZXQubm9kZU5hbWUgPT09ICdJTUcnKSByZXR1cm4gZmFsc2U7XG5cdFx0dGFyZ2V0LnNldEF0dHJpYnV0ZSgnc3JjJywgdGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1zcmMnKSk7XG5cdFx0Y29uc29sZS5sb2coJ0ltYWdlIGxvYWRlZDogJyx0YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXNyYycpKTtcblx0XHRyZXR1cm4gdGFyZ2V0O1xuXHR9XG5cblxuXHQvKipcblx0ICogUmVzdGF1cmFudCBwYWdlIFVSTC5cblx0ICovXG5cdHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcblx0XHRyZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XG5cdH1cblx0XG5cdC8qKlxuXHQgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cblx0ICovXG5cdHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2l6ZSkge1xuXHRcdGxldCBpbWcgPSByZXN0YXVyYW50LnBob3RvZ3JhcGg7XG5cdFx0cmV0dXJuIGltZyA/IChgL2ltZy8ke2ltZ30tJHtzaXplfS5qcGdgKSA6ICcvaW1nL3Jlc3RhdXJhbnRfcGxhY2Vob2xkZXIuc3ZnJztcblx0fVxuXG5cbn1cbiJdfQ==\n"]}