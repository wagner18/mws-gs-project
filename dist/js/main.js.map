{"version":3,"sources":["main.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Object","defineProperty","value","Main","obj","_mainController","_mainController2","__esModule","default","this","controller","document","querySelector","updateRestaurants","window","initMap","self","map","google","maps","Map","getElementById","zoom","center","lat","lng","scrollwheel","script","createElement","setAttribute","src","appendChild","prototype","cSelect","nSelect","cIndex","selectedIndex","nIndex","cuisine","neighborhood","fetchRestaurants","fetchNeighborhoods","fetchCuisines","main","./mainController","2","MainController","_util","_util2","container","markers","_container","_registerServiceWorker","dataWorker","Worker","navigator","checkConnection","onLine","error","requestAnimationFrame","snackbar","message","setTimeout","serviceWorker","register","scope","then","swReg","console","log","catch","err","postMessage","_ref","_this","action","input","onmessage","event","data","fillRestaurantsHTML","result","fillNeighborhoodsHTML","fillCuisinesHTML","restaurant","el","id","btnEl","is_favorite","classList","remove","add","innerHTML","resetRestaurants","restaurants","forEach","m","setMap","neighborhoods","select","option","append","cuisines","_this2","ul","createRestaurantHTML","imgLazyLoader","addMarkersToMap","_this3","li","name","cuisine_type","address","image","className","imageUrlForRestaurant","alt","isFavorite","more","href","urlForRestaurant","favorite","addEventListener","toggleFavorite","_this4","marker","Marker","position","latlng","title","url","animation","Animation","DROP","addListener","location","push","./util","3","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","Util","instance","TypeError","_classCallCheck","color","arguments","undefined","style","background","removeAttribute","imgs","querySelectorAll","IntersectionObserver","observer","entries","obsr","entry","intersectionRatio","unobserve","preloadImage","rootMargin","threshold","observe","img","nodeName","getAttribute","size","photograph"],"mappings":"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","file":"main.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nexports.Main = Main;\n\nvar _mainController = require('./mainController');\n\nvar _mainController2 = _interopRequireDefault(_mainController);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar map;\n\nfunction Main() {\n\n\tthis.controller = new _mainController2.default(document.querySelector('#app-main'));\n\tthis.updateRestaurants();\n\n\t/**\n * Initialize Google map, called from HTML.\n */\n\twindow.initMap = function () {\n\t\tvar loc = { lat: 40.722216, lng: -73.987501 };\n\t\tself.map = new google.maps.Map(document.getElementById('map'), {\n\t\t\tzoom: 12,\n\t\t\tcenter: loc,\n\t\t\tscrollwheel: false\n\t\t});\n\t};\n\n\tvar script = document.createElement('script');\n\tscript.setAttribute('async', true);\n\tscript.setAttribute('defer', true);\n\tscript.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyCAGI5xQ4PXUpi6HNhM7fwIVzSzTVVJz5E&libraries=places&callback=initMap';\n\tdocument.getElementById('app-main').appendChild(script);\n}\n\nMain.prototype.updateRestaurants = function () {\n\n\tvar cSelect = document.getElementById('cuisines-select');\n\tvar nSelect = document.getElementById('neighborhoods-select');\n\n\tvar cIndex = cSelect.selectedIndex;\n\tvar nIndex = nSelect.selectedIndex;\n\n\tvar cuisine = cSelect[cIndex].value;\n\tvar neighborhood = nSelect[nIndex].value;\n\n\tthis.controller.fetchRestaurants(cuisine, neighborhood);\n\tthis.controller.fetchNeighborhoods();\n\tthis.controller.fetchCuisines();\n};\n\nwindow.main = new Main();\n\n},{\"./mainController\":2}],2:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nexports.default = MainController;\n\nvar _util = require('./util');\n\nvar _util2 = _interopRequireDefault(_util);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction MainController(container) {\n\tthis.markers = [];\n\tthis._container = container;\n\tthis._registerServiceWorker();\n\n\tthis.dataWorker = new Worker('./js/dataWorker.js');\n\n\tif (navigator) checkConnection();\n}\n\nMainController.prototype._registerServiceWorker = function () {\n\tif (navigator.serviceWorker) {\n\t\tif (navigator.serviceWorker.controller) return;\n\n\t\tnavigator.serviceWorker.register('/sw.js', { scope: '/' }).then(function (swReg) {\n\t\t\tconsole.log('\\nServiceWorker successfully registred. Scope\\n', swReg.scope);\n\t\t}).catch(function (err) {\n\t\t\tconsole.log('\\nServiceWorker swReg failed :(\\n', err.message);\n\t\t});\n\t}\n};\n\nMainController.prototype.postMessage = function (_ref) {\n\tvar _this = this;\n\n\tvar action = _ref.action,\n\t    input = _ref.input;\n\n\tthis.dataWorker.postMessage({ action: action, input: input });\n\tthis.dataWorker.onmessage = function (event) {\n\n\t\tif (!event.data) throw new Error('There is no data: ' + event);\n\n\t\tif (event.data.action === 'fetchRestaurantByCuisineAndNeighborhood') {\n\t\t\t// this.resetRestaurants();\n\t\t\trequestAnimationFrame(function () {\n\t\t\t\treturn _this.fillRestaurantsHTML(event.data.result);\n\t\t\t});\n\t\t}\n\n\t\tif (event.data.action === 'fetchNeighborhoods') {\n\t\t\trequestAnimationFrame(function () {\n\t\t\t\treturn _this.fillNeighborhoodsHTML(event.data.result);\n\t\t\t});\n\t\t}\n\n\t\tif (event.data.action === 'fetchCuisines') {\n\t\t\trequestAnimationFrame(function () {\n\t\t\t\treturn _this.fillCuisinesHTML(event.data.result);\n\t\t\t});\n\t\t}\n\n\t\tif (event.data.action === 'toggleFavorite') {\n\t\t\tvar restaurant = event.data.result;\n\t\t\tvar el = document.querySelector('#favorite-' + restaurant.id);\n\t\t\tvar btnEl = document.querySelector('#favorite-button-' + restaurant.id);\n\t\t\tif (restaurant.is_favorite === \"true\") {\n\t\t\t\tel.classList.remove('hidden');\n\t\t\t\tel.classList.add('visible');\n\t\t\t\tbtnEl.innerHTML = 'Remove from favorites';\n\t\t\t} else {\n\t\t\t\tel.classList.remove('visible');\n\t\t\t\tel.classList.add('hidden');\n\t\t\t\tbtnEl.innerHTML = 'Add to favorites';\n\t\t\t}\n\t\t}\n\t};\n};\n\nMainController.prototype.fetchRestaurants = function (cuisine, neighborhood) {\n\tthis.postMessage({\n\t\taction: 'fetchRestaurantByCuisineAndNeighborhood',\n\t\tinput: {\n\t\t\tcuisine: cuisine,\n\t\t\tneighborhood: neighborhood\n\t\t}\n\t});\n};\n\n/**\n * Fetch all neighborhoods and set their HTML.\n */\nMainController.prototype.fetchNeighborhoods = function () {\n\tthis.postMessage({\n\t\taction: 'fetchNeighborhoods',\n\t\tinput: null\n\t});\n};\n\n/**\n * Fetch all cuisines and set their HTML.\n */\nMainController.prototype.fetchCuisines = function () {\n\tthis.postMessage({\n\t\taction: 'fetchCuisines',\n\t\tinput: null\n\t});\n};\n\n/**\n * Clear current restaurants, their HTML and remove their map markers.\n */\nMainController.prototype.resetRestaurants = function (restaurants) {\n\t// Remove all restaurants\n\tvar ul = document.getElementById('restaurants-list');\n\tul.innerHTML = '';\n\n\t// Remove all map markers\n\tthis.markers.forEach(function (m) {\n\t\treturn m.setMap(null);\n\t});\n\tthis.markers = [];\n};\n\n/**\n * Set neighborhoods HTML.\n */\nMainController.prototype.fillNeighborhoodsHTML = function (neighborhoods) {\n\tvar select = document.getElementById('neighborhoods-select');\n\tneighborhoods.forEach(function (neighborhood) {\n\t\tvar option = document.createElement('option');\n\t\toption.innerHTML = neighborhood;\n\t\toption.value = neighborhood;\n\t\tselect.append(option);\n\t});\n};\n\n/**\n * Set cuisines HTML.\n */\nMainController.prototype.fillCuisinesHTML = function (cuisines) {\n\tvar select = document.getElementById('cuisines-select');\n\tcuisines.forEach(function (cuisine) {\n\t\tvar option = document.createElement('option');\n\t\toption.innerHTML = cuisine;\n\t\toption.value = cuisine;\n\t\tselect.append(option);\n\t});\n};\n\n/**\n * Create all restaurants HTML and add them to the webpage.\n */\nMainController.prototype.fillRestaurantsHTML = function (restaurants) {\n\tvar _this2 = this;\n\n\tvar animate = function animate() {\n\t\t_this2.resetRestaurants();\n\t\tvar ul = document.getElementById('restaurants-list');\n\t\trestaurants.forEach(function (restaurant) {\n\t\t\tul.append(_this2.createRestaurantHTML(restaurant));\n\t\t});\n\n\t\t_util2.default.imgLazyLoader('.img-lazy-load');\n\t\tif (self.initMap) _this2.addMarkersToMap(restaurants);\n\t};\n\n\trequestAnimationFrame(animate);\n};\n\n/**\n * Create restaurant HTML.\n */\nMainController.prototype.createRestaurantHTML = function (restaurant) {\n\tvar _this3 = this;\n\n\tvar li = document.createElement('li');\n\tli.setAttribute('id', 'restaurant-' + restaurant.id);\n\tli.setAttribute('aria-label', restaurant.name + ' - ' + restaurant.cuisine_type + ' - ' + restaurant.address);\n\n\tvar image = document.createElement('img');\n\timage.className = 'img-lazy-load restaurant-img';\n\timage.setAttribute('data-src', _util2.default.imageUrlForRestaurant(restaurant, 600));\n\timage.alt = restaurant.name + ' - ' + restaurant.cuisine_type + ' Cuisine';\n\n\tli.append(image);\n\n\tvar isFavorite = document.createElement('img');\n\tisFavorite.src = '/img/heart.svg';\n\tisFavorite.setAttribute('id', 'favorite-' + restaurant.id);\n\tisFavorite.classList.add('favorite-icon', 'hidden');\n\tif (restaurant.is_favorite === \"true\") {\n\t\tisFavorite.classList.remove('hidden');\n\t\tisFavorite.classList.add('visible');\n\t}\n\tli.append(isFavorite);\n\n\tvar name = document.createElement('h2');\n\tname.innerHTML = restaurant.name;\n\tli.append(name);\n\n\tvar cuisine = document.createElement('p');\n\tcuisine.className = 'cuisine-type';\n\tcuisine.innerHTML = restaurant.cuisine_type;\n\tli.append(cuisine);\n\n\tvar neighborhood = document.createElement('p');\n\tneighborhood.innerHTML = restaurant.neighborhood;\n\tli.append(neighborhood);\n\n\tvar address = document.createElement('p');\n\taddress.innerHTML = restaurant.address;\n\tli.append(address);\n\n\tvar more = document.createElement('a');\n\tmore.innerHTML = 'View Details';\n\tmore.classList.add('item-button');\n\tmore.setAttribute('role', 'button');\n\tmore.href = _util2.default.urlForRestaurant(restaurant);\n\tli.append(more);\n\n\tvar favorite = document.createElement('button');\n\tfavorite.setAttribute('id', 'favorite-button-' + restaurant.id);\n\tfavorite.innerHTML = restaurant.is_favorite === \"true\" ? 'Remove from favorites' : 'Add to favorites';\n\tfavorite.classList.add('item-button');\n\tfavorite.addEventListener('click', function () {\n\t\treturn _this3.toggleFavorite(restaurant);\n\t});\n\tli.append(favorite);\n\n\treturn li;\n};\n\n/**\n * Add markers for current restaurants to the map.\n */\nMainController.prototype.addMarkersToMap = function (restaurants) {\n\tvar _this4 = this;\n\n\tif (!google) return;\n\trestaurants.forEach(function (restaurant) {\n\t\tvar marker = new google.maps.Marker({\n\t\t\tposition: restaurant.latlng,\n\t\t\ttitle: restaurant.name,\n\t\t\turl: './restaurant.html?id=' + restaurant.id,\n\t\t\tmap: self.map,\n\t\t\tanimation: google.maps.Animation.DROP });\n\n\t\tgoogle.maps.event.addListener(marker, 'click', function () {\n\t\t\twindow.location.href = marker.url;\n\t\t});\n\t\t_this4.markers.push(marker);\n\t});\n};\n\nMainController.prototype.toggleFavorite = function (restaurant) {\n\tthis.postMessage({\n\t\taction: 'toggleFavorite',\n\t\tinput: { id: restaurant.id }\n\t});\n};\n\nfunction checkConnection() {\n\tif (!navigator.onLine) handleError(new Error('No Connection'));\n\t// check connetion every 5 seconds\n\tvar checkTimeout = setTimeout(function () {\n\t\tcheckConnection();\n\t}, 10000);\n}\n\nfunction handleError(error) {\n\trequestAnimationFrame(function () {\n\t\treturn _util2.default.snackbar(document.querySelector('#snackbar'), error.message);\n\t});\n}\n\n},{\"./util\":3}],3:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n// Utility functions\n\n\nvar Util = function () {\n\tfunction Util() {\n\t\t_classCallCheck(this, Util);\n\t}\n\n\t_createClass(Util, null, [{\n\t\tkey: 'snackbar',\n\n\n\t\t/**\n  *\n  */\n\t\tvalue: function snackbar(el, message) {\n\t\t\tvar color = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '#D9001F';\n\n\n\t\t\t// TODO\n\t\t\t// Create a element if the selected element does not existe\n\t\t\t// var newDiv = document.createElement(\"div\");\n\n\t\t\tif (!el) {\n\t\t\t\tconsole.log(new Error('Snackbar element not valid'));\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tel.innerHTML = message;\n\t\t\tel.setAttribute('class', 'showSnackbar');\n\t\t\tel.style.background = color;\n\t\t\tsetTimeout(function () {\n\t\t\t\tel.removeAttribute('class');\n\t\t\t}, 5500);\n\t\t}\n\n\t\t/**\n  *\n  */\n\n\t}, {\n\t\tkey: 'imgLazyLoader',\n\t\tvalue: function imgLazyLoader(target) {\n\t\t\tvar imgs = document.querySelectorAll(target);\n\n\t\t\tif (!window.IntersectionObserver) {\n\t\t\t\tconsole.log('No lazy loading for you :(');\n\t\t\t\timgs.forEach(function (img) {\n\t\t\t\t\treturn Util.preloadImage(img);\n\t\t\t\t});\n\t\t\t} else {\n\n\t\t\t\tvar onIntersection = function onIntersection(entries, obsr) {\n\t\t\t\t\tentries.forEach(function (entry) {\n\t\t\t\t\t\tif (entry.intersectionRatio > 0) {\n\t\t\t\t\t\t\tobsr.unobserve(entry.target);\n\t\t\t\t\t\t\trequestAnimationFrame(function () {\n\t\t\t\t\t\t\t\treturn Util.preloadImage(entry.target);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\tvar obsrOptions = {\n\t\t\t\t\trootMargin: '30px 0px',\n\t\t\t\t\tthreshold: [0.1]\n\t\t\t\t};\n\n\t\t\t\tvar observer = new IntersectionObserver(onIntersection, obsrOptions);\n\t\t\t\timgs.forEach(function (target) {\n\t\t\t\t\treturn observer.observe(target);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n  *\n  */\n\n\t}, {\n\t\tkey: 'preloadImage',\n\t\tvalue: function preloadImage(target) {\n\t\t\tif (!target.nodeName === 'IMG') return false;\n\t\t\ttarget.setAttribute('src', target.getAttribute('data-src'));\n\t\t\tconsole.log('Image loaded: ', target.getAttribute('data-src'));\n\t\t\treturn target;\n\t\t}\n\n\t\t/**\n   * Restaurant page URL.\n   */\n\n\t}, {\n\t\tkey: 'urlForRestaurant',\n\t\tvalue: function urlForRestaurant(restaurant) {\n\t\t\treturn './restaurant.html?id=' + restaurant.id;\n\t\t}\n\n\t\t/**\n   * Restaurant image URL.\n   */\n\n\t}, {\n\t\tkey: 'imageUrlForRestaurant',\n\t\tvalue: function imageUrlForRestaurant(restaurant, size) {\n\t\t\tvar img = restaurant.photograph;\n\t\t\treturn img ? '/img/' + img + '-' + size + '.jpg' : '/img/restaurant_placeholder.svg';\n\t\t}\n\t}]);\n\n\treturn Util;\n}();\n\nexports.default = Util;\n\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9tYWluLmpzIiwianMvbWFpbkNvbnRyb2xsZXIuanMiLCJqcy91dGlsLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7UUNJZ0IsSSxHQUFBLEk7O0FBSmhCOzs7Ozs7QUFFQSxJQUFJLEdBQUo7O0FBRU8sU0FBUyxJQUFULEdBQWdCOztBQUV0QixNQUFLLFVBQUwsR0FBa0IsSUFBSSx3QkFBSixDQUFtQixTQUFTLGFBQVQsQ0FBdUIsV0FBdkIsQ0FBbkIsQ0FBbEI7QUFDQSxNQUFLLGlCQUFMOztBQUVBOzs7QUFHQSxRQUFPLE9BQVAsR0FBaUIsWUFBTTtBQUN0QixNQUFJLE1BQU0sRUFBRSxLQUFLLFNBQVAsRUFBa0IsS0FBSyxDQUFDLFNBQXhCLEVBQVY7QUFDQSxPQUFLLEdBQUwsR0FBVyxJQUFJLE9BQU8sSUFBUCxDQUFZLEdBQWhCLENBQW9CLFNBQVMsY0FBVCxDQUF3QixLQUF4QixDQUFwQixFQUFvRDtBQUM5RCxTQUFNLEVBRHdEO0FBRTlELFdBQVEsR0FGc0Q7QUFHOUQsZ0JBQWE7QUFIaUQsR0FBcEQsQ0FBWDtBQUtBLEVBUEQ7O0FBU0EsS0FBTSxTQUFTLFNBQVMsYUFBVCxDQUF1QixRQUF2QixDQUFmO0FBQ0EsUUFBTyxZQUFQLENBQW9CLE9BQXBCLEVBQTZCLElBQTdCO0FBQ0EsUUFBTyxZQUFQLENBQW9CLE9BQXBCLEVBQTZCLElBQTdCO0FBQ0EsUUFBTyxHQUFQLEdBQWEsdUhBQWI7QUFDQSxVQUFTLGNBQVQsQ0FBd0IsVUFBeEIsRUFBb0MsV0FBcEMsQ0FBZ0QsTUFBaEQ7QUFFQTs7QUFFRCxLQUFLLFNBQUwsQ0FBZSxpQkFBZixHQUFtQyxZQUFXOztBQUU3QyxLQUFNLFVBQVUsU0FBUyxjQUFULENBQXdCLGlCQUF4QixDQUFoQjtBQUNBLEtBQU0sVUFBVSxTQUFTLGNBQVQsQ0FBd0Isc0JBQXhCLENBQWhCOztBQUVBLEtBQU0sU0FBUyxR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QWpCLENBQVY7QUFBQSxLQUFiO0FBQ0E7QUFDRDs7QUFFRDs7Ozs7OytCQUdvQixNLEVBQVE7QUFDM0IsT0FBRyxDQUFDLE9BQU8sUUFBUixLQUFxQixLQUF4QixFQUErQixPQUFPLEtBQVA7QUFDL0IsVUFBTyxZQUFQLENBQW9CLEtBQXBCLEVBQTJCLE9BQU8sWUFBUCxDQUFvQixVQUFwQixDQUEzQjtBQUNBLFdBQVEsR0FBUixDQUFZLGdCQUFaLEVBQTZCLE9BQU8sWUFBUCxDQUFvQixVQUFwQixDQUE3QjtBQUNBLFVBQU8sTUFBUDtBQUNBOztBQUdEOzs7Ozs7bUNBR3dCLFUsRUFBWTtBQUNuQyxvQ0FBZ0MsV0FBVyxFQUEzQztBQUNBOztBQUVEOzs7Ozs7d0NBRzZCLFUsRUFBWSxJLEVBQU07QUFDOUMsT0FBSSxNQUFNLFdBQVcsVUFBckI7QUFDQSxVQUFPLGdCQUFlLEdBQWYsU0FBc0IsSUFBdEIsWUFBb0MsaUNBQTNDO0FBQ0E7Ozs7OztrQkE3RW1CLEkiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJpbXBvcnQgTWFpbkNvbnRyb2xsZXIgZnJvbSAnLi9tYWluQ29udHJvbGxlcic7XG5cbnZhciBtYXA7XG5cbmV4cG9ydCBmdW5jdGlvbiBNYWluKCkge1xuXG5cdHRoaXMuY29udHJvbGxlciA9IG5ldyBNYWluQ29udHJvbGxlcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjYXBwLW1haW4nKSk7XG5cdHRoaXMudXBkYXRlUmVzdGF1cmFudHMoKTtcblxuXHQvKipcblx0KiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG5cdCovXG5cdHdpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuXHRcdGxldCBsb2MgPSB7IGxhdDogNDAuNzIyMjE2LCBsbmc6IC03My45ODc1MDEgfTtcblx0XHRzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XG5cdFx0XHR6b29tOiAxMixcblx0XHRcdGNlbnRlcjogbG9jLFxuXHRcdFx0c2Nyb2xsd2hlZWw6IGZhbHNlXG5cdFx0fSk7XG5cdH07XG5cblx0Y29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG5cdHNjcmlwdC5zZXRBdHRyaWJ1dGUoJ2FzeW5jJywgdHJ1ZSk7XG5cdHNjcmlwdC5zZXRBdHRyaWJ1dGUoJ2RlZmVyJywgdHJ1ZSk7XG5cdHNjcmlwdC5zcmMgPSAnaHR0cHM6Ly9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL2pzP2tleT1BSXphU3lDQUdJNXhRNFBYVXBpNkhOaE03ZndJVnpTelRWVkp6NUUmbGlicmFyaWVzPXBsYWNlcyZjYWxsYmFjaz1pbml0TWFwJztcblx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwcC1tYWluJykuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcblxufVxuXG5NYWluLnByb3RvdHlwZS51cGRhdGVSZXN0YXVyYW50cyA9IGZ1bmN0aW9uKCkge1xuXG5cdGNvbnN0IGNTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XG5cdGNvbnN0IG5TZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcblxuXHRjb25zdCBjSW5kZXggPSBjU2VsZWN0LnNlbGVjdGVkSW5kZXg7XG5cdGNvbnN0IG5JbmRleCA9IG5TZWxlY3Quc2VsZWN0ZWRJbmRleDtcblxuXHRjb25zdCBjdWlzaW5lID0gY1NlbGVjdFtjSW5kZXhdLnZhbHVlO1xuXHRjb25zdCBuZWlnaGJvcmhvb2QgPSBuU2VsZWN0W25JbmRleF0udmFsdWU7XG5cblx0dGhpcy5jb250cm9sbGVyLmZldGNoUmVzdGF1cmFudHMoY3Vpc2luZSwgbmVpZ2hib3Job29kKTtcblx0dGhpcy5jb250cm9sbGVyLmZldGNoTmVpZ2hib3Job29kcygpO1xuXHR0aGlzLmNvbnRyb2xsZXIuZmV0Y2hDdWlzaW5lcygpO1xuXG59O1xuXG53aW5kb3cubWFpbiA9IG5ldyBNYWluKCk7XG4iLCJpbXBvcnQgVXRpbCBmcm9tICcuL3V0aWwnO1xuXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIE1haW5Db250cm9sbGVyKGNvbnRhaW5lcikge1xuXHR0aGlzLm1hcmtlcnMgPSBbXTtcblx0dGhpcy5fY29udGFpbmVyID0gY29udGFpbmVyO1xuXHR0aGlzLl9yZWdpc3RlclNlcnZpY2VXb3JrZXIoKTtcblxuXHR0aGlzLmRhdGFXb3JrZXIgPSBuZXcgV29ya2VyKCcuL2pzL2RhdGFXb3JrZXIuanMnKTtcblxuXHRpZiAobmF2aWdhdG9yKSBjaGVja0Nvbm5lY3Rpb24oKTtcbn1cblxuTWFpbkNvbnRyb2xsZXIucHJvdG90eXBlLl9yZWdpc3RlclNlcnZpY2VXb3JrZXIgPSBmdW5jdGlvbigpIHtcblx0aWYgKG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XG5cdFx0aWYgKG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmNvbnRyb2xsZXIpIHJldHVybjtcblxuXHRcdG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvc3cuanMnLCB7c2NvcGU6ICcvJ30pLnRoZW4oKHN3UmVnKSA9PiB7XG5cdFx0XHRjb25zb2xlLmxvZygnXFxuU2VydmljZVdvcmtlciBzdWNjZXNzZnVsbHkgcmVnaXN0cmVkLiBTY29wZVxcbicsIHN3UmVnLnNjb3BlKTtcblx0XHR9KS5jYXRjaCgoZXJyKSA9PiB7XG5cdFx0XHRjb25zb2xlLmxvZygnXFxuU2VydmljZVdvcmtlciBzd1JlZyBmYWlsZWQgOihcXG4nLCBlcnIubWVzc2FnZSk7XG5cdFx0fSk7XG5cblx0fVxufTtcblxuXG5NYWluQ29udHJvbGxlci5wcm90b3R5cGUucG9zdE1lc3NhZ2UgPSBmdW5jdGlvbih7IGFjdGlvbiwgaW5wdXQgfSkge1xuXHR0aGlzLmRhdGFXb3JrZXIucG9zdE1lc3NhZ2UoeyBhY3Rpb24sIGlucHV0IH0pO1xuXHR0aGlzLmRhdGFXb3JrZXIub25tZXNzYWdlID0gKGV2ZW50KSA9PiB7XG5cblx0XHRpZighZXZlbnQuZGF0YSkgdGhyb3cgbmV3IEVycm9yKGBUaGVyZSBpcyBubyBkYXRhOiAke2V2ZW50fWApO1xuXG5cdFx0aWYoZXZlbnQuZGF0YS5hY3Rpb24gPT09ICdmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QnKSB7XG5cdFx0XHQvLyB0aGlzLnJlc2V0UmVzdGF1cmFudHMoKTtcblx0XHRcdHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmZpbGxSZXN0YXVyYW50c0hUTUwoZXZlbnQuZGF0YS5yZXN1bHQpKTtcblx0XHR9XG5cblx0XHRpZihldmVudC5kYXRhLmFjdGlvbiA9PT0gJ2ZldGNoTmVpZ2hib3Job29kcycpIHtcblx0XHRcdHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmZpbGxOZWlnaGJvcmhvb2RzSFRNTChldmVudC5kYXRhLnJlc3VsdCkpO1xuXHRcdH1cblxuXHRcdGlmKGV2ZW50LmRhdGEuYWN0aW9uID09PSAnZmV0Y2hDdWlzaW5lcycpIHtcblx0XHRcdHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmZpbGxDdWlzaW5lc0hUTUwoZXZlbnQuZGF0YS5yZXN1bHQpKTtcblx0XHR9XG5cblx0XHRpZihldmVudC5kYXRhLmFjdGlvbiA9PT0gJ3RvZ2dsZUZhdm9yaXRlJykge1xuXHRcdFx0Y29uc3QgcmVzdGF1cmFudCA9IGV2ZW50LmRhdGEucmVzdWx0O1xuXHRcdFx0Y29uc3QgZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjZmF2b3JpdGUtJHtyZXN0YXVyYW50LmlkfWApO1xuXHRcdFx0Y29uc3QgYnRuRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjZmF2b3JpdGUtYnV0dG9uLSR7cmVzdGF1cmFudC5pZH1gKTtcblx0XHRcdGlmKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09IFwidHJ1ZVwiKSB7XG5cdFx0XHRcdGVsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuXHRcdFx0XHRlbC5jbGFzc0xpc3QuYWRkKCd2aXNpYmxlJyk7XG5cdFx0XHRcdGJ0bkVsLmlubmVySFRNTCA9ICdSZW1vdmUgZnJvbSBmYXZvcml0ZXMnO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZWwuY2xhc3NMaXN0LnJlbW92ZSgndmlzaWJsZScpO1xuXHRcdFx0XHRlbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcblx0XHRcdFx0YnRuRWwuaW5uZXJIVE1MID0gJ0FkZCB0byBmYXZvcml0ZXMnO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcbn1cblxuXG5NYWluQ29udHJvbGxlci5wcm90b3R5cGUuZmV0Y2hSZXN0YXVyYW50cyA9IGZ1bmN0aW9uKGN1aXNpbmUsIG5laWdoYm9yaG9vZCkge1xuXHR0aGlzLnBvc3RNZXNzYWdlKHtcblx0XHRhY3Rpb246ICdmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QnLFxuXHRcdGlucHV0OiB7XG5cdFx0XHRjdWlzaW5lLFxuXHRcdFx0bmVpZ2hib3Job29kXG5cdFx0fVxuXHR9KTtcbn1cblxuXG4vKipcbiAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIGFuZCBzZXQgdGhlaXIgSFRNTC5cbiAqL1xuTWFpbkNvbnRyb2xsZXIucHJvdG90eXBlLmZldGNoTmVpZ2hib3Job29kcyA9IGZ1bmN0aW9uKCkge1xuXHR0aGlzLnBvc3RNZXNzYWdlKHtcblx0XHRhY3Rpb246ICdmZXRjaE5laWdoYm9yaG9vZHMnLFxuXHRcdGlucHV0OiBudWxsXG5cdH0pO1xufTtcblxuLyoqXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxuICovXG5NYWluQ29udHJvbGxlci5wcm90b3R5cGUuZmV0Y2hDdWlzaW5lcyA9IGZ1bmN0aW9uKCkge1xuXHR0aGlzLnBvc3RNZXNzYWdlKHtcblx0XHRhY3Rpb246ICdmZXRjaEN1aXNpbmVzJyxcblx0XHRpbnB1dDogbnVsbFxuXHR9KTtcbn07XG5cbi8qKlxuICogQ2xlYXIgY3VycmVudCByZXN0YXVyYW50cywgdGhlaXIgSFRNTCBhbmQgcmVtb3ZlIHRoZWlyIG1hcCBtYXJrZXJzLlxuICovXG5NYWluQ29udHJvbGxlci5wcm90b3R5cGUucmVzZXRSZXN0YXVyYW50cyA9IGZ1bmN0aW9uKHJlc3RhdXJhbnRzKSB7XG5cdC8vIFJlbW92ZSBhbGwgcmVzdGF1cmFudHNcblx0Y29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuXHR1bC5pbm5lckhUTUwgPSAnJztcblxuXHQvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXG5cdHRoaXMubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xuXHR0aGlzLm1hcmtlcnMgPSBbXTtcbn07XG5cblxuLyoqXG4gKiBTZXQgbmVpZ2hib3Job29kcyBIVE1MLlxuICovXG5NYWluQ29udHJvbGxlci5wcm90b3R5cGUuZmlsbE5laWdoYm9yaG9vZHNIVE1MID0gZnVuY3Rpb24obmVpZ2hib3Job29kcykge1xuXHRjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcblx0bmVpZ2hib3Job29kcy5mb3JFYWNoKG5laWdoYm9yaG9vZCA9PiB7XG5cdFx0Y29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG5cdFx0b3B0aW9uLmlubmVySFRNTCA9IG5laWdoYm9yaG9vZDtcblx0XHRvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XG5cdFx0c2VsZWN0LmFwcGVuZChvcHRpb24pO1xuXHR9KTtcbn07XG5cblxuLyoqXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cbiAqL1xuTWFpbkNvbnRyb2xsZXIucHJvdG90eXBlLmZpbGxDdWlzaW5lc0hUTUwgPSBmdW5jdGlvbihjdWlzaW5lcykge1xuXHRjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XG5cdGN1aXNpbmVzLmZvckVhY2goY3Vpc2luZSA9PiB7XG5cdFx0Y29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG5cdFx0b3B0aW9uLmlubmVySFRNTCA9IGN1aXNpbmU7XG5cdFx0b3B0aW9uLnZhbHVlID0gY3Vpc2luZTtcblx0XHRzZWxlY3QuYXBwZW5kKG9wdGlvbik7XG5cdH0pO1xufTtcblxuXG4vKipcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbk1haW5Db250cm9sbGVyLnByb3RvdHlwZS5maWxsUmVzdGF1cmFudHNIVE1MID0gZnVuY3Rpb24ocmVzdGF1cmFudHMpIHtcblx0Y29uc3QgYW5pbWF0ZSA9ICgpID0+IHtcblx0XHR0aGlzLnJlc2V0UmVzdGF1cmFudHMoKTtcblx0XHRjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XG5cdFx0cmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcblx0XHRcdHVsLmFwcGVuZCh0aGlzLmNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcblx0XHR9KTtcblxuXHRcdFV0aWwuaW1nTGF6eUxvYWRlcignLmltZy1sYXp5LWxvYWQnKTtcblx0XHRpZihzZWxmLmluaXRNYXApIHRoaXMuYWRkTWFya2Vyc1RvTWFwKHJlc3RhdXJhbnRzKTtcblx0fVxuXG5cdHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTtcbn07XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTC5cbiAqL1xuTWFpbkNvbnRyb2xsZXIucHJvdG90eXBlLmNyZWF0ZVJlc3RhdXJhbnRIVE1MID0gZnVuY3Rpb24ocmVzdGF1cmFudCkge1xuXG5cdGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcblx0bGkuc2V0QXR0cmlidXRlKCdpZCcsIGByZXN0YXVyYW50LSR7cmVzdGF1cmFudC5pZH1gKTtcblx0bGkuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgYCR7cmVzdGF1cmFudC5uYW1lfSAtICR7cmVzdGF1cmFudC5jdWlzaW5lX3R5cGV9IC0gJHtyZXN0YXVyYW50LmFkZHJlc3N9YCk7XG5cblx0Y29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcblx0aW1hZ2UuY2xhc3NOYW1lID0gJ2ltZy1sYXp5LWxvYWQgcmVzdGF1cmFudC1pbWcnO1xuXHRpbWFnZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtc3JjJywgVXRpbC5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgNjAwKSk7XG5cdGltYWdlLmFsdCA9IGAke3Jlc3RhdXJhbnQubmFtZX0gLSAke3Jlc3RhdXJhbnQuY3Vpc2luZV90eXBlfSBDdWlzaW5lYDtcblxuXHRsaS5hcHBlbmQoaW1hZ2UpO1xuXG5cdGNvbnN0IGlzRmF2b3JpdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcblx0aXNGYXZvcml0ZS5zcmMgPSAnL2ltZy9oZWFydC5zdmcnO1xuXHRpc0Zhdm9yaXRlLnNldEF0dHJpYnV0ZSgnaWQnLCBgZmF2b3JpdGUtJHtyZXN0YXVyYW50LmlkfWApO1xuXHRpc0Zhdm9yaXRlLmNsYXNzTGlzdC5hZGQoJ2Zhdm9yaXRlLWljb24nLCAnaGlkZGVuJyk7XG5cdGlmKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09IFwidHJ1ZVwiKSB7XG5cdFx0aXNGYXZvcml0ZS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcblx0XHRpc0Zhdm9yaXRlLmNsYXNzTGlzdC5hZGQoJ3Zpc2libGUnKTtcblx0fVxuXHRsaS5hcHBlbmQoaXNGYXZvcml0ZSk7XG5cblx0Y29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XG5cdG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuXHRsaS5hcHBlbmQobmFtZSk7XG5cblx0Y29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcblx0Y3Vpc2luZS5jbGFzc05hbWUgPSAnY3Vpc2luZS10eXBlJztcblx0Y3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcblx0bGkuYXBwZW5kKGN1aXNpbmUpO1xuXG5cdGNvbnN0IG5laWdoYm9yaG9vZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcblx0bmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xuXHRsaS5hcHBlbmQobmVpZ2hib3Job29kKTtcblxuXHRjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHRhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcblx0bGkuYXBwZW5kKGFkZHJlc3MpO1xuXG5cblx0Y29uc3QgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcblx0bW9yZS5pbm5lckhUTUwgPSAnVmlldyBEZXRhaWxzJztcblx0bW9yZS5jbGFzc0xpc3QuYWRkKCdpdGVtLWJ1dHRvbicpO1xuXHRtb3JlLnNldEF0dHJpYnV0ZSgncm9sZScsICdidXR0b24nKTtcblx0bW9yZS5ocmVmID0gVXRpbC51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuXHRsaS5hcHBlbmQobW9yZSk7XG5cblx0Y29uc3QgZmF2b3JpdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcblx0ZmF2b3JpdGUuc2V0QXR0cmlidXRlKCdpZCcsIGBmYXZvcml0ZS1idXR0b24tJHtyZXN0YXVyYW50LmlkfWApO1xuXHRmYXZvcml0ZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSBcInRydWVcIiA/ICdSZW1vdmUgZnJvbSBmYXZvcml0ZXMnIDogJ0FkZCB0byBmYXZvcml0ZXMnO1xuXHRmYXZvcml0ZS5jbGFzc0xpc3QuYWRkKCdpdGVtLWJ1dHRvbicpO1xuXHRmYXZvcml0ZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMudG9nZ2xlRmF2b3JpdGUocmVzdGF1cmFudCkpO1xuXHRsaS5hcHBlbmQoZmF2b3JpdGUpO1xuXG5cdHJldHVybiBsaTtcbn07XG5cbi8qKlxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cbiAqL1xuTWFpbkNvbnRyb2xsZXIucHJvdG90eXBlLmFkZE1hcmtlcnNUb01hcCA9IGZ1bmN0aW9uKHJlc3RhdXJhbnRzKSB7XG5cdGlmKCFnb29nbGUpIHJldHVybjtcblx0cmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcblx0XHRjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcblx0XHRcdHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcblx0XHRcdHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXG5cdFx0XHR1cmw6IGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCxcblx0XHRcdG1hcDogc2VsZi5tYXAsXG5cdFx0XHRhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QfVxuXHRcdCk7XG5cblx0XHRnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsICgpID0+IHtcblx0XHRcdHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFya2VyLnVybDtcblx0XHR9KTtcblx0XHR0aGlzLm1hcmtlcnMucHVzaChtYXJrZXIpO1xuXHR9KTtcbn07XG5cbk1haW5Db250cm9sbGVyLnByb3RvdHlwZS50b2dnbGVGYXZvcml0ZSA9IGZ1bmN0aW9uKHJlc3RhdXJhbnQpIHtcblx0dGhpcy5wb3N0TWVzc2FnZSh7XG5cdFx0YWN0aW9uOiAndG9nZ2xlRmF2b3JpdGUnLFxuXHRcdGlucHV0OiB7aWQ6IHJlc3RhdXJhbnQuaWR9XG5cdH0pO1xufVxuXG5cbmZ1bmN0aW9uIGNoZWNrQ29ubmVjdGlvbigpIHtcblx0aWYoIW5hdmlnYXRvci5vbkxpbmUpIGhhbmRsZUVycm9yKG5ldyBFcnJvcignTm8gQ29ubmVjdGlvbicpKTtcblx0Ly8gY2hlY2sgY29ubmV0aW9uIGV2ZXJ5IDUgc2Vjb25kc1xuXHRjb25zdCBjaGVja1RpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRjaGVja0Nvbm5lY3Rpb24oKTtcbiAgfSwgMTAwMDApO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVFcnJvcihlcnJvcikge1xuXHRyZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gVXRpbC5zbmFja2Jhcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc25hY2tiYXInKSwgZXJyb3IubWVzc2FnZSkpO1xufVxuIiwiLy8gVXRpbGl0eSBmdW5jdGlvbnNcblxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBVdGlsIHtcblxuXHQvKipcblx0KlxuXHQqL1xuXHRzdGF0aWMgc25hY2tiYXIoZWwsIG1lc3NhZ2UsIGNvbG9yID0gJyNEOTAwMUYnKSB7XG5cblx0XHQvLyBUT0RPXG5cdFx0Ly8gQ3JlYXRlIGEgZWxlbWVudCBpZiB0aGUgc2VsZWN0ZWQgZWxlbWVudCBkb2VzIG5vdCBleGlzdGVcblx0XHQvLyB2YXIgbmV3RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHRcdGlmKCFlbCkge1xuXHRcdFx0Y29uc29sZS5sb2cobmV3IEVycm9yKCdTbmFja2JhciBlbGVtZW50IG5vdCB2YWxpZCcpKTtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHRlbC5pbm5lckhUTUwgPSBtZXNzYWdlO1xuXHRcdGVsLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnc2hvd1NuYWNrYmFyJyk7XG5cdFx0ZWwuc3R5bGUuYmFja2dyb3VuZCA9IGNvbG9yO1xuXHRcdHNldFRpbWVvdXQoKCkgPT4geyBlbC5yZW1vdmVBdHRyaWJ1dGUoJ2NsYXNzJykgfSwgNTUwMCk7XG5cdH1cblxuXG5cdC8qKlxuXHQqXG5cdCovXG5cdHN0YXRpYyBpbWdMYXp5TG9hZGVyKHRhcmdldCkge1xuXHRcdGNvbnN0IGltZ3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHRhcmdldCk7XG5cblx0XHRpZighd2luZG93LkludGVyc2VjdGlvbk9ic2VydmVyKSB7XG5cdFx0XHRjb25zb2xlLmxvZygnTm8gbGF6eSBsb2FkaW5nIGZvciB5b3UgOignKTtcblx0XHRcdGltZ3MuZm9yRWFjaChpbWcgPT4gVXRpbC5wcmVsb2FkSW1hZ2UoaW1nKSk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0Y29uc3Qgb25JbnRlcnNlY3Rpb24gPSBmdW5jdGlvbiAoZW50cmllcywgb2Jzcikge1xuXHRcdFx0XHRlbnRyaWVzLmZvckVhY2goZW50cnkgPT4ge1xuXHRcdFx0XHRcdGlmIChlbnRyeS5pbnRlcnNlY3Rpb25SYXRpbyA+IDApIHtcblx0XHRcdFx0XHRcdG9ic3IudW5vYnNlcnZlKGVudHJ5LnRhcmdldCk7XG5cdFx0XHRcdFx0XHRyZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gVXRpbC5wcmVsb2FkSW1hZ2UoZW50cnkudGFyZ2V0KSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0ICB9KTtcblx0XHRcdH07XG5cblx0XHRcdGNvbnN0IG9ic3JPcHRpb25zID0ge1xuXHRcdFx0XHRyb290TWFyZ2luOiAnMzBweCAwcHgnLFxuXHQgIFx0XHR0aHJlc2hvbGQ6IFswLjFdXG5cdFx0XHR9XG5cblx0XHRcdGNvbnN0IG9ic2VydmVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKG9uSW50ZXJzZWN0aW9uLCBvYnNyT3B0aW9ucyk7XG5cdFx0XHRpbWdzLmZvckVhY2godGFyZ2V0ID0+IG9ic2VydmVyLm9ic2VydmUodGFyZ2V0KSk7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCpcblx0Ki9cblx0c3RhdGljIHByZWxvYWRJbWFnZSh0YXJnZXQpIHtcblx0XHRpZighdGFyZ2V0Lm5vZGVOYW1lID09PSAnSU1HJykgcmV0dXJuIGZhbHNlO1xuXHRcdHRhcmdldC5zZXRBdHRyaWJ1dGUoJ3NyYycsIHRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtc3JjJykpO1xuXHRcdGNvbnNvbGUubG9nKCdJbWFnZSBsb2FkZWQ6ICcsdGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1zcmMnKSk7XG5cdFx0cmV0dXJuIHRhcmdldDtcblx0fVxuXG5cblx0LyoqXG5cdCAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXG5cdCAqL1xuXHRzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG5cdFx0cmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xuXHR9XG5cdFxuXHQvKipcblx0ICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXG5cdCAqL1xuXHRzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNpemUpIHtcblx0XHRsZXQgaW1nID0gcmVzdGF1cmFudC5waG90b2dyYXBoO1xuXHRcdHJldHVybiBpbWcgPyAoYC9pbWcvJHtpbWd9LSR7c2l6ZX0uanBnYCkgOiAnL2ltZy9yZXN0YXVyYW50X3BsYWNlaG9sZGVyLnN2Zyc7XG5cdH1cblxuXG59XG4iXX0=\n"]}