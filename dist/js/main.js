!function(){return function e(t,n,r){function o(i,s){if(!n[i]){if(!t[i]){var u="function"==typeof require&&require;if(!s&&u)return u(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[i]={exports:{}};t[i][0].call(l.exports,function(e){return o(t[i][1][e]||e)},l,l.exports,e,t,n,r)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}}()({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Main=i;var r,o=e("./mainController"),a=(r=o)&&r.__esModule?r:{default:r};function i(){this.controller=new a.default(document.querySelector("#app-main")),this.controller.fetchNeighborhoods(),this.controller.fetchCuisines(),this.updateRestaurants(),console.log("All resources finished loading!"),window.initMap=function(){self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1})}}i.prototype.updateRestaurants=function(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,r=t.selectedIndex,o=e[n].value,a=t[r].value;this.controller.fetchRestaurants(o,a)},window.main=new i},{"./mainController":2}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=i;var r,o=e("./util"),a=(r=o)&&r.__esModule?r:{default:r};function i(e){this.markers=[],this._container=e,this._registerServiceWorker(),this.dataWorker=new Worker("./js/dataWorker.js"),navigator&&function e(){navigator.onLine||(t=new Error("No Connection"),requestAnimationFrame(function(){return a.default.snackbar(document.querySelector("#snackbar"),t.message)}));var t;setTimeout(function(){e()},1e4)}()}i.prototype._registerServiceWorker=function(){if(navigator.serviceWorker){if(navigator.serviceWorker.controller)return;navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(function(e){console.log("\nServiceWorker successfully registred. Scope\n",e.scope)}).catch(function(e){console.log("\nServiceWorker swReg failed :(\n",e.message)})}},i.prototype.postMessage=function(e){var t=this,n=e.action,r=e.input;this.dataWorker.postMessage({action:n,input:r}),this.dataWorker.onmessage=function(e){if(!e.data)throw new Error("There is no data: "+e);if("fetchRestaurantByCuisineAndNeighborhood"===e.data.action&&requestAnimationFrame(function(){return t.fillRestaurantsHTML(e.data.result)}),"fetchNeighborhoods"===e.data.action&&requestAnimationFrame(function(){return t.fillNeighborhoodsHTML(e.data.result)}),"fetchCuisines"===e.data.action&&requestAnimationFrame(function(){return t.fillCuisinesHTML(e.data.result)}),"toggleFavorite"===e.data.action){var n=e.data.result,r=document.querySelector("#favorite-"+n.id),o=document.querySelector("#favorite-button-"+n.id);"true"===n.is_favorite?(r.classList.remove("hidden"),r.classList.add("visible"),o.innerHTML="Remove from favorites"):(r.classList.remove("visible"),r.classList.add("hidden"),o.innerHTML="Add to favorites")}}},i.prototype.fetchRestaurants=function(e,t){this.postMessage({action:"fetchRestaurantByCuisineAndNeighborhood",input:{cuisine:e,neighborhood:t}})},i.prototype.fetchNeighborhoods=function(){this.postMessage({action:"fetchNeighborhoods",input:null})},i.prototype.fillNeighborhoodsHTML=function(e){var t=document.getElementById("neighborhoods-select");e.forEach(function(e){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})},i.prototype.fetchCuisines=function(){this.postMessage({action:"fetchCuisines",input:null})},i.prototype.fillCuisinesHTML=function(e){var t=document.getElementById("cuisines-select");e.forEach(function(e){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})},i.prototype.resetRestaurants=function(e){document.getElementById("restaurants-list").innerHTML="",this.markers.forEach(function(e){return e.setMap(null)}),this.markers=[]},i.prototype.fillRestaurantsHTML=function(e){var t=this;requestAnimationFrame(function(){t.resetRestaurants();var n=document.getElementById("restaurants-list");e.forEach(function(e){n.append(t.createRestaurantHTML(e))}),a.default.imgLazyLoader(".img-lazy-load"),self.initMap&&t.addMarkersToMap(e)})},i.prototype.createRestaurantHTML=function(e){var t=this,n=document.createElement("li");n.setAttribute("id","restaurant-"+e.id),n.setAttribute("aria-label",e.name+" - "+e.cuisine_type+" - "+e.address);var r=document.createElement("img");r.className="img-lazy-load restaurant-img",r.setAttribute("data-src",a.default.imageUrlForRestaurant(e,600)),r.alt=e.name+" - "+e.cuisine_type+" Cuisine",n.append(r);var o=document.createElement("img");o.src="/img/heart.svg",o.setAttribute("id","favorite-"+e.id),o.classList.add("favorite-icon","hidden"),"true"===e.is_favorite&&(o.classList.remove("hidden"),o.classList.add("visible")),n.append(o);var i=document.createElement("h2");i.innerHTML=e.name,n.append(i);var s=document.createElement("p");s.className="cuisine-type",s.innerHTML=e.cuisine_type,n.append(s);var u=document.createElement("p");u.innerHTML=e.neighborhood,n.append(u);var c=document.createElement("p");c.innerHTML=e.address,n.append(c);var l=document.createElement("a");l.innerHTML="View Details",l.classList.add("item-button"),l.setAttribute("role","button"),l.href=a.default.urlForRestaurant(e),n.append(l);var d=document.createElement("button");return d.setAttribute("id","favorite-button-"+e.id),d.innerHTML="true"===e.is_favorite?"Remove from favorites":"Add to favorites",d.classList.add("item-button"),d.addEventListener("click",function(){return t.toggleFavorite(e)}),n.append(d),n},i.prototype.addMarkersToMap=function(e){var t=this;google&&e.forEach(function(e){var n=new google.maps.Marker({position:e.latlng,title:e.name,url:"./restaurant.html?id="+e.id,map:self.map,animation:google.maps.Animation.DROP});google.maps.event.addListener(n,"click",function(){window.location.href=n.url}),t.markers.push(n)})},i.prototype.toggleFavorite=function(e){this.postMessage({action:"toggleFavorite",input:{id:e.id}})}},{"./util":3}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"snackbar",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#D9001F";if(!e)return console.log(new Error("Snackbar element not valid")),!1;e.innerHTML=t,e.setAttribute("class","showSnackbar"),e.style.background=n,setTimeout(function(){e.removeAttribute("class")},5500)}},{key:"imgLazyLoader",value:function(t){var n=document.querySelectorAll(t);if(window.IntersectionObserver){var r=new IntersectionObserver(function(t,n){t.forEach(function(t){t.intersectionRatio>0&&(n.unobserve(t.target),requestAnimationFrame(function(){return e.preloadImage(t.target)}))})},{rootMargin:"30px 0px",threshold:[.1]});n.forEach(function(e){return r.observe(e)})}else console.log("No lazy loading for you :("),n.forEach(function(t){return e.preloadImage(t)})}},{key:"preloadImage",value:function(e){return"IMG"!==!e.nodeName&&(e.setAttribute("src",e.getAttribute("data-src")),console.log("Image loaded: ",e.getAttribute("data-src")),e)}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e,t){var n=e.photograph;return n?"/img/"+n+"-"+t+".jpg":"/img/restaurant_placeholder.svg"}}]),e}();n.default=o},{}]},{},[1]);
//# sourceMappingURL=main.js.map
