{"version":3,"sources":["dbhelper.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Object","defineProperty","value","default","COLLECTIONS","RESTAURANTS","REVIEWS","UNSYNCED_REVIEWS","IS_DATA_SYNCRONIZED","2","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_idb2","_interopRequireDefault","obj","__esModule","DataCache","instance","TypeError","_classCallCheck","this","dbName","_IDB","setDatabase","setSyncAsPending","open","upgradedDB","console","log","oldVersion","createObjectStore","keyPath","createIndex","autoIncrement","collection","status","then","db","transaction","objectStore","put","data","arguments","undefined","tx","readwriteStore","forEach","item","complete","id","index","get","parseInt","getAll","restaurants","delete","clear","./constants","idb","3","_dataCache2","_toConsumableArray","arr","Array","isArray","arr2","from","DBHelper","DATABASE","idbCache","callback","_this","getCacheById","response","toogle","is_favorite","setCache","navigator","onLine","path","fetch","method","catch","error","_this2","body","JSON","stringify","_this3","getCacheAll","json","cacheData","handleResponseError","_this4","unsycedReviews","review","saveReview","clearCache","reviewsPath","reviews","cachedReviews","concat","filteredReviews","filter","restaurant_id","_this5","cuisine","fetchRestaurants","results","cuisine_type","neighborhood","neighborhoods","map","v","uniqueNeighborhoods","indexOf","cuisines","uniqueCuisines","restaurant","size","img","photograph","google","maps","Marker","position","latlng","title","name","url","urlForRestaurant","animation","Animation","DROP","type","./dataCache","4","promisifyRequest","request","Promise","resolve","reject","onsuccess","result","onerror","promisifyRequestCall","args","apply","proxyProperties","ProxyClass","targetProp","properties","prop","set","val","proxyRequestMethods","proxyMethods","proxyCursorRequestMethods","Cursor","Index","_index","cursor","_cursor","_request","ObjectStore","store","_store","Transaction","idbTransaction","_tx","oncomplete","onabort","UpgradeDB","_db","DB","IDBIndex","IDBCursor","methodName","IDBObjectStore","IDBTransaction","IDBDatabase","funcName","replace","slice","nativeObject","query","count","items","iterateCursor","push","continue","exp","version","upgradeCallback","indexedDB","onupgradeneeded","event","self"],"mappings":"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","file":"dbhelper.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar constants = {\n  COLLECTIONS: {\n    RESTAURANTS: 'restaurants',\n    REVIEWS: 'reviews',\n    UNSYNCED_REVIEWS: 'unsynced_reviews',\n    IS_DATA_SYNCRONIZED: 'isDataSyncronzed'\n  }\n};\n\nexports.default = constants;\n\n},{}],2:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _idb = require('idb');\n\nvar _idb2 = _interopRequireDefault(_idb);\n\nvar _constants = require('./constants');\n\nvar _constants2 = _interopRequireDefault(_constants);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar COLLECTIONS = _constants2.default.COLLECTIONS;\n\n/*\n* Common database helper functions.\n*/\n\nvar DataCache = function () {\n\tfunction DataCache() {\n\t\t_classCallCheck(this, DataCache);\n\n\t\tthis.dbName = \"restaurantApp\";\n\t\tthis._IDB = this.setDatabase(this.dbName);\n\t\tthis.setSyncAsPending(COLLECTIONS.RESTAURANTS, true);\n\t\tthis.setSyncAsPending(COLLECTIONS.REVIEWS, true);\n\t}\n\n\t_createClass(DataCache, [{\n\t\tkey: 'setDatabase',\n\t\tvalue: function setDatabase(dbName) {\n\t\t\treturn _idb2.default.open(dbName, 1, function (upgradedDB) {\n\n\t\t\t\tconsole.log('\\n\\n\\n-----', upgradedDB.oldVersion);\n\n\t\t\t\tswitch (upgradedDB.oldVersion) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\tvar restaurants = upgradedDB.createObjectStore(COLLECTIONS.RESTAURANTS, { keyPath: 'id' });\n\t\t\t\t\t\trestaurants.createIndex('by-id', 'id');\n\n\t\t\t\t\t\tvar reviews = upgradedDB.createObjectStore(COLLECTIONS.REVIEWS, { keyPath: 'id' });\n\t\t\t\t\t\treviews.createIndex('by-id', 'restaurant_id');\n\n\t\t\t\t\t\tvar unsyncedReviews = upgradedDB.createObjectStore(COLLECTIONS.UNSYNCED_REVIEWS, { autoIncrement: true });\n\t\t\t\t\t\tunsyncedReviews.createIndex('by-id', 'restaurant_id');\n\n\t\t\t\t\t\tupgradedDB.createObjectStore(COLLECTIONS.IS_DATA_SYNCRONIZED, { keyPath: 'collection' });\n\t\t\t\t\t\tconsole.log('Database and Index created');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Set local data sync as panding\n   */\n\n\t}, {\n\t\tkey: 'setSyncAsPending',\n\t\tvalue: function setSyncAsPending(collection, status) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(COLLECTIONS.IS_DATA_SYNCRONIZED, 'readwrite');\n\t\t\t\ttx.objectStore(COLLECTIONS.IS_DATA_SYNCRONIZED).put({ collection: collection, status: status });\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'cacheData',\n\t\tvalue: function cacheData(collection) {\n\t\t\tvar data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n\t\t\t// add post the local DB\n\t\t\tthis._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\tvar readwriteStore = tx.objectStore(collection);\n\t\t\t\tdata.forEach(function (item) {\n\t\t\t\t\treturn readwriteStore.put(item);\n\t\t\t\t});\n\t\t\t\ttx.complete.then(function () {\n\t\t\t\t\treturn console.log('data added to ' + collection);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'setCache',\n\t\tvalue: function setCache(collection, data) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\ttx.objectStore(collection).put(data);\n\t\t\t\treturn tx.complete.then(function () {\n\t\t\t\t\treturn console.log('data added to ' + collection);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'getCacheById',\n\t\tvalue: function getCacheById(collection) {\n\t\t\tvar id = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\treturn db.transaction(collection).objectStore(collection).index('by-id').get(parseInt(id));\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'getCacheAll',\n\t\tvalue: function getCacheAll(collection) {\n\t\t\tvar index = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'by-id';\n\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\treturn db.transaction(collection).objectStore(collection).index(index).getAll();\n\t\t\t}).then(function (restaurants) {\n\t\t\t\treturn restaurants;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'deleteCache',\n\t\tvalue: function deleteCache(collection, id) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\ttx.objectStore(collection).delete(id);\n\t\t\t\treturn tx.complete;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'clearCache',\n\t\tvalue: function clearCache(collection) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\ttx.objectStore(collection).clear();\n\t\t\t\treturn tx.complete;\n\t\t\t});\n\t\t}\n\t}]);\n\n\treturn DataCache;\n}();\n\nexports.default = DataCache;\n\n},{\"./constants\":1,\"idb\":4}],3:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _idb = require('idb');\n\nvar _idb2 = _interopRequireDefault(_idb);\n\nvar _dataCache = require('./dataCache');\n\nvar _dataCache2 = _interopRequireDefault(_dataCache);\n\nvar _constants = require('./constants');\n\nvar _constants2 = _interopRequireDefault(_constants);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar COLLECTIONS = _constants2.default.COLLECTIONS;\n\n/*\n* Common database helper functions.\n*/\n\nvar DBHelper = function () {\n\tfunction DBHelper() {\n\t\t_classCallCheck(this, DBHelper);\n\n\t\tvar port = 1337; // Change this to your server port\n\t\t// Database URL.\n\t\tthis.DATABASE = {\n\t\t\tRESTAURANTS: 'http://0.0.0.0:' + port + '/restaurants',\n\t\t\tREVIEWS: 'http://0.0.0.0:' + port + '/reviews/'\n\t\t};\n\n\t\tthis.idbCache = new _dataCache2.default();\n\t}\n\n\t// Data storage interfaces \\\\\n\n\t_createClass(DBHelper, [{\n\t\tkey: 'toogleFavorite',\n\t\tvalue: function toogleFavorite(id, callback) {\n\t\t\tvar _this = this;\n\n\t\t\tthis.idbCache.getCacheById(COLLECTIONS.RESTAURANTS, id).then(function (response) {\n\n\t\t\t\tvar toogle = response.is_favorite === \"true\" ? \"false\" : \"true\";\n\t\t\t\tresponse.is_favorite = toogle;\n\t\t\t\treturn _this.idbCache.setCache(COLLECTIONS.RESTAURANTS, response).then(function () {\n\t\t\t\t\tcallback(null, response);\n\t\t\t\t\tif (!navigator.onLine) {\n\t\t\t\t\t\t_this.idbCache.setSyncAsPending(COLLECTIONS.RESTAURANTS, false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar path = '/' + id + '/?is_favorite=' + toogle;\n\t\t\t\t\t\treturn fetch(_this.DATABASE.RESTAURANTS + path, { method: 'PUT' }).then(function (response) {\n\t\t\t\t\t\t\tif (response.status === 200) _this.idbCache.setSyncAsPending(COLLECTIONS.RESTAURANTS, true);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}).catch(function (error) {\n\t\t\t\treturn callback(error, null);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'saveReview',\n\t\tvalue: function saveReview(data, callback) {\n\t\t\tvar _this2 = this;\n\n\t\t\tif (!navigator.onLine) {\n\t\t\t\treturn this.idbCache.setCache(COLLECTIONS.UNSYNCED_REVIEWS, data).then(function () {\n\t\t\t\t\t_this2.idbCache.setSyncAsPending(COLLECTIONS.REVIEWS, false);\n\t\t\t\t\tcallback(null, data);\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t} else {\n\n\t\t\t\treturn fetch(this.DATABASE.REVIEWS, {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tbody: JSON.stringify(data)\n\t\t\t\t}).then(function (response) {\n\t\t\t\t\tif (response.status < 400) {\n\t\t\t\t\t\treturn _this2.idbCache.setCache(COLLECTIONS.REVIEWS, data).then(function () {\n\t\t\t\t\t\t\tcallback(null, response);\n\t\t\t\t\t\t\treturn _this2.idbCache.setSyncAsPending(COLLECTIONS.REVIEWS, true);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error('Error code ' + response.status);\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Fetch all restaurants.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurants',\n\t\tvalue: function fetchRestaurants(callback) {\n\t\t\tvar _this3 = this;\n\n\t\t\tthis.idbCache.getCacheAll(COLLECTIONS.RESTAURANTS).then(function (data) {\n\t\t\t\tif (data.length > 0) {\n\t\t\t\t\tcallback(null, data);\n\t\t\t\t\tconsole.log('data loaded from local storage!');\n\t\t\t\t} else {\n\n\t\t\t\t\tfetch(_this3.DATABASE.RESTAURANTS).then(function (response) {\n\t\t\t\t\t\tif (response.status === 200) {\n\t\t\t\t\t\t\tresponse.json().then(function (data) {\n\t\t\t\t\t\t\t\t_this3.idbCache.cacheData(COLLECTIONS.RESTAURANTS, data);\n\t\t\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcallback(_this3.handleResponseError(response, 'api request'), null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch(function (error) {\n\t\t\t\t\t\treturn callback(error, null);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Fetch all restaurants.\n   */\n\n\t}, {\n\t\tkey: 'fetchReviews',\n\t\tvalue: function fetchReviews(id, callback) {\n\t\t\tvar _this4 = this;\n\n\t\t\t// check unsyced reviews\n\t\t\tthis.idbCache.getCacheAll(COLLECTIONS.UNSYNCED_REVIEWS).then(function (unsycedReviews) {\n\n\t\t\t\tif (!navigator.onLine) {\n\t\t\t\t\t_this4.idbCache.getCacheAll(COLLECTIONS.REVIEWS).then(function (reviews) {\n\t\t\t\t\t\tvar cachedReviews = [].concat(_toConsumableArray(reviews), _toConsumableArray(unsycedReviews));\n\t\t\t\t\t\tif (cachedReviews && cachedReviews.length > 0) {\n\t\t\t\t\t\t\tvar filteredReviews = cachedReviews.filter(function (review) {\n\t\t\t\t\t\t\t\treturn review.restaurant_id === id;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tcallback(null, filteredReviews);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcallback(null, []);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\n\t\t\t\t\t// Syced reviews if any unsyced\n\t\t\t\t\tif (unsycedReviews && unsycedReviews.length > 0) {\n\t\t\t\t\t\tunsycedReviews.forEach(function (review) {\n\t\t\t\t\t\t\t_this4.saveReview(review, function (error, data) {\n\t\t\t\t\t\t\t\tif (error) console.error(error);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t\t_this4.idbCache.clearCache(COLLECTIONS.UNSYNCED_REVIEWS);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar reviewsPath = '?restaurant_id=' + id;\n\t\t\t\t\tfetch(_this4.DATABASE.REVIEWS + reviewsPath).then(function (response) {\n\t\t\t\t\t\tif (response.status < 400) {\n\t\t\t\t\t\t\tresponse.json().then(function (data) {\n\t\t\t\t\t\t\t\t_this4.idbCache.cacheData(COLLECTIONS.REVIEWS, data);\n\t\t\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcallback(_this4.handleResponseError(response, 'API request'), null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch(function (error) {\n\t\t\t\t\t\treturn callback(error, null);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Fetch a restaurant by its ID.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantById',\n\t\tvalue: function fetchRestaurantById(id, callback) {\n\t\t\tvar _this5 = this;\n\n\t\t\tif (!navigator.onLine) {\n\t\t\t\tthis.idbCache.getCacheById(COLLECTIONS.RESTAURANTS, id).then(function (response) {\n\t\t\t\t\tcallback(null, response);\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tvar path = '/' + id;\n\t\t\t\tfetch(this.DATABASE.RESTAURANTS + path).then(function (response) {\n\t\t\t\t\tif (response.status === 200) {\n\t\t\t\t\t\tresponse.json().then(function (data) {\n\t\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback(_this5.handleResponseError(response, 'api request'), null);\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Fetch restaurants by a cuisine type with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantByCuisine',\n\t\tvalue: function fetchRestaurantByCuisine(cuisine, callback) {\n\t\t\t// Fetch all restaurants\twith proper error handling\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Filter restaurants to have only given cuisine type\n\t\t\t\t\tvar results = restaurants.filter(function (r) {\n\t\t\t\t\t\treturn r.cuisine_type == cuisine;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, results);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t/**\n   * Fetch restaurants by a neighborhood with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantByNeighborhood',\n\t\tvalue: function fetchRestaurantByNeighborhood(neighborhood, callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Filter restaurants to have only given neighborhood\n\t\t\t\t\tvar results = restaurants.filter(function (r) {\n\t\t\t\t\t\treturn r.neighborhood == neighborhood;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, results);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t/**\n   * Fetch restaurants by a cuisine and a neighborhood with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantByCuisineAndNeighborhood',\n\t\tvalue: function fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\tvar results = restaurants;\n\t\t\t\t\tif (cuisine != 'all') {\n\t\t\t\t\t\t// filter by cuisine\n\t\t\t\t\t\tresults = results.filter(function (r) {\n\t\t\t\t\t\t\treturn r.cuisine_type == cuisine;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (neighborhood != 'all') {\n\t\t\t\t\t\t// filter by neighborhood\n\t\t\t\t\t\tresults = results.filter(function (r) {\n\t\t\t\t\t\t\treturn r.neighborhood == neighborhood;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tcallback(null, results);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t/**\n   * Fetch all neighborhoods with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchNeighborhoods',\n\t\tvalue: function fetchNeighborhoods(callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Get all neighborhoods from all restaurants\n\t\t\t\t\tvar neighborhoods = restaurants.map(function (v, i) {\n\t\t\t\t\t\treturn restaurants[i].neighborhood;\n\t\t\t\t\t});\n\t\t\t\t\t// Remove duplicates from neighborhoods\n\t\t\t\t\tvar uniqueNeighborhoods = neighborhoods.filter(function (v, i) {\n\t\t\t\t\t\treturn neighborhoods.indexOf(v) == i;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, uniqueNeighborhoods);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Fetch all cuisines with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchCuisines',\n\t\tvalue: function fetchCuisines(callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Get all cuisines from all restaurants\n\t\t\t\t\tvar cuisines = restaurants.map(function (v, i) {\n\t\t\t\t\t\treturn restaurants[i].cuisine_type;\n\t\t\t\t\t});\n\t\t\t\t\t// Remove duplicates from cuisines\n\t\t\t\t\tvar uniqueCuisines = cuisines.filter(function (v, i) {\n\t\t\t\t\t\treturn cuisines.indexOf(v) == i;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, uniqueCuisines);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Restaurant page URL.\n   */\n\n\t}, {\n\t\tkey: 'urlForRestaurant',\n\t\tvalue: function urlForRestaurant(restaurant) {\n\t\t\treturn './restaurant.html?id=' + restaurant.id;\n\t\t}\n\t\t/**\n   * Restaurant image URL.\n   */\n\n\t}, {\n\t\tkey: 'imageUrlForRestaurant',\n\t\tvalue: function imageUrlForRestaurant(restaurant, size) {\n\t\t\tvar img = restaurant.photograph;\n\t\t\treturn img ? '/img/' + img + '-' + size + '.jpg' : '/img/restaurant_placeholder.svg';\n\t\t}\n\t\t/**\n   * Map marker for a restaurant.\n   */\n\n\t}, {\n\t\tkey: 'mapMarkerForRestaurant',\n\t\tvalue: function mapMarkerForRestaurant(restaurant, map) {\n\t\t\tvar marker = new google.maps.Marker({\n\t\t\t\tposition: restaurant.latlng,\n\t\t\t\ttitle: restaurant.name,\n\t\t\t\turl: this.urlForRestaurant(restaurant),\n\t\t\t\tmap: map,\n\t\t\t\tanimation: google.maps.Animation.DROP });\n\t\t\treturn marker;\n\t\t}\n\t}, {\n\t\tkey: 'handleResponseError',\n\t\tvalue: function handleResponseError(response, type) {\n\t\t\tswitch (response.status) {\n\t\t\t\tcase 400:\n\t\t\t\t\treturn new Error('Bed request');\n\t\t\t\tcase 404:\n\t\t\t\t\treturn new Error('Not found');\n\t\t\t\tcase 500:\n\t\t\t\t\treturn new Error('Internal server error');\n\t\t\t}\n\t\t}\n\t}]);\n\n\treturn DBHelper;\n}();\n\nexports.default = DBHelper;\n\n},{\"./constants\":1,\"./dataCache\":2,\"idb\":4}],4:[function(require,module,exports){\n'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      if (request) {\n        request.onupgradeneeded = function(event) {\n          if (upgradeCallback) {\n            upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n          }\n        };\n      }\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n\n},{}]},{},[3])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9jb25zdGFudHMuanMiLCJqcy9kYXRhQ2FjaGUuanMiLCJqcy9kYmhlbHBlci5qcyIsIm5vZGVfbW9kdWxlcy9pZGIvbGliL2lkYi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FDQUEsSUFBTSxZQUFZO0FBQ2hCLGVBQWE7QUFDWixpQkFBYSxhQUREO0FBRVosYUFBUyxTQUZHO0FBR1osc0JBQWtCLGtCQUhOO0FBSVoseUJBQXFCO0FBSlQ7QUFERyxDQUFsQjs7a0JBU2UsUzs7Ozs7Ozs7Ozs7QUNUZjs7OztBQUNBOzs7Ozs7OztBQUVBLElBQU0sY0FBYyxvQkFBVSxXQUE5Qjs7QUFFQTs7OztJQUdxQixTO0FBRW5CLHNCQUFhO0FBQUE7O0FBQ2IsT0FBSyxNQUFMLEdBQWMsZUFBZDtBQUNBLE9BQUssSUFBTCxHQUFZLEtBQUssV0FBTCxDQUFpQixLQUFLLE1BQXRCLENBQVo7QUFDQSxPQUFLLGdCQUFMLENBQXNCLFlBQVksV0FBbEMsRUFBK0MsSUFBL0M7QUFDQSxPQUFLLGdCQUFMLENBQXNCLFlBQVksT0FBbEMsRUFBMkMsSUFBM0M7QUFDQTs7Ozs4QkFFVyxNLEVBQVE7QUFDbkIsVUFBTyxjQUFJLElBQUosQ0FBUyxNQUFULEVBQWlCLENBQWpCLEVBQW9CLFVBQUMsVUFBRCxFQUFnQjs7QUFFN0MsWUFBUSxHQUFSLENBQVksYUFBWixFQUEyQixXQUFXLFVBQXRDOztBQUVHLFlBQU8sV0FBVyxVQUFsQjtBQUNDLFVBQUssQ0FBTDtBQUNDLFVBQU0sY0FBYyxXQUFXLGlCQUFYLENBQTZCLFlBQVksV0FBekMsRUFBc0QsRUFBQyxTQUFTLElBQVYsRUFBdEQsQ0FBcEI7QUFDQSxrQkFBWSxXQUFaLENBQXdCLE9BQXhCLEVBQWlDLElBQWpDOztBQUVBLFVBQU0sVUFBVSxXQUFXLGlCQUFYLENBQTZCLFlBQVksT0FBekMsRUFBa0QsRUFBQyxTQUFTLElBQVYs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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImNvbnN0IGNvbnN0YW50cyA9IHtcbiAgQ09MTEVDVElPTlM6IHtcbiAgXHRSRVNUQVVSQU5UUzogJ3Jlc3RhdXJhbnRzJyxcbiAgXHRSRVZJRVdTOiAncmV2aWV3cycsXG4gIFx0VU5TWU5DRURfUkVWSUVXUzogJ3Vuc3luY2VkX3Jldmlld3MnLFxuICBcdElTX0RBVEFfU1lOQ1JPTklaRUQ6ICdpc0RhdGFTeW5jcm9uemVkJyxcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjb25zdGFudHM7XG4iLCJpbXBvcnQgSURCIGZyb20gJ2lkYic7XG5pbXBvcnQgY29uc3RhbnRzIGZyb20gJy4vY29uc3RhbnRzJztcblxuY29uc3QgQ09MTEVDVElPTlMgPSBjb25zdGFudHMuQ09MTEVDVElPTlM7XG5cbi8qXG4qIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxuKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERhdGFDYWNoZSB7XG5cbiAgY29uc3RydWN0b3IoKXtcblx0XHR0aGlzLmRiTmFtZSA9IFwicmVzdGF1cmFudEFwcFwiO1xuXHRcdHRoaXMuX0lEQiA9IHRoaXMuc2V0RGF0YWJhc2UodGhpcy5kYk5hbWUpO1xuXHRcdHRoaXMuc2V0U3luY0FzUGVuZGluZyhDT0xMRUNUSU9OUy5SRVNUQVVSQU5UUywgdHJ1ZSk7XG5cdFx0dGhpcy5zZXRTeW5jQXNQZW5kaW5nKENPTExFQ1RJT05TLlJFVklFV1MsIHRydWUpO1xuXHR9XG5cblx0c2V0RGF0YWJhc2UoZGJOYW1lKSB7XG5cdFx0cmV0dXJuIElEQi5vcGVuKGRiTmFtZSwgMSwgKHVwZ3JhZGVkREIpID0+IHtcblxuY29uc29sZS5sb2coJ1xcblxcblxcbi0tLS0tJywgdXBncmFkZWREQi5vbGRWZXJzaW9uKTtcblxuXHRcdFx0c3dpdGNoKHVwZ3JhZGVkREIub2xkVmVyc2lvbil7XG5cdFx0XHRcdGNhc2UgMDpcblx0XHRcdFx0XHRjb25zdCByZXN0YXVyYW50cyA9IHVwZ3JhZGVkREIuY3JlYXRlT2JqZWN0U3RvcmUoQ09MTEVDVElPTlMuUkVTVEFVUkFOVFMsIHtrZXlQYXRoOiAnaWQnfSk7XG5cdFx0XHRcdFx0cmVzdGF1cmFudHMuY3JlYXRlSW5kZXgoJ2J5LWlkJywgJ2lkJyk7XG5cblx0XHRcdFx0XHRjb25zdCByZXZpZXdzID0gdXBncmFkZWREQi5jcmVhdGVPYmplY3RTdG9yZShDT0xMRUNUSU9OUy5SRVZJRVdTLCB7a2V5UGF0aDogJ2lkJ30pO1xuXHRcdFx0XHRcdHJldmlld3MuY3JlYXRlSW5kZXgoJ2J5LWlkJywgJ3Jlc3RhdXJhbnRfaWQnKTtcblxuXHRcdFx0XHRcdGNvbnN0IHVuc3luY2VkUmV2aWV3cyA9IHVwZ3JhZGVkREIuY3JlYXRlT2JqZWN0U3RvcmUoQ09MTEVDVElPTlMuVU5TWU5DRURfUkVWSUVXUywge2F1dG9JbmNyZW1lbnQ6IHRydWV9KTtcblx0XHRcdFx0XHR1bnN5bmNlZFJldmlld3MuY3JlYXRlSW5kZXgoJ2J5LWlkJywgJ3Jlc3RhdXJhbnRfaWQnKTtcblxuXHRcdFx0XHRcdHVwZ3JhZGVkREIuY3JlYXRlT2JqZWN0U3RvcmUoQ09MTEVDVElPTlMuSVNfREFUQV9TWU5DUk9OSVpFRCwgeyBrZXlQYXRoOiAnY29sbGVjdGlvbicgfSk7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coJ0RhdGFiYXNlIGFuZCBJbmRleCBjcmVhdGVkJyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0ICogU2V0IGxvY2FsIGRhdGEgc3luYyBhcyBwYW5kaW5nXG5cdCAqL1xuXHRzZXRTeW5jQXNQZW5kaW5nKGNvbGxlY3Rpb24sIHN0YXR1cykge1xuXHRcdHJldHVybiB0aGlzLl9JREIudGhlbihkYiA9PiB7XG5cdFx0XHRjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKENPTExFQ1RJT05TLklTX0RBVEFfU1lOQ1JPTklaRUQsICdyZWFkd3JpdGUnKTtcblx0XHRcdHR4Lm9iamVjdFN0b3JlKENPTExFQ1RJT05TLklTX0RBVEFfU1lOQ1JPTklaRUQpLnB1dCh7IGNvbGxlY3Rpb24sIHN0YXR1cyB9KTtcblx0XHR9KTtcblx0fVxuXG5cblx0Y2FjaGVEYXRhKGNvbGxlY3Rpb24sIGRhdGEgPSBbXSl7XG5cdFx0IC8vIGFkZCBwb3N0IHRoZSBsb2NhbCBEQlxuXHRcdHRoaXMuX0lEQi50aGVuKGRiID0+IHtcblx0XHRcdGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oY29sbGVjdGlvbiwgJ3JlYWR3cml0ZScpO1xuXHRcdFx0Y29uc3QgcmVhZHdyaXRlU3RvcmUgPSB0eC5vYmplY3RTdG9yZShjb2xsZWN0aW9uKTtcblx0XHRcdGRhdGEuZm9yRWFjaCgoaXRlbSkgPT4gcmVhZHdyaXRlU3RvcmUucHV0KGl0ZW0pKTtcblx0XHRcdHR4LmNvbXBsZXRlLnRoZW4oKCkgPT4gY29uc29sZS5sb2coJ2RhdGEgYWRkZWQgdG8gJyArIGNvbGxlY3Rpb24pKTtcblx0XHR9KTtcblx0fVxuXG5cblx0c2V0Q2FjaGUoY29sbGVjdGlvbiwgZGF0YSl7XG5cdFx0cmV0dXJuIHRoaXMuX0lEQi50aGVuKGRiID0+IHtcblx0XHRcdGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oY29sbGVjdGlvbiwgJ3JlYWR3cml0ZScpO1xuXHRcdFx0dHgub2JqZWN0U3RvcmUoY29sbGVjdGlvbikucHV0KGRhdGEpO1xuICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlLnRoZW4oKCkgPT4gY29uc29sZS5sb2coJ2RhdGEgYWRkZWQgdG8gJyArIGNvbGxlY3Rpb24pKTtcblx0XHR9KTtcblx0fVxuXG5cblx0Z2V0Q2FjaGVCeUlkKGNvbGxlY3Rpb24sIGlkID0gZmFsc2UpIHtcblx0XHRyZXR1cm4gdGhpcy5fSURCLnRoZW4oZGIgPT4ge1xuXHRcdFx0cmV0dXJuIGRiLnRyYW5zYWN0aW9uKGNvbGxlY3Rpb24pXG5cdFx0XHRcdC5vYmplY3RTdG9yZShjb2xsZWN0aW9uKS5pbmRleCgnYnktaWQnKS5nZXQocGFyc2VJbnQoaWQpKTtcblx0XHR9KTtcblx0fVxuXG5cblx0Z2V0Q2FjaGVBbGwoY29sbGVjdGlvbiwgaW5kZXggPSAnYnktaWQnKSB7XG5cdFx0cmV0dXJuIHRoaXMuX0lEQi50aGVuKGRiID0+IHtcblx0XHRcdHJldHVybiBkYi50cmFuc2FjdGlvbihjb2xsZWN0aW9uKVxuXHRcdFx0XHQub2JqZWN0U3RvcmUoY29sbGVjdGlvbilcblx0XHRcdFx0LmluZGV4KGluZGV4KVxuXHRcdFx0XHQuZ2V0QWxsKCk7XG5cdFx0fSkudGhlbihyZXN0YXVyYW50cyA9PiByZXN0YXVyYW50cyk7XG5cdH1cblxuXG5cdGRlbGV0ZUNhY2hlKGNvbGxlY3Rpb24sIGlkKSB7XG5cdFx0cmV0dXJuIHRoaXMuX0lEQi50aGVuKGRiID0+IHtcblx0XHRcdGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oY29sbGVjdGlvbiwgJ3JlYWR3cml0ZScpO1xuXHRcdFx0dHgub2JqZWN0U3RvcmUoY29sbGVjdGlvbikuZGVsZXRlKGlkKTtcblx0XHRcdHJldHVybiB0eC5jb21wbGV0ZTtcblx0XHR9KTtcblx0fVxuXG5cblx0Y2xlYXJDYWNoZShjb2xsZWN0aW9uKSB7XG5cdFx0cmV0dXJuIHRoaXMuX0lEQi50aGVuKGRiID0+IHtcblx0XHRcdGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oY29sbGVjdGlvbiwgJ3JlYWR3cml0ZScpO1xuXHRcdFx0dHgub2JqZWN0U3RvcmUoY29sbGVjdGlvbikuY2xlYXIoKTtcblx0XHRcdHJldHVybiB0eC5jb21wbGV0ZTtcblx0XHR9KTtcblx0fVxuXG5cbn1cbiIsImltcG9ydCBJREIgZnJvbSAnaWRiJztcbmltcG9ydCBEYXRhQ2FjaGUgZnJvbSAnLi9kYXRhQ2FjaGUnO1xuaW1wb3J0IGNvbnN0YW50cyBmcm9tICcuL2NvbnN0YW50cyc7XG5cbmNvbnN0IENPTExFQ1RJT05TID0gY29uc3RhbnRzLkNPTExFQ1RJT05TO1xuXG4vKlxuKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cbiovXG5jbGFzcyBEQkhlbHBlciB7XG5cblx0Y29uc3RydWN0b3IoKXtcblx0XHRjb25zdCBwb3J0ID0gMTMzNzsgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxuXHRcdC8vIERhdGFiYXNlIFVSTC5cblx0XHR0aGlzLkRBVEFCQVNFID0ge1xuXHRcdFx0UkVTVEFVUkFOVFM6IGBodHRwOi8vMC4wLjAuMDoke3BvcnR9L3Jlc3RhdXJhbnRzYCxcblx0XHRcdFJFVklFV1M6IGBodHRwOi8vMC4wLjAuMDoke3BvcnR9L3Jldmlld3MvYCxcblx0XHR9XG5cblx0XHR0aGlzLmlkYkNhY2hlID0gbmV3IERhdGFDYWNoZSgpO1xuXHR9XG5cblxuXHQvLyBEYXRhIHN0b3JhZ2UgaW50ZXJmYWNlcyBcXFxcXG5cblx0dG9vZ2xlRmF2b3JpdGUoaWQsIGNhbGxiYWNrKSB7XG5cdFx0dGhpcy5pZGJDYWNoZS5nZXRDYWNoZUJ5SWQoQ09MTEVDVElPTlMuUkVTVEFVUkFOVFMsIGlkKS50aGVuKChyZXNwb25zZSkgPT4ge1xuXG5cdFx0XHRjb25zdCB0b29nbGUgPSByZXNwb25zZS5pc19mYXZvcml0ZSA9PT0gXCJ0cnVlXCIgPyBcImZhbHNlXCIgOiBcInRydWVcIjtcblx0XHRcdHJlc3BvbnNlLmlzX2Zhdm9yaXRlID0gdG9vZ2xlO1xuXHRcdFx0cmV0dXJuIHRoaXMuaWRiQ2FjaGUuc2V0Q2FjaGUoQ09MTEVDVElPTlMuUkVTVEFVUkFOVFMsIHJlc3BvbnNlKS50aGVuKCgpID0+IHtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xuXHRcdFx0XHRpZighbmF2aWdhdG9yLm9uTGluZSkge1xuXHRcdFx0XHRcdHRoaXMuaWRiQ2FjaGUuc2V0U3luY0FzUGVuZGluZyhDT0xMRUNUSU9OUy5SRVNUQVVSQU5UUywgZmFsc2UpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvbnN0IHBhdGggPSBgLyR7aWR9Lz9pc19mYXZvcml0ZT0ke3Rvb2dsZX1gO1xuXHRcdFx0XHRcdHJldHVybiBmZXRjaCh0aGlzLkRBVEFCQVNFLlJFU1RBVVJBTlRTICsgcGF0aCwgeyBtZXRob2Q6ICdQVVQnIH0pLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHRoaXMuaWRiQ2FjaGUuc2V0U3luY0FzUGVuZGluZyhDT0xMRUNUSU9OUy5SRVNUQVVSQU5UUywgdHJ1ZSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0pXG5cdFx0LmNhdGNoKChlcnJvcikgPT4gY2FsbGJhY2soZXJyb3IsIG51bGwpKTtcblx0fVxuXG5cblx0c2F2ZVJldmlldyhkYXRhLCBjYWxsYmFjaykge1xuXHRcdGlmKCFuYXZpZ2F0b3Iub25MaW5lKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5pZGJDYWNoZS5zZXRDYWNoZShDT0xMRUNUSU9OUy5VTlNZTkNFRF9SRVZJRVdTLCBkYXRhKS50aGVuKCgpID0+IHtcblx0XHRcdFx0dGhpcy5pZGJDYWNoZS5zZXRTeW5jQXNQZW5kaW5nKENPTExFQ1RJT05TLlJFVklFV1MsIGZhbHNlKTtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgZGF0YSk7XG5cdFx0XHR9KS5jYXRjaCgoZXJyb3IpID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0cmV0dXJuIGZldGNoKHRoaXMuREFUQUJBU0UuUkVWSUVXUywge1xuXHRcdFx0XHQgbWV0aG9kOiAnUE9TVCcsXG5cdFx0XHRcdCBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKVxuXHRcdFx0IH0pXG5cdFx0XHQgLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG5cdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMgPCA0MDApIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5pZGJDYWNoZS5zZXRDYWNoZShDT0xMRUNUSU9OUy5SRVZJRVdTLCBkYXRhKS50aGVuKCgpID0+IHtcblx0XHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcblx0XHRcdFx0XHRcdHJldHVybiB0aGlzLmlkYkNhY2hlLnNldFN5bmNBc1BlbmRpbmcoQ09MTEVDVElPTlMuUkVWSUVXUywgdHJ1ZSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGBFcnJvciBjb2RlICR7cmVzcG9uc2Uuc3RhdHVzfWApO1xuXHRcdFx0XHR9XG5cdFx0XHR9KS5jYXRjaCgoZXJyb3IpID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSk7XG5cblx0XHR9XG5cdH1cblxuXG5cdC8qKlxuXHQgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXG5cdCAqL1xuXHRmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XG5cdFx0dGhpcy5pZGJDYWNoZS5nZXRDYWNoZUFsbChDT0xMRUNUSU9OUy5SRVNUQVVSQU5UUykudGhlbihkYXRhID0+IHtcblx0XHRcdGlmKGRhdGEubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCBkYXRhKTtcblx0XHRcdFx0Y29uc29sZS5sb2coJ2RhdGEgbG9hZGVkIGZyb20gbG9jYWwgc3RvcmFnZSEnKTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0ZmV0Y2godGhpcy5EQVRBQkFTRS5SRVNUQVVSQU5UUykudGhlbihyZXNwb25zZSA9PiB7XG5cdFx0XHRcdFx0aWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG5cdFx0XHRcdFx0XHRyZXNwb25zZS5qc29uKCkudGhlbihkYXRhID0+IHtcblx0XHRcdFx0XHRcdFx0dGhpcy5pZGJDYWNoZS5jYWNoZURhdGEoQ09MTEVDVElPTlMuUkVTVEFVUkFOVFMsIGRhdGEpO1xuXHRcdFx0XHRcdFx0XHRjYWxsYmFjayhudWxsLCBkYXRhKTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRjYWxsYmFjayh0aGlzLmhhbmRsZVJlc3BvbnNlRXJyb3IocmVzcG9uc2UsICdhcGkgcmVxdWVzdCcpLCBudWxsKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pLmNhdGNoKGVycm9yID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSk7XG5cblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXG5cdCAqL1xuXHRmZXRjaFJldmlld3MoaWQsIGNhbGxiYWNrKSB7XG5cdFx0Ly8gY2hlY2sgdW5zeWNlZCByZXZpZXdzXG5cdFx0dGhpcy5pZGJDYWNoZS5nZXRDYWNoZUFsbChDT0xMRUNUSU9OUy5VTlNZTkNFRF9SRVZJRVdTKS50aGVuKCh1bnN5Y2VkUmV2aWV3cykgPT4ge1xuXG5cdFx0XHRpZighbmF2aWdhdG9yLm9uTGluZSl7XG5cdFx0XHRcdHRoaXMuaWRiQ2FjaGUuZ2V0Q2FjaGVBbGwoQ09MTEVDVElPTlMuUkVWSUVXUykudGhlbigocmV2aWV3cykgPT4ge1xuXHRcdFx0XHRcdGNvbnN0IGNhY2hlZFJldmlld3MgPSBbLi4ucmV2aWV3cywgLi4udW5zeWNlZFJldmlld3NdO1xuXHRcdFx0XHRcdGlmKGNhY2hlZFJldmlld3MgJiYgY2FjaGVkUmV2aWV3cy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0XHRjb25zdCBmaWx0ZXJlZFJldmlld3MgPSBjYWNoZWRSZXZpZXdzLmZpbHRlcigocmV2aWV3KSA9PiByZXZpZXcucmVzdGF1cmFudF9pZCA9PT0gaWQpO1xuXHRcdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgZmlsdGVyZWRSZXZpZXdzKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgW10pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdC8vIFN5Y2VkIHJldmlld3MgaWYgYW55IHVuc3ljZWRcblx0XHRcdFx0aWYodW5zeWNlZFJldmlld3MgJiYgdW5zeWNlZFJldmlld3MubGVuZ3RoID4gMCl7XG5cdFx0XHRcdFx0dW5zeWNlZFJldmlld3MuZm9yRWFjaCgocmV2aWV3KSA9PiB7XG5cdFx0XHRcdFx0XHR0aGlzLnNhdmVSZXZpZXcocmV2aWV3LCAoZXJyb3IsIGRhdGEpID0+IHtcblx0XHRcdFx0XHRcdFx0aWYoZXJyb3IpIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0dGhpcy5pZGJDYWNoZS5jbGVhckNhY2hlKENPTExFQ1RJT05TLlVOU1lOQ0VEX1JFVklFV1MpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y29uc3QgcmV2aWV3c1BhdGggPSBgP3Jlc3RhdXJhbnRfaWQ9JHtpZH1gO1xuXHRcdFx0XHRmZXRjaCh0aGlzLkRBVEFCQVNFLlJFVklFV1MgKyByZXZpZXdzUGF0aCkudGhlbihyZXNwb25zZSA9PiB7XG5cdFx0XHRcdFx0aWYgKHJlc3BvbnNlLnN0YXR1cyA8IDQwMCkge1xuXHRcdFx0XHRcdFx0cmVzcG9uc2UuanNvbigpLnRoZW4oZGF0YSA9PiB7XG5cdFx0XHRcdFx0XHRcdHRoaXMuaWRiQ2FjaGUuY2FjaGVEYXRhKENPTExFQ1RJT05TLlJFVklFV1MsIGRhdGEpO1xuXHRcdFx0XHRcdFx0XHRjYWxsYmFjayhudWxsLCBkYXRhKTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRjYWxsYmFjayh0aGlzLmhhbmRsZVJlc3BvbnNlRXJyb3IocmVzcG9uc2UsICdBUEkgcmVxdWVzdCcpLCBudWxsKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pLmNhdGNoKGVycm9yID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSk7XG5cdFx0XHR9XG5cblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxuXHQgKi9cblx0ZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcblx0XHRpZighbmF2aWdhdG9yLm9uTGluZSkge1xuXHRcdFx0dGhpcy5pZGJDYWNoZS5nZXRDYWNoZUJ5SWQoQ09MTEVDVElPTlMuUkVTVEFVUkFOVFMsIGlkKS50aGVuKChyZXNwb25zZSkgPT4ge1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG5cdFx0XHR9KS5jYXRjaChlcnJvciA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjb25zdCBwYXRoID0gYC8ke2lkfWA7XG5cdFx0XHRmZXRjaCh0aGlzLkRBVEFCQVNFLlJFU1RBVVJBTlRTICsgcGF0aCkudGhlbihyZXNwb25zZSA9PiB7XG5cdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuXHRcdFx0XHRcdHJlc3BvbnNlLmpzb24oKS50aGVuKGRhdGEgPT4ge1xuXHRcdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgZGF0YSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y2FsbGJhY2sodGhpcy5oYW5kbGVSZXNwb25zZUVycm9yKHJlc3BvbnNlLCAnYXBpIHJlcXVlc3QnKSwgbnVsbCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pLmNhdGNoKGVycm9yID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSk7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuXHQgKi9cblx0ZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XG5cdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHR3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xuXHRcdHRoaXMuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcblx0XHRcdFx0Y29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXHQvKipcblx0ICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG5cdCAqL1xuXHRmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XG5cdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG5cdFx0dGhpcy5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcblx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxuXHRcdFx0XHRjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblx0LyoqXG5cdCAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG5cdCAqL1xuXHRmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuXHRcdHRoaXMuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0bGV0IHJlc3VsdHMgPSByZXN0YXVyYW50cztcblx0XHRcdFx0aWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcblx0XHRcdFx0XHRyZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2Rcblx0XHRcdFx0XHRyZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cdC8qKlxuXHQgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cblx0ICovXG5cdGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuXHRcdHRoaXMuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXG5cdFx0XHRcdGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZCk7XG5cdFx0XHRcdC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xuXHRcdFx0XHRjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpKTtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuICAvKipcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cbiAgZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIHRoaXMuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuICAgICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKTtcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xuICAgICAgICBjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cblx0LyoqXG5cdCAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXG5cdCAqL1xuXHR1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcblx0XHRyZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XG5cdH1cblx0LyoqXG5cdCAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxuXHQgKi9cblx0aW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNpemUpIHtcblx0XHRsZXQgaW1nID0gcmVzdGF1cmFudC5waG90b2dyYXBoO1xuXHRcdHJldHVybiBpbWcgPyAoYC9pbWcvJHtpbWd9LSR7c2l6ZX0uanBnYCkgOiAnL2ltZy9yZXN0YXVyYW50X3BsYWNlaG9sZGVyLnN2Zyc7XG5cdH1cblx0LyoqXG5cdCAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cblx0ICovXG5cdG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XG5cdFx0Y29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG5cdFx0XHRwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXG5cdFx0XHR0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxuXHRcdFx0dXJsOiB0aGlzLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXG5cdFx0XHRtYXA6IG1hcCxcblx0XHRcdGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1B9XG5cdFx0KTtcblx0XHRyZXR1cm4gbWFya2VyO1xuXHR9XG5cblx0aGFuZGxlUmVzcG9uc2VFcnJvcihyZXNwb25zZSwgdHlwZSl7XG5cdFx0c3dpdGNoIChyZXNwb25zZS5zdGF0dXMpIHtcblx0XHRcdGNhc2UgNDAwOlxuXHRcdFx0XHRyZXR1cm4gbmV3IEVycm9yKCdCZWQgcmVxdWVzdCcpO1xuXHRcdFx0Y2FzZSA0MDQ6XG5cdFx0XHRcdHJldHVybiBuZXcgRXJyb3IoJ05vdCBmb3VuZCcpO1xuXHRcdFx0Y2FzZSA1MDA6XG5cdFx0XHRcdHJldHVybiBuZXcgRXJyb3IoJ0ludGVybmFsIHNlcnZlciBlcnJvcicpO1xuXHRcdH1cblx0fVxuXG59XG5cblxuZXhwb3J0IGRlZmF1bHQgREJIZWxwZXI7XG4iLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gdG9BcnJheShhcnIpIHtcbiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXN1bHQpO1xuICAgICAgfTtcblxuICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciByZXF1ZXN0O1xuICAgIHZhciBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0ID0gb2JqW21ldGhvZF0uYXBwbHkob2JqLCBhcmdzKTtcbiAgICAgIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkudGhlbihyZXNvbHZlLCByZWplY3QpO1xuICAgIH0pO1xuXG4gICAgcC5yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgICByZXR1cm4gcDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG4gICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncyk7XG4gICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIHAucmVxdWVzdCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVByb3BlcnRpZXMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUHJveHlDbGFzcy5wcm90b3R5cGUsIHByb3AsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpIHtcbiAgICAgICAgICB0aGlzW3RhcmdldFByb3BdW3Byb3BdID0gdmFsO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eU1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXS5hcHBseSh0aGlzW3RhcmdldFByb3BdLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBJbmRleChpbmRleCkge1xuICAgIHRoaXMuX2luZGV4ID0gaW5kZXg7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoSW5kZXgsICdfaW5kZXgnLCBbXG4gICAgJ25hbWUnLFxuICAgICdrZXlQYXRoJyxcbiAgICAnbXVsdGlFbnRyeScsXG4gICAgJ3VuaXF1ZSdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbXG4gICAgJ2dldCcsXG4gICAgJ2dldEtleScsXG4gICAgJ2dldEFsbCcsXG4gICAgJ2dldEFsbEtleXMnLFxuICAgICdjb3VudCdcbiAgXSk7XG5cbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbXG4gICAgJ29wZW5DdXJzb3InLFxuICAgICdvcGVuS2V5Q3Vyc29yJ1xuICBdKTtcblxuICBmdW5jdGlvbiBDdXJzb3IoY3Vyc29yLCByZXF1ZXN0KSB7XG4gICAgdGhpcy5fY3Vyc29yID0gY3Vyc29yO1xuICAgIHRoaXMuX3JlcXVlc3QgPSByZXF1ZXN0O1xuICB9XG5cbiAgcHJveHlQcm9wZXJ0aWVzKEN1cnNvciwgJ19jdXJzb3InLCBbXG4gICAgJ2RpcmVjdGlvbicsXG4gICAgJ2tleScsXG4gICAgJ3ByaW1hcnlLZXknLFxuICAgICd2YWx1ZSdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhDdXJzb3IsICdfY3Vyc29yJywgSURCQ3Vyc29yLCBbXG4gICAgJ3VwZGF0ZScsXG4gICAgJ2RlbGV0ZSdcbiAgXSk7XG5cbiAgLy8gcHJveHkgJ25leHQnIG1ldGhvZHNcbiAgWydhZHZhbmNlJywgJ2NvbnRpbnVlJywgJ2NvbnRpbnVlUHJpbWFyeUtleSddLmZvckVhY2goZnVuY3Rpb24obWV0aG9kTmFtZSkge1xuICAgIGlmICghKG1ldGhvZE5hbWUgaW4gSURCQ3Vyc29yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICBDdXJzb3IucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgY3Vyc29yID0gdGhpcztcbiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgIGN1cnNvci5fY3Vyc29yW21ldGhvZE5hbWVdLmFwcGx5KGN1cnNvci5fY3Vyc29yLCBhcmdzKTtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3QoY3Vyc29yLl9yZXF1ZXN0KS50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBjdXJzb3IuX3JlcXVlc3QpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIE9iamVjdFN0b3JlKHN0b3JlKSB7XG4gICAgdGhpcy5fc3RvcmUgPSBzdG9yZTtcbiAgfVxuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5jcmVhdGVJbmRleCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuY3JlYXRlSW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5pbmRleCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuaW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIFtcbiAgICAnbmFtZScsXG4gICAgJ2tleVBhdGgnLFxuICAgICdpbmRleE5hbWVzJyxcbiAgICAnYXV0b0luY3JlbWVudCdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ3B1dCcsXG4gICAgJ2FkZCcsXG4gICAgJ2RlbGV0ZScsXG4gICAgJ2NsZWFyJyxcbiAgICAnZ2V0JyxcbiAgICAnZ2V0QWxsJyxcbiAgICAnZ2V0S2V5JyxcbiAgICAnZ2V0QWxsS2V5cycsXG4gICAgJ2NvdW50J1xuICBdKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAnb3BlbkN1cnNvcicsXG4gICAgJ29wZW5LZXlDdXJzb3InXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ2RlbGV0ZUluZGV4J1xuICBdKTtcblxuICBmdW5jdGlvbiBUcmFuc2FjdGlvbihpZGJUcmFuc2FjdGlvbikge1xuICAgIHRoaXMuX3R4ID0gaWRiVHJhbnNhY3Rpb247XG4gICAgdGhpcy5jb21wbGV0ZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uYWJvcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBUcmFuc2FjdGlvbi5wcm90b3R5cGUub2JqZWN0U3RvcmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX3R4Lm9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX3R4LCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoVHJhbnNhY3Rpb24sICdfdHgnLCBbXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnLFxuICAgICdtb2RlJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoVHJhbnNhY3Rpb24sICdfdHgnLCBJREJUcmFuc2FjdGlvbiwgW1xuICAgICdhYm9ydCdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gVXBncmFkZURCKGRiLCBvbGRWZXJzaW9uLCB0cmFuc2FjdGlvbikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gICAgdGhpcy5vbGRWZXJzaW9uID0gb2xkVmVyc2lvbjtcbiAgICB0aGlzLnRyYW5zYWN0aW9uID0gbmV3IFRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uKTtcbiAgfVxuXG4gIFVwZ3JhZGVEQi5wcm90b3R5cGUuY3JlYXRlT2JqZWN0U3RvcmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX2RiLmNyZWF0ZU9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoVXBncmFkZURCLCAnX2RiJywgW1xuICAgICduYW1lJyxcbiAgICAndmVyc2lvbicsXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhVcGdyYWRlREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuICAgICdkZWxldGVPYmplY3RTdG9yZScsXG4gICAgJ2Nsb3NlJ1xuICBdKTtcblxuICBmdW5jdGlvbiBEQihkYikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gIH1cblxuICBEQi5wcm90b3R5cGUudHJhbnNhY3Rpb24gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uKHRoaXMuX2RiLnRyYW5zYWN0aW9uLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoREIsICdfZGInLCBbXG4gICAgJ25hbWUnLFxuICAgICd2ZXJzaW9uJyxcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKERCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcbiAgICAnY2xvc2UnXG4gIF0pO1xuXG4gIC8vIEFkZCBjdXJzb3IgaXRlcmF0b3JzXG4gIC8vIFRPRE86IHJlbW92ZSB0aGlzIG9uY2UgYnJvd3NlcnMgZG8gdGhlIHJpZ2h0IHRoaW5nIHdpdGggcHJvbWlzZXNcbiAgWydvcGVuQ3Vyc29yJywgJ29wZW5LZXlDdXJzb3InXS5mb3JFYWNoKGZ1bmN0aW9uKGZ1bmNOYW1lKSB7XG4gICAgW09iamVjdFN0b3JlLCBJbmRleF0uZm9yRWFjaChmdW5jdGlvbihDb25zdHJ1Y3Rvcikge1xuICAgICAgLy8gRG9uJ3QgY3JlYXRlIGl0ZXJhdGVLZXlDdXJzb3IgaWYgb3BlbktleUN1cnNvciBkb2Vzbid0IGV4aXN0LlxuICAgICAgaWYgKCEoZnVuY05hbWUgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXG4gICAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGVbZnVuY05hbWUucmVwbGFjZSgnb3BlbicsICdpdGVyYXRlJyldID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMpO1xuICAgICAgICB2YXIgY2FsbGJhY2sgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07XG4gICAgICAgIHZhciBuYXRpdmVPYmplY3QgPSB0aGlzLl9zdG9yZSB8fCB0aGlzLl9pbmRleDtcbiAgICAgICAgdmFyIHJlcXVlc3QgPSBuYXRpdmVPYmplY3RbZnVuY05hbWVdLmFwcGx5KG5hdGl2ZU9iamVjdCwgYXJncy5zbGljZSgwLCAtMSkpO1xuICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGNhbGxiYWNrKHJlcXVlc3QucmVzdWx0KTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIHBvbHlmaWxsIGdldEFsbFxuICBbSW5kZXgsIE9iamVjdFN0b3JlXS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG4gICAgaWYgKENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwpIHJldHVybjtcbiAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsID0gZnVuY3Rpb24ocXVlcnksIGNvdW50KSB7XG4gICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuICAgICAgdmFyIGl0ZW1zID0gW107XG5cbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7XG4gICAgICAgIGluc3RhbmNlLml0ZXJhdGVDdXJzb3IocXVlcnksIGZ1bmN0aW9uKGN1cnNvcikge1xuICAgICAgICAgIGlmICghY3Vyc29yKSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xuXG4gICAgICAgICAgaWYgKGNvdW50ICE9PSB1bmRlZmluZWQgJiYgaXRlbXMubGVuZ3RoID09IGNvdW50KSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgdmFyIGV4cCA9IHtcbiAgICBvcGVuOiBmdW5jdGlvbihuYW1lLCB2ZXJzaW9uLCB1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnb3BlbicsIFtuYW1lLCB2ZXJzaW9uXSk7XG4gICAgICB2YXIgcmVxdWVzdCA9IHAucmVxdWVzdDtcblxuICAgICAgaWYgKHJlcXVlc3QpIHtcbiAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgIGlmICh1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgICAgICAgIHVwZ3JhZGVDYWxsYmFjayhuZXcgVXBncmFkZURCKHJlcXVlc3QucmVzdWx0LCBldmVudC5vbGRWZXJzaW9uLCByZXF1ZXN0LnRyYW5zYWN0aW9uKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKGRiKSB7XG4gICAgICAgIHJldHVybiBuZXcgREIoZGIpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBkZWxldGU6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdkZWxldGVEYXRhYmFzZScsIFtuYW1lXSk7XG4gICAgfVxuICB9O1xuXG4gIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZXhwO1xuICAgIG1vZHVsZS5leHBvcnRzLmRlZmF1bHQgPSBtb2R1bGUuZXhwb3J0cztcbiAgfVxuICBlbHNlIHtcbiAgICBzZWxmLmlkYiA9IGV4cDtcbiAgfVxufSgpKTtcbiJdfQ==\n"]}