{"version":3,"sources":["dataWorker.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Object","defineProperty","value","default","COLLECTIONS","RESTAURANTS","REVIEWS","UNSYNCED_REVIEWS","IS_DATA_SYNCRONIZED","2","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_idb2","_interopRequireDefault","obj","__esModule","DataCache","instance","TypeError","_classCallCheck","this","dbName","_IDB","setDatabase","setSyncAsPending","open","upgradedDB","oldVersion","createObjectStore","keyPath","createIndex","autoIncrement","console","log","collection","status","then","db","transaction","objectStore","put","data","arguments","undefined","tx","readwriteStore","forEach","item","complete","id","index","get","parseInt","getAll","restaurants","delete","clear","./constants","idb","3","_storage","dataObject","self","onmessage","input","action","fetchRestaurantById","error","result","warn","postMessage","fetchRestaurantByCuisineAndNeighborhood","cuisine","neighborhood","fetchNeighborhoods","fetchCuisines","toggleFavorite","fetchReviews","saveReview","./storage","4","_dataCache2","_toConsumableArray","arr","Array","isArray","arr2","from","Storage","DATABASE","reloadInterval","reloadTimer","Date","now","idbCache","syncDataToApi","callback","_this","navigator","onLine","fetch","response","json","cacheData","handleResponseError","catch","getCacheAll","_this2","unsycedReviews","reviewsPath","reviews","cachedReviews","concat","filteredReviews","filter","review","restaurant_id","_this3","path","getCacheById","fetchRestaurants","results","cuisine_type","neighborhoods","map","v","uniqueNeighborhoods","indexOf","cuisines","uniqueCuisines","_this4","toogle","is_favorite","setCache","method","_this5","body","JSON","stringify","responseData","_this6","setInterval","clearCache","restaurant","google","maps","Marker","position","latlng","title","name","url","animation","Animation","DROP","type","./dataCache","5","promisifyRequest","request","Promise","resolve","reject","onsuccess","onerror","promisifyRequestCall","args","apply","proxyProperties","ProxyClass","targetProp","properties","prop","set","val","proxyRequestMethods","proxyMethods","proxyCursorRequestMethods","Cursor","Index","_index","cursor","_cursor","_request","ObjectStore","store","_store","Transaction","idbTransaction","_tx","oncomplete","onabort","UpgradeDB","_db","DB","IDBIndex","IDBCursor","methodName","IDBObjectStore","IDBTransaction","IDBDatabase","funcName","replace","slice","nativeObject","query","count","items","iterateCursor","push","continue","exp","version","upgradeCallback","indexedDB","onupgradeneeded","event"],"mappings":"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","file":"dataWorker.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar constants = {\n  COLLECTIONS: {\n    RESTAURANTS: 'restaurants',\n    REVIEWS: 'reviews',\n    UNSYNCED_REVIEWS: 'unsynced_reviews',\n    IS_DATA_SYNCRONIZED: 'isDataSyncronzed'\n  }\n};\n\nexports.default = constants;\n\n},{}],2:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _idb = require('idb');\n\nvar _idb2 = _interopRequireDefault(_idb);\n\nvar _constants = require('./constants');\n\nvar _constants2 = _interopRequireDefault(_constants);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar COLLECTIONS = _constants2.default.COLLECTIONS;\n\n/*\n* Common database helper functions.\n*/\n\nvar DataCache = function () {\n\tfunction DataCache() {\n\t\t_classCallCheck(this, DataCache);\n\n\t\tthis.dbName = \"restaurantApp\";\n\t\tthis._IDB = this.setDatabase(this.dbName);\n\t\tthis.setSyncAsPending(COLLECTIONS.RESTAURANTS, true);\n\t\tthis.setSyncAsPending(COLLECTIONS.REVIEWS, true);\n\t}\n\n\t_createClass(DataCache, [{\n\t\tkey: 'setDatabase',\n\t\tvalue: function setDatabase(dbName) {\n\t\t\treturn _idb2.default.open(dbName, 1, function (upgradedDB) {\n\t\t\t\tswitch (upgradedDB.oldVersion) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\tvar restaurants = upgradedDB.createObjectStore(COLLECTIONS.RESTAURANTS, { keyPath: 'id' });\n\t\t\t\t\t\trestaurants.createIndex('by-id', 'id');\n\n\t\t\t\t\t\tvar reviews = upgradedDB.createObjectStore(COLLECTIONS.REVIEWS, { keyPath: 'id' });\n\t\t\t\t\t\treviews.createIndex('by-id', 'restaurant_id');\n\n\t\t\t\t\t\tvar unsyncedReviews = upgradedDB.createObjectStore(COLLECTIONS.UNSYNCED_REVIEWS, { autoIncrement: true });\n\t\t\t\t\t\tunsyncedReviews.createIndex('by-id', 'restaurant_id');\n\n\t\t\t\t\t\tupgradedDB.createObjectStore(COLLECTIONS.IS_DATA_SYNCRONIZED, { keyPath: 'collection' });\n\t\t\t\t\t\tconsole.log('Database and Index created');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Set local data sync as panding\n   */\n\n\t}, {\n\t\tkey: 'setSyncAsPending',\n\t\tvalue: function setSyncAsPending(collection, status) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(COLLECTIONS.IS_DATA_SYNCRONIZED, 'readwrite');\n\t\t\t\ttx.objectStore(COLLECTIONS.IS_DATA_SYNCRONIZED).put({ collection: collection, status: status });\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'cacheData',\n\t\tvalue: function cacheData(collection) {\n\t\t\tvar data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n\t\t\t// add post the local DB\n\t\t\tthis._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\tvar readwriteStore = tx.objectStore(collection);\n\t\t\t\tdata.forEach(function (item) {\n\t\t\t\t\treturn readwriteStore.put(item);\n\t\t\t\t});\n\t\t\t\treturn tx.complete;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'setCache',\n\t\tvalue: function setCache(collection, data) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\ttx.objectStore(collection).put(data);\n\t\t\t\treturn tx.complete;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'getCacheById',\n\t\tvalue: function getCacheById(collection) {\n\t\t\tvar id = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\treturn db.transaction(collection).objectStore(collection).index('by-id').get(parseInt(id));\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'getCacheAll',\n\t\tvalue: function getCacheAll(collection) {\n\t\t\tvar index = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'by-id';\n\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\treturn db.transaction(collection).objectStore(collection).index(index).getAll();\n\t\t\t}).then(function (restaurants) {\n\t\t\t\treturn restaurants;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'deleteCache',\n\t\tvalue: function deleteCache(collection, id) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\ttx.objectStore(collection).delete(id);\n\t\t\t\treturn tx.complete;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'clearCache',\n\t\tvalue: function clearCache(collection) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\ttx.objectStore(collection).clear();\n\t\t\t\treturn tx.complete;\n\t\t\t});\n\t\t}\n\t}]);\n\n\treturn DataCache;\n}();\n\nexports.default = DataCache;\n\n},{\"./constants\":1,\"idb\":5}],3:[function(require,module,exports){\n\"use strict\";\n\nvar _storage = require(\"./storage\");\n\nvar _storage2 = _interopRequireDefault(_storage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// const dataObject = new Storage();\nvar dataObject = new _storage2.default(); // importScripts('storage.js');\n\n\nself.onmessage = function (e) {\n  var input = e.data.input;\n  var action = e.data.action;\n\n  try {\n\n    switch (action) {\n\n      case \"fetchRestaurantById\":\n        dataObject.fetchRestaurantById(input.id, function (error, result) {\n          if (error) console.warn(error);\n          postMessage({ action: action, result: result });\n        });\n        break;\n\n      case \"fetchRestaurantByCuisineAndNeighborhood\":\n        dataObject.fetchRestaurantByCuisineAndNeighborhood(input.cuisine, input.neighborhood, function (error, result) {\n          if (error) console.warn(error);\n          postMessage({ action: action, result: result });\n        });\n        break;\n\n      case \"fetchNeighborhoods\":\n        dataObject.fetchNeighborhoods(function (error, result) {\n          if (error) console.warn(error);\n          postMessage({ action: action, result: result });\n        });\n        break;\n\n      case \"fetchCuisines\":\n        dataObject.fetchCuisines(function (error, result) {\n          if (error) console.warn(error);\n          postMessage({ action: action, result: result });\n        });\n        break;\n\n      case \"toggleFavorite\":\n        dataObject.toggleFavorite(input.id, function (error, result) {\n          if (error) console.warn(error);\n          postMessage({ action: action, result: result });\n        });\n        break;\n\n      case \"fetchReviews\":\n        dataObject.fetchReviews(input.id, function (error, result) {\n          if (error) console.warn(error);\n          postMessage({ action: action, result: result });\n        });\n        break;\n\n      case \"saveReview\":\n        dataObject.saveReview(input.data, function (error, result) {\n          if (error) console.warn(error);\n          postMessage({ action: action, result: result });\n        });\n        break;\n\n      default:\n        postMessage({ action: action, result: \"Action not found\" });\n    }\n  } catch (e) {\n    postMessage(undefined);\n  }\n};\n\n},{\"./storage\":4}],4:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _idb = require('idb');\n\nvar _idb2 = _interopRequireDefault(_idb);\n\nvar _dataCache = require('./dataCache');\n\nvar _dataCache2 = _interopRequireDefault(_dataCache);\n\nvar _constants = require('./constants');\n\nvar _constants2 = _interopRequireDefault(_constants);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar COLLECTIONS = _constants2.default.COLLECTIONS;\n\n/*\n* Common database helper functions.\n*/\n\nvar Storage = function () {\n\tfunction Storage() {\n\t\t_classCallCheck(this, Storage);\n\n\t\tvar port = 1337; // Change this to your server port\n\t\t// Database URL.\n\t\tthis.DATABASE = {\n\t\t\tRESTAURANTS: 'http://0.0.0.0:' + port + '/restaurants',\n\t\t\tREVIEWS: 'http://0.0.0.0:' + port + '/reviews/'\n\t\t};\n\n\t\tthis.reloadInterval = 0;\n\t\tthis.reloadTimer = Date.now();\n\t\tthis.restaurants = [];\n\t\tthis.idbCache = new _dataCache2.default();\n\t\tthis.syncDataToApi();\n\t}\n\n\t/**\n  * Fetch all restaurants.\n  */\n\n\n\t_createClass(Storage, [{\n\t\tkey: 'fetchRestaurants',\n\t\tvalue: function fetchRestaurants(callback) {\n\t\t\tvar _this = this;\n\n\t\t\t// Allow reload local data every 5 minutes\n\t\t\tvar isTimeToReload = Date.now() - this.reloadTimer > this.reloadInterval ? true : false;\n\n\t\t\tif (isTimeToReload && navigator.onLine) {\n\t\t\t\tfetch(this.DATABASE.RESTAURANTS).then(function (response) {\n\t\t\t\t\tif (response.status === 200) {\n\t\t\t\t\t\tresponse.json().then(function (data) {\n\t\t\t\t\t\t\t_this.restaurants = data;\n\t\t\t\t\t\t\t_this.reloadInterval = 300;\n\t\t\t\t\t\t\t_this.idbCache.cacheData(COLLECTIONS.RESTAURANTS, data);\n\t\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback(_this.handleResponseError(response, 'api request'), null);\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.restaurants.length > 0) {\n\t\t\t\tcallback(null, this.restaurants);\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthis.idbCache.getCacheAll(COLLECTIONS.RESTAURANTS).then(function (data) {\n\t\t\t\t\tif (data.length > 0) {\n\t\t\t\t\t\t_this.restaurants = data;\n\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Fetch all restaurants.\n   */\n\n\t}, {\n\t\tkey: 'fetchReviews',\n\t\tvalue: function fetchReviews(id, callback) {\n\t\t\tvar _this2 = this;\n\n\t\t\t// check unsyced reviews\n\t\t\tthis.idbCache.getCacheAll(COLLECTIONS.UNSYNCED_REVIEWS).then(function (unsycedReviews) {\n\n\t\t\t\tif (!navigator.onLine) {\n\t\t\t\t\t_this2.idbCache.getCacheAll(COLLECTIONS.REVIEWS).then(function (reviews) {\n\t\t\t\t\t\tvar cachedReviews = [].concat(_toConsumableArray(reviews), _toConsumableArray(unsycedReviews));\n\t\t\t\t\t\tif (cachedReviews && cachedReviews.length > 0) {\n\t\t\t\t\t\t\tvar filteredReviews = cachedReviews.filter(function (review) {\n\t\t\t\t\t\t\t\treturn review.restaurant_id === id;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tcallback(null, filteredReviews);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcallback(null, []);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\n\t\t\t\t\t// Syced reviews if any unsyced\n\t\t\t\t\t// if(unsycedReviews && unsycedReviews.length > 0){\n\t\t\t\t\t// \tunsycedReviews.forEach((review) => {\n\t\t\t\t\t// \t\tthis.saveReview(review, (error, data) => {\n\t\t\t\t\t// \t\t\tif(error) console.error(error);\n\t\t\t\t\t// \t\t});\n\t\t\t\t\t// \t});\n\t\t\t\t\t// \tthis.idbCache.clearCache(COLLECTIONS.UNSYNCED_REVIEWS);\n\t\t\t\t\t// }\n\n\t\t\t\t\tvar reviewsPath = '?restaurant_id=' + id;\n\t\t\t\t\tfetch(_this2.DATABASE.REVIEWS + reviewsPath).then(function (response) {\n\t\t\t\t\t\tif (response.status < 400) {\n\t\t\t\t\t\t\tresponse.json().then(function (data) {\n\t\t\t\t\t\t\t\t_this2.idbCache.cacheData(COLLECTIONS.REVIEWS, data);\n\t\t\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcallback(_this2.handleResponseError(response, 'API request'), null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch(function (error) {\n\t\t\t\t\t\treturn callback(error, null);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Fetch a restaurant by its ID.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantById',\n\t\tvalue: function fetchRestaurantById(id, callback) {\n\t\t\tvar _this3 = this;\n\n\t\t\tif (!navigator.onLine) {\n\t\t\t\tthis.idbCache.getCacheById(COLLECTIONS.RESTAURANTS, id).then(function (response) {\n\t\t\t\t\tcallback(null, response);\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tvar path = '/' + id;\n\t\t\t\tfetch(this.DATABASE.RESTAURANTS + path).then(function (response) {\n\t\t\t\t\tif (response.status === 200) {\n\t\t\t\t\t\tresponse.json().then(function (data) {\n\t\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback(_this3.handleResponseError(response, 'api request'), null);\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Fetch restaurants by a cuisine type with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantByCuisine',\n\t\tvalue: function fetchRestaurantByCuisine(cuisine, callback) {\n\t\t\t// Fetch all restaurants\twith proper error handling\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Filter restaurants to have only given cuisine type\n\t\t\t\t\tvar results = restaurants.filter(function (r) {\n\t\t\t\t\t\treturn r.cuisine_type == cuisine;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, results);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t/**\n   * Fetch restaurants by a neighborhood with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantByNeighborhood',\n\t\tvalue: function fetchRestaurantByNeighborhood(neighborhood, callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Filter restaurants to have only given neighborhood\n\t\t\t\t\tvar results = restaurants.filter(function (r) {\n\t\t\t\t\t\treturn r.neighborhood == neighborhood;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, results);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t/**\n   * Fetch restaurants by a cuisine and a neighborhood with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantByCuisineAndNeighborhood',\n\t\tvalue: function fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\tvar results = restaurants;\n\t\t\t\t\tif (cuisine != 'all') {\n\t\t\t\t\t\t// filter by cuisine\n\t\t\t\t\t\tresults = results.filter(function (r) {\n\t\t\t\t\t\t\treturn r.cuisine_type == cuisine;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (neighborhood != 'all') {\n\t\t\t\t\t\t// filter by neighborhood\n\t\t\t\t\t\tresults = results.filter(function (r) {\n\t\t\t\t\t\t\treturn r.neighborhood == neighborhood;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tcallback(null, results);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t/**\n   * Fetch all neighborhoods with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchNeighborhoods',\n\t\tvalue: function fetchNeighborhoods(callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Get all neighborhoods from all restaurants\n\t\t\t\t\tvar neighborhoods = restaurants.map(function (v, i) {\n\t\t\t\t\t\treturn restaurants[i].neighborhood;\n\t\t\t\t\t});\n\t\t\t\t\t// Remove duplicates from neighborhoods\n\t\t\t\t\tvar uniqueNeighborhoods = neighborhoods.filter(function (v, i) {\n\t\t\t\t\t\treturn neighborhoods.indexOf(v) == i;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, uniqueNeighborhoods);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Fetch all cuisines with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchCuisines',\n\t\tvalue: function fetchCuisines(callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Get all cuisines from all restaurants\n\t\t\t\t\tvar cuisines = restaurants.map(function (v, i) {\n\t\t\t\t\t\treturn restaurants[i].cuisine_type;\n\t\t\t\t\t});\n\t\t\t\t\t// Remove duplicates from cuisines\n\t\t\t\t\tvar uniqueCuisines = cuisines.filter(function (v, i) {\n\t\t\t\t\t\treturn cuisines.indexOf(v) == i;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, uniqueCuisines);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'toggleFavorite',\n\t\tvalue: function toggleFavorite(id, callback) {\n\t\t\tvar _this4 = this;\n\n\t\t\tthis.idbCache.getCacheById(COLLECTIONS.RESTAURANTS, id).then(function (response) {\n\t\t\t\tvar toogle = response.is_favorite === \"true\" ? \"false\" : \"true\";\n\t\t\t\tresponse.is_favorite = toogle;\n\t\t\t\treturn _this4.idbCache.setCache(COLLECTIONS.RESTAURANTS, response).then(function () {\n\t\t\t\t\tcallback(null, response);\n\t\t\t\t\tif (!navigator.onLine) {\n\t\t\t\t\t\t_this4.idbCache.setSyncAsPending(COLLECTIONS.RESTAURANTS, false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar path = '/' + id + '/?is_favorite=' + toogle;\n\t\t\t\t\t\treturn fetch(_this4.DATABASE.RESTAURANTS + path, { method: 'PUT' }).then(function (response) {\n\t\t\t\t\t\t\tif (response.status === 200) _this4.idbCache.setSyncAsPending(COLLECTIONS.RESTAURANTS, true);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}).catch(function (error) {\n\t\t\t\treturn callback(error, null);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'saveReview',\n\t\tvalue: function saveReview(data, callback) {\n\t\t\tvar _this5 = this;\n\n\t\t\tif (!navigator.onLine) {\n\t\t\t\treturn this.idbCache.setCache(COLLECTIONS.UNSYNCED_REVIEWS, data).then(function () {\n\t\t\t\t\t_this5.idbCache.setSyncAsPending(COLLECTIONS.REVIEWS, false);\n\t\t\t\t\tcallback(null, data);\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t} else {\n\n\t\t\t\treturn fetch(this.DATABASE.REVIEWS, {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tbody: JSON.stringify(data)\n\t\t\t\t}).then(function (response) {\n\t\t\t\t\tif (response.status < 400) {\n\t\t\t\t\t\tresponse.json().then(function (responseData) {\n\t\t\t\t\t\t\treturn _this5.idbCache.setCache(COLLECTIONS.REVIEWS, responseData).then(function () {\n\t\t\t\t\t\t\t\tcallback(null, responseData);\n\t\t\t\t\t\t\t\treturn _this5.idbCache.setSyncAsPending(COLLECTIONS.REVIEWS, true);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error('Error code ' + response.status);\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'syncDataToApi',\n\t\tvalue: function syncDataToApi() {\n\t\t\tvar _this6 = this;\n\n\t\t\tvar syncInterval = setInterval(function () {\n\t\t\t\tif (!navigator.onLine) return;\n\t\t\t\t_this6.idbCache.getCacheAll(COLLECTIONS.UNSYNCED_REVIEWS).then(function (unsycedReviews) {\n\t\t\t\t\t// Syced reviews if any unsyced\n\t\t\t\t\tif (unsycedReviews && unsycedReviews.length > 0) {\n\t\t\t\t\t\tunsycedReviews.forEach(function (review) {\n\t\t\t\t\t\t\t_this6.saveReview(review, function (error, data) {\n\t\t\t\t\t\t\t\tif (error) console.error(error);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t\t_this6.idbCache.clearCache(COLLECTIONS.UNSYNCED_REVIEWS);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, 3000);\n\t\t}\n\n\t\t/**\n   * Map marker for a restaurant.\n   */\n\n\t}, {\n\t\tkey: 'mapMarkerForRestaurant',\n\t\tvalue: function mapMarkerForRestaurant(restaurant, map) {\n\t\t\tif (!google) return;\n\t\t\tvar marker = new google.maps.Marker({\n\t\t\t\tposition: restaurant.latlng,\n\t\t\t\ttitle: restaurant.name,\n\t\t\t\turl: './restaurant.html?id=' + restaurant.id,\n\t\t\t\tmap: map,\n\t\t\t\tanimation: google.maps.Animation.DROP });\n\t\t\treturn marker;\n\t\t}\n\t}, {\n\t\tkey: 'handleResponseError',\n\t\tvalue: function handleResponseError(response, type) {\n\t\t\tswitch (response.status) {\n\t\t\t\tcase 400:\n\t\t\t\t\treturn new Error('Bed request');\n\t\t\t\tcase 404:\n\t\t\t\t\treturn new Error('Not found');\n\t\t\t\tcase 500:\n\t\t\t\t\treturn new Error('Internal server error');\n\t\t\t}\n\t\t}\n\t}]);\n\n\treturn Storage;\n}();\n\nexports.default = Storage;\n\n},{\"./constants\":1,\"./dataCache\":2,\"idb\":5}],5:[function(require,module,exports){\n'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      if (request) {\n        request.onupgradeneeded = function(event) {\n          if (upgradeCallback) {\n            upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n          }\n        };\n      }\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n\n},{}]},{},[3])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9jb25zdGFudHMuanMiLCJqcy9kYXRhQ2FjaGUuanMiLCJqcy9kYXRhV29ya2VyLmpzIiwianMvc3RvcmFnZS5qcyIsIm5vZGVfbW9kdWxlcy9pZGIvbGliL2lkYi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FDQUEsSUFBTSxZQUFZO0FBQ2hCLGVBQWE7QUFDWixpQkFBYSxhQUREO0FBRVosYUFBUyxTQUZHO0FBR1osc0JBQWtCLGtCQUhOO0FBSVoseUJBQXFCO0FBSlQ7QUFERyxDQUFsQjs7a0JBU2UsUzs7Ozs7Ozs7Ozs7QUNUZjs7OztBQUNBOzs7Ozs7OztBQUVBLElBQU0sY0FBYyxvQkFBVSxXQUE5Qjs7QUFFQTs7OztJQUdxQixTO0FBRW5CLHNCQUFhO0FBQUE7O0FBQ2IsT0FBSyxNQUFMLEdBQWMsZUFBZDtBQUNBLE9BQUssSUFBTCxHQUFZLEtBQUssV0FBTCxDQUFpQixLQUFLLE1BQXRCLENBQVo7QUFDQSxPQUFLLGdCQUFMLENBQXNCLFlBQVksV0FBbEMsRUFBK0MsSUFBL0M7QUFDQSxPQUFLLGdCQUFMLENBQXNCLFlBQVksT0FBbEMsRUFBMkMsSUFBM0M7QUFDQTs7Ozs4QkFFVyxNLEVBQVE7QUFDbkIsVUFBTyxjQUFJLElBQUosQ0FBUyxNQUFULEVBQWlCLENBQWpCLEVBQW9CLFVBQUMsVUFBRCxFQUFnQjtBQUMxQyxZQUFPLFdBQVcsVUFBbEI7QUFDQyxVQUFLLENBQUw7QUFDQyxVQUFNLGNBQWMsV0FBVyxpQkFBWCxDQUE2QixZQUFZLFdBQXpDLEVBQXNELEVBQUMsU0FBUyxJQUFWLEVBQXRELENBQXBCO0FBQ0Esa0JBQVksV0FBWixDQUF3QixPQUF4QixFQUFpQyxJQUFqQzs7QUFFQSxVQUFNLFVBQVUsV0FBVyxpQkFBWCxDQUE2QixZQUFZLE9BQXpDLEVBQWtELEVBQUMsU0FBUyxJQUFWLEVBQWxELENBQWhCO0FBQ0EsY0FBUSxXQUFS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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiY29uc3QgY29uc3RhbnRzID0ge1xuICBDT0xMRUNUSU9OUzoge1xuICBcdFJFU1RBVVJBTlRTOiAncmVzdGF1cmFudHMnLFxuICBcdFJFVklFV1M6ICdyZXZpZXdzJyxcbiAgXHRVTlNZTkNFRF9SRVZJRVdTOiAndW5zeW5jZWRfcmV2aWV3cycsXG4gIFx0SVNfREFUQV9TWU5DUk9OSVpFRDogJ2lzRGF0YVN5bmNyb256ZWQnLFxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNvbnN0YW50cztcbiIsImltcG9ydCBJREIgZnJvbSAnaWRiJztcbmltcG9ydCBjb25zdGFudHMgZnJvbSAnLi9jb25zdGFudHMnO1xuXG5jb25zdCBDT0xMRUNUSU9OUyA9IGNvbnN0YW50cy5DT0xMRUNUSU9OUztcblxuLypcbiogQ29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXG4qL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRGF0YUNhY2hlIHtcblxuICBjb25zdHJ1Y3Rvcigpe1xuXHRcdHRoaXMuZGJOYW1lID0gXCJyZXN0YXVyYW50QXBwXCI7XG5cdFx0dGhpcy5fSURCID0gdGhpcy5zZXREYXRhYmFzZSh0aGlzLmRiTmFtZSk7XG5cdFx0dGhpcy5zZXRTeW5jQXNQZW5kaW5nKENPTExFQ1RJT05TLlJFU1RBVVJBTlRTLCB0cnVlKTtcblx0XHR0aGlzLnNldFN5bmNBc1BlbmRpbmcoQ09MTEVDVElPTlMuUkVWSUVXUywgdHJ1ZSk7XG5cdH1cblxuXHRzZXREYXRhYmFzZShkYk5hbWUpIHtcblx0XHRyZXR1cm4gSURCLm9wZW4oZGJOYW1lLCAxLCAodXBncmFkZWREQikgPT4ge1xuXHRcdFx0c3dpdGNoKHVwZ3JhZGVkREIub2xkVmVyc2lvbil7XG5cdFx0XHRcdGNhc2UgMDpcblx0XHRcdFx0XHRjb25zdCByZXN0YXVyYW50cyA9IHVwZ3JhZGVkREIuY3JlYXRlT2JqZWN0U3RvcmUoQ09MTEVDVElPTlMuUkVTVEFVUkFOVFMsIHtrZXlQYXRoOiAnaWQnfSk7XG5cdFx0XHRcdFx0cmVzdGF1cmFudHMuY3JlYXRlSW5kZXgoJ2J5LWlkJywgJ2lkJyk7XG5cblx0XHRcdFx0XHRjb25zdCByZXZpZXdzID0gdXBncmFkZWREQi5jcmVhdGVPYmplY3RTdG9yZShDT0xMRUNUSU9OUy5SRVZJRVdTLCB7a2V5UGF0aDogJ2lkJ30pO1xuXHRcdFx0XHRcdHJldmlld3MuY3JlYXRlSW5kZXgoJ2J5LWlkJywgJ3Jlc3RhdXJhbnRfaWQnKTtcblxuXHRcdFx0XHRcdGNvbnN0IHVuc3luY2VkUmV2aWV3cyA9IHVwZ3JhZGVkREIuY3JlYXRlT2JqZWN0U3RvcmUoQ09MTEVDVElPTlMuVU5TWU5DRURfUkVWSUVXUywge2F1dG9JbmNyZW1lbnQ6IHRydWV9KTtcblx0XHRcdFx0XHR1bnN5bmNlZFJldmlld3MuY3JlYXRlSW5kZXgoJ2J5LWlkJywgJ3Jlc3RhdXJhbnRfaWQnKTtcblxuXHRcdFx0XHRcdHVwZ3JhZGVkREIuY3JlYXRlT2JqZWN0U3RvcmUoQ09MTEVDVElPTlMuSVNfREFUQV9TWU5DUk9OSVpFRCwgeyBrZXlQYXRoOiAnY29sbGVjdGlvbicgfSk7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coJ0RhdGFiYXNlIGFuZCBJbmRleCBjcmVhdGVkJyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0ICogU2V0IGxvY2FsIGRhdGEgc3luYyBhcyBwYW5kaW5nXG5cdCAqL1xuXHRzZXRTeW5jQXNQZW5kaW5nKGNvbGxlY3Rpb24sIHN0YXR1cykge1xuXHRcdHJldHVybiB0aGlzLl9JREIudGhlbihkYiA9PiB7XG5cdFx0XHRjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKENPTExFQ1RJT05TLklTX0RBVEFfU1lOQ1JPTklaRUQsICdyZWFkd3JpdGUnKTtcblx0XHRcdHR4Lm9iamVjdFN0b3JlKENPTExFQ1RJT05TLklTX0RBVEFfU1lOQ1JPTklaRUQpLnB1dCh7IGNvbGxlY3Rpb24sIHN0YXR1cyB9KTtcblx0XHR9KTtcblx0fVxuXG5cblx0Y2FjaGVEYXRhKGNvbGxlY3Rpb24sIGRhdGEgPSBbXSl7XG5cdFx0IC8vIGFkZCBwb3N0IHRoZSBsb2NhbCBEQlxuXHRcdHRoaXMuX0lEQi50aGVuKGRiID0+IHtcblx0XHRcdGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oY29sbGVjdGlvbiwgJ3JlYWR3cml0ZScpO1xuXHRcdFx0Y29uc3QgcmVhZHdyaXRlU3RvcmUgPSB0eC5vYmplY3RTdG9yZShjb2xsZWN0aW9uKTtcblx0XHRcdGRhdGEuZm9yRWFjaCgoaXRlbSkgPT4gcmVhZHdyaXRlU3RvcmUucHV0KGl0ZW0pKTtcblx0XHRcdHJldHVybiB0eC5jb21wbGV0ZTtcblx0XHR9KTtcblx0fVxuXG5cblx0c2V0Q2FjaGUoY29sbGVjdGlvbiwgZGF0YSl7XG5cdFx0cmV0dXJuIHRoaXMuX0lEQi50aGVuKGRiID0+IHtcblx0XHRcdGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oY29sbGVjdGlvbiwgJ3JlYWR3cml0ZScpO1xuXHRcdFx0dHgub2JqZWN0U3RvcmUoY29sbGVjdGlvbikucHV0KGRhdGEpO1xuICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xuXHRcdH0pO1xuXHR9XG5cblxuXHRnZXRDYWNoZUJ5SWQoY29sbGVjdGlvbiwgaWQgPSBmYWxzZSkge1xuXHRcdHJldHVybiB0aGlzLl9JREIudGhlbihkYiA9PiB7XG5cdFx0XHRyZXR1cm4gZGIudHJhbnNhY3Rpb24oY29sbGVjdGlvbilcblx0XHRcdFx0Lm9iamVjdFN0b3JlKGNvbGxlY3Rpb24pLmluZGV4KCdieS1pZCcpLmdldChwYXJzZUludChpZCkpO1xuXHRcdH0pO1xuXHR9XG5cblxuXHRnZXRDYWNoZUFsbChjb2xsZWN0aW9uLCBpbmRleCA9ICdieS1pZCcpIHtcblx0XHRyZXR1cm4gdGhpcy5fSURCLnRoZW4oZGIgPT4ge1xuXHRcdFx0cmV0dXJuIGRiLnRyYW5zYWN0aW9uKGNvbGxlY3Rpb24pXG5cdFx0XHRcdC5vYmplY3RTdG9yZShjb2xsZWN0aW9uKVxuXHRcdFx0XHQuaW5kZXgoaW5kZXgpXG5cdFx0XHRcdC5nZXRBbGwoKTtcblx0XHR9KS50aGVuKHJlc3RhdXJhbnRzID0+IHJlc3RhdXJhbnRzKTtcblx0fVxuXG5cblx0ZGVsZXRlQ2FjaGUoY29sbGVjdGlvbiwgaWQpIHtcblx0XHRyZXR1cm4gdGhpcy5fSURCLnRoZW4oZGIgPT4ge1xuXHRcdFx0Y29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihjb2xsZWN0aW9uLCAncmVhZHdyaXRlJyk7XG5cdFx0XHR0eC5vYmplY3RTdG9yZShjb2xsZWN0aW9uKS5kZWxldGUoaWQpO1xuXHRcdFx0cmV0dXJuIHR4LmNvbXBsZXRlO1xuXHRcdH0pO1xuXHR9XG5cblxuXHRjbGVhckNhY2hlKGNvbGxlY3Rpb24pIHtcblx0XHRyZXR1cm4gdGhpcy5fSURCLnRoZW4oZGIgPT4ge1xuXHRcdFx0Y29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihjb2xsZWN0aW9uLCAncmVhZHdyaXRlJyk7XG5cdFx0XHR0eC5vYmplY3RTdG9yZShjb2xsZWN0aW9uKS5jbGVhcigpO1xuXHRcdFx0cmV0dXJuIHR4LmNvbXBsZXRlO1xuXHRcdH0pO1xuXHR9XG5cblxufVxuIiwiLy8gaW1wb3J0U2NyaXB0cygnc3RvcmFnZS5qcycpO1xuaW1wb3J0IFN0b3JhZ2UgZnJvbSAnLi9zdG9yYWdlJztcblxuXG4vLyBjb25zdCBkYXRhT2JqZWN0ID0gbmV3IFN0b3JhZ2UoKTtcbmNvbnN0IGRhdGFPYmplY3QgPSBuZXcgU3RvcmFnZSgpO1xuXG5zZWxmLm9ubWVzc2FnZSA9IGZ1bmN0aW9uKGUpIHtcbiAgY29uc3QgaW5wdXQgPSBlLmRhdGEuaW5wdXQ7XG4gIGNvbnN0IGFjdGlvbiA9IGUuZGF0YS5hY3Rpb247XG5cbiAgdHJ5IHtcblxuICAgIHN3aXRjaCAoYWN0aW9uKSB7XG5cbiAgICAgIGNhc2UgXCJmZXRjaFJlc3RhdXJhbnRCeUlkXCI6XG4gICAgICAgIGRhdGFPYmplY3QuZmV0Y2hSZXN0YXVyYW50QnlJZChpbnB1dC5pZCwgKGVycm9yLCByZXN1bHQpID0+IHtcbiAgICAgICAgICBpZihlcnJvcikgY29uc29sZS53YXJuKGVycm9yKTtcbiAgICAgICAgICBwb3N0TWVzc2FnZSh7IGFjdGlvbiwgcmVzdWx0IH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgXCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2RcIjpcbiAgICAgICAgZGF0YU9iamVjdC5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoaW5wdXQuY3Vpc2luZSwgaW5wdXQubmVpZ2hib3Job29kLCAoZXJyb3IsIHJlc3VsdCkgPT4ge1xuICAgICAgICAgIGlmKGVycm9yKSBjb25zb2xlLndhcm4oZXJyb3IpO1xuICAgICAgICAgIHBvc3RNZXNzYWdlKHsgYWN0aW9uLCByZXN1bHQgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBcImZldGNoTmVpZ2hib3Job29kc1wiOlxuICAgICAgICBkYXRhT2JqZWN0LmZldGNoTmVpZ2hib3Job29kcygoZXJyb3IsIHJlc3VsdCkgPT4ge1xuICAgICAgICAgIGlmKGVycm9yKSBjb25zb2xlLndhcm4oZXJyb3IpO1xuICAgICAgICAgIHBvc3RNZXNzYWdlKHsgYWN0aW9uLCByZXN1bHQgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBcImZldGNoQ3Vpc2luZXNcIjpcbiAgICAgICAgZGF0YU9iamVjdC5mZXRjaEN1aXNpbmVzKChlcnJvciwgcmVzdWx0KSA9PiB7XG4gICAgICAgICAgaWYoZXJyb3IpIGNvbnNvbGUud2FybihlcnJvcik7XG4gICAgICAgICAgcG9zdE1lc3NhZ2UoeyBhY3Rpb24sIHJlc3VsdCB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFwidG9nZ2xlRmF2b3JpdGVcIjpcbiAgICAgICAgZGF0YU9iamVjdC50b2dnbGVGYXZvcml0ZShpbnB1dC5pZCwgKGVycm9yLCByZXN1bHQpID0+IHtcbiAgICAgICAgICBpZihlcnJvcikgY29uc29sZS53YXJuKGVycm9yKTtcbiAgICAgICAgICBwb3N0TWVzc2FnZSh7IGFjdGlvbiwgcmVzdWx0IH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgXCJmZXRjaFJldmlld3NcIjpcbiAgICAgICAgZGF0YU9iamVjdC5mZXRjaFJldmlld3MoaW5wdXQuaWQsIChlcnJvciwgcmVzdWx0KSA9PiB7XG4gICAgICAgICAgaWYoZXJyb3IpIGNvbnNvbGUud2FybihlcnJvcik7XG4gICAgICAgICAgcG9zdE1lc3NhZ2UoeyBhY3Rpb24sIHJlc3VsdCB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFwic2F2ZVJldmlld1wiOlxuICAgICAgICBkYXRhT2JqZWN0LnNhdmVSZXZpZXcoaW5wdXQuZGF0YSwgKGVycm9yLCByZXN1bHQpID0+IHtcbiAgICAgICAgICBpZihlcnJvcikgY29uc29sZS53YXJuKGVycm9yKTtcbiAgICAgICAgICBwb3N0TWVzc2FnZSh7IGFjdGlvbiwgcmVzdWx0IH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHBvc3RNZXNzYWdlKHthY3Rpb24sIHJlc3VsdDogXCJBY3Rpb24gbm90IGZvdW5kXCJ9KTtcbiAgICB9XG5cbiAgfVxuICBjYXRjaChlKSB7XG4gICAgcG9zdE1lc3NhZ2UodW5kZWZpbmVkKTtcbiAgfVxufTtcbiIsImltcG9ydCBJREIgZnJvbSAnaWRiJztcbmltcG9ydCBEYXRhQ2FjaGUgZnJvbSAnLi9kYXRhQ2FjaGUnO1xuaW1wb3J0IGNvbnN0YW50cyBmcm9tICcuL2NvbnN0YW50cyc7XG5cbmNvbnN0IENPTExFQ1RJT05TID0gY29uc3RhbnRzLkNPTExFQ1RJT05TO1xuXG4vKlxuKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cbiovXG5jbGFzcyBTdG9yYWdlIHtcblxuXHRjb25zdHJ1Y3RvcigpIHtcblx0XHRjb25zdCBwb3J0ID0gMTMzNzsgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxuXHRcdC8vIERhdGFiYXNlIFVSTC5cblx0XHR0aGlzLkRBVEFCQVNFID0ge1xuXHRcdFx0UkVTVEFVUkFOVFM6IGBodHRwOi8vMC4wLjAuMDoke3BvcnR9L3Jlc3RhdXJhbnRzYCxcblx0XHRcdFJFVklFV1M6IGBodHRwOi8vMC4wLjAuMDoke3BvcnR9L3Jldmlld3MvYCxcblx0XHR9XG5cblx0XHR0aGlzLnJlbG9hZEludGVydmFsID0gMDtcblx0XHR0aGlzLnJlbG9hZFRpbWVyID0gRGF0ZS5ub3coKTtcblx0XHR0aGlzLnJlc3RhdXJhbnRzID0gW107XG5cdFx0dGhpcy5pZGJDYWNoZSA9IG5ldyBEYXRhQ2FjaGUoKTtcblx0XHR0aGlzLnN5bmNEYXRhVG9BcGkoKTtcblx0fVxuXG5cblx0LyoqXG5cdCAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cblx0ICovXG5cdGZldGNoUmVzdGF1cmFudHMoY2FsbGJhY2spIHtcblx0XHQvLyBBbGxvdyByZWxvYWQgbG9jYWwgZGF0YSBldmVyeSA1IG1pbnV0ZXNcblx0XHRjb25zdCBpc1RpbWVUb1JlbG9hZCA9IChEYXRlLm5vdygpIC0gdGhpcy5yZWxvYWRUaW1lcikgPiB0aGlzLnJlbG9hZEludGVydmFsID8gdHJ1ZSA6IGZhbHNlO1xuXG5cdFx0aWYgKGlzVGltZVRvUmVsb2FkICYmIG5hdmlnYXRvci5vbkxpbmUpIHtcblx0XHRcdGZldGNoKHRoaXMuREFUQUJBU0UuUkVTVEFVUkFOVFMpLnRoZW4ocmVzcG9uc2UgPT4ge1xuXHRcdFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcblx0XHRcdFx0XHRyZXNwb25zZS5qc29uKCkudGhlbihkYXRhID0+IHtcblx0XHRcdFx0XHRcdHRoaXMucmVzdGF1cmFudHMgPSBkYXRhO1xuXHRcdFx0XHRcdFx0dGhpcy5yZWxvYWRJbnRlcnZhbCA9IDMwMDtcblx0XHRcdFx0XHRcdHRoaXMuaWRiQ2FjaGUuY2FjaGVEYXRhKENPTExFQ1RJT05TLlJFU1RBVVJBTlRTLCBkYXRhKTtcblx0XHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIGRhdGEpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNhbGxiYWNrKHRoaXMuaGFuZGxlUmVzcG9uc2VFcnJvcihyZXNwb25zZSwgJ2FwaSByZXF1ZXN0JyksIG51bGwpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KS5jYXRjaChlcnJvciA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdGlmKHRoaXMucmVzdGF1cmFudHMubGVuZ3RoID4gMCApIHtcblx0XHRcdGNhbGxiYWNrKG51bGwsIHRoaXMucmVzdGF1cmFudHMpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLmlkYkNhY2hlLmdldENhY2hlQWxsKENPTExFQ1RJT05TLlJFU1RBVVJBTlRTKS50aGVuKGRhdGEgPT4ge1xuXHRcdFx0XHRpZihkYXRhLmxlbmd0aCA+IDAgKSB7XG5cdFx0XHRcdFx0dGhpcy5yZXN0YXVyYW50cyA9IGRhdGE7XG5cdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgZGF0YSk7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0fVxuXG5cdC8qKlxuXHQgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXG5cdCAqL1xuXHRmZXRjaFJldmlld3MoaWQsIGNhbGxiYWNrKSB7XG5cdFx0Ly8gY2hlY2sgdW5zeWNlZCByZXZpZXdzXG5cdFx0dGhpcy5pZGJDYWNoZS5nZXRDYWNoZUFsbChDT0xMRUNUSU9OUy5VTlNZTkNFRF9SRVZJRVdTKS50aGVuKCh1bnN5Y2VkUmV2aWV3cykgPT4ge1xuXG5cdFx0XHRpZighbmF2aWdhdG9yLm9uTGluZSl7XG5cdFx0XHRcdHRoaXMuaWRiQ2FjaGUuZ2V0Q2FjaGVBbGwoQ09MTEVDVElPTlMuUkVWSUVXUykudGhlbigocmV2aWV3cykgPT4ge1xuXHRcdFx0XHRcdGNvbnN0IGNhY2hlZFJldmlld3MgPSBbLi4ucmV2aWV3cywgLi4udW5zeWNlZFJldmlld3NdO1xuXHRcdFx0XHRcdGlmKGNhY2hlZFJldmlld3MgJiYgY2FjaGVkUmV2aWV3cy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0XHRjb25zdCBmaWx0ZXJlZFJldmlld3MgPSBjYWNoZWRSZXZpZXdzLmZpbHRlcigocmV2aWV3KSA9PiByZXZpZXcucmVzdGF1cmFudF9pZCA9PT0gaWQpO1xuXHRcdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgZmlsdGVyZWRSZXZpZXdzKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgW10pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdC8vIFN5Y2VkIHJldmlld3MgaWYgYW55IHVuc3ljZWRcblx0XHRcdFx0Ly8gaWYodW5zeWNlZFJldmlld3MgJiYgdW5zeWNlZFJldmlld3MubGVuZ3RoID4gMCl7XG5cdFx0XHRcdC8vIFx0dW5zeWNlZFJldmlld3MuZm9yRWFjaCgocmV2aWV3KSA9PiB7XG5cdFx0XHRcdC8vIFx0XHR0aGlzLnNhdmVSZXZpZXcocmV2aWV3LCAoZXJyb3IsIGRhdGEpID0+IHtcblx0XHRcdFx0Ly8gXHRcdFx0aWYoZXJyb3IpIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuXHRcdFx0XHQvLyBcdFx0fSk7XG5cdFx0XHRcdC8vIFx0fSk7XG5cdFx0XHRcdC8vIFx0dGhpcy5pZGJDYWNoZS5jbGVhckNhY2hlKENPTExFQ1RJT05TLlVOU1lOQ0VEX1JFVklFV1MpO1xuXHRcdFx0XHQvLyB9XG5cblx0XHRcdFx0Y29uc3QgcmV2aWV3c1BhdGggPSBgP3Jlc3RhdXJhbnRfaWQ9JHtpZH1gO1xuXHRcdFx0XHRmZXRjaCh0aGlzLkRBVEFCQVNFLlJFVklFV1MgKyByZXZpZXdzUGF0aCkudGhlbihyZXNwb25zZSA9PiB7XG5cdFx0XHRcdFx0aWYgKHJlc3BvbnNlLnN0YXR1cyA8IDQwMCkge1xuXHRcdFx0XHRcdFx0cmVzcG9uc2UuanNvbigpLnRoZW4oZGF0YSA9PiB7XG5cdFx0XHRcdFx0XHRcdHRoaXMuaWRiQ2FjaGUuY2FjaGVEYXRhKENPTExFQ1RJT05TLlJFVklFV1MsIGRhdGEpO1xuXHRcdFx0XHRcdFx0XHRjYWxsYmFjayhudWxsLCBkYXRhKTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRjYWxsYmFjayh0aGlzLmhhbmRsZVJlc3BvbnNlRXJyb3IocmVzcG9uc2UsICdBUEkgcmVxdWVzdCcpLCBudWxsKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pLmNhdGNoKGVycm9yID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSk7XG5cdFx0XHR9XG5cblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxuXHQgKi9cblx0ZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcblx0XHRpZighbmF2aWdhdG9yLm9uTGluZSkge1xuXHRcdFx0dGhpcy5pZGJDYWNoZS5nZXRDYWNoZUJ5SWQoQ09MTEVDVElPTlMuUkVTVEFVUkFOVFMsIGlkKS50aGVuKChyZXNwb25zZSkgPT4ge1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG5cdFx0XHR9KS5jYXRjaChlcnJvciA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjb25zdCBwYXRoID0gYC8ke2lkfWA7XG5cdFx0XHRmZXRjaCh0aGlzLkRBVEFCQVNFLlJFU1RBVVJBTlRTICsgcGF0aCkudGhlbihyZXNwb25zZSA9PiB7XG5cdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuXHRcdFx0XHRcdHJlc3BvbnNlLmpzb24oKS50aGVuKGRhdGEgPT4ge1xuXHRcdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgZGF0YSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y2FsbGJhY2sodGhpcy5oYW5kbGVSZXNwb25zZUVycm9yKHJlc3BvbnNlLCAnYXBpIHJlcXVlc3QnKSwgbnVsbCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pLmNhdGNoKGVycm9yID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSk7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuXHQgKi9cblx0ZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XG5cdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHR3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xuXHRcdHRoaXMuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcblx0XHRcdFx0Y29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXHQvKipcblx0ICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG5cdCAqL1xuXHRmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XG5cdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG5cdFx0dGhpcy5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcblx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxuXHRcdFx0XHRjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblx0LyoqXG5cdCAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG5cdCAqL1xuXHRmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuXHRcdHRoaXMuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0bGV0IHJlc3VsdHMgPSByZXN0YXVyYW50cztcblx0XHRcdFx0aWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcblx0XHRcdFx0XHRyZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2Rcblx0XHRcdFx0XHRyZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cdC8qKlxuXHQgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cblx0ICovXG5cdGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuXHRcdHRoaXMuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXG5cdFx0XHRcdGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZCk7XG5cdFx0XHRcdC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xuXHRcdFx0XHRjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpKTtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuICAvKipcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cbiAgZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIHRoaXMuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuICAgICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKTtcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xuICAgICAgICBjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cblx0dG9nZ2xlRmF2b3JpdGUoaWQsIGNhbGxiYWNrKSB7XG5cdFx0dGhpcy5pZGJDYWNoZS5nZXRDYWNoZUJ5SWQoQ09MTEVDVElPTlMuUkVTVEFVUkFOVFMsIGlkKS50aGVuKChyZXNwb25zZSkgPT4ge1xuXHRcdFx0Y29uc3QgdG9vZ2xlID0gcmVzcG9uc2UuaXNfZmF2b3JpdGUgPT09IFwidHJ1ZVwiID8gXCJmYWxzZVwiIDogXCJ0cnVlXCI7XG5cdFx0XHRyZXNwb25zZS5pc19mYXZvcml0ZSA9IHRvb2dsZTtcblx0XHRcdHJldHVybiB0aGlzLmlkYkNhY2hlLnNldENhY2hlKENPTExFQ1RJT05TLlJFU1RBVVJBTlRTLCByZXNwb25zZSkudGhlbigoKSA9PiB7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcblx0XHRcdFx0aWYoIW5hdmlnYXRvci5vbkxpbmUpIHtcblx0XHRcdFx0XHR0aGlzLmlkYkNhY2hlLnNldFN5bmNBc1BlbmRpbmcoQ09MTEVDVElPTlMuUkVTVEFVUkFOVFMsIGZhbHNlKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zdCBwYXRoID0gYC8ke2lkfS8/aXNfZmF2b3JpdGU9JHt0b29nbGV9YDtcblx0XHRcdFx0XHRyZXR1cm4gZmV0Y2godGhpcy5EQVRBQkFTRS5SRVNUQVVSQU5UUyArIHBhdGgsIHsgbWV0aG9kOiAnUFVUJyB9KS50aGVuKChyZXNwb25zZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB0aGlzLmlkYkNhY2hlLnNldFN5bmNBc1BlbmRpbmcoQ09MTEVDVElPTlMuUkVTVEFVUkFOVFMsIHRydWUpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9KVxuXHRcdC5jYXRjaCgoZXJyb3IpID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSk7XG5cdH1cblxuXG5cdHNhdmVSZXZpZXcoZGF0YSwgY2FsbGJhY2spIHtcblx0XHRpZighbmF2aWdhdG9yLm9uTGluZSkge1xuXHRcdFx0cmV0dXJuIHRoaXMuaWRiQ2FjaGUuc2V0Q2FjaGUoQ09MTEVDVElPTlMuVU5TWU5DRURfUkVWSUVXUywgZGF0YSkudGhlbigoKSA9PiB7XG5cdFx0XHRcdHRoaXMuaWRiQ2FjaGUuc2V0U3luY0FzUGVuZGluZyhDT0xMRUNUSU9OUy5SRVZJRVdTLCBmYWxzZSk7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIGRhdGEpO1xuXHRcdFx0fSkuY2F0Y2goKGVycm9yKSA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiBmZXRjaCh0aGlzLkRBVEFCQVNFLlJFVklFV1MsIHtcblx0XHRcdFx0IG1ldGhvZDogJ1BPU1QnLFxuXHRcdFx0XHQgYm9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSlcblx0XHRcdH0pXG5cdFx0XHQudGhlbigocmVzcG9uc2UpID0+IHtcblx0XHRcdFx0aWYgKHJlc3BvbnNlLnN0YXR1cyA8IDQwMCkge1xuXHRcdFx0XHRcdHJlc3BvbnNlLmpzb24oKS50aGVuKChyZXNwb25zZURhdGEpID0+IHtcblx0XHRcdFx0XHRcdHJldHVybiB0aGlzLmlkYkNhY2hlLnNldENhY2hlKENPTExFQ1RJT05TLlJFVklFV1MsIHJlc3BvbnNlRGF0YSkudGhlbigoKSA9PiB7XG5cdFx0XHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlRGF0YSk7XG5cdFx0XHRcdFx0XHRcdHJldHVybiB0aGlzLmlkYkNhY2hlLnNldFN5bmNBc1BlbmRpbmcoQ09MTEVDVElPTlMuUkVWSUVXUywgdHJ1ZSk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEVycm9yIGNvZGUgJHtyZXNwb25zZS5zdGF0dXN9YCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pLmNhdGNoKChlcnJvcikgPT4gY2FsbGJhY2soZXJyb3IsIG51bGwpKTtcblxuXHRcdH1cblx0fVxuXG5cblx0c3luY0RhdGFUb0FwaSgpIHtcblx0XHRjb25zdCBzeW5jSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG5cdFx0XHRpZighbmF2aWdhdG9yLm9uTGluZSkgcmV0dXJuO1xuXHRcdFx0dGhpcy5pZGJDYWNoZS5nZXRDYWNoZUFsbChDT0xMRUNUSU9OUy5VTlNZTkNFRF9SRVZJRVdTKS50aGVuKCh1bnN5Y2VkUmV2aWV3cykgPT4ge1xuXHRcdFx0XHQvLyBTeWNlZCByZXZpZXdzIGlmIGFueSB1bnN5Y2VkXG5cdFx0XHRcdGlmKHVuc3ljZWRSZXZpZXdzICYmIHVuc3ljZWRSZXZpZXdzLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHR1bnN5Y2VkUmV2aWV3cy5mb3JFYWNoKChyZXZpZXcpID0+IHtcblx0XHRcdFx0XHRcdHRoaXMuc2F2ZVJldmlldyhyZXZpZXcsIChlcnJvciwgZGF0YSkgPT4ge1xuXHRcdFx0XHRcdFx0XHRpZihlcnJvcikgY29uc29sZS5lcnJvcihlcnJvcik7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR0aGlzLmlkYkNhY2hlLmNsZWFyQ2FjaGUoQ09MTEVDVElPTlMuVU5TWU5DRURfUkVWSUVXUyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0sIDMwMDApO1xuXHR9XG5cblx0LyoqXG5cdCAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cblx0ICovXG5cdG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XG5cdFx0aWYoIWdvb2dsZSkgcmV0dXJuO1xuXHRcdGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuXHRcdFx0cG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxuXHRcdFx0dGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcblx0XHRcdHVybDogYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gLFxuXHRcdFx0bWFwOiBtYXAsXG5cdFx0XHRhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QfVxuXHRcdCk7XG5cdFx0cmV0dXJuIG1hcmtlcjtcblx0fVxuXG5cblx0aGFuZGxlUmVzcG9uc2VFcnJvcihyZXNwb25zZSwgdHlwZSl7XG5cdFx0c3dpdGNoIChyZXNwb25zZS5zdGF0dXMpIHtcblx0XHRcdGNhc2UgNDAwOlxuXHRcdFx0XHRyZXR1cm4gbmV3IEVycm9yKCdCZWQgcmVxdWVzdCcpO1xuXHRcdFx0Y2FzZSA0MDQ6XG5cdFx0XHRcdHJldHVybiBuZXcgRXJyb3IoJ05vdCBmb3VuZCcpO1xuXHRcdFx0Y2FzZSA1MDA6XG5cdFx0XHRcdHJldHVybiBuZXcgRXJyb3IoJ0ludGVybmFsIHNlcnZlciBlcnJvcicpO1xuXHRcdH1cblx0fVxuXG59XG5cblxuZXhwb3J0IGRlZmF1bHQgU3RvcmFnZTtcbiIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiB0b0FycmF5KGFycikge1xuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnIpO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICB9O1xuXG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG4gICAgdmFyIHJlcXVlc3Q7XG4gICAgdmFyIHAgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3QgPSBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3MpO1xuICAgICAgcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KS50aGVuKHJlc29sdmUsIHJlamVjdCk7XG4gICAgfSk7XG5cbiAgICBwLnJlcXVlc3QgPSByZXF1ZXN0O1xuICAgIHJldHVybiBwO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcbiAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UHJvcGVydGllcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcm94eUNsYXNzLnByb3RvdHlwZSwgcHJvcCwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHZhbCkge1xuICAgICAgICAgIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdLmFwcGx5KHRoaXNbdGFyZ2V0UHJvcF0sIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIEluZGV4KGluZGV4KSB7XG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFtcbiAgICAnbmFtZScsXG4gICAgJ2tleVBhdGgnLFxuICAgICdtdWx0aUVudHJ5JyxcbiAgICAndW5pcXVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnZ2V0JyxcbiAgICAnZ2V0S2V5JyxcbiAgICAnZ2V0QWxsJyxcbiAgICAnZ2V0QWxsS2V5cycsXG4gICAgJ2NvdW50J1xuICBdKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnb3BlbkN1cnNvcicsXG4gICAgJ29wZW5LZXlDdXJzb3InXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIEN1cnNvcihjdXJzb3IsIHJlcXVlc3QpIHtcbiAgICB0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XG4gICAgdGhpcy5fcmVxdWVzdCA9IHJlcXVlc3Q7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoQ3Vyc29yLCAnX2N1cnNvcicsIFtcbiAgICAnZGlyZWN0aW9uJyxcbiAgICAna2V5JyxcbiAgICAncHJpbWFyeUtleScsXG4gICAgJ3ZhbHVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEN1cnNvciwgJ19jdXJzb3InLCBJREJDdXJzb3IsIFtcbiAgICAndXBkYXRlJyxcbiAgICAnZGVsZXRlJ1xuICBdKTtcblxuICAvLyBwcm94eSAnbmV4dCcgbWV0aG9kc1xuICBbJ2FkdmFuY2UnLCAnY29udGludWUnLCAnY29udGludWVQcmltYXJ5S2V5J10uZm9yRWFjaChmdW5jdGlvbihtZXRob2ROYW1lKSB7XG4gICAgaWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgIEN1cnNvci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBjdXJzb3IgPSB0aGlzO1xuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgY3Vyc29yLl9jdXJzb3JbbWV0aG9kTmFtZV0uYXBwbHkoY3Vyc29yLl9jdXJzb3IsIGFyZ3MpO1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdChjdXJzb3IuX3JlcXVlc3QpLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIGN1cnNvci5fcmVxdWVzdCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gT2JqZWN0U3RvcmUoc3RvcmUpIHtcbiAgICB0aGlzLl9zdG9yZSA9IHN0b3JlO1xuICB9XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmNyZWF0ZUluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5jcmVhdGVJbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5pbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgW1xuICAgICduYW1lJyxcbiAgICAna2V5UGF0aCcsXG4gICAgJ2luZGV4TmFtZXMnLFxuICAgICdhdXRvSW5jcmVtZW50J1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAncHV0JyxcbiAgICAnYWRkJyxcbiAgICAnZGVsZXRlJyxcbiAgICAnY2xlYXInLFxuICAgICdnZXQnLFxuICAgICdnZXRBbGwnLFxuICAgICdnZXRLZXknLFxuICAgICdnZXRBbGxLZXlzJyxcbiAgICAnY291bnQnXG4gIF0pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdvcGVuQ3Vyc29yJyxcbiAgICAnb3BlbktleUN1cnNvcidcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAnZGVsZXRlSW5kZXgnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fdHggPSBpZGJUcmFuc2FjdGlvbjtcbiAgICB0aGlzLmNvbXBsZXRlID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIFRyYW5zYWN0aW9uLnByb3RvdHlwZS5vYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fdHgub2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fdHgsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhUcmFuc2FjdGlvbiwgJ190eCcsIFtcbiAgICAnb2JqZWN0U3RvcmVOYW1lcycsXG4gICAgJ21vZGUnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbXG4gICAgJ2Fib3J0J1xuICBdKTtcblxuICBmdW5jdGlvbiBVcGdyYWRlREIoZGIsIG9sZFZlcnNpb24sIHRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgICB0aGlzLm9sZFZlcnNpb24gPSBvbGRWZXJzaW9uO1xuICAgIHRoaXMudHJhbnNhY3Rpb24gPSBuZXcgVHJhbnNhY3Rpb24odHJhbnNhY3Rpb24pO1xuICB9XG5cbiAgVXBncmFkZURCLnByb3RvdHlwZS5jcmVhdGVPYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fZGIuY3JlYXRlT2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhVcGdyYWRlREIsICdfZGInLCBbXG4gICAgJ25hbWUnLFxuICAgICd2ZXJzaW9uJyxcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKFVwZ3JhZGVEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG4gICAgJ2RlbGV0ZU9iamVjdFN0b3JlJyxcbiAgICAnY2xvc2UnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIERCKGRiKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgfVxuXG4gIERCLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb24odGhpcy5fZGIudHJhbnNhY3Rpb24uYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhEQiwgJ19kYicsIFtcbiAgICAnbmFtZScsXG4gICAgJ3ZlcnNpb24nLFxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuICAgICdjbG9zZSdcbiAgXSk7XG5cbiAgLy8gQWRkIGN1cnNvciBpdGVyYXRvcnNcbiAgLy8gVE9ETzogcmVtb3ZlIHRoaXMgb25jZSBicm93c2VycyBkbyB0aGUgcmlnaHQgdGhpbmcgd2l0aCBwcm9taXNlc1xuICBbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddLmZvckVhY2goZnVuY3Rpb24oZnVuY05hbWUpIHtcbiAgICBbT2JqZWN0U3RvcmUsIEluZGV4XS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG4gICAgICAvLyBEb24ndCBjcmVhdGUgaXRlcmF0ZUtleUN1cnNvciBpZiBvcGVuS2V5Q3Vyc29yIGRvZXNuJ3QgZXhpc3QuXG4gICAgICBpZiAoIShmdW5jTmFtZSBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG5cbiAgICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZVtmdW5jTmFtZS5yZXBsYWNlKCdvcGVuJywgJ2l0ZXJhdGUnKV0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyk7XG4gICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTtcbiAgICAgICAgdmFyIG5hdGl2ZU9iamVjdCA9IHRoaXMuX3N0b3JlIHx8IHRoaXMuX2luZGV4O1xuICAgICAgICB2YXIgcmVxdWVzdCA9IG5hdGl2ZU9iamVjdFtmdW5jTmFtZV0uYXBwbHkobmF0aXZlT2JqZWN0LCBhcmdzLnNsaWNlKDAsIC0xKSk7XG4gICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgY2FsbGJhY2socmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gcG9seWZpbGwgZ2V0QWxsXG4gIFtJbmRleCwgT2JqZWN0U3RvcmVdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcbiAgICBpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xuICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwgPSBmdW5jdGlvbihxdWVyeSwgY291bnQpIHtcbiAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG4gICAgICB2YXIgaXRlbXMgPSBbXTtcblxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgaW5zdGFuY2UuaXRlcmF0ZUN1cnNvcihxdWVyeSwgZnVuY3Rpb24oY3Vyc29yKSB7XG4gICAgICAgICAgaWYgKCFjdXJzb3IpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XG5cbiAgICAgICAgICBpZiAoY291bnQgIT09IHVuZGVmaW5lZCAmJiBpdGVtcy5sZW5ndGggPT0gY291bnQpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICB2YXIgZXhwID0ge1xuICAgIG9wZW46IGZ1bmN0aW9uKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdvcGVuJywgW25hbWUsIHZlcnNpb25dKTtcbiAgICAgIHZhciByZXF1ZXN0ID0gcC5yZXF1ZXN0O1xuXG4gICAgICBpZiAocmVxdWVzdCkge1xuICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgaWYgKHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgICAgICAgdXBncmFkZUNhbGxiYWNrKG5ldyBVcGdyYWRlREIocmVxdWVzdC5yZXN1bHQsIGV2ZW50Lm9sZFZlcnNpb24sIHJlcXVlc3QudHJhbnNhY3Rpb24pKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24oZGIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEQihkYik7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGRlbGV0ZTogZnVuY3Rpb24obmFtZSkge1xuICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ2RlbGV0ZURhdGFiYXNlJywgW25hbWVdKTtcbiAgICB9XG4gIH07XG5cbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBleHA7XG4gICAgbW9kdWxlLmV4cG9ydHMuZGVmYXVsdCA9IG1vZHVsZS5leHBvcnRzO1xuICB9XG4gIGVsc2Uge1xuICAgIHNlbGYuaWRiID0gZXhwO1xuICB9XG59KCkpO1xuIl19\n"]}