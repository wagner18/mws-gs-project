{"version":3,"sources":["dataWorker.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Object","defineProperty","value","default","COLLECTIONS","RESTAURANTS","REVIEWS","UNSYNCED_REVIEWS","IS_DATA_SYNCRONIZED","2","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_idb2","_interopRequireDefault","obj","__esModule","DataCache","instance","TypeError","_classCallCheck","this","dbName","_IDB","setDatabase","setSyncAsPending","open","upgradedDB","oldVersion","createObjectStore","keyPath","createIndex","autoIncrement","console","log","collection","status","then","db","transaction","objectStore","put","data","arguments","undefined","tx","readwriteStore","forEach","item","complete","id","index","get","parseInt","getAll","restaurants","delete","clear","./constants","idb","3","_storage","dataObject","self","onmessage","input","action","fetchRestaurantByCuisineAndNeighborhood","cuisine","neighborhood","error","result","postMessage","fetchNeighborhoods","fetchCuisines","toggleFavorite","./storage","4","_dataCache2","_toConsumableArray","arr","Array","isArray","arr2","from","Storage","DATABASE","idbCache","callback","_this","getCacheById","response","toogle","is_favorite","setCache","navigator","onLine","path","fetch","method","catch","_this2","body","JSON","stringify","_this3","getCacheAll","json","cacheData","handleResponseError","_this4","unsycedReviews","review","saveReview","clearCache","reviewsPath","reviews","cachedReviews","concat","filteredReviews","filter","restaurant_id","_this5","fetchRestaurants","results","cuisine_type","neighborhoods","map","v","uniqueNeighborhoods","indexOf","cuisines","uniqueCuisines","restaurant","google","maps","Marker","position","latlng","title","name","url","animation","Animation","DROP","type","./dataCache","5","promisifyRequest","request","Promise","resolve","reject","onsuccess","onerror","promisifyRequestCall","args","apply","proxyProperties","ProxyClass","targetProp","properties","prop","set","val","proxyRequestMethods","proxyMethods","proxyCursorRequestMethods","Cursor","Index","_index","cursor","_cursor","_request","ObjectStore","store","_store","Transaction","idbTransaction","_tx","oncomplete","onabort","UpgradeDB","_db","DB","IDBIndex","IDBCursor","methodName","IDBObjectStore","IDBTransaction","IDBDatabase","funcName","replace","slice","nativeObject","query","count","items","iterateCursor","push","continue","exp","version","upgradeCallback","indexedDB","onupgradeneeded","event"],"mappings":"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","file":"dataWorker.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar constants = {\n  COLLECTIONS: {\n    RESTAURANTS: 'restaurants',\n    REVIEWS: 'reviews',\n    UNSYNCED_REVIEWS: 'unsynced_reviews',\n    IS_DATA_SYNCRONIZED: 'isDataSyncronzed'\n  }\n};\n\nexports.default = constants;\n\n},{}],2:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _idb = require('idb');\n\nvar _idb2 = _interopRequireDefault(_idb);\n\nvar _constants = require('./constants');\n\nvar _constants2 = _interopRequireDefault(_constants);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar COLLECTIONS = _constants2.default.COLLECTIONS;\n\n/*\n* Common database helper functions.\n*/\n\nvar DataCache = function () {\n\tfunction DataCache() {\n\t\t_classCallCheck(this, DataCache);\n\n\t\tthis.dbName = \"restaurantApp\";\n\t\tthis._IDB = this.setDatabase(this.dbName);\n\t\tthis.setSyncAsPending(COLLECTIONS.RESTAURANTS, true);\n\t\tthis.setSyncAsPending(COLLECTIONS.REVIEWS, true);\n\t}\n\n\t_createClass(DataCache, [{\n\t\tkey: 'setDatabase',\n\t\tvalue: function setDatabase(dbName) {\n\t\t\t// DAMN THIS LINE!!!!!! if (!navigator.serviceWorker) return Promise.resolve();\n\t\t\treturn _idb2.default.open(dbName, 1, function (upgradedDB) {\n\t\t\t\tswitch (upgradedDB.oldVersion) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\tvar restaurants = upgradedDB.createObjectStore(COLLECTIONS.RESTAURANTS, { keyPath: 'id' });\n\t\t\t\t\t\trestaurants.createIndex('by-id', 'id');\n\n\t\t\t\t\t\tvar reviews = upgradedDB.createObjectStore(COLLECTIONS.REVIEWS, { keyPath: 'id' });\n\t\t\t\t\t\treviews.createIndex('by-id', 'restaurant_id');\n\n\t\t\t\t\t\tvar unsyncedReviews = upgradedDB.createObjectStore(COLLECTIONS.UNSYNCED_REVIEWS, { autoIncrement: true });\n\t\t\t\t\t\tunsyncedReviews.createIndex('by-id', 'restaurant_id');\n\n\t\t\t\t\t\tupgradedDB.createObjectStore(COLLECTIONS.IS_DATA_SYNCRONIZED, { keyPath: 'collection' });\n\t\t\t\t\t\tconsole.log('Database and Index created');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Set local data sync as panding\n   */\n\n\t}, {\n\t\tkey: 'setSyncAsPending',\n\t\tvalue: function setSyncAsPending(collection, status) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(COLLECTIONS.IS_DATA_SYNCRONIZED, 'readwrite');\n\t\t\t\ttx.objectStore(COLLECTIONS.IS_DATA_SYNCRONIZED).put({ collection: collection, status: status });\n\t\t\t});\n\t\t}\n\n\t\t// syncDataToApi(path, data) {\n\t\t// \tfetch(this.DATABASE.RESTAURANTS + path, { method: 'PUT' }).then(response => {\n\t\t// \t\tif (response.status === 200) {\n\t\t// \t\t\tresponse.json().then(data => {\n\t\t// \t\t\t\t// this.cacheItem(data);\n\t\t// \t\t\t\t// console.warn(data);\n\t\t// \t\t\t});\n\t\t// \t\t} else {\n\t\t// \t\t\tcallback(this.handleResponseError(response, 'api request'), null);\n\t\t// \t\t}\n\t\t// \t}).catch(error => callback(error, null));\n\t\t// }\n\n\n\t}, {\n\t\tkey: 'cacheData',\n\t\tvalue: function cacheData(collection) {\n\t\t\tvar data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n\t\t\t// add post the local DB\n\t\t\tthis._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\tvar readwriteStore = tx.objectStore(collection);\n\t\t\t\tdata.forEach(function (item) {\n\t\t\t\t\treturn readwriteStore.put(item);\n\t\t\t\t});\n\t\t\t\ttx.complete.then(function () {\n\t\t\t\t\treturn console.log('post added to indexedDB');\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'setCache',\n\t\tvalue: function setCache(collection, data) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\ttx.objectStore(collection).put(data);\n\t\t\t\treturn tx.complete;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'getCacheById',\n\t\tvalue: function getCacheById(collection) {\n\t\t\tvar id = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\treturn db.transaction(collection).objectStore(collection).index('by-id').get(parseInt(id));\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'getCacheAll',\n\t\tvalue: function getCacheAll(collection) {\n\t\t\tvar index = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'by-id';\n\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\treturn db.transaction(collection).objectStore(collection).index(index).getAll();\n\t\t\t}).then(function (restaurants) {\n\t\t\t\treturn restaurants;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'deleteCache',\n\t\tvalue: function deleteCache(collection, id) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\ttx.objectStore(collection).delete(id);\n\t\t\t\treturn tx.complete;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'clearCache',\n\t\tvalue: function clearCache(collection) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\ttx.objectStore(collection).clear();\n\t\t\t\treturn tx.complete;\n\t\t\t});\n\t\t}\n\t}]);\n\n\treturn DataCache;\n}();\n\nexports.default = DataCache;\n\n},{\"./constants\":1,\"idb\":5}],3:[function(require,module,exports){\n\"use strict\";\n\nvar _storage = require(\"./storage\");\n\nvar _storage2 = _interopRequireDefault(_storage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// const dataObject = new Storage();\nvar dataObject = new _storage2.default(); // importScripts('storage.js');\n\n\nself.onmessage = function (e) {\n  var input = e.data.input;\n  var action = e.data.action;\n\n  try {\n\n    switch (action) {\n      case \"fetchRestaurantByCuisineAndNeighborhood\":\n        dataObject.fetchRestaurantByCuisineAndNeighborhood(input.cuisine, input.neighborhood, function (error, result) {\n          if (error) throw new Error(error);\n          postMessage({ action: action, result: result });\n        });\n        break;\n\n      case \"fetchNeighborhoods\":\n        dataObject.fetchNeighborhoods(function (error, result) {\n          if (error) throw new Error(error);\n          postMessage({ action: action, result: result });\n        });\n        break;\n\n      case \"fetchCuisines\":\n        dataObject.fetchCuisines(function (error, result) {\n          if (error) throw new Error(error);\n          postMessage({ action: action, result: result });\n        });\n        break;\n\n      case \"toggleFavorite\":\n        dataObject.toggleFavorite(input.id, function (error, result) {\n          if (error) throw new Error(error);\n          postMessage({ action: action, result: result });\n        });\n        break;\n\n      default:\n        postMessage({ action: action, result: \"Action not found\" });\n    }\n  } catch (e) {\n    postMessage(undefined);\n  }\n};\n\n},{\"./storage\":4}],4:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _idb = require('idb');\n\nvar _idb2 = _interopRequireDefault(_idb);\n\nvar _dataCache = require('./dataCache');\n\nvar _dataCache2 = _interopRequireDefault(_dataCache);\n\nvar _constants = require('./constants');\n\nvar _constants2 = _interopRequireDefault(_constants);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar COLLECTIONS = _constants2.default.COLLECTIONS;\n\n/*\n* Common database helper functions.\n*/\n\nvar Storage = function () {\n\tfunction Storage() {\n\t\t_classCallCheck(this, Storage);\n\n\t\tvar port = 1337; // Change this to your server port\n\t\t// Database URL.\n\t\tthis.DATABASE = {\n\t\t\tRESTAURANTS: 'http://0.0.0.0:' + port + '/restaurants',\n\t\t\tREVIEWS: 'http://0.0.0.0:' + port + '/reviews/'\n\t\t};\n\n\t\tthis.idbCache = new _dataCache2.default();\n\t}\n\n\t_createClass(Storage, [{\n\t\tkey: 'toggleFavorite',\n\t\tvalue: function toggleFavorite(id, callback) {\n\t\t\tvar _this = this;\n\n\t\t\tthis.idbCache.getCacheById(COLLECTIONS.RESTAURANTS, id).then(function (response) {\n\t\t\t\tvar toogle = response.is_favorite === \"true\" ? \"false\" : \"true\";\n\t\t\t\tresponse.is_favorite = toogle;\n\t\t\t\treturn _this.idbCache.setCache(COLLECTIONS.RESTAURANTS, response).then(function () {\n\t\t\t\t\tcallback(null, response);\n\t\t\t\t\tif (!navigator.onLine) {\n\t\t\t\t\t\t_this.idbCache.setSyncAsPending(COLLECTIONS.RESTAURANTS, false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar path = '/' + id + '/?is_favorite=' + toogle;\n\t\t\t\t\t\treturn fetch(_this.DATABASE.RESTAURANTS + path, { method: 'PUT' }).then(function (response) {\n\t\t\t\t\t\t\tif (response.status === 200) _this.idbCache.setSyncAsPending(COLLECTIONS.RESTAURANTS, true);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}).catch(function (error) {\n\t\t\t\treturn callback(error, null);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'saveReview',\n\t\tvalue: function saveReview(data, callback) {\n\t\t\tvar _this2 = this;\n\n\t\t\tif (!navigator.onLine) {\n\t\t\t\treturn this.idbCache.setCache(COLLECTIONS.UNSYNCED_REVIEWS, data).then(function () {\n\t\t\t\t\t_this2.idbCache.setSyncAsPending(COLLECTIONS.REVIEWS, false);\n\t\t\t\t\tcallback(null, data);\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t} else {\n\n\t\t\t\treturn fetch(this.DATABASE.REVIEWS, {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tbody: JSON.stringify(data)\n\t\t\t\t}).then(function (response) {\n\t\t\t\t\tif (response.status < 400) {\n\t\t\t\t\t\treturn _this2.idbCache.setCache(COLLECTIONS.REVIEWS, data).then(function () {\n\t\t\t\t\t\t\tcallback(null, response);\n\t\t\t\t\t\t\treturn _this2.idbCache.setSyncAsPending(COLLECTIONS.REVIEWS, true);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error('Error code ' + response.status);\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Fetch all restaurants.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurants',\n\t\tvalue: function fetchRestaurants(callback) {\n\t\t\tvar _this3 = this;\n\n\t\t\tthis.idbCache.getCacheAll(COLLECTIONS.RESTAURANTS).then(function (data) {\n\t\t\t\tif (data.length > 0) {\n\t\t\t\t\tcallback(null, data);\n\t\t\t\t\tconsole.log('data loaded from local storage!');\n\t\t\t\t} else {\n\n\t\t\t\t\tfetch(_this3.DATABASE.RESTAURANTS).then(function (response) {\n\t\t\t\t\t\tif (response.status === 200) {\n\t\t\t\t\t\t\tresponse.json().then(function (data) {\n\t\t\t\t\t\t\t\t_this3.idbCache.cacheData(COLLECTIONS.RESTAURANTS, data);\n\t\t\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcallback(_this3.handleResponseError(response, 'api request'), null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch(function (error) {\n\t\t\t\t\t\treturn callback(error, null);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Fetch all restaurants.\n   */\n\n\t}, {\n\t\tkey: 'fetchReviews',\n\t\tvalue: function fetchReviews(id, callback) {\n\t\t\tvar _this4 = this;\n\n\t\t\t// check unsyced reviews\n\t\t\tthis.idbCache.getCacheAll(COLLECTIONS.UNSYNCED_REVIEWS).then(function (unsycedReviews) {\n\n\t\t\t\tif (!navigator.onLine) {\n\t\t\t\t\t_this4.idbCache.getCacheAll(COLLECTIONS.REVIEWS).then(function (reviews) {\n\t\t\t\t\t\tvar cachedReviews = [].concat(_toConsumableArray(reviews), _toConsumableArray(unsycedReviews));\n\t\t\t\t\t\tif (cachedReviews && cachedReviews.length > 0) {\n\t\t\t\t\t\t\tvar filteredReviews = cachedReviews.filter(function (review) {\n\t\t\t\t\t\t\t\treturn review.restaurant_id === id;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tcallback(null, filteredReviews);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcallback(null, []);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\n\t\t\t\t\t// Syced reviews if any unsyced\n\t\t\t\t\tif (unsycedReviews && unsycedReviews.length > 0) {\n\t\t\t\t\t\tunsycedReviews.forEach(function (review) {\n\t\t\t\t\t\t\t_this4.saveReview(review, function (error, data) {\n\t\t\t\t\t\t\t\tif (error) console.error(error);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t\t_this4.idbCache.clearCache(COLLECTIONS.UNSYNCED_REVIEWS);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar reviewsPath = '?restaurant_id=' + id;\n\t\t\t\t\tfetch(_this4.DATABASE.REVIEWS + reviewsPath).then(function (response) {\n\t\t\t\t\t\tif (response.status < 400) {\n\t\t\t\t\t\t\tresponse.json().then(function (data) {\n\t\t\t\t\t\t\t\t_this4.idbCache.cacheData(COLLECTIONS.REVIEWS, data);\n\t\t\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcallback(_this4.handleResponseError(response, 'API request'), null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch(function (error) {\n\t\t\t\t\t\treturn callback(error, null);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Fetch a restaurant by its ID.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantById',\n\t\tvalue: function fetchRestaurantById(id, callback) {\n\t\t\tvar _this5 = this;\n\n\t\t\tif (!navigator.onLine) {\n\t\t\t\tthis.idbCache.getCacheById(COLLECTIONS.RESTAURANTS, id).then(function (response) {\n\t\t\t\t\tcallback(null, response);\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tvar path = '/' + id;\n\t\t\t\tfetch(this.DATABASE.RESTAURANTS + path).then(function (response) {\n\t\t\t\t\tif (response.status === 200) {\n\t\t\t\t\t\tresponse.json().then(function (data) {\n\t\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback(_this5.handleResponseError(response, 'api request'), null);\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Fetch restaurants by a cuisine type with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantByCuisine',\n\t\tvalue: function fetchRestaurantByCuisine(cuisine, callback) {\n\t\t\t// Fetch all restaurants\twith proper error handling\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Filter restaurants to have only given cuisine type\n\t\t\t\t\tvar results = restaurants.filter(function (r) {\n\t\t\t\t\t\treturn r.cuisine_type == cuisine;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, results);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t/**\n   * Fetch restaurants by a neighborhood with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantByNeighborhood',\n\t\tvalue: function fetchRestaurantByNeighborhood(neighborhood, callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Filter restaurants to have only given neighborhood\n\t\t\t\t\tvar results = restaurants.filter(function (r) {\n\t\t\t\t\t\treturn r.neighborhood == neighborhood;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, results);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t/**\n   * Fetch restaurants by a cuisine and a neighborhood with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantByCuisineAndNeighborhood',\n\t\tvalue: function fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\tvar results = restaurants;\n\t\t\t\t\tif (cuisine != 'all') {\n\t\t\t\t\t\t// filter by cuisine\n\t\t\t\t\t\tresults = results.filter(function (r) {\n\t\t\t\t\t\t\treturn r.cuisine_type == cuisine;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (neighborhood != 'all') {\n\t\t\t\t\t\t// filter by neighborhood\n\t\t\t\t\t\tresults = results.filter(function (r) {\n\t\t\t\t\t\t\treturn r.neighborhood == neighborhood;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tcallback(null, results);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t/**\n   * Fetch all neighborhoods with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchNeighborhoods',\n\t\tvalue: function fetchNeighborhoods(callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Get all neighborhoods from all restaurants\n\t\t\t\t\tvar neighborhoods = restaurants.map(function (v, i) {\n\t\t\t\t\t\treturn restaurants[i].neighborhood;\n\t\t\t\t\t});\n\t\t\t\t\t// Remove duplicates from neighborhoods\n\t\t\t\t\tvar uniqueNeighborhoods = neighborhoods.filter(function (v, i) {\n\t\t\t\t\t\treturn neighborhoods.indexOf(v) == i;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, uniqueNeighborhoods);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Fetch all cuisines with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchCuisines',\n\t\tvalue: function fetchCuisines(callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Get all cuisines from all restaurants\n\t\t\t\t\tvar cuisines = restaurants.map(function (v, i) {\n\t\t\t\t\t\treturn restaurants[i].cuisine_type;\n\t\t\t\t\t});\n\t\t\t\t\t// Remove duplicates from cuisines\n\t\t\t\t\tvar uniqueCuisines = cuisines.filter(function (v, i) {\n\t\t\t\t\t\treturn cuisines.indexOf(v) == i;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, uniqueCuisines);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Map marker for a restaurant.\n   */\n\n\t}, {\n\t\tkey: 'mapMarkerForRestaurant',\n\t\tvalue: function mapMarkerForRestaurant(restaurant, map) {\n\t\t\tif (!google) return;\n\t\t\tvar marker = new google.maps.Marker({\n\t\t\t\tposition: restaurant.latlng,\n\t\t\t\ttitle: restaurant.name,\n\t\t\t\turl: './restaurant.html?id=' + restaurant.id,\n\t\t\t\tmap: map,\n\t\t\t\tanimation: google.maps.Animation.DROP });\n\t\t\treturn marker;\n\t\t}\n\t}, {\n\t\tkey: 'handleResponseError',\n\t\tvalue: function handleResponseError(response, type) {\n\t\t\tswitch (response.status) {\n\t\t\t\tcase 400:\n\t\t\t\t\treturn new Error('Bed request');\n\t\t\t\tcase 404:\n\t\t\t\t\treturn new Error('Not found');\n\t\t\t\tcase 500:\n\t\t\t\t\treturn new Error('Internal server error');\n\t\t\t}\n\t\t}\n\t}]);\n\n\treturn Storage;\n}();\n\nexports.default = Storage;\n\n},{\"./constants\":1,\"./dataCache\":2,\"idb\":5}],5:[function(require,module,exports){\n'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      if (request) {\n        request.onupgradeneeded = function(event) {\n          if (upgradeCallback) {\n            upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n          }\n        };\n      }\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n\n},{}]},{},[3])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9jb25zdGFudHMuanMiLCJqcy9kYXRhQ2FjaGUuanMiLCJqcy9kYXRhV29ya2VyLmpzIiwianMvc3RvcmFnZS5qcyIsIm5vZGVfbW9kdWxlcy9pZGIvbGliL2lkYi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FDQUEsSUFBTSxZQUFZO0FBQ2hCLGVBQWE7QUFDWixpQkFBYSxhQUREO0FBRVosYUFBUyxTQUZHO0FBR1osc0JBQWtCLGtCQUhOO0FBSVoseUJBQXFCO0FBSlQ7QUFERyxDQUFsQjs7a0JBU2UsUzs7Ozs7Ozs7Ozs7QUNUZjs7OztBQUNBOzs7Ozs7OztBQUVBLElBQU0sY0FBYyxvQkFBVSxXQUE5Qjs7QUFFQTs7OztJQUdxQixTO0FBRW5CLHNCQUFhO0FBQUE7O0FBQ2IsT0FBSyxNQUFMLEdBQWMsZUFBZDtBQUNBLE9BQUssSUFBTCxHQUFZLEtBQUssV0FBTCxDQUFpQixLQUFLLE1BQXRCLENBQVo7QUFDQSxPQUFLLGdCQUFMLENBQXNCLFlBQVksV0FBbEMsRUFBK0MsSUFBL0M7QUFDQSxPQUFLLGdCQUFMLENBQXNCLFlBQVksT0FBbEMsRUFBMkMsSUFBM0M7QUFDQTs7Ozs4QkFFVyxNLEVBQVE7QUFDbkI7QUFDQSxVQUFPLGNBQUksSUFBSixDQUFTLE1BQVQsRUFBaUIsQ0FBakIsRUFBb0IsVUFBQyxVQUFELEVBQWdCO0FBQzFDLFlBQU8sV0FBVyxVQUFsQjtBQUNDLFVBQUssQ0FBTDtBQUNDLFVBQU0sY0FBYyxXQUFXLGlCQUFYLENBQTZCLFlBQVksV0FBekMsRUFBc0QsRUFBQyxTQUFTLElBQVYsRUFBdEQsQ0FBcEI7QUFDQSxrQkFBWSxXQUFaLENBQXdCLE9BQXhCLEVBQWlDLElBQWpDOztBQUVBLFVBQU0sVUFBVSxXQUFXLGlCQUFYLENBQTZCLFlBQVksT0FBekMsRUFBa0QsRUFBQyxTQUFTLElBQVYsRUFBbEQsQ0FBaEI7QUFDQSxjQUFR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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJjb25zdCBjb25zdGFudHMgPSB7XG4gIENPTExFQ1RJT05TOiB7XG4gIFx0UkVTVEFVUkFOVFM6ICdyZXN0YXVyYW50cycsXG4gIFx0UkVWSUVXUzogJ3Jldmlld3MnLFxuICBcdFVOU1lOQ0VEX1JFVklFV1M6ICd1bnN5bmNlZF9yZXZpZXdzJyxcbiAgXHRJU19EQVRBX1NZTkNST05JWkVEOiAnaXNEYXRhU3luY3JvbnplZCcsXG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY29uc3RhbnRzO1xuIiwiaW1wb3J0IElEQiBmcm9tICdpZGInO1xuaW1wb3J0IGNvbnN0YW50cyBmcm9tICcuL2NvbnN0YW50cyc7XG5cbmNvbnN0IENPTExFQ1RJT05TID0gY29uc3RhbnRzLkNPTExFQ1RJT05TO1xuXG4vKlxuKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cbiovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEYXRhQ2FjaGUge1xuXG4gIGNvbnN0cnVjdG9yKCl7XG5cdFx0dGhpcy5kYk5hbWUgPSBcInJlc3RhdXJhbnRBcHBcIjtcblx0XHR0aGlzLl9JREIgPSB0aGlzLnNldERhdGFiYXNlKHRoaXMuZGJOYW1lKTtcblx0XHR0aGlzLnNldFN5bmNBc1BlbmRpbmcoQ09MTEVDVElPTlMuUkVTVEFVUkFOVFMsIHRydWUpO1xuXHRcdHRoaXMuc2V0U3luY0FzUGVuZGluZyhDT0xMRUNUSU9OUy5SRVZJRVdTLCB0cnVlKTtcblx0fVxuXG5cdHNldERhdGFiYXNlKGRiTmFtZSkge1xuXHRcdC8vIERBTU4gVEhJUyBMSU5FISEhISEhIGlmICghbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcblx0XHRyZXR1cm4gSURCLm9wZW4oZGJOYW1lLCAxLCAodXBncmFkZWREQikgPT4ge1xuXHRcdFx0c3dpdGNoKHVwZ3JhZGVkREIub2xkVmVyc2lvbil7XG5cdFx0XHRcdGNhc2UgMDpcblx0XHRcdFx0XHRjb25zdCByZXN0YXVyYW50cyA9IHVwZ3JhZGVkREIuY3JlYXRlT2JqZWN0U3RvcmUoQ09MTEVDVElPTlMuUkVTVEFVUkFOVFMsIHtrZXlQYXRoOiAnaWQnfSk7XG5cdFx0XHRcdFx0cmVzdGF1cmFudHMuY3JlYXRlSW5kZXgoJ2J5LWlkJywgJ2lkJyk7XG5cblx0XHRcdFx0XHRjb25zdCByZXZpZXdzID0gdXBncmFkZWREQi5jcmVhdGVPYmplY3RTdG9yZShDT0xMRUNUSU9OUy5SRVZJRVdTLCB7a2V5UGF0aDogJ2lkJ30pO1xuXHRcdFx0XHRcdHJldmlld3MuY3JlYXRlSW5kZXgoJ2J5LWlkJywgJ3Jlc3RhdXJhbnRfaWQnKTtcblxuXHRcdFx0XHRcdGNvbnN0IHVuc3luY2VkUmV2aWV3cyA9IHVwZ3JhZGVkREIuY3JlYXRlT2JqZWN0U3RvcmUoQ09MTEVDVElPTlMuVU5TWU5DRURfUkVWSUVXUywge2F1dG9JbmNyZW1lbnQ6IHRydWV9KTtcblx0XHRcdFx0XHR1bnN5bmNlZFJldmlld3MuY3JlYXRlSW5kZXgoJ2J5LWlkJywgJ3Jlc3RhdXJhbnRfaWQnKTtcblxuXHRcdFx0XHRcdHVwZ3JhZGVkREIuY3JlYXRlT2JqZWN0U3RvcmUoQ09MTEVDVElPTlMuSVNfREFUQV9TWU5DUk9OSVpFRCwgeyBrZXlQYXRoOiAnY29sbGVjdGlvbicgfSk7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coJ0RhdGFiYXNlIGFuZCBJbmRleCBjcmVhdGVkJyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0ICogU2V0IGxvY2FsIGRhdGEgc3luYyBhcyBwYW5kaW5nXG5cdCAqL1xuXHRzZXRTeW5jQXNQZW5kaW5nKGNvbGxlY3Rpb24sIHN0YXR1cykge1xuXHRcdHJldHVybiB0aGlzLl9JREIudGhlbihkYiA9PiB7XG5cdFx0XHRjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKENPTExFQ1RJT05TLklTX0RBVEFfU1lOQ1JPTklaRUQsICdyZWFkd3JpdGUnKTtcblx0XHRcdHR4Lm9iamVjdFN0b3JlKENPTExFQ1RJT05TLklTX0RBVEFfU1lOQ1JPTklaRUQpLnB1dCh7IGNvbGxlY3Rpb24sIHN0YXR1cyB9KTtcblx0XHR9KTtcblx0fVxuXG5cdC8vIHN5bmNEYXRhVG9BcGkocGF0aCwgZGF0YSkge1xuXHQvLyBcdGZldGNoKHRoaXMuREFUQUJBU0UuUkVTVEFVUkFOVFMgKyBwYXRoLCB7IG1ldGhvZDogJ1BVVCcgfSkudGhlbihyZXNwb25zZSA9PiB7XG5cdC8vIFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcblx0Ly8gXHRcdFx0cmVzcG9uc2UuanNvbigpLnRoZW4oZGF0YSA9PiB7XG5cdC8vIFx0XHRcdFx0Ly8gdGhpcy5jYWNoZUl0ZW0oZGF0YSk7XG5cdC8vIFx0XHRcdFx0Ly8gY29uc29sZS53YXJuKGRhdGEpO1xuXHQvLyBcdFx0XHR9KTtcblx0Ly8gXHRcdH0gZWxzZSB7XG5cdC8vIFx0XHRcdGNhbGxiYWNrKHRoaXMuaGFuZGxlUmVzcG9uc2VFcnJvcihyZXNwb25zZSwgJ2FwaSByZXF1ZXN0JyksIG51bGwpO1xuXHQvLyBcdFx0fVxuXHQvLyBcdH0pLmNhdGNoKGVycm9yID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSk7XG5cdC8vIH1cblxuXG5cdGNhY2hlRGF0YShjb2xsZWN0aW9uLCBkYXRhID0gW10pe1xuXHRcdCAvLyBhZGQgcG9zdCB0aGUgbG9jYWwgREJcblx0XHR0aGlzLl9JREIudGhlbihkYiA9PiB7XG5cdFx0XHRjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKGNvbGxlY3Rpb24sICdyZWFkd3JpdGUnKTtcblx0XHRcdGNvbnN0IHJlYWR3cml0ZVN0b3JlID0gdHgub2JqZWN0U3RvcmUoY29sbGVjdGlvbik7XG5cdFx0XHRkYXRhLmZvckVhY2goKGl0ZW0pID0+IHJlYWR3cml0ZVN0b3JlLnB1dChpdGVtKSk7XG5cdFx0XHR0eC5jb21wbGV0ZS50aGVuKCgpID0+IGNvbnNvbGUubG9nKCdwb3N0IGFkZGVkIHRvIGluZGV4ZWREQicpKTtcblx0XHR9KTtcblx0fVxuXG5cblx0c2V0Q2FjaGUoY29sbGVjdGlvbiwgZGF0YSl7XG5cdFx0cmV0dXJuIHRoaXMuX0lEQi50aGVuKGRiID0+IHtcblx0XHRcdGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oY29sbGVjdGlvbiwgJ3JlYWR3cml0ZScpO1xuXHRcdFx0dHgub2JqZWN0U3RvcmUoY29sbGVjdGlvbikucHV0KGRhdGEpO1xuXHRcdFx0cmV0dXJuIHR4LmNvbXBsZXRlO1xuXHRcdH0pO1xuXHR9XG5cblxuXHRnZXRDYWNoZUJ5SWQoY29sbGVjdGlvbiwgaWQgPSBmYWxzZSkge1xuXHRcdHJldHVybiB0aGlzLl9JREIudGhlbihkYiA9PiB7XG5cdFx0XHRyZXR1cm4gZGIudHJhbnNhY3Rpb24oY29sbGVjdGlvbilcblx0XHRcdFx0Lm9iamVjdFN0b3JlKGNvbGxlY3Rpb24pLmluZGV4KCdieS1pZCcpLmdldChwYXJzZUludChpZCkpO1xuXHRcdH0pO1xuXHR9XG5cblxuXHRnZXRDYWNoZUFsbChjb2xsZWN0aW9uLCBpbmRleCA9ICdieS1pZCcpIHtcblx0XHRyZXR1cm4gdGhpcy5fSURCLnRoZW4oZGIgPT4ge1xuXHRcdFx0cmV0dXJuIGRiLnRyYW5zYWN0aW9uKGNvbGxlY3Rpb24pXG5cdFx0XHRcdC5vYmplY3RTdG9yZShjb2xsZWN0aW9uKVxuXHRcdFx0XHQuaW5kZXgoaW5kZXgpXG5cdFx0XHRcdC5nZXRBbGwoKTtcblx0XHR9KS50aGVuKHJlc3RhdXJhbnRzID0+IHJlc3RhdXJhbnRzKTtcblx0fVxuXG5cblx0ZGVsZXRlQ2FjaGUoY29sbGVjdGlvbiwgaWQpIHtcblx0XHRyZXR1cm4gdGhpcy5fSURCLnRoZW4oZGIgPT4ge1xuXHRcdFx0Y29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihjb2xsZWN0aW9uLCAncmVhZHdyaXRlJyk7XG5cdFx0XHR0eC5vYmplY3RTdG9yZShjb2xsZWN0aW9uKS5kZWxldGUoaWQpO1xuXHRcdFx0cmV0dXJuIHR4LmNvbXBsZXRlO1xuXHRcdH0pO1xuXHR9XG5cblxuXHRjbGVhckNhY2hlKGNvbGxlY3Rpb24pIHtcblx0XHRyZXR1cm4gdGhpcy5fSURCLnRoZW4oZGIgPT4ge1xuXHRcdFx0Y29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihjb2xsZWN0aW9uLCAncmVhZHdyaXRlJyk7XG5cdFx0XHR0eC5vYmplY3RTdG9yZShjb2xsZWN0aW9uKS5jbGVhcigpO1xuXHRcdFx0cmV0dXJuIHR4LmNvbXBsZXRlO1xuXHRcdH0pO1xuXHR9XG5cblxufVxuIiwiLy8gaW1wb3J0U2NyaXB0cygnc3RvcmFnZS5qcycpO1xuaW1wb3J0IFN0b3JhZ2UgZnJvbSAnLi9zdG9yYWdlJztcblxuXG4vLyBjb25zdCBkYXRhT2JqZWN0ID0gbmV3IFN0b3JhZ2UoKTtcbmNvbnN0IGRhdGFPYmplY3QgPSBuZXcgU3RvcmFnZSgpO1xuXG5cbnNlbGYub25tZXNzYWdlID0gZnVuY3Rpb24oZSkge1xuICBjb25zdCBpbnB1dCA9IGUuZGF0YS5pbnB1dDtcbiAgY29uc3QgYWN0aW9uID0gZS5kYXRhLmFjdGlvbjtcblxuICB0cnkge1xuXG4gICAgc3dpdGNoIChhY3Rpb24pIHtcbiAgICAgIGNhc2UgXCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2RcIjpcbiAgICAgICAgZGF0YU9iamVjdC5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoaW5wdXQuY3Vpc2luZSwgaW5wdXQubmVpZ2hib3Job29kLCAoZXJyb3IsIHJlc3VsdCkgPT4ge1xuICAgICAgICAgIGlmKGVycm9yKSB0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuICAgICAgICAgIHBvc3RNZXNzYWdlKHsgYWN0aW9uLCByZXN1bHQgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBcImZldGNoTmVpZ2hib3Job29kc1wiOlxuICAgICAgICBkYXRhT2JqZWN0LmZldGNoTmVpZ2hib3Job29kcygoZXJyb3IsIHJlc3VsdCkgPT4ge1xuICAgICAgICAgIGlmKGVycm9yKSB0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuICAgICAgICAgIHBvc3RNZXNzYWdlKHsgYWN0aW9uLCByZXN1bHQgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBcImZldGNoQ3Vpc2luZXNcIjpcbiAgICAgICAgZGF0YU9iamVjdC5mZXRjaEN1aXNpbmVzKChlcnJvciwgcmVzdWx0KSA9PiB7XG4gICAgICAgICAgaWYoZXJyb3IpIHRocm93IG5ldyBFcnJvcihlcnJvcik7XG4gICAgICAgICAgcG9zdE1lc3NhZ2UoeyBhY3Rpb24sIHJlc3VsdCB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFwidG9nZ2xlRmF2b3JpdGVcIjpcbiAgICAgICAgZGF0YU9iamVjdC50b2dnbGVGYXZvcml0ZShpbnB1dC5pZCwgKGVycm9yLCByZXN1bHQpID0+IHtcbiAgICAgICAgICBpZihlcnJvcikgdGhyb3cgbmV3IEVycm9yKGVycm9yKTtcbiAgICAgICAgICBwb3N0TWVzc2FnZSh7IGFjdGlvbiwgcmVzdWx0IH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHBvc3RNZXNzYWdlKHthY3Rpb24sIHJlc3VsdDogXCJBY3Rpb24gbm90IGZvdW5kXCJ9KTtcbiAgICB9XG5cbiAgfVxuICBjYXRjaChlKSB7XG4gICAgcG9zdE1lc3NhZ2UodW5kZWZpbmVkKTtcbiAgfVxufTtcbiIsImltcG9ydCBJREIgZnJvbSAnaWRiJztcbmltcG9ydCBEYXRhQ2FjaGUgZnJvbSAnLi9kYXRhQ2FjaGUnO1xuaW1wb3J0IGNvbnN0YW50cyBmcm9tICcuL2NvbnN0YW50cyc7XG5cbmNvbnN0IENPTExFQ1RJT05TID0gY29uc3RhbnRzLkNPTExFQ1RJT05TO1xuXG4vKlxuKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cbiovXG5jbGFzcyBTdG9yYWdlIHtcblxuXHRjb25zdHJ1Y3Rvcigpe1xuXHRcdGNvbnN0IHBvcnQgPSAxMzM3OyAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XG5cdFx0Ly8gRGF0YWJhc2UgVVJMLlxuXHRcdHRoaXMuREFUQUJBU0UgPSB7XG5cdFx0XHRSRVNUQVVSQU5UUzogYGh0dHA6Ly8wLjAuMC4wOiR7cG9ydH0vcmVzdGF1cmFudHNgLFxuXHRcdFx0UkVWSUVXUzogYGh0dHA6Ly8wLjAuMC4wOiR7cG9ydH0vcmV2aWV3cy9gLFxuXHRcdH1cblxuXHRcdHRoaXMuaWRiQ2FjaGUgPSBuZXcgRGF0YUNhY2hlKCk7XG5cdH1cblxuXG5cdHRvZ2dsZUZhdm9yaXRlKGlkLCBjYWxsYmFjaykge1xuXHRcdHRoaXMuaWRiQ2FjaGUuZ2V0Q2FjaGVCeUlkKENPTExFQ1RJT05TLlJFU1RBVVJBTlRTLCBpZCkudGhlbigocmVzcG9uc2UpID0+IHtcblx0XHRcdGNvbnN0IHRvb2dsZSA9IHJlc3BvbnNlLmlzX2Zhdm9yaXRlID09PSBcInRydWVcIiA/IFwiZmFsc2VcIiA6IFwidHJ1ZVwiO1xuXHRcdFx0cmVzcG9uc2UuaXNfZmF2b3JpdGUgPSB0b29nbGU7XG5cdFx0XHRyZXR1cm4gdGhpcy5pZGJDYWNoZS5zZXRDYWNoZShDT0xMRUNUSU9OUy5SRVNUQVVSQU5UUywgcmVzcG9uc2UpLnRoZW4oKCkgPT4ge1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG5cdFx0XHRcdGlmKCFuYXZpZ2F0b3Iub25MaW5lKSB7XG5cdFx0XHRcdFx0dGhpcy5pZGJDYWNoZS5zZXRTeW5jQXNQZW5kaW5nKENPTExFQ1RJT05TLlJFU1RBVVJBTlRTLCBmYWxzZSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29uc3QgcGF0aCA9IGAvJHtpZH0vP2lzX2Zhdm9yaXRlPSR7dG9vZ2xlfWA7XG5cdFx0XHRcdFx0cmV0dXJuIGZldGNoKHRoaXMuREFUQUJBU0UuUkVTVEFVUkFOVFMgKyBwYXRoLCB7IG1ldGhvZDogJ1BVVCcgfSkudGhlbigocmVzcG9uc2UpID0+IHtcblx0XHRcdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkgdGhpcy5pZGJDYWNoZS5zZXRTeW5jQXNQZW5kaW5nKENPTExFQ1RJT05TLlJFU1RBVVJBTlRTLCB0cnVlKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSlcblx0XHQuY2F0Y2goKGVycm9yKSA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xuXHR9XG5cblxuXHRzYXZlUmV2aWV3KGRhdGEsIGNhbGxiYWNrKSB7XG5cdFx0aWYoIW5hdmlnYXRvci5vbkxpbmUpIHtcblx0XHRcdHJldHVybiB0aGlzLmlkYkNhY2hlLnNldENhY2hlKENPTExFQ1RJT05TLlVOU1lOQ0VEX1JFVklFV1MsIGRhdGEpLnRoZW4oKCkgPT4ge1xuXHRcdFx0XHR0aGlzLmlkYkNhY2hlLnNldFN5bmNBc1BlbmRpbmcoQ09MTEVDVElPTlMuUkVWSUVXUywgZmFsc2UpO1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCBkYXRhKTtcblx0XHRcdH0pLmNhdGNoKChlcnJvcikgPT4gY2FsbGJhY2soZXJyb3IsIG51bGwpKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRyZXR1cm4gZmV0Y2godGhpcy5EQVRBQkFTRS5SRVZJRVdTLCB7XG5cdFx0XHRcdCBtZXRob2Q6ICdQT1NUJyxcblx0XHRcdFx0IGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpXG5cdFx0XHQgfSlcblx0XHRcdCAudGhlbigocmVzcG9uc2UpID0+IHtcblx0XHRcdFx0aWYgKHJlc3BvbnNlLnN0YXR1cyA8IDQwMCkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLmlkYkNhY2hlLnNldENhY2hlKENPTExFQ1RJT05TLlJFVklFV1MsIGRhdGEpLnRoZW4oKCkgPT4ge1xuXHRcdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHRoaXMuaWRiQ2FjaGUuc2V0U3luY0FzUGVuZGluZyhDT0xMRUNUSU9OUy5SRVZJRVdTLCB0cnVlKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEVycm9yIGNvZGUgJHtyZXNwb25zZS5zdGF0dXN9YCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pLmNhdGNoKChlcnJvcikgPT4gY2FsbGJhY2soZXJyb3IsIG51bGwpKTtcblxuXHRcdH1cblx0fVxuXG5cblx0LyoqXG5cdCAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cblx0ICovXG5cdGZldGNoUmVzdGF1cmFudHMoY2FsbGJhY2spIHtcblx0XHR0aGlzLmlkYkNhY2hlLmdldENhY2hlQWxsKENPTExFQ1RJT05TLlJFU1RBVVJBTlRTKS50aGVuKGRhdGEgPT4ge1xuXHRcdFx0aWYoZGF0YS5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIGRhdGEpO1xuXHRcdFx0XHRjb25zb2xlLmxvZygnZGF0YSBsb2FkZWQgZnJvbSBsb2NhbCBzdG9yYWdlIScpO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRmZXRjaCh0aGlzLkRBVEFCQVNFLlJFU1RBVVJBTlRTKS50aGVuKHJlc3BvbnNlID0+IHtcblx0XHRcdFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcblx0XHRcdFx0XHRcdHJlc3BvbnNlLmpzb24oKS50aGVuKGRhdGEgPT4ge1xuXHRcdFx0XHRcdFx0XHR0aGlzLmlkYkNhY2hlLmNhY2hlRGF0YShDT0xMRUNUSU9OUy5SRVNUQVVSQU5UUywgZGF0YSk7XG5cdFx0XHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIGRhdGEpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGNhbGxiYWNrKHRoaXMuaGFuZGxlUmVzcG9uc2VFcnJvcihyZXNwb25zZSwgJ2FwaSByZXF1ZXN0JyksIG51bGwpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4gY2FsbGJhY2soZXJyb3IsIG51bGwpKTtcblxuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG5cdCAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cblx0ICovXG5cdGZldGNoUmV2aWV3cyhpZCwgY2FsbGJhY2spIHtcblx0XHQvLyBjaGVjayB1bnN5Y2VkIHJldmlld3Ncblx0XHR0aGlzLmlkYkNhY2hlLmdldENhY2hlQWxsKENPTExFQ1RJT05TLlVOU1lOQ0VEX1JFVklFV1MpLnRoZW4oKHVuc3ljZWRSZXZpZXdzKSA9PiB7XG5cblx0XHRcdGlmKCFuYXZpZ2F0b3Iub25MaW5lKXtcblx0XHRcdFx0dGhpcy5pZGJDYWNoZS5nZXRDYWNoZUFsbChDT0xMRUNUSU9OUy5SRVZJRVdTKS50aGVuKChyZXZpZXdzKSA9PiB7XG5cdFx0XHRcdFx0Y29uc3QgY2FjaGVkUmV2aWV3cyA9IFsuLi5yZXZpZXdzLCAuLi51bnN5Y2VkUmV2aWV3c107XG5cdFx0XHRcdFx0aWYoY2FjaGVkUmV2aWV3cyAmJiBjYWNoZWRSZXZpZXdzLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHRcdGNvbnN0IGZpbHRlcmVkUmV2aWV3cyA9IGNhY2hlZFJldmlld3MuZmlsdGVyKChyZXZpZXcpID0+IHJldmlldy5yZXN0YXVyYW50X2lkID09PSBpZCk7XG5cdFx0XHRcdFx0XHRjYWxsYmFjayhudWxsLCBmaWx0ZXJlZFJldmlld3MpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRjYWxsYmFjayhudWxsLCBbXSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0Ly8gU3ljZWQgcmV2aWV3cyBpZiBhbnkgdW5zeWNlZFxuXHRcdFx0XHRpZih1bnN5Y2VkUmV2aWV3cyAmJiB1bnN5Y2VkUmV2aWV3cy5sZW5ndGggPiAwKXtcblx0XHRcdFx0XHR1bnN5Y2VkUmV2aWV3cy5mb3JFYWNoKChyZXZpZXcpID0+IHtcblx0XHRcdFx0XHRcdHRoaXMuc2F2ZVJldmlldyhyZXZpZXcsIChlcnJvciwgZGF0YSkgPT4ge1xuXHRcdFx0XHRcdFx0XHRpZihlcnJvcikgY29uc29sZS5lcnJvcihlcnJvcik7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR0aGlzLmlkYkNhY2hlLmNsZWFyQ2FjaGUoQ09MTEVDVElPTlMuVU5TWU5DRURfUkVWSUVXUyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjb25zdCByZXZpZXdzUGF0aCA9IGA/cmVzdGF1cmFudF9pZD0ke2lkfWA7XG5cdFx0XHRcdGZldGNoKHRoaXMuREFUQUJBU0UuUkVWSUVXUyArIHJldmlld3NQYXRoKS50aGVuKHJlc3BvbnNlID0+IHtcblx0XHRcdFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzIDwgNDAwKSB7XG5cdFx0XHRcdFx0XHRyZXNwb25zZS5qc29uKCkudGhlbihkYXRhID0+IHtcblx0XHRcdFx0XHRcdFx0dGhpcy5pZGJDYWNoZS5jYWNoZURhdGEoQ09MTEVDVElPTlMuUkVWSUVXUywgZGF0YSk7XG5cdFx0XHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIGRhdGEpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGNhbGxiYWNrKHRoaXMuaGFuZGxlUmVzcG9uc2VFcnJvcihyZXNwb25zZSwgJ0FQSSByZXF1ZXN0JyksIG51bGwpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4gY2FsbGJhY2soZXJyb3IsIG51bGwpKTtcblx0XHRcdH1cblxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG5cdCAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXG5cdCAqL1xuXHRmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xuXHRcdGlmKCFuYXZpZ2F0b3Iub25MaW5lKSB7XG5cdFx0XHR0aGlzLmlkYkNhY2hlLmdldENhY2hlQnlJZChDT0xMRUNUSU9OUy5SRVNUQVVSQU5UUywgaWQpLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcblx0XHRcdH0pLmNhdGNoKGVycm9yID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnN0IHBhdGggPSBgLyR7aWR9YDtcblx0XHRcdGZldGNoKHRoaXMuREFUQUJBU0UuUkVTVEFVUkFOVFMgKyBwYXRoKS50aGVuKHJlc3BvbnNlID0+IHtcblx0XHRcdFx0aWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG5cdFx0XHRcdFx0cmVzcG9uc2UuanNvbigpLnRoZW4oZGF0YSA9PiB7XG5cdFx0XHRcdFx0XHRjYWxsYmFjayhudWxsLCBkYXRhKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjYWxsYmFjayh0aGlzLmhhbmRsZVJlc3BvbnNlRXJyb3IocmVzcG9uc2UsICdhcGkgcmVxdWVzdCcpLCBudWxsKTtcblx0XHRcdFx0fVxuXHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4gY2FsbGJhY2soZXJyb3IsIG51bGwpKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG5cdCAqL1xuXHRmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcdHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nXG5cdFx0dGhpcy5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcblx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxuXHRcdFx0XHRjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cdC8qKlxuXHQgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cblx0ICovXG5cdGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcblx0XHR0aGlzLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuXHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXG5cdFx0XHRcdGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXHQvKipcblx0ICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cblx0ICovXG5cdGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XG5cdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG5cdFx0dGhpcy5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcblx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzO1xuXHRcdFx0XHRpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxuXHRcdFx0XHRcdHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxuXHRcdFx0XHRcdHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblx0LyoqXG5cdCAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuXHQgKi9cblx0ZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XG5cdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG5cdFx0dGhpcy5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcblx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcblx0XHRcdFx0Y29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKTtcblx0XHRcdFx0Ly8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXG5cdFx0XHRcdGNvbnN0IHVuaXF1ZU5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzLmZpbHRlcigodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGkpO1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCB1bmlxdWVOZWlnaGJvcmhvb2RzKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG4gIC8qKlxuICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuICBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG4gICAgdGhpcy5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpO1xuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuXHQvKipcblx0ICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxuXHQgKi9cblx0bWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcblx0XHRpZighZ29vZ2xlKSByZXR1cm47XG5cdFx0Y29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG5cdFx0XHRwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXG5cdFx0XHR0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxuXHRcdFx0dXJsOiBgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWAsXG5cdFx0XHRtYXA6IG1hcCxcblx0XHRcdGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1B9XG5cdFx0KTtcblx0XHRyZXR1cm4gbWFya2VyO1xuXHR9XG5cblxuXHRoYW5kbGVSZXNwb25zZUVycm9yKHJlc3BvbnNlLCB0eXBlKXtcblx0XHRzd2l0Y2ggKHJlc3BvbnNlLnN0YXR1cykge1xuXHRcdFx0Y2FzZSA0MDA6XG5cdFx0XHRcdHJldHVybiBuZXcgRXJyb3IoJ0JlZCByZXF1ZXN0Jyk7XG5cdFx0XHRjYXNlIDQwNDpcblx0XHRcdFx0cmV0dXJuIG5ldyBFcnJvcignTm90IGZvdW5kJyk7XG5cdFx0XHRjYXNlIDUwMDpcblx0XHRcdFx0cmV0dXJuIG5ldyBFcnJvcignSW50ZXJuYWwgc2VydmVyIGVycm9yJyk7XG5cdFx0fVxuXHR9XG5cbn1cblxuXG5leHBvcnQgZGVmYXVsdCBTdG9yYWdlO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIHRvQXJyYXkoYXJyKSB7XG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycik7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzdWx0KTtcbiAgICAgIH07XG5cbiAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcmVxdWVzdDtcbiAgICB2YXIgcCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdCA9IG9ialttZXRob2RdLmFwcGx5KG9iaiwgYXJncyk7XG4gICAgICBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcbiAgICB9KTtcblxuICAgIHAucmVxdWVzdCA9IHJlcXVlc3Q7XG4gICAgcmV0dXJuIHA7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpO1xuICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBwLnJlcXVlc3QpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlQcm9wZXJ0aWVzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFByb3h5Q2xhc3MucHJvdG90eXBlLCBwcm9wLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF07XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgdGhpc1t0YXJnZXRQcm9wXVtwcm9wXSA9IHZhbDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0uYXBwbHkodGhpc1t0YXJnZXRQcm9wXSwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gSW5kZXgoaW5kZXgpIHtcbiAgICB0aGlzLl9pbmRleCA9IGluZGV4O1xuICB9XG5cbiAgcHJveHlQcm9wZXJ0aWVzKEluZGV4LCAnX2luZGV4JywgW1xuICAgICduYW1lJyxcbiAgICAna2V5UGF0aCcsXG4gICAgJ211bHRpRW50cnknLFxuICAgICd1bmlxdWUnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xuICAgICdnZXQnLFxuICAgICdnZXRLZXknLFxuICAgICdnZXRBbGwnLFxuICAgICdnZXRBbGxLZXlzJyxcbiAgICAnY291bnQnXG4gIF0pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xuICAgICdvcGVuQ3Vyc29yJyxcbiAgICAnb3BlbktleUN1cnNvcidcbiAgXSk7XG5cbiAgZnVuY3Rpb24gQ3Vyc29yKGN1cnNvciwgcmVxdWVzdCkge1xuICAgIHRoaXMuX2N1cnNvciA9IGN1cnNvcjtcbiAgICB0aGlzLl9yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhDdXJzb3IsICdfY3Vyc29yJywgW1xuICAgICdkaXJlY3Rpb24nLFxuICAgICdrZXknLFxuICAgICdwcmltYXJ5S2V5JyxcbiAgICAndmFsdWUnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoQ3Vyc29yLCAnX2N1cnNvcicsIElEQkN1cnNvciwgW1xuICAgICd1cGRhdGUnLFxuICAgICdkZWxldGUnXG4gIF0pO1xuXG4gIC8vIHByb3h5ICduZXh0JyBtZXRob2RzXG4gIFsnYWR2YW5jZScsICdjb250aW51ZScsICdjb250aW51ZVByaW1hcnlLZXknXS5mb3JFYWNoKGZ1bmN0aW9uKG1ldGhvZE5hbWUpIHtcbiAgICBpZiAoIShtZXRob2ROYW1lIGluIElEQkN1cnNvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgQ3Vyc29yLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGN1cnNvciA9IHRoaXM7XG4gICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICBjdXJzb3IuX2N1cnNvclttZXRob2ROYW1lXS5hcHBseShjdXJzb3IuX2N1cnNvciwgYXJncyk7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KGN1cnNvci5fcmVxdWVzdCkudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgY3Vyc29yLl9yZXF1ZXN0KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICBmdW5jdGlvbiBPYmplY3RTdG9yZShzdG9yZSkge1xuICAgIHRoaXMuX3N0b3JlID0gc3RvcmU7XG4gIH1cblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuY3JlYXRlSW5kZXggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmNyZWF0ZUluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuaW5kZXggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBbXG4gICAgJ25hbWUnLFxuICAgICdrZXlQYXRoJyxcbiAgICAnaW5kZXhOYW1lcycsXG4gICAgJ2F1dG9JbmNyZW1lbnQnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdwdXQnLFxuICAgICdhZGQnLFxuICAgICdkZWxldGUnLFxuICAgICdjbGVhcicsXG4gICAgJ2dldCcsXG4gICAgJ2dldEFsbCcsXG4gICAgJ2dldEtleScsXG4gICAgJ2dldEFsbEtleXMnLFxuICAgICdjb3VudCdcbiAgXSk7XG5cbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ29wZW5DdXJzb3InLFxuICAgICdvcGVuS2V5Q3Vyc29yJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdkZWxldGVJbmRleCdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gVHJhbnNhY3Rpb24oaWRiVHJhbnNhY3Rpb24pIHtcbiAgICB0aGlzLl90eCA9IGlkYlRyYW5zYWN0aW9uO1xuICAgIHRoaXMuY29tcGxldGUgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmFib3J0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgVHJhbnNhY3Rpb24ucHJvdG90eXBlLm9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl90eC5vYmplY3RTdG9yZS5hcHBseSh0aGlzLl90eCwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFRyYW5zYWN0aW9uLCAnX3R4JywgW1xuICAgICdvYmplY3RTdG9yZU5hbWVzJyxcbiAgICAnbW9kZSdcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKFRyYW5zYWN0aW9uLCAnX3R4JywgSURCVHJhbnNhY3Rpb24sIFtcbiAgICAnYWJvcnQnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIFVwZ3JhZGVEQihkYiwgb2xkVmVyc2lvbiwgdHJhbnNhY3Rpb24pIHtcbiAgICB0aGlzLl9kYiA9IGRiO1xuICAgIHRoaXMub2xkVmVyc2lvbiA9IG9sZFZlcnNpb247XG4gICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XG4gIH1cblxuICBVcGdyYWRlREIucHJvdG90eXBlLmNyZWF0ZU9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl9kYi5jcmVhdGVPYmplY3RTdG9yZS5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFVwZ3JhZGVEQiwgJ19kYicsIFtcbiAgICAnbmFtZScsXG4gICAgJ3ZlcnNpb24nLFxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoVXBncmFkZURCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcbiAgICAnZGVsZXRlT2JqZWN0U3RvcmUnLFxuICAgICdjbG9zZSdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gREIoZGIpIHtcbiAgICB0aGlzLl9kYiA9IGRiO1xuICB9XG5cbiAgREIucHJvdG90eXBlLnRyYW5zYWN0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBUcmFuc2FjdGlvbih0aGlzLl9kYi50cmFuc2FjdGlvbi5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKERCLCAnX2RiJywgW1xuICAgICduYW1lJyxcbiAgICAndmVyc2lvbicsXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG4gICAgJ2Nsb3NlJ1xuICBdKTtcblxuICAvLyBBZGQgY3Vyc29yIGl0ZXJhdG9yc1xuICAvLyBUT0RPOiByZW1vdmUgdGhpcyBvbmNlIGJyb3dzZXJzIGRvIHRoZSByaWdodCB0aGluZyB3aXRoIHByb21pc2VzXG4gIFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10uZm9yRWFjaChmdW5jdGlvbihmdW5jTmFtZSkge1xuICAgIFtPYmplY3RTdG9yZSwgSW5kZXhdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcbiAgICAgIC8vIERvbid0IGNyZWF0ZSBpdGVyYXRlS2V5Q3Vyc29yIGlmIG9wZW5LZXlDdXJzb3IgZG9lc24ndCBleGlzdC5cbiAgICAgIGlmICghKGZ1bmNOYW1lIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcblxuICAgICAgQ29uc3RydWN0b3IucHJvdG90eXBlW2Z1bmNOYW1lLnJlcGxhY2UoJ29wZW4nLCAnaXRlcmF0ZScpXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzKTtcbiAgICAgICAgdmFyIGNhbGxiYWNrID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdO1xuICAgICAgICB2YXIgbmF0aXZlT2JqZWN0ID0gdGhpcy5fc3RvcmUgfHwgdGhpcy5faW5kZXg7XG4gICAgICAgIHZhciByZXF1ZXN0ID0gbmF0aXZlT2JqZWN0W2Z1bmNOYW1lXS5hcHBseShuYXRpdmVPYmplY3QsIGFyZ3Muc2xpY2UoMCwgLTEpKTtcbiAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBjYWxsYmFjayhyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgIH0pO1xuICB9KTtcblxuICAvLyBwb2x5ZmlsbCBnZXRBbGxcbiAgW0luZGV4LCBPYmplY3RTdG9yZV0uZm9yRWFjaChmdW5jdGlvbihDb25zdHJ1Y3Rvcikge1xuICAgIGlmIChDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsKSByZXR1cm47XG4gICAgQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCA9IGZ1bmN0aW9uKHF1ZXJ5LCBjb3VudCkge1xuICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcbiAgICAgIHZhciBpdGVtcyA9IFtdO1xuXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkge1xuICAgICAgICBpbnN0YW5jZS5pdGVyYXRlQ3Vyc29yKHF1ZXJ5LCBmdW5jdGlvbihjdXJzb3IpIHtcbiAgICAgICAgICBpZiAoIWN1cnNvcikge1xuICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGl0ZW1zLnB1c2goY3Vyc29yLnZhbHVlKTtcblxuICAgICAgICAgIGlmIChjb3VudCAhPT0gdW5kZWZpbmVkICYmIGl0ZW1zLmxlbmd0aCA9PSBjb3VudCkge1xuICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0pO1xuXG4gIHZhciBleHAgPSB7XG4gICAgb3BlbjogZnVuY3Rpb24obmFtZSwgdmVyc2lvbiwgdXBncmFkZUNhbGxiYWNrKSB7XG4gICAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ29wZW4nLCBbbmFtZSwgdmVyc2lvbl0pO1xuICAgICAgdmFyIHJlcXVlc3QgPSBwLnJlcXVlc3Q7XG5cbiAgICAgIGlmIChyZXF1ZXN0KSB7XG4gICAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICBpZiAodXBncmFkZUNhbGxiYWNrKSB7XG4gICAgICAgICAgICB1cGdyYWRlQ2FsbGJhY2sobmV3IFVwZ3JhZGVEQihyZXF1ZXN0LnJlc3VsdCwgZXZlbnQub2xkVmVyc2lvbiwgcmVxdWVzdC50cmFuc2FjdGlvbikpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbihkYikge1xuICAgICAgICByZXR1cm4gbmV3IERCKGRiKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVsZXRlOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnZGVsZXRlRGF0YWJhc2UnLCBbbmFtZV0pO1xuICAgIH1cbiAgfTtcblxuICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGV4cDtcbiAgICBtb2R1bGUuZXhwb3J0cy5kZWZhdWx0ID0gbW9kdWxlLmV4cG9ydHM7XG4gIH1cbiAgZWxzZSB7XG4gICAgc2VsZi5pZGIgPSBleHA7XG4gIH1cbn0oKSk7XG4iXX0=\n"]}