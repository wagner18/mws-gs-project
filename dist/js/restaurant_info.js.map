{"version":3,"sources":["restaurant_info.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Object","defineProperty","value","default","COLLECTIONS","RESTAURANTS","REVIEWS","UNSYNCED_REVIEWS","IS_DATA_SYNCRONIZED","2","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_idb2","_interopRequireDefault","obj","__esModule","DataCache","instance","TypeError","_classCallCheck","this","dbName","_IDB","setDatabase","setSyncAsPending","open","upgradedDB","oldVersion","createObjectStore","keyPath","createIndex","autoIncrement","console","log","collection","status","then","db","transaction","objectStore","put","data","arguments","undefined","tx","readwriteStore","forEach","item","complete","id","index","get","parseInt","getAll","restaurants","delete","clear","./constants","idb","3","_dataCache2","_toConsumableArray","arr","Array","isArray","arr2","from","DBHelper","DATABASE","idbCache","callback","_this","getCacheById","response","toogle","is_favorite","setCache","navigator","onLine","path","fetch","method","catch","error","_this2","body","JSON","stringify","_this3","getCacheAll","json","cacheData","handleResponseError","_this4","unsycedReviews","review","saveReview","clearCache","reviewsPath","reviews","cachedReviews","concat","filteredReviews","filter","restaurant_id","_this5","cuisine","fetchRestaurants","results","cuisine_type","neighborhood","neighborhoods","map","v","uniqueNeighborhoods","indexOf","cuisines","uniqueCuisines","restaurant","size","img","photograph","google","maps","Marker","position","latlng","title","name","url","urlForRestaurant","animation","Animation","DROP","type","./dataCache","4","_dbhelper","_dbhelper2","RestaurantInfo","window","addEventListener","script","document","createElement","setAttribute","src","querySelector","appendChild","fetchRestaurantFromURL","initMap","Map","getElementById","zoom","center","scrollwheel","mapMarkerForRestaurant","fillBreadcrumb","getParameterByName","fetchRestaurantById","fillRestaurantHTML","innerHTML","address","image","className","imageUrlForRestaurant","alt","srcset","operating_hours","fillRestaurantHoursHTML","fetchReviews","fillReviewsHTML","operatingHours","hours","row","day","time","reverse","container","noReviews","ul","createReviewHTML","li","date","rating","comments","breadcrumb","location","href","replace","RegExp","exec","decodeURIComponent","formData","querySelectorAll","field","prepend","restaurantInfo","./dbhelper","5","promisifyRequest","request","Promise","resolve","reject","onsuccess","result","onerror","promisifyRequestCall","args","apply","proxyProperties","ProxyClass","targetProp","properties","prop","set","val","proxyRequestMethods","proxyMethods","proxyCursorRequestMethods","Cursor","Index","_index","cursor","_cursor","_request","ObjectStore","store","_store","Transaction","idbTransaction","_tx","oncomplete","onabort","UpgradeDB","_db","DB","IDBIndex","IDBCursor","methodName","IDBObjectStore","IDBTransaction","IDBDatabase","funcName","slice","nativeObject","query","count","items","iterateCursor","push","continue","exp","version","upgradeCallback","indexedDB","onupgradeneeded","event","self"],"mappings":"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","file":"restaurant_info.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar constants = {\n  COLLECTIONS: {\n    RESTAURANTS: 'restaurants',\n    REVIEWS: 'reviews',\n    UNSYNCED_REVIEWS: 'unsynced_reviews',\n    IS_DATA_SYNCRONIZED: 'isDataSyncronzed'\n  }\n};\n\nexports.default = constants;\n\n},{}],2:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _idb = require('idb');\n\nvar _idb2 = _interopRequireDefault(_idb);\n\nvar _constants = require('./constants');\n\nvar _constants2 = _interopRequireDefault(_constants);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar COLLECTIONS = _constants2.default.COLLECTIONS;\n\n/*\n* Common database helper functions.\n*/\n\nvar DataCache = function () {\n\tfunction DataCache() {\n\t\t_classCallCheck(this, DataCache);\n\n\t\tthis.dbName = \"restaurantApp\";\n\t\tthis._IDB = this.setDatabase(this.dbName);\n\t\tthis.setSyncAsPending(COLLECTIONS.RESTAURANTS, true);\n\t\tthis.setSyncAsPending(COLLECTIONS.REVIEWS, true);\n\t}\n\n\t_createClass(DataCache, [{\n\t\tkey: 'setDatabase',\n\t\tvalue: function setDatabase(dbName) {\n\t\t\t// DAMN THIS LINE!!!!!! if (!navigator.serviceWorker) return Promise.resolve();\n\t\t\treturn _idb2.default.open(dbName, 1, function (upgradedDB) {\n\t\t\t\tswitch (upgradedDB.oldVersion) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\tvar restaurants = upgradedDB.createObjectStore(COLLECTIONS.RESTAURANTS, { keyPath: 'id' });\n\t\t\t\t\t\trestaurants.createIndex('by-id', 'id');\n\n\t\t\t\t\t\tvar reviews = upgradedDB.createObjectStore(COLLECTIONS.REVIEWS, { keyPath: 'id' });\n\t\t\t\t\t\treviews.createIndex('by-id', 'restaurant_id');\n\n\t\t\t\t\t\tvar unsyncedReviews = upgradedDB.createObjectStore(COLLECTIONS.UNSYNCED_REVIEWS, { autoIncrement: true });\n\t\t\t\t\t\tunsyncedReviews.createIndex('by-id', 'restaurant_id');\n\n\t\t\t\t\t\tupgradedDB.createObjectStore(COLLECTIONS.IS_DATA_SYNCRONIZED, { keyPath: 'collection' });\n\t\t\t\t\t\tconsole.log('Database and Index created');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Set local data sync as panding\n   */\n\n\t}, {\n\t\tkey: 'setSyncAsPending',\n\t\tvalue: function setSyncAsPending(collection, status) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(COLLECTIONS.IS_DATA_SYNCRONIZED, 'readwrite');\n\t\t\t\ttx.objectStore(COLLECTIONS.IS_DATA_SYNCRONIZED).put({ collection: collection, status: status });\n\t\t\t});\n\t\t}\n\n\t\t// syncDataToApi(path, data) {\n\t\t// \tfetch(this.DATABASE.RESTAURANTS + path, { method: 'PUT' }).then(response => {\n\t\t// \t\tif (response.status === 200) {\n\t\t// \t\t\tresponse.json().then(data => {\n\t\t// \t\t\t\t// this.cacheItem(data);\n\t\t// \t\t\t\t// console.warn(data);\n\t\t// \t\t\t});\n\t\t// \t\t} else {\n\t\t// \t\t\tcallback(this.handleResponseError(response, 'api request'), null);\n\t\t// \t\t}\n\t\t// \t}).catch(error => callback(error, null));\n\t\t// }\n\n\n\t}, {\n\t\tkey: 'cacheData',\n\t\tvalue: function cacheData(collection) {\n\t\t\tvar data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n\t\t\t// add post the local DB\n\t\t\tthis._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\tvar readwriteStore = tx.objectStore(collection);\n\t\t\t\tdata.forEach(function (item) {\n\t\t\t\t\treturn readwriteStore.put(item);\n\t\t\t\t});\n\t\t\t\ttx.complete.then(function () {\n\t\t\t\t\treturn console.log('post added to indexedDB');\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'setCache',\n\t\tvalue: function setCache(collection, data) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\ttx.objectStore(collection).put(data);\n\t\t\t\treturn tx.complete;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'getCacheById',\n\t\tvalue: function getCacheById(collection) {\n\t\t\tvar id = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\treturn db.transaction(collection).objectStore(collection).index('by-id').get(parseInt(id));\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'getCacheAll',\n\t\tvalue: function getCacheAll(collection) {\n\t\t\tvar index = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'by-id';\n\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\treturn db.transaction(collection).objectStore(collection).index(index).getAll();\n\t\t\t}).then(function (restaurants) {\n\t\t\t\treturn restaurants;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'deleteCache',\n\t\tvalue: function deleteCache(collection, id) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\ttx.objectStore(collection).delete(id);\n\t\t\t\treturn tx.complete;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'clearCache',\n\t\tvalue: function clearCache(collection) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\ttx.objectStore(collection).clear();\n\t\t\t\treturn tx.complete;\n\t\t\t});\n\t\t}\n\t}]);\n\n\treturn DataCache;\n}();\n\nexports.default = DataCache;\n\n},{\"./constants\":1,\"idb\":5}],3:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _idb = require('idb');\n\nvar _idb2 = _interopRequireDefault(_idb);\n\nvar _dataCache = require('./dataCache');\n\nvar _dataCache2 = _interopRequireDefault(_dataCache);\n\nvar _constants = require('./constants');\n\nvar _constants2 = _interopRequireDefault(_constants);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar COLLECTIONS = _constants2.default.COLLECTIONS;\n\n/*\n* Common database helper functions.\n*/\n\nvar DBHelper = function () {\n\tfunction DBHelper() {\n\t\t_classCallCheck(this, DBHelper);\n\n\t\tvar port = 1337; // Change this to your server port\n\t\t// Database URL.\n\t\tthis.DATABASE = {\n\t\t\tRESTAURANTS: 'http://0.0.0.0:' + port + '/restaurants',\n\t\t\tREVIEWS: 'http://0.0.0.0:' + port + '/reviews/'\n\t\t};\n\n\t\tthis.idbCache = new _dataCache2.default();\n\t}\n\n\t// Data storage interfaces \\\\\n\n\t_createClass(DBHelper, [{\n\t\tkey: 'toogleFavorite',\n\t\tvalue: function toogleFavorite(id, callback) {\n\t\t\tvar _this = this;\n\n\t\t\tthis.idbCache.getCacheById(COLLECTIONS.RESTAURANTS, id).then(function (response) {\n\n\t\t\t\tvar toogle = response.is_favorite === \"true\" ? \"false\" : \"true\";\n\t\t\t\tresponse.is_favorite = toogle;\n\t\t\t\treturn _this.idbCache.setCache(COLLECTIONS.RESTAURANTS, response).then(function () {\n\t\t\t\t\tcallback(null, response);\n\t\t\t\t\tif (!navigator.onLine) {\n\t\t\t\t\t\t_this.idbCache.setSyncAsPending(COLLECTIONS.RESTAURANTS, false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar path = '/' + id + '/?is_favorite=' + toogle;\n\t\t\t\t\t\treturn fetch(_this.DATABASE.RESTAURANTS + path, { method: 'PUT' }).then(function (response) {\n\t\t\t\t\t\t\tif (response.status === 200) _this.idbCache.setSyncAsPending(COLLECTIONS.RESTAURANTS, true);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}).catch(function (error) {\n\t\t\t\treturn callback(error, null);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'saveReview',\n\t\tvalue: function saveReview(data, callback) {\n\t\t\tvar _this2 = this;\n\n\t\t\tif (!navigator.onLine) {\n\t\t\t\treturn this.idbCache.setCache(COLLECTIONS.UNSYNCED_REVIEWS, data).then(function () {\n\t\t\t\t\t_this2.idbCache.setSyncAsPending(COLLECTIONS.REVIEWS, false);\n\t\t\t\t\tcallback(null, data);\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t} else {\n\n\t\t\t\treturn fetch(this.DATABASE.REVIEWS, {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tbody: JSON.stringify(data)\n\t\t\t\t}).then(function (response) {\n\t\t\t\t\tif (response.status < 400) {\n\t\t\t\t\t\treturn _this2.idbCache.setCache(COLLECTIONS.REVIEWS, data).then(function () {\n\t\t\t\t\t\t\tcallback(null, response);\n\t\t\t\t\t\t\treturn _this2.idbCache.setSyncAsPending(COLLECTIONS.REVIEWS, true);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error('Error code ' + response.status);\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Fetch all restaurants.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurants',\n\t\tvalue: function fetchRestaurants(callback) {\n\t\t\tvar _this3 = this;\n\n\t\t\tthis.idbCache.getCacheAll(COLLECTIONS.RESTAURANTS).then(function (data) {\n\t\t\t\tif (data.length > 0) {\n\t\t\t\t\tcallback(null, data);\n\t\t\t\t\tconsole.log('data loaded from local storage!');\n\t\t\t\t} else {\n\n\t\t\t\t\tfetch(_this3.DATABASE.RESTAURANTS).then(function (response) {\n\t\t\t\t\t\tif (response.status === 200) {\n\t\t\t\t\t\t\tresponse.json().then(function (data) {\n\t\t\t\t\t\t\t\t_this3.idbCache.cacheData(COLLECTIONS.RESTAURANTS, data);\n\t\t\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcallback(_this3.handleResponseError(response, 'api request'), null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch(function (error) {\n\t\t\t\t\t\treturn callback(error, null);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Fetch all restaurants.\n   */\n\n\t}, {\n\t\tkey: 'fetchReviews',\n\t\tvalue: function fetchReviews(id, callback) {\n\t\t\tvar _this4 = this;\n\n\t\t\t// check unsyced reviews\n\t\t\tthis.idbCache.getCacheAll(COLLECTIONS.UNSYNCED_REVIEWS).then(function (unsycedReviews) {\n\n\t\t\t\tif (!navigator.onLine) {\n\t\t\t\t\t_this4.idbCache.getCacheAll(COLLECTIONS.REVIEWS).then(function (reviews) {\n\t\t\t\t\t\tvar cachedReviews = [].concat(_toConsumableArray(reviews), _toConsumableArray(unsycedReviews));\n\t\t\t\t\t\tif (cachedReviews && cachedReviews.length > 0) {\n\t\t\t\t\t\t\tvar filteredReviews = cachedReviews.filter(function (review) {\n\t\t\t\t\t\t\t\treturn review.restaurant_id === id;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tcallback(null, filteredReviews);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcallback(null, []);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\n\t\t\t\t\t// Syced reviews if any unsyced\n\t\t\t\t\tif (unsycedReviews && unsycedReviews.length > 0) {\n\t\t\t\t\t\tunsycedReviews.forEach(function (review) {\n\t\t\t\t\t\t\t_this4.saveReview(review, function (error, data) {\n\t\t\t\t\t\t\t\tif (error) console.error(error);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t\t_this4.idbCache.clearCache(COLLECTIONS.UNSYNCED_REVIEWS);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar reviewsPath = '?restaurant_id=' + id;\n\t\t\t\t\tfetch(_this4.DATABASE.REVIEWS + reviewsPath).then(function (response) {\n\t\t\t\t\t\tif (response.status < 400) {\n\t\t\t\t\t\t\tresponse.json().then(function (data) {\n\t\t\t\t\t\t\t\t_this4.idbCache.cacheData(COLLECTIONS.REVIEWS, data);\n\t\t\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcallback(_this4.handleResponseError(response, 'API request'), null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch(function (error) {\n\t\t\t\t\t\treturn callback(error, null);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Fetch a restaurant by its ID.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantById',\n\t\tvalue: function fetchRestaurantById(id, callback) {\n\t\t\tvar _this5 = this;\n\n\t\t\tif (!navigator.onLine) {\n\t\t\t\tthis.idbCache.getCacheById(COLLECTIONS.RESTAURANTS, id).then(function (response) {\n\t\t\t\t\tcallback(null, response);\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tvar path = '/' + id;\n\t\t\t\tfetch(this.DATABASE.RESTAURANTS + path).then(function (response) {\n\t\t\t\t\tif (response.status === 200) {\n\t\t\t\t\t\tresponse.json().then(function (data) {\n\t\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback(_this5.handleResponseError(response, 'api request'), null);\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Fetch restaurants by a cuisine type with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantByCuisine',\n\t\tvalue: function fetchRestaurantByCuisine(cuisine, callback) {\n\t\t\t// Fetch all restaurants\twith proper error handling\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Filter restaurants to have only given cuisine type\n\t\t\t\t\tvar results = restaurants.filter(function (r) {\n\t\t\t\t\t\treturn r.cuisine_type == cuisine;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, results);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t/**\n   * Fetch restaurants by a neighborhood with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantByNeighborhood',\n\t\tvalue: function fetchRestaurantByNeighborhood(neighborhood, callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Filter restaurants to have only given neighborhood\n\t\t\t\t\tvar results = restaurants.filter(function (r) {\n\t\t\t\t\t\treturn r.neighborhood == neighborhood;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, results);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t/**\n   * Fetch restaurants by a cuisine and a neighborhood with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantByCuisineAndNeighborhood',\n\t\tvalue: function fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\tvar results = restaurants;\n\t\t\t\t\tif (cuisine != 'all') {\n\t\t\t\t\t\t// filter by cuisine\n\t\t\t\t\t\tresults = results.filter(function (r) {\n\t\t\t\t\t\t\treturn r.cuisine_type == cuisine;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (neighborhood != 'all') {\n\t\t\t\t\t\t// filter by neighborhood\n\t\t\t\t\t\tresults = results.filter(function (r) {\n\t\t\t\t\t\t\treturn r.neighborhood == neighborhood;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tcallback(null, results);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t/**\n   * Fetch all neighborhoods with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchNeighborhoods',\n\t\tvalue: function fetchNeighborhoods(callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Get all neighborhoods from all restaurants\n\t\t\t\t\tvar neighborhoods = restaurants.map(function (v, i) {\n\t\t\t\t\t\treturn restaurants[i].neighborhood;\n\t\t\t\t\t});\n\t\t\t\t\t// Remove duplicates from neighborhoods\n\t\t\t\t\tvar uniqueNeighborhoods = neighborhoods.filter(function (v, i) {\n\t\t\t\t\t\treturn neighborhoods.indexOf(v) == i;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, uniqueNeighborhoods);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Fetch all cuisines with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchCuisines',\n\t\tvalue: function fetchCuisines(callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Get all cuisines from all restaurants\n\t\t\t\t\tvar cuisines = restaurants.map(function (v, i) {\n\t\t\t\t\t\treturn restaurants[i].cuisine_type;\n\t\t\t\t\t});\n\t\t\t\t\t// Remove duplicates from cuisines\n\t\t\t\t\tvar uniqueCuisines = cuisines.filter(function (v, i) {\n\t\t\t\t\t\treturn cuisines.indexOf(v) == i;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, uniqueCuisines);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Restaurant page URL.\n   */\n\n\t}, {\n\t\tkey: 'urlForRestaurant',\n\t\tvalue: function urlForRestaurant(restaurant) {\n\t\t\treturn './restaurant.html?id=' + restaurant.id;\n\t\t}\n\t\t/**\n   * Restaurant image URL.\n   */\n\n\t}, {\n\t\tkey: 'imageUrlForRestaurant',\n\t\tvalue: function imageUrlForRestaurant(restaurant, size) {\n\t\t\tvar img = restaurant.photograph;\n\t\t\treturn img ? '/img/' + img + '-' + size + '.jpg' : '/img/restaurant_placeholder.svg';\n\t\t}\n\t\t/**\n   * Map marker for a restaurant.\n   */\n\n\t}, {\n\t\tkey: 'mapMarkerForRestaurant',\n\t\tvalue: function mapMarkerForRestaurant(restaurant, map) {\n\t\t\tvar marker = new google.maps.Marker({\n\t\t\t\tposition: restaurant.latlng,\n\t\t\t\ttitle: restaurant.name,\n\t\t\t\turl: this.urlForRestaurant(restaurant),\n\t\t\t\tmap: map,\n\t\t\t\tanimation: google.maps.Animation.DROP });\n\t\t\treturn marker;\n\t\t}\n\t}, {\n\t\tkey: 'handleResponseError',\n\t\tvalue: function handleResponseError(response, type) {\n\t\t\tswitch (response.status) {\n\t\t\t\tcase 400:\n\t\t\t\t\treturn new Error('Bed request');\n\t\t\t\tcase 404:\n\t\t\t\t\treturn new Error('Not found');\n\t\t\t\tcase 500:\n\t\t\t\t\treturn new Error('Internal server error');\n\t\t\t}\n\t\t}\n\t}]);\n\n\treturn DBHelper;\n}();\n\nexports.default = DBHelper;\n\n},{\"./constants\":1,\"./dataCache\":2,\"idb\":5}],4:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _dbhelper = require('./dbhelper');\n\nvar _dbhelper2 = _interopRequireDefault(_dbhelper);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar RestaurantInfo = function () {\n\tfunction RestaurantInfo() {\n\t\tvar _this = this;\n\n\t\t_classCallCheck(this, RestaurantInfo);\n\n\t\tthis.map = null;\n\t\tthis.restaurant = null;\n\t\tthis.db = new _dbhelper2.default();\n\n\t\t/**\n   * Initialize Google map, called from HTML.\n   */\n\n\t\twindow.addEventListener('load', function (e) {\n\t\t\tconsole.log('All resources finished loading!');\n\n\t\t\tvar script = document.createElement('script');\n\t\t\tscript.setAttribute('async', true);\n\t\t\tscript.setAttribute('defer', true);\n\t\t\tscript.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyCAGI5xQ4PXUpi6HNhM7fwIVzSzTVVJz5E&libraries=places&callback=initMap';\n\t\t\tdocument.querySelector('.inside').appendChild(script);\n\n\t\t\t_this.fetchRestaurantFromURL(function (error, restaurant) {\n\t\t\t\tif (error) {\n\t\t\t\t\t// Got an error!\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t} else {\n\t\t\t\t\t// if(navigator.onLine) {\n\t\t\t\t\twindow.initMap = function () {\n\t\t\t\t\t\t_this.map = new google.maps.Map(document.getElementById('map'), {\n\t\t\t\t\t\t\tzoom: 16,\n\t\t\t\t\t\t\tcenter: restaurant.latlng,\n\t\t\t\t\t\t\tscrollwheel: false\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t_this.db.mapMarkerForRestaurant(_this.restaurant, _this.map);\n\t\t\t\t\t};\n\t\t\t\t\t// }\n\n\t\t\t\t\t_this.fillBreadcrumb();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n  * Get current restaurant from page URL.\n  */\n\n\n\t_createClass(RestaurantInfo, [{\n\t\tkey: 'fetchRestaurantFromURL',\n\t\tvalue: function fetchRestaurantFromURL(callback) {\n\t\t\tvar _this2 = this;\n\n\t\t\tif (this.restaurant) {\n\t\t\t\t// restaurant already fetched!\n\t\t\t\tcallback(null, this.restaurant);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar id = this.getParameterByName('id');\n\t\t\tif (!id) {\n\t\t\t\t// no id found in URL\n\t\t\t\tcallback('No restaurant id in URL', null);\n\t\t\t} else {\n\t\t\t\tthis.db.fetchRestaurantById(id, function (error, restaurant) {\n\t\t\t\t\t_this2.restaurant = restaurant;\n\n\t\t\t\t\tif (!restaurant) {\n\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t_this2.fillRestaurantHTML();\n\t\t\t\t\tcallback(null, restaurant);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'fillRestaurantHTML',\n\n\n\t\t/**\n   * Create restaurant HTML and add it to the webpage\n   */\n\t\tvalue: function fillRestaurantHTML() {\n\t\t\tvar _this3 = this;\n\n\t\t\tvar restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.restaurant;\n\n\t\t\tvar name = document.getElementById('restaurant-name');\n\t\t\tname.innerHTML = restaurant.name;\n\n\t\t\tvar address = document.getElementById('restaurant-address');\n\t\t\taddress.innerHTML = restaurant.address;\n\n\t\t\tvar image = document.getElementById('restaurant-img');\n\t\t\timage.className = 'restaurant-img';\n\t\t\timage.src = this.db.imageUrlForRestaurant(restaurant, 600);\n\t\t\timage.alt = restaurant.name + ' - ' + restaurant.cuisine_type + ' Cuisine';\n\t\t\timage.srcset = this.db.imageUrlForRestaurant(restaurant, 1200) + ' 600w, ' + this.db.imageUrlForRestaurant(restaurant, 600) + ' 400w';\n\n\t\t\tvar cuisine = document.getElementById('restaurant-cuisine');\n\t\t\tcuisine.innerHTML = restaurant.cuisine_type;\n\n\t\t\t// fill operating hours\n\t\t\tif (restaurant.operating_hours) {\n\t\t\t\tthis.fillRestaurantHoursHTML();\n\t\t\t}\n\t\t\t// fill reviews\n\t\t\tthis.db.fetchReviews(restaurant.id, function (error, reviews) {\n\t\t\t\tif (!error) _this3.fillReviewsHTML(reviews);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'fillRestaurantHoursHTML',\n\n\n\t\t/**\n   * Create restaurant operating hours HTML table and add it to the webpage.\n   */\n\t\tvalue: function fillRestaurantHoursHTML() {\n\t\t\tvar operatingHours = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.restaurant.operating_hours;\n\n\t\t\tvar hours = document.getElementById('restaurant-hours');\n\t\t\tfor (var key in operatingHours) {\n\t\t\t\tvar row = document.createElement('tr');\n\n\t\t\t\tvar day = document.createElement('td');\n\t\t\t\tday.innerHTML = key;\n\t\t\t\trow.appendChild(day);\n\n\t\t\t\tvar time = document.createElement('td');\n\t\t\t\ttime.innerHTML = operatingHours[key];\n\t\t\t\trow.appendChild(time);\n\n\t\t\t\thours.appendChild(row);\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'fillReviewsHTML',\n\n\n\t\t/**\n   * Create all reviews HTML and add them to the webpage.\n   */\n\t\tvalue: function fillReviewsHTML() {\n\t\t\tvar _this4 = this;\n\n\t\t\tvar reviews = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n\t\t\treviews.reverse();\n\t\t\tvar container = document.getElementById('reviews-container');\n\t\t\tvar title = document.createElement('h3');\n\t\t\ttitle.innerHTML = 'Reviews';\n\t\t\tcontainer.appendChild(title);\n\n\t\t\tif (!reviews) {\n\t\t\t\tvar noReviews = document.createElement('p');\n\t\t\t\tnoReviews.innerHTML = 'No reviews yet!';\n\t\t\t\tcontainer.appendChild(noReviews);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar ul = document.getElementById('reviews-list');\n\t\t\treviews.forEach(function (review) {\n\t\t\t\tul.appendChild(_this4.createReviewHTML(review));\n\t\t\t});\n\t\t\tcontainer.appendChild(ul);\n\t\t}\n\t}, {\n\t\tkey: 'createReviewHTML',\n\n\n\t\t/**\n   * Create review HTML and add it to the webpage.\n   */\n\t\tvalue: function createReviewHTML(review) {\n\t\t\tvar li = document.createElement('li');\n\t\t\tvar name = document.createElement('p');\n\t\t\tname.innerHTML = review.name;\n\t\t\tli.appendChild(name);\n\n\t\t\tvar date = document.createElement('p');\n\t\t\tdate.innerHTML = review.date;\n\t\t\tli.appendChild(date);\n\n\t\t\tvar rating = document.createElement('p');\n\t\t\trating.innerHTML = 'Rating: ' + review.rating;\n\t\t\tli.appendChild(rating);\n\n\t\t\tvar comments = document.createElement('p');\n\t\t\tcomments.innerHTML = review.comments;\n\t\t\tli.appendChild(comments);\n\n\t\t\treturn li;\n\t\t}\n\t}, {\n\t\tkey: 'fillBreadcrumb',\n\n\n\t\t/**\n   * Add restaurant name to the breadcrumb navigation menu\n   */\n\t\tvalue: function fillBreadcrumb() {\n\t\t\tvar restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.restaurant;\n\n\t\t\tvar breadcrumb = document.getElementById('breadcrumb');\n\t\t\tvar li = document.createElement('li');\n\t\t\tli.innerHTML = restaurant.name;\n\t\t\tli.setAttribute('aria-label', restaurant.name);\n\t\t\tli.setAttribute('aria-current', 'page');\n\t\t\tbreadcrumb.appendChild(li);\n\t\t}\n\t}, {\n\t\tkey: 'getParameterByName',\n\n\n\t\t/**\n   * Get a parameter by name from page URL.\n   */\n\t\tvalue: function getParameterByName(name, url) {\n\t\t\tif (!url) url = window.location.href;\n\t\t\tname = name.replace(/[\\[\\]]/g, '\\\\$&');\n\t\t\tvar regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),\n\t\t\t    results = regex.exec(url);\n\t\t\tif (!results) return null;\n\t\t\tif (!results[2]) return '';\n\t\t\treturn decodeURIComponent(results[2].replace(/\\+/g, ' '));\n\t\t}\n\t}, {\n\t\tkey: 'sendReview',\n\t\tvalue: function sendReview() {\n\t\t\tvar _this5 = this;\n\n\t\t\tvar formData = {\n\t\t\t\trestaurant_id: this.restaurant.id\n\t\t\t};\n\t\t\tvar formDataFields = document.querySelectorAll(\".field\");\n\t\t\tformDataFields.forEach(function (field) {\n\t\t\t\tformData[field.name] = field.value;\n\t\t\t});\n\n\t\t\tthis.db.saveReview(formData, function (error, status) {\n\t\t\t\tif (!error) {\n\t\t\t\t\tvar commentList = document.querySelector('#reviews-list');\n\t\t\t\t\tcommentList.prepend(_this5.createReviewHTML(formData));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}]);\n\n\treturn RestaurantInfo;\n}();\n\nexports.default = RestaurantInfo;\n\n\nwindow.restaurantInfo = new RestaurantInfo();\n\n},{\"./dbhelper\":3}],5:[function(require,module,exports){\n'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      if (request) {\n        request.onupgradeneeded = function(event) {\n          if (upgradeCallback) {\n            upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n          }\n        };\n      }\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n\n},{}]},{},[4])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9jb25zdGFudHMuanMiLCJqcy9kYXRhQ2FjaGUuanMiLCJqcy9kYmhlbHBlci5qcyIsImpzL3Jlc3RhdXJhbnRfaW5mby5qcyIsIm5vZGVfbW9kdWxlcy9pZGIvbGliL2lkYi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FDQUEsSUFBTSxZQUFZO0FBQ2hCLGVBQWE7QUFDWixpQkFBYSxhQUREO0FBRVosYUFBUyxTQUZHO0FBR1osc0JBQWtCLGtCQUhOO0FBSVoseUJBQXFCO0FBSlQ7QUFERyxDQUFsQjs7a0JBU2UsUzs7Ozs7Ozs7Ozs7QUNUZjs7OztBQUNBOzs7Ozs7OztBQUVBLElBQU0sY0FBYyxvQkFBVSxXQUE5Qjs7QUFFQTs7OztJQUdxQixTO0FBRW5CLHNCQUFhO0FBQUE7O0FBQ2IsT0FBSyxNQUFMLEdBQWMsZUFBZDtBQUNBLE9BQUssSUFBTCxHQUFZLEtBQUssV0FBTCxDQUFpQixLQUFLLE1BQXRCLENBQVo7QUFDQSxPQUFLLGdCQUFMLENBQXNCLFlBQVksV0FBbEMsRUFBK0MsSUFBL0M7QUFDQSxPQUFLLGdCQUFMLENBQXNCLFlBQVksT0FBbEMsRUFBMkMsSUFBM0M7QUFDQTs7Ozs4QkFFVyxNLEVBQVE7QUFDbkI7QUFDQSxVQUFPLGNBQUksSUFBSixDQUFTLE1BQVQsRUFBaUIsQ0FBakIsRUFBb0IsVUFBQyxVQUFELEVBQWdCO0FBQzFDLFlBQU8sV0FBVyxVQUFsQjtBQUNDLFVBQUssQ0FBTDtBQUNDLFVBQU0sY0FBYyxXQUFXLGlCQUFYLENBQTZCLFlBQVksV0FBekMsRUFBc0QsRUFBQyxTQUFTLElBQVYsRUFBdEQsQ0FBcEI7QUFDQSxrQkFBWSxXQUFaLENBQXdCLE9BQXhCLEVBQWlDLElBQWpDOztBQUVBLFVBQU0sVUFBVSxXQUFXLGlCQUFYLENBQTZCLFlBQVksT0FBekMsRUFBa0QsRUFBQyxTQUFTLElBQVYsRUFBbEQsQ0FBaEI7QUFD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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImNvbnN0IGNvbnN0YW50cyA9IHtcbiAgQ09MTEVDVElPTlM6IHtcbiAgXHRSRVNUQVVSQU5UUzogJ3Jlc3RhdXJhbnRzJyxcbiAgXHRSRVZJRVdTOiAncmV2aWV3cycsXG4gIFx0VU5TWU5DRURfUkVWSUVXUzogJ3Vuc3luY2VkX3Jldmlld3MnLFxuICBcdElTX0RBVEFfU1lOQ1JPTklaRUQ6ICdpc0RhdGFTeW5jcm9uemVkJyxcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjb25zdGFudHM7XG4iLCJpbXBvcnQgSURCIGZyb20gJ2lkYic7XG5pbXBvcnQgY29uc3RhbnRzIGZyb20gJy4vY29uc3RhbnRzJztcblxuY29uc3QgQ09MTEVDVElPTlMgPSBjb25zdGFudHMuQ09MTEVDVElPTlM7XG5cbi8qXG4qIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxuKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERhdGFDYWNoZSB7XG5cbiAgY29uc3RydWN0b3IoKXtcblx0XHR0aGlzLmRiTmFtZSA9IFwicmVzdGF1cmFudEFwcFwiO1xuXHRcdHRoaXMuX0lEQiA9IHRoaXMuc2V0RGF0YWJhc2UodGhpcy5kYk5hbWUpO1xuXHRcdHRoaXMuc2V0U3luY0FzUGVuZGluZyhDT0xMRUNUSU9OUy5SRVNUQVVSQU5UUywgdHJ1ZSk7XG5cdFx0dGhpcy5zZXRTeW5jQXNQZW5kaW5nKENPTExFQ1RJT05TLlJFVklFV1MsIHRydWUpO1xuXHR9XG5cblx0c2V0RGF0YWJhc2UoZGJOYW1lKSB7XG5cdFx0Ly8gREFNTiBUSElTIExJTkUhISEhISEgaWYgKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuXHRcdHJldHVybiBJREIub3BlbihkYk5hbWUsIDEsICh1cGdyYWRlZERCKSA9PiB7XG5cdFx0XHRzd2l0Y2godXBncmFkZWREQi5vbGRWZXJzaW9uKXtcblx0XHRcdFx0Y2FzZSAwOlxuXHRcdFx0XHRcdGNvbnN0IHJlc3RhdXJhbnRzID0gdXBncmFkZWREQi5jcmVhdGVPYmplY3RTdG9yZShDT0xMRUNUSU9OUy5SRVNUQVVSQU5UUywge2tleVBhdGg6ICdpZCd9KTtcblx0XHRcdFx0XHRyZXN0YXVyYW50cy5jcmVhdGVJbmRleCgnYnktaWQnLCAnaWQnKTtcblxuXHRcdFx0XHRcdGNvbnN0IHJldmlld3MgPSB1cGdyYWRlZERCLmNyZWF0ZU9iamVjdFN0b3JlKENPTExFQ1RJT05TLlJFVklFV1MsIHtrZXlQYXRoOiAnaWQnfSk7XG5cdFx0XHRcdFx0cmV2aWV3cy5jcmVhdGVJbmRleCgnYnktaWQnLCAncmVzdGF1cmFudF9pZCcpO1xuXG5cdFx0XHRcdFx0Y29uc3QgdW5zeW5jZWRSZXZpZXdzID0gdXBncmFkZWREQi5jcmVhdGVPYmplY3RTdG9yZShDT0xMRUNUSU9OUy5VTlNZTkNFRF9SRVZJRVdTLCB7YXV0b0luY3JlbWVudDogdHJ1ZX0pO1xuXHRcdFx0XHRcdHVuc3luY2VkUmV2aWV3cy5jcmVhdGVJbmRleCgnYnktaWQnLCAncmVzdGF1cmFudF9pZCcpO1xuXG5cdFx0XHRcdFx0dXBncmFkZWREQi5jcmVhdGVPYmplY3RTdG9yZShDT0xMRUNUSU9OUy5JU19EQVRBX1NZTkNST05JWkVELCB7IGtleVBhdGg6ICdjb2xsZWN0aW9uJyB9KTtcblx0XHRcdFx0XHRjb25zb2xlLmxvZygnRGF0YWJhc2UgYW5kIEluZGV4IGNyZWF0ZWQnKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBTZXQgbG9jYWwgZGF0YSBzeW5jIGFzIHBhbmRpbmdcblx0ICovXG5cdHNldFN5bmNBc1BlbmRpbmcoY29sbGVjdGlvbiwgc3RhdHVzKSB7XG5cdFx0cmV0dXJuIHRoaXMuX0lEQi50aGVuKGRiID0+IHtcblx0XHRcdGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oQ09MTEVDVElPTlMuSVNfREFUQV9TWU5DUk9OSVpFRCwgJ3JlYWR3cml0ZScpO1xuXHRcdFx0dHgub2JqZWN0U3RvcmUoQ09MTEVDVElPTlMuSVNfREFUQV9TWU5DUk9OSVpFRCkucHV0KHsgY29sbGVjdGlvbiwgc3RhdHVzIH0pO1xuXHRcdH0pO1xuXHR9XG5cblx0Ly8gc3luY0RhdGFUb0FwaShwYXRoLCBkYXRhKSB7XG5cdC8vIFx0ZmV0Y2godGhpcy5EQVRBQkFTRS5SRVNUQVVSQU5UUyArIHBhdGgsIHsgbWV0aG9kOiAnUFVUJyB9KS50aGVuKHJlc3BvbnNlID0+IHtcblx0Ly8gXHRcdGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuXHQvLyBcdFx0XHRyZXNwb25zZS5qc29uKCkudGhlbihkYXRhID0+IHtcblx0Ly8gXHRcdFx0XHQvLyB0aGlzLmNhY2hlSXRlbShkYXRhKTtcblx0Ly8gXHRcdFx0XHQvLyBjb25zb2xlLndhcm4oZGF0YSk7XG5cdC8vIFx0XHRcdH0pO1xuXHQvLyBcdFx0fSBlbHNlIHtcblx0Ly8gXHRcdFx0Y2FsbGJhY2sodGhpcy5oYW5kbGVSZXNwb25zZUVycm9yKHJlc3BvbnNlLCAnYXBpIHJlcXVlc3QnKSwgbnVsbCk7XG5cdC8vIFx0XHR9XG5cdC8vIFx0fSkuY2F0Y2goZXJyb3IgPT4gY2FsbGJhY2soZXJyb3IsIG51bGwpKTtcblx0Ly8gfVxuXG5cblx0Y2FjaGVEYXRhKGNvbGxlY3Rpb24sIGRhdGEgPSBbXSl7XG5cdFx0IC8vIGFkZCBwb3N0IHRoZSBsb2NhbCBEQlxuXHRcdHRoaXMuX0lEQi50aGVuKGRiID0+IHtcblx0XHRcdGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oY29sbGVjdGlvbiwgJ3JlYWR3cml0ZScpO1xuXHRcdFx0Y29uc3QgcmVhZHdyaXRlU3RvcmUgPSB0eC5vYmplY3RTdG9yZShjb2xsZWN0aW9uKTtcblx0XHRcdGRhdGEuZm9yRWFjaCgoaXRlbSkgPT4gcmVhZHdyaXRlU3RvcmUucHV0KGl0ZW0pKTtcblx0XHRcdHR4LmNvbXBsZXRlLnRoZW4oKCkgPT4gY29uc29sZS5sb2coJ3Bvc3QgYWRkZWQgdG8gaW5kZXhlZERCJykpO1xuXHRcdH0pO1xuXHR9XG5cblxuXHRzZXRDYWNoZShjb2xsZWN0aW9uLCBkYXRhKXtcblx0XHRyZXR1cm4gdGhpcy5fSURCLnRoZW4oZGIgPT4ge1xuXHRcdFx0Y29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihjb2xsZWN0aW9uLCAncmVhZHdyaXRlJyk7XG5cdFx0XHR0eC5vYmplY3RTdG9yZShjb2xsZWN0aW9uKS5wdXQoZGF0YSk7XG5cdFx0XHRyZXR1cm4gdHguY29tcGxldGU7XG5cdFx0fSk7XG5cdH1cblxuXG5cdGdldENhY2hlQnlJZChjb2xsZWN0aW9uLCBpZCA9IGZhbHNlKSB7XG5cdFx0cmV0dXJuIHRoaXMuX0lEQi50aGVuKGRiID0+IHtcblx0XHRcdHJldHVybiBkYi50cmFuc2FjdGlvbihjb2xsZWN0aW9uKVxuXHRcdFx0XHQub2JqZWN0U3RvcmUoY29sbGVjdGlvbikuaW5kZXgoJ2J5LWlkJykuZ2V0KHBhcnNlSW50KGlkKSk7XG5cdFx0fSk7XG5cdH1cblxuXG5cdGdldENhY2hlQWxsKGNvbGxlY3Rpb24sIGluZGV4ID0gJ2J5LWlkJykge1xuXHRcdHJldHVybiB0aGlzLl9JREIudGhlbihkYiA9PiB7XG5cdFx0XHRyZXR1cm4gZGIudHJhbnNhY3Rpb24oY29sbGVjdGlvbilcblx0XHRcdFx0Lm9iamVjdFN0b3JlKGNvbGxlY3Rpb24pXG5cdFx0XHRcdC5pbmRleChpbmRleClcblx0XHRcdFx0LmdldEFsbCgpO1xuXHRcdH0pLnRoZW4ocmVzdGF1cmFudHMgPT4gcmVzdGF1cmFudHMpO1xuXHR9XG5cblxuXHRkZWxldGVDYWNoZShjb2xsZWN0aW9uLCBpZCkge1xuXHRcdHJldHVybiB0aGlzLl9JREIudGhlbihkYiA9PiB7XG5cdFx0XHRjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKGNvbGxlY3Rpb24sICdyZWFkd3JpdGUnKTtcblx0XHRcdHR4Lm9iamVjdFN0b3JlKGNvbGxlY3Rpb24pLmRlbGV0ZShpZCk7XG5cdFx0XHRyZXR1cm4gdHguY29tcGxldGU7XG5cdFx0fSk7XG5cdH1cblxuXG5cdGNsZWFyQ2FjaGUoY29sbGVjdGlvbikge1xuXHRcdHJldHVybiB0aGlzLl9JREIudGhlbihkYiA9PiB7XG5cdFx0XHRjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKGNvbGxlY3Rpb24sICdyZWFkd3JpdGUnKTtcblx0XHRcdHR4Lm9iamVjdFN0b3JlKGNvbGxlY3Rpb24pLmNsZWFyKCk7XG5cdFx0XHRyZXR1cm4gdHguY29tcGxldGU7XG5cdFx0fSk7XG5cdH1cblxuXG59XG4iLCJpbXBvcnQgSURCIGZyb20gJ2lkYic7XG5pbXBvcnQgRGF0YUNhY2hlIGZyb20gJy4vZGF0YUNhY2hlJztcbmltcG9ydCBjb25zdGFudHMgZnJvbSAnLi9jb25zdGFudHMnO1xuXG5jb25zdCBDT0xMRUNUSU9OUyA9IGNvbnN0YW50cy5DT0xMRUNUSU9OUztcblxuLypcbiogQ29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXG4qL1xuY2xhc3MgREJIZWxwZXIge1xuXG5cdGNvbnN0cnVjdG9yKCl7XG5cdFx0Y29uc3QgcG9ydCA9IDEzMzc7IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcblx0XHQvLyBEYXRhYmFzZSBVUkwuXG5cdFx0dGhpcy5EQVRBQkFTRSA9IHtcblx0XHRcdFJFU1RBVVJBTlRTOiBgaHR0cDovLzAuMC4wLjA6JHtwb3J0fS9yZXN0YXVyYW50c2AsXG5cdFx0XHRSRVZJRVdTOiBgaHR0cDovLzAuMC4wLjA6JHtwb3J0fS9yZXZpZXdzL2AsXG5cdFx0fVxuXG5cdFx0dGhpcy5pZGJDYWNoZSA9IG5ldyBEYXRhQ2FjaGUoKTtcblx0fVxuXG5cblx0Ly8gRGF0YSBzdG9yYWdlIGludGVyZmFjZXMgXFxcXFxuXG5cdHRvb2dsZUZhdm9yaXRlKGlkLCBjYWxsYmFjaykge1xuXHRcdHRoaXMuaWRiQ2FjaGUuZ2V0Q2FjaGVCeUlkKENPTExFQ1RJT05TLlJFU1RBVVJBTlRTLCBpZCkudGhlbigocmVzcG9uc2UpID0+IHtcblxuXHRcdFx0Y29uc3QgdG9vZ2xlID0gcmVzcG9uc2UuaXNfZmF2b3JpdGUgPT09IFwidHJ1ZVwiID8gXCJmYWxzZVwiIDogXCJ0cnVlXCI7XG5cdFx0XHRyZXNwb25zZS5pc19mYXZvcml0ZSA9IHRvb2dsZTtcblx0XHRcdHJldHVybiB0aGlzLmlkYkNhY2hlLnNldENhY2hlKENPTExFQ1RJT05TLlJFU1RBVVJBTlRTLCByZXNwb25zZSkudGhlbigoKSA9PiB7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcblx0XHRcdFx0aWYoIW5hdmlnYXRvci5vbkxpbmUpIHtcblx0XHRcdFx0XHR0aGlzLmlkYkNhY2hlLnNldFN5bmNBc1BlbmRpbmcoQ09MTEVDVElPTlMuUkVTVEFVUkFOVFMsIGZhbHNlKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zdCBwYXRoID0gYC8ke2lkfS8/aXNfZmF2b3JpdGU9JHt0b29nbGV9YDtcblx0XHRcdFx0XHRyZXR1cm4gZmV0Y2godGhpcy5EQVRBQkFTRS5SRVNUQVVSQU5UUyArIHBhdGgsIHsgbWV0aG9kOiAnUFVUJyB9KS50aGVuKChyZXNwb25zZSkgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB0aGlzLmlkYkNhY2hlLnNldFN5bmNBc1BlbmRpbmcoQ09MTEVDVElPTlMuUkVTVEFVUkFOVFMsIHRydWUpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9KVxuXHRcdC5jYXRjaCgoZXJyb3IpID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSk7XG5cdH1cblxuXG5cdHNhdmVSZXZpZXcoZGF0YSwgY2FsbGJhY2spIHtcblx0XHRpZighbmF2aWdhdG9yLm9uTGluZSkge1xuXHRcdFx0cmV0dXJuIHRoaXMuaWRiQ2FjaGUuc2V0Q2FjaGUoQ09MTEVDVElPTlMuVU5TWU5DRURfUkVWSUVXUywgZGF0YSkudGhlbigoKSA9PiB7XG5cdFx0XHRcdHRoaXMuaWRiQ2FjaGUuc2V0U3luY0FzUGVuZGluZyhDT0xMRUNUSU9OUy5SRVZJRVdTLCBmYWxzZSk7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIGRhdGEpO1xuXHRcdFx0fSkuY2F0Y2goKGVycm9yKSA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHJldHVybiBmZXRjaCh0aGlzLkRBVEFCQVNFLlJFVklFV1MsIHtcblx0XHRcdFx0IG1ldGhvZDogJ1BPU1QnLFxuXHRcdFx0XHQgYm9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSlcblx0XHRcdCB9KVxuXHRcdFx0IC50aGVuKChyZXNwb25zZSkgPT4ge1xuXHRcdFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzIDwgNDAwKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuaWRiQ2FjaGUuc2V0Q2FjaGUoQ09MTEVDVElPTlMuUkVWSUVXUywgZGF0YSkudGhlbigoKSA9PiB7XG5cdFx0XHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdGhpcy5pZGJDYWNoZS5zZXRTeW5jQXNQZW5kaW5nKENPTExFQ1RJT05TLlJFVklFV1MsIHRydWUpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihgRXJyb3IgY29kZSAke3Jlc3BvbnNlLnN0YXR1c31gKTtcblx0XHRcdFx0fVxuXHRcdFx0fSkuY2F0Y2goKGVycm9yKSA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xuXG5cdFx0fVxuXHR9XG5cblxuXHQvKipcblx0ICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxuXHQgKi9cblx0ZmV0Y2hSZXN0YXVyYW50cyhjYWxsYmFjaykge1xuXHRcdHRoaXMuaWRiQ2FjaGUuZ2V0Q2FjaGVBbGwoQ09MTEVDVElPTlMuUkVTVEFVUkFOVFMpLnRoZW4oZGF0YSA9PiB7XG5cdFx0XHRpZihkYXRhLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgZGF0YSk7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdkYXRhIGxvYWRlZCBmcm9tIGxvY2FsIHN0b3JhZ2UhJyk7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdGZldGNoKHRoaXMuREFUQUJBU0UuUkVTVEFVUkFOVFMpLnRoZW4ocmVzcG9uc2UgPT4ge1xuXHRcdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuXHRcdFx0XHRcdFx0cmVzcG9uc2UuanNvbigpLnRoZW4oZGF0YSA9PiB7XG5cdFx0XHRcdFx0XHRcdHRoaXMuaWRiQ2FjaGUuY2FjaGVEYXRhKENPTExFQ1RJT05TLlJFU1RBVVJBTlRTLCBkYXRhKTtcblx0XHRcdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgZGF0YSk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Y2FsbGJhY2sodGhpcy5oYW5kbGVSZXNwb25zZUVycm9yKHJlc3BvbnNlLCAnYXBpIHJlcXVlc3QnKSwgbnVsbCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KS5jYXRjaChlcnJvciA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xuXG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0ICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxuXHQgKi9cblx0ZmV0Y2hSZXZpZXdzKGlkLCBjYWxsYmFjaykge1xuXHRcdC8vIGNoZWNrIHVuc3ljZWQgcmV2aWV3c1xuXHRcdHRoaXMuaWRiQ2FjaGUuZ2V0Q2FjaGVBbGwoQ09MTEVDVElPTlMuVU5TWU5DRURfUkVWSUVXUykudGhlbigodW5zeWNlZFJldmlld3MpID0+IHtcblxuXHRcdFx0aWYoIW5hdmlnYXRvci5vbkxpbmUpe1xuXHRcdFx0XHR0aGlzLmlkYkNhY2hlLmdldENhY2hlQWxsKENPTExFQ1RJT05TLlJFVklFV1MpLnRoZW4oKHJldmlld3MpID0+IHtcblx0XHRcdFx0XHRjb25zdCBjYWNoZWRSZXZpZXdzID0gWy4uLnJldmlld3MsIC4uLnVuc3ljZWRSZXZpZXdzXTtcblx0XHRcdFx0XHRpZihjYWNoZWRSZXZpZXdzICYmIGNhY2hlZFJldmlld3MubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdFx0Y29uc3QgZmlsdGVyZWRSZXZpZXdzID0gY2FjaGVkUmV2aWV3cy5maWx0ZXIoKHJldmlldykgPT4gcmV2aWV3LnJlc3RhdXJhbnRfaWQgPT09IGlkKTtcblx0XHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIGZpbHRlcmVkUmV2aWV3cyk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIFtdKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHQvLyBTeWNlZCByZXZpZXdzIGlmIGFueSB1bnN5Y2VkXG5cdFx0XHRcdGlmKHVuc3ljZWRSZXZpZXdzICYmIHVuc3ljZWRSZXZpZXdzLmxlbmd0aCA+IDApe1xuXHRcdFx0XHRcdHVuc3ljZWRSZXZpZXdzLmZvckVhY2goKHJldmlldykgPT4ge1xuXHRcdFx0XHRcdFx0dGhpcy5zYXZlUmV2aWV3KHJldmlldywgKGVycm9yLCBkYXRhKSA9PiB7XG5cdFx0XHRcdFx0XHRcdGlmKGVycm9yKSBjb25zb2xlLmVycm9yKGVycm9yKTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdHRoaXMuaWRiQ2FjaGUuY2xlYXJDYWNoZShDT0xMRUNUSU9OUy5VTlNZTkNFRF9SRVZJRVdTKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNvbnN0IHJldmlld3NQYXRoID0gYD9yZXN0YXVyYW50X2lkPSR7aWR9YDtcblx0XHRcdFx0ZmV0Y2godGhpcy5EQVRBQkFTRS5SRVZJRVdTICsgcmV2aWV3c1BhdGgpLnRoZW4ocmVzcG9uc2UgPT4ge1xuXHRcdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMgPCA0MDApIHtcblx0XHRcdFx0XHRcdHJlc3BvbnNlLmpzb24oKS50aGVuKGRhdGEgPT4ge1xuXHRcdFx0XHRcdFx0XHR0aGlzLmlkYkNhY2hlLmNhY2hlRGF0YShDT0xMRUNUSU9OUy5SRVZJRVdTLCBkYXRhKTtcblx0XHRcdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgZGF0YSk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Y2FsbGJhY2sodGhpcy5oYW5kbGVSZXNwb25zZUVycm9yKHJlc3BvbnNlLCAnQVBJIHJlcXVlc3QnKSwgbnVsbCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KS5jYXRjaChlcnJvciA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xuXHRcdFx0fVxuXG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0ICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cblx0ICovXG5cdGZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIGNhbGxiYWNrKSB7XG5cdFx0aWYoIW5hdmlnYXRvci5vbkxpbmUpIHtcblx0XHRcdHRoaXMuaWRiQ2FjaGUuZ2V0Q2FjaGVCeUlkKENPTExFQ1RJT05TLlJFU1RBVVJBTlRTLCBpZCkudGhlbigocmVzcG9uc2UpID0+IHtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xuXHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4gY2FsbGJhY2soZXJyb3IsIG51bGwpKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29uc3QgcGF0aCA9IGAvJHtpZH1gO1xuXHRcdFx0ZmV0Y2godGhpcy5EQVRBQkFTRS5SRVNUQVVSQU5UUyArIHBhdGgpLnRoZW4ocmVzcG9uc2UgPT4ge1xuXHRcdFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcblx0XHRcdFx0XHRyZXNwb25zZS5qc29uKCkudGhlbihkYXRhID0+IHtcblx0XHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIGRhdGEpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNhbGxiYWNrKHRoaXMuaGFuZGxlUmVzcG9uc2VFcnJvcihyZXNwb25zZSwgJ2FwaSByZXF1ZXN0JyksIG51bGwpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KS5jYXRjaChlcnJvciA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cblx0ICovXG5cdGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1x0d2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcblx0XHR0aGlzLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuXHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gY3Vpc2luZSB0eXBlXG5cdFx0XHRcdGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblx0LyoqXG5cdCAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuXHQgKi9cblx0ZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuXHRcdHRoaXMuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBuZWlnaGJvcmhvb2Rcblx0XHRcdFx0Y29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cdC8qKlxuXHQgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuXHQgKi9cblx0ZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcblx0XHR0aGlzLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuXHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGxldCByZXN1bHRzID0gcmVzdGF1cmFudHM7XG5cdFx0XHRcdGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXG5cdFx0XHRcdFx0cmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXG5cdFx0XHRcdFx0cmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXHQvKipcblx0ICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG5cdCAqL1xuXHRmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcblx0XHR0aGlzLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuXHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuXHRcdFx0XHRjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpO1xuXHRcdFx0XHQvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcblx0XHRcdFx0Y29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSk7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cbiAgLyoqXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG4gIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICB0aGlzLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSk7XG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZUN1aXNpbmVzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG5cdC8qKlxuXHQgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxuXHQgKi9cblx0dXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG5cdFx0cmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xuXHR9XG5cdC8qKlxuXHQgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cblx0ICovXG5cdGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzaXplKSB7XG5cdFx0bGV0IGltZyA9IHJlc3RhdXJhbnQucGhvdG9ncmFwaDtcblx0XHRyZXR1cm4gaW1nID8gKGAvaW1nLyR7aW1nfS0ke3NpemV9LmpwZ2ApIDogJy9pbWcvcmVzdGF1cmFudF9wbGFjZWhvbGRlci5zdmcnO1xuXHR9XG5cdC8qKlxuXHQgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXG5cdCAqL1xuXHRtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xuXHRcdGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuXHRcdFx0cG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxuXHRcdFx0dGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcblx0XHRcdHVybDogdGhpcy51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxuXHRcdFx0bWFwOiBtYXAsXG5cdFx0XHRhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QfVxuXHRcdCk7XG5cdFx0cmV0dXJuIG1hcmtlcjtcblx0fVxuXG5cdGhhbmRsZVJlc3BvbnNlRXJyb3IocmVzcG9uc2UsIHR5cGUpe1xuXHRcdHN3aXRjaCAocmVzcG9uc2Uuc3RhdHVzKSB7XG5cdFx0XHRjYXNlIDQwMDpcblx0XHRcdFx0cmV0dXJuIG5ldyBFcnJvcignQmVkIHJlcXVlc3QnKTtcblx0XHRcdGNhc2UgNDA0OlxuXHRcdFx0XHRyZXR1cm4gbmV3IEVycm9yKCdOb3QgZm91bmQnKTtcblx0XHRcdGNhc2UgNTAwOlxuXHRcdFx0XHRyZXR1cm4gbmV3IEVycm9yKCdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InKTtcblx0XHR9XG5cdH1cblxufVxuXG5cbmV4cG9ydCBkZWZhdWx0IERCSGVscGVyO1xuIiwiaW1wb3J0IERCSGVscGVyIGZyb20gJy4vZGJoZWxwZXInO1xuXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJlc3RhdXJhbnRJbmZvIHtcblxuXHRjb25zdHJ1Y3RvcigpIHtcblx0XHR0aGlzLm1hcCA9IG51bGw7XG5cdFx0dGhpcy5yZXN0YXVyYW50ID0gbnVsbDtcblx0XHR0aGlzLmRiID0gbmV3IERCSGVscGVyKCk7XG5cblx0XHQvKipcblx0XHQgKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG5cdFx0ICovXG5cblx0XHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIChlKSA9PiB7XG5cdFx0XHRjb25zb2xlLmxvZygnQWxsIHJlc291cmNlcyBmaW5pc2hlZCBsb2FkaW5nIScpO1xuXG5cdFx0XHRjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcblx0XHRcdHNjcmlwdC5zZXRBdHRyaWJ1dGUoJ2FzeW5jJywgdHJ1ZSk7XG5cdFx0XHRzY3JpcHQuc2V0QXR0cmlidXRlKCdkZWZlcicsIHRydWUpO1xuXHRcdFx0c2NyaXB0LnNyYyA9ICdodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvanM/a2V5PUFJemFTeUNBR0k1eFE0UFhVcGk2SE5oTTdmd0lWelN6VFZWSno1RSZsaWJyYXJpZXM9cGxhY2VzJmNhbGxiYWNrPWluaXRNYXAnO1xuXHRcdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmluc2lkZScpLmFwcGVuZENoaWxkKHNjcmlwdCk7XG5cblx0XHRcdHRoaXMuZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcblx0XHRcdFx0aWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhlcnJvcik7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly8gaWYobmF2aWdhdG9yLm9uTGluZSkge1xuXHRcdFx0XHRcdFx0d2luZG93LmluaXRNYXAgPSAoKSA9PiB7XG5cdFx0XHRcdFx0XHRcdHRoaXMubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcblx0XHRcdFx0XHRcdFx0XHR6b29tOiAxNixcblx0XHRcdFx0XHRcdFx0XHRjZW50ZXI6IHJlc3RhdXJhbnQubGF0bG5nLFxuXHRcdFx0XHRcdFx0XHRcdHNjcm9sbHdoZWVsOiBmYWxzZVxuXHRcdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0XHR0aGlzLmRiLm1hcE1hcmtlckZvclJlc3RhdXJhbnQodGhpcy5yZXN0YXVyYW50LCB0aGlzLm1hcCk7XG5cdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdC8vIH1cblxuXHRcdFx0XHRcdHRoaXMuZmlsbEJyZWFkY3J1bWIoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHR9KTtcblxuXG5cdH1cblxuXHQvKipcblx0ICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxuXHQgKi9cblx0ZmV0Y2hSZXN0YXVyYW50RnJvbVVSTChjYWxsYmFjaykge1xuXHRcdGlmICh0aGlzLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXG5cdFx0XHRjYWxsYmFjayhudWxsLCB0aGlzLnJlc3RhdXJhbnQpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRjb25zdCBpZCA9IHRoaXMuZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xuXHRcdGlmICghaWQpIHsgLy8gbm8gaWQgZm91bmQgaW4gVVJMXG5cdFx0XHRjYWxsYmFjaygnTm8gcmVzdGF1cmFudCBpZCBpbiBVUkwnLCBudWxsKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5kYi5mZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCAoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcblx0XHRcdFx0dGhpcy5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcblxuXHRcdFx0XHRpZiAoIXJlc3RhdXJhbnQpIHtcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKGVycm9yKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdFx0dGhpcy5maWxsUmVzdGF1cmFudEhUTUwoKTtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH07XG5cblx0LyoqXG5cdCAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxuXHQgKi9cblx0ZmlsbFJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQgPSB0aGlzLnJlc3RhdXJhbnQpIHtcblx0XHRjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xuXHRcdG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuXG5cdFx0Y29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKTtcblx0XHRhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcblxuXHRcdGNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaW1nJyk7XG5cdFx0aW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcblx0XHRpbWFnZS5zcmMgPSB0aGlzLmRiLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCA2MDApO1xuXHRcdGltYWdlLmFsdCA9IGAke3Jlc3RhdXJhbnQubmFtZX0gLSAke3Jlc3RhdXJhbnQuY3Vpc2luZV90eXBlfSBDdWlzaW5lYDtcblx0XHRpbWFnZS5zcmNzZXQgPSBgJHt0aGlzLmRiLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCAxMjAwKX0gNjAwdywgJHt0aGlzLmRiLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCA2MDApfSA0MDB3YDtcblxuXHRcdGNvbnN0IGN1aXNpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1jdWlzaW5lJyk7XG5cdFx0Y3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcblxuXHRcdC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXG5cdFx0aWYgKHJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XG5cdFx0XHR0aGlzLmZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XG5cdFx0fVxuXHRcdC8vIGZpbGwgcmV2aWV3c1xuXHRcdHRoaXMuZGIuZmV0Y2hSZXZpZXdzKHJlc3RhdXJhbnQuaWQsIChlcnJvciwgcmV2aWV3cykgPT4ge1xuXHRcdFx0aWYoIWVycm9yKSB0aGlzLmZpbGxSZXZpZXdzSFRNTChyZXZpZXdzKTtcblx0XHR9KVxuXG5cdH07XG5cblx0LyoqXG5cdCAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG5cdCAqL1xuXHRmaWxsUmVzdGF1cmFudEhvdXJzSFRNTChvcGVyYXRpbmdIb3VycyA9IHRoaXMucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcblx0XHRjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XG5cdFx0Zm9yIChsZXQga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XG5cdFx0XHRjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXG5cdFx0XHRjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuXHRcdFx0ZGF5LmlubmVySFRNTCA9IGtleTtcblx0XHRcdHJvdy5hcHBlbmRDaGlsZChkYXkpO1xuXG5cdFx0XHRjb25zdCB0aW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcblx0XHRcdHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcblx0XHRcdHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcblxuXHRcdFx0aG91cnMuYXBwZW5kQ2hpbGQocm93KTtcblx0XHR9XG5cdH07XG5cblx0LyoqXG5cdCAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cblx0ICovXG5cdGZpbGxSZXZpZXdzSFRNTChyZXZpZXdzID0gW10pIHtcblx0XHRyZXZpZXdzLnJldmVyc2UoKTtcblx0XHRjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcblx0XHRjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gzJyk7XG5cdFx0dGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xuXHRcdGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aXRsZSk7XG5cblx0XHRpZiAoIXJldmlld3MpIHtcblx0XHRcdGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcblx0XHRcdG5vUmV2aWV3cy5pbm5lckhUTUwgPSAnTm8gcmV2aWV3cyB5ZXQhJztcblx0XHRcdGNvbnRhaW5lci5hcHBlbmRDaGlsZChub1Jldmlld3MpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcblx0XHRyZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcblx0XHRcdHVsLmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpKTtcblx0XHR9KTtcblx0XHRjb250YWluZXIuYXBwZW5kQ2hpbGQodWwpO1xuXHR9O1xuXG5cdC8qKlxuXHQgKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cblx0ICovXG5cdGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSB7XG5cdFx0Y29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXHRcdGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG5cdFx0bmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcblx0XHRsaS5hcHBlbmRDaGlsZChuYW1lKTtcblxuXHRcdGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG5cdFx0ZGF0ZS5pbm5lckhUTUwgPSByZXZpZXcuZGF0ZTtcblx0XHRsaS5hcHBlbmRDaGlsZChkYXRlKTtcblxuXHRcdGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcblx0XHRyYXRpbmcuaW5uZXJIVE1MID0gYFJhdGluZzogJHtyZXZpZXcucmF0aW5nfWA7XG5cdFx0bGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcblxuXHRcdGNvbnN0IGNvbW1lbnRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHRcdGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcblx0XHRsaS5hcHBlbmRDaGlsZChjb21tZW50cyk7XG5cblx0XHRyZXR1cm4gbGk7XG5cdH07XG5cblx0LyoqXG5cdCAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XG5cdCAqL1xuXHRmaWxsQnJlYWRjcnVtYihyZXN0YXVyYW50ID0gdGhpcy5yZXN0YXVyYW50KSB7XG5cdFx0Y29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicmVhZGNydW1iJyk7XG5cdFx0Y29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXHRcdGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcblx0XHRsaS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCByZXN0YXVyYW50Lm5hbWUpO1xuXHRcdGxpLnNldEF0dHJpYnV0ZSgnYXJpYS1jdXJyZW50JywgJ3BhZ2UnKTtcblx0XHRicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcblx0fTtcblxuXHQvKipcblx0ICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cblx0ICovXG5cdGdldFBhcmFtZXRlckJ5TmFtZShuYW1lLCB1cmwpIHtcblx0XHRpZiAoIXVybClcblx0XHRcdHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuXHRcdG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKTtcblx0XHRjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcblx0XHRcdHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG5cdFx0aWYgKCFyZXN1bHRzKVxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0aWYgKCFyZXN1bHRzWzJdKVxuXHRcdFx0cmV0dXJuICcnO1xuXHRcdHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XG5cdH07XG5cblxuXHRzZW5kUmV2aWV3KCkge1xuXHRcdGNvbnN0IGZvcm1EYXRhID0ge1xuXHRcdFx0cmVzdGF1cmFudF9pZDogdGhpcy5yZXN0YXVyYW50LmlkXG5cdFx0fTtcblx0XHRjb25zdCBmb3JtRGF0YUZpZWxkcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZmllbGRcIik7XG5cdFx0Zm9ybURhdGFGaWVsZHMuZm9yRWFjaCgoZmllbGQpID0+IHtcblx0XHRcdGZvcm1EYXRhW2ZpZWxkLm5hbWVdID0gZmllbGQudmFsdWU7XG5cdFx0fSk7XG5cblx0XHR0aGlzLmRiLnNhdmVSZXZpZXcoZm9ybURhdGEsIChlcnJvciwgc3RhdHVzKSA9PiB7XG5cdFx0XHRpZighZXJyb3IpIHtcblx0XHRcdFx0Y29uc3QgY29tbWVudExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcmV2aWV3cy1saXN0Jyk7XG5cdFx0XHRcdGNvbW1lbnRMaXN0LnByZXBlbmQodGhpcy5jcmVhdGVSZXZpZXdIVE1MKGZvcm1EYXRhKSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxufVxuXG53aW5kb3cucmVzdGF1cmFudEluZm8gPSBuZXcgUmVzdGF1cmFudEluZm8oKTtcbiIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiB0b0FycmF5KGFycikge1xuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnIpO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICB9O1xuXG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG4gICAgdmFyIHJlcXVlc3Q7XG4gICAgdmFyIHAgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3QgPSBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3MpO1xuICAgICAgcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KS50aGVuKHJlc29sdmUsIHJlamVjdCk7XG4gICAgfSk7XG5cbiAgICBwLnJlcXVlc3QgPSByZXF1ZXN0O1xuICAgIHJldHVybiBwO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcbiAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UHJvcGVydGllcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcm94eUNsYXNzLnByb3RvdHlwZSwgcHJvcCwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHZhbCkge1xuICAgICAgICAgIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdLmFwcGx5KHRoaXNbdGFyZ2V0UHJvcF0sIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIEluZGV4KGluZGV4KSB7XG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFtcbiAgICAnbmFtZScsXG4gICAgJ2tleVBhdGgnLFxuICAgICdtdWx0aUVudHJ5JyxcbiAgICAndW5pcXVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnZ2V0JyxcbiAgICAnZ2V0S2V5JyxcbiAgICAnZ2V0QWxsJyxcbiAgICAnZ2V0QWxsS2V5cycsXG4gICAgJ2NvdW50J1xuICBdKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnb3BlbkN1cnNvcicsXG4gICAgJ29wZW5LZXlDdXJzb3InXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIEN1cnNvcihjdXJzb3IsIHJlcXVlc3QpIHtcbiAgICB0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XG4gICAgdGhpcy5fcmVxdWVzdCA9IHJlcXVlc3Q7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoQ3Vyc29yLCAnX2N1cnNvcicsIFtcbiAgICAnZGlyZWN0aW9uJyxcbiAgICAna2V5JyxcbiAgICAncHJpbWFyeUtleScsXG4gICAgJ3ZhbHVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEN1cnNvciwgJ19jdXJzb3InLCBJREJDdXJzb3IsIFtcbiAgICAndXBkYXRlJyxcbiAgICAnZGVsZXRlJ1xuICBdKTtcblxuICAvLyBwcm94eSAnbmV4dCcgbWV0aG9kc1xuICBbJ2FkdmFuY2UnLCAnY29udGludWUnLCAnY29udGludWVQcmltYXJ5S2V5J10uZm9yRWFjaChmdW5jdGlvbihtZXRob2ROYW1lKSB7XG4gICAgaWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgIEN1cnNvci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBjdXJzb3IgPSB0aGlzO1xuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgY3Vyc29yLl9jdXJzb3JbbWV0aG9kTmFtZV0uYXBwbHkoY3Vyc29yLl9jdXJzb3IsIGFyZ3MpO1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdChjdXJzb3IuX3JlcXVlc3QpLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIGN1cnNvci5fcmVxdWVzdCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gT2JqZWN0U3RvcmUoc3RvcmUpIHtcbiAgICB0aGlzLl9zdG9yZSA9IHN0b3JlO1xuICB9XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmNyZWF0ZUluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5jcmVhdGVJbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5pbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgW1xuICAgICduYW1lJyxcbiAgICAna2V5UGF0aCcsXG4gICAgJ2luZGV4TmFtZXMnLFxuICAgICdhdXRvSW5jcmVtZW50J1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAncHV0JyxcbiAgICAnYWRkJyxcbiAgICAnZGVsZXRlJyxcbiAgICAnY2xlYXInLFxuICAgICdnZXQnLFxuICAgICdnZXRBbGwnLFxuICAgICdnZXRLZXknLFxuICAgICdnZXRBbGxLZXlzJyxcbiAgICAnY291bnQnXG4gIF0pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdvcGVuQ3Vyc29yJyxcbiAgICAnb3BlbktleUN1cnNvcidcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAnZGVsZXRlSW5kZXgnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fdHggPSBpZGJUcmFuc2FjdGlvbjtcbiAgICB0aGlzLmNvbXBsZXRlID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIFRyYW5zYWN0aW9uLnByb3RvdHlwZS5vYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fdHgub2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fdHgsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhUcmFuc2FjdGlvbiwgJ190eCcsIFtcbiAgICAnb2JqZWN0U3RvcmVOYW1lcycsXG4gICAgJ21vZGUnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbXG4gICAgJ2Fib3J0J1xuICBdKTtcblxuICBmdW5jdGlvbiBVcGdyYWRlREIoZGIsIG9sZFZlcnNpb24sIHRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgICB0aGlzLm9sZFZlcnNpb24gPSBvbGRWZXJzaW9uO1xuICAgIHRoaXMudHJhbnNhY3Rpb24gPSBuZXcgVHJhbnNhY3Rpb24odHJhbnNhY3Rpb24pO1xuICB9XG5cbiAgVXBncmFkZURCLnByb3RvdHlwZS5jcmVhdGVPYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fZGIuY3JlYXRlT2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhVcGdyYWRlREIsICdfZGInLCBbXG4gICAgJ25hbWUnLFxuICAgICd2ZXJzaW9uJyxcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKFVwZ3JhZGVEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG4gICAgJ2RlbGV0ZU9iamVjdFN0b3JlJyxcbiAgICAnY2xvc2UnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIERCKGRiKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgfVxuXG4gIERCLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb24odGhpcy5fZGIudHJhbnNhY3Rpb24uYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhEQiwgJ19kYicsIFtcbiAgICAnbmFtZScsXG4gICAgJ3ZlcnNpb24nLFxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuICAgICdjbG9zZSdcbiAgXSk7XG5cbiAgLy8gQWRkIGN1cnNvciBpdGVyYXRvcnNcbiAgLy8gVE9ETzogcmVtb3ZlIHRoaXMgb25jZSBicm93c2VycyBkbyB0aGUgcmlnaHQgdGhpbmcgd2l0aCBwcm9taXNlc1xuICBbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddLmZvckVhY2goZnVuY3Rpb24oZnVuY05hbWUpIHtcbiAgICBbT2JqZWN0U3RvcmUsIEluZGV4XS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG4gICAgICAvLyBEb24ndCBjcmVhdGUgaXRlcmF0ZUtleUN1cnNvciBpZiBvcGVuS2V5Q3Vyc29yIGRvZXNuJ3QgZXhpc3QuXG4gICAgICBpZiAoIShmdW5jTmFtZSBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG5cbiAgICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZVtmdW5jTmFtZS5yZXBsYWNlKCdvcGVuJywgJ2l0ZXJhdGUnKV0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyk7XG4gICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTtcbiAgICAgICAgdmFyIG5hdGl2ZU9iamVjdCA9IHRoaXMuX3N0b3JlIHx8IHRoaXMuX2luZGV4O1xuICAgICAgICB2YXIgcmVxdWVzdCA9IG5hdGl2ZU9iamVjdFtmdW5jTmFtZV0uYXBwbHkobmF0aXZlT2JqZWN0LCBhcmdzLnNsaWNlKDAsIC0xKSk7XG4gICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgY2FsbGJhY2socmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gcG9seWZpbGwgZ2V0QWxsXG4gIFtJbmRleCwgT2JqZWN0U3RvcmVdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcbiAgICBpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xuICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwgPSBmdW5jdGlvbihxdWVyeSwgY291bnQpIHtcbiAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG4gICAgICB2YXIgaXRlbXMgPSBbXTtcblxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgaW5zdGFuY2UuaXRlcmF0ZUN1cnNvcihxdWVyeSwgZnVuY3Rpb24oY3Vyc29yKSB7XG4gICAgICAgICAgaWYgKCFjdXJzb3IpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XG5cbiAgICAgICAgICBpZiAoY291bnQgIT09IHVuZGVmaW5lZCAmJiBpdGVtcy5sZW5ndGggPT0gY291bnQpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICB2YXIgZXhwID0ge1xuICAgIG9wZW46IGZ1bmN0aW9uKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdvcGVuJywgW25hbWUsIHZlcnNpb25dKTtcbiAgICAgIHZhciByZXF1ZXN0ID0gcC5yZXF1ZXN0O1xuXG4gICAgICBpZiAocmVxdWVzdCkge1xuICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgaWYgKHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgICAgICAgdXBncmFkZUNhbGxiYWNrKG5ldyBVcGdyYWRlREIocmVxdWVzdC5yZXN1bHQsIGV2ZW50Lm9sZFZlcnNpb24sIHJlcXVlc3QudHJhbnNhY3Rpb24pKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24oZGIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEQihkYik7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGRlbGV0ZTogZnVuY3Rpb24obmFtZSkge1xuICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ2RlbGV0ZURhdGFiYXNlJywgW25hbWVdKTtcbiAgICB9XG4gIH07XG5cbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBleHA7XG4gICAgbW9kdWxlLmV4cG9ydHMuZGVmYXVsdCA9IG1vZHVsZS5leHBvcnRzO1xuICB9XG4gIGVsc2Uge1xuICAgIHNlbGYuaWRiID0gZXhwO1xuICB9XG59KCkpO1xuIl19\n"]}