{"version":3,"sources":["restaurant_info.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Object","defineProperty","value","default","COLLECTIONS","RESTAURANTS","REVIEWS","UNSYNCED_REVIEWS","IS_DATA_SYNCRONIZED","2","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_idb2","_interopRequireDefault","obj","__esModule","DataCache","instance","TypeError","_classCallCheck","this","dbName","_IDB","setDatabase","setSyncAsPending","open","upgradedDB","oldVersion","createObjectStore","keyPath","createIndex","autoIncrement","console","log","collection","status","then","db","transaction","objectStore","put","data","arguments","undefined","tx","readwriteStore","forEach","item","complete","id","index","get","parseInt","getAll","restaurants","delete","clear","./constants","idb","3","_util2","RestaurantInfo","map","restaurant","dataWorker","Worker","fetchRestaurantFromURL","_ref","_this","action","input","postMessage","onmessage","event","result","error","requestAnimationFrame","initMap","fillRestaurantHTML","fillBreadcrumb","fillReviewsHTML","document","querySelector","prepend","createReviewHTML","callback","getParameterByName","getElementById","innerHTML","name","address","image","className","src","imageUrlForRestaurant","alt","cuisine_type","srcset","operating_hours","fillRestaurantHoursHTML","operatingHours","hours","row","createElement","day","appendChild","time","_this2","reviews","reverse","container","title","noReviews","ul","review","li","date","createdAt","Date","toDateString","rating","comments","breadcrumb","setAttribute","url","window","location","href","replace","results","RegExp","exec","decodeURIComponent","formData","restaurant_id","isDataValid","querySelectorAll","field","_this3","google","maps","Map","zoom","center","latlng","scrollwheel","addMarkersToMap","script","Marker","position","animation","Animation","DROP","restaurantInfo","./storage","./util","4","_dataCache2","_toConsumableArray","arr","Array","isArray","arr2","from","Storage","DATABASE","reloadInterval","reloadTimer","now","idbCache","syncDataToApi","navigator","onLine","fetch","response","json","cacheData","handleResponseError","catch","getCacheAll","unsycedReviews","reviewsPath","cachedReviews","concat","filteredReviews","filter","path","getCacheById","cuisine","fetchRestaurants","neighborhood","neighborhoods","v","uniqueNeighborhoods","indexOf","cuisines","uniqueCuisines","_this4","toogle","is_favorite","setCache","method","_this5","body","JSON","stringify","responseData","_this6","setInterval","saveReview","clearCache","type","./dataCache","5","Util","el","message","color","style","background","setTimeout","removeAttribute","imgs","IntersectionObserver","observer","entries","obsr","entry","intersectionRatio","unobserve","preloadImage","rootMargin","threshold","observe","img","nodeName","getAttribute","size","photograph","6","promisifyRequest","request","Promise","resolve","reject","onsuccess","onerror","promisifyRequestCall","args","apply","proxyProperties","ProxyClass","targetProp","properties","prop","set","val","proxyRequestMethods","proxyMethods","proxyCursorRequestMethods","Cursor","Index","_index","cursor","_cursor","_request","ObjectStore","store","_store","Transaction","idbTransaction","_tx","oncomplete","onabort","UpgradeDB","_db","DB","IDBIndex","IDBCursor","methodName","IDBObjectStore","IDBTransaction","IDBDatabase","funcName","slice","nativeObject","query","count","items","iterateCursor","push","continue","exp","version","upgradeCallback","indexedDB","onupgradeneeded","self"],"mappings":"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","file":"restaurant_info.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar constants = {\n  COLLECTIONS: {\n    RESTAURANTS: 'restaurants',\n    REVIEWS: 'reviews',\n    UNSYNCED_REVIEWS: 'unsynced_reviews',\n    IS_DATA_SYNCRONIZED: 'isDataSyncronzed'\n  }\n};\n\nexports.default = constants;\n\n},{}],2:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _idb = require('idb');\n\nvar _idb2 = _interopRequireDefault(_idb);\n\nvar _constants = require('./constants');\n\nvar _constants2 = _interopRequireDefault(_constants);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar COLLECTIONS = _constants2.default.COLLECTIONS;\n\n/*\n* Common database helper functions.\n*/\n\nvar DataCache = function () {\n\tfunction DataCache() {\n\t\t_classCallCheck(this, DataCache);\n\n\t\tthis.dbName = \"restaurantApp\";\n\t\tthis._IDB = this.setDatabase(this.dbName);\n\t\tthis.setSyncAsPending(COLLECTIONS.RESTAURANTS, true);\n\t\tthis.setSyncAsPending(COLLECTIONS.REVIEWS, true);\n\t}\n\n\t_createClass(DataCache, [{\n\t\tkey: 'setDatabase',\n\t\tvalue: function setDatabase(dbName) {\n\t\t\treturn _idb2.default.open(dbName, 1, function (upgradedDB) {\n\t\t\t\tswitch (upgradedDB.oldVersion) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\tvar restaurants = upgradedDB.createObjectStore(COLLECTIONS.RESTAURANTS, { keyPath: 'id' });\n\t\t\t\t\t\trestaurants.createIndex('by-id', 'id');\n\n\t\t\t\t\t\tvar reviews = upgradedDB.createObjectStore(COLLECTIONS.REVIEWS, { keyPath: 'id' });\n\t\t\t\t\t\treviews.createIndex('by-id', 'restaurant_id');\n\n\t\t\t\t\t\tvar unsyncedReviews = upgradedDB.createObjectStore(COLLECTIONS.UNSYNCED_REVIEWS, { autoIncrement: true });\n\t\t\t\t\t\tunsyncedReviews.createIndex('by-id', 'restaurant_id');\n\n\t\t\t\t\t\tupgradedDB.createObjectStore(COLLECTIONS.IS_DATA_SYNCRONIZED, { keyPath: 'collection' });\n\t\t\t\t\t\tconsole.log('Database and Index created');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Set local data sync as panding\n   */\n\n\t}, {\n\t\tkey: 'setSyncAsPending',\n\t\tvalue: function setSyncAsPending(collection, status) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(COLLECTIONS.IS_DATA_SYNCRONIZED, 'readwrite');\n\t\t\t\ttx.objectStore(COLLECTIONS.IS_DATA_SYNCRONIZED).put({ collection: collection, status: status });\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'cacheData',\n\t\tvalue: function cacheData(collection) {\n\t\t\tvar data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n\t\t\t// add post the local DB\n\t\t\tthis._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\tvar readwriteStore = tx.objectStore(collection);\n\t\t\t\tdata.forEach(function (item) {\n\t\t\t\t\treturn readwriteStore.put(item);\n\t\t\t\t});\n\t\t\t\treturn tx.complete;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'setCache',\n\t\tvalue: function setCache(collection, data) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\ttx.objectStore(collection).put(data);\n\t\t\t\treturn tx.complete;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'getCacheById',\n\t\tvalue: function getCacheById(collection) {\n\t\t\tvar id = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\treturn db.transaction(collection).objectStore(collection).index('by-id').get(parseInt(id));\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'getCacheAll',\n\t\tvalue: function getCacheAll(collection) {\n\t\t\tvar index = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'by-id';\n\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\treturn db.transaction(collection).objectStore(collection).index(index).getAll();\n\t\t\t}).then(function (restaurants) {\n\t\t\t\treturn restaurants;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'deleteCache',\n\t\tvalue: function deleteCache(collection, id) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\ttx.objectStore(collection).delete(id);\n\t\t\t\treturn tx.complete;\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'clearCache',\n\t\tvalue: function clearCache(collection) {\n\t\t\treturn this._IDB.then(function (db) {\n\t\t\t\tvar tx = db.transaction(collection, 'readwrite');\n\t\t\t\ttx.objectStore(collection).clear();\n\t\t\t\treturn tx.complete;\n\t\t\t});\n\t\t}\n\t}]);\n\n\treturn DataCache;\n}();\n\nexports.default = DataCache;\n\n},{\"./constants\":1,\"idb\":6}],3:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _storage = require('./storage');\n\nvar _storage2 = _interopRequireDefault(_storage);\n\nvar _util = require('./util');\n\nvar _util2 = _interopRequireDefault(_util);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar RestaurantInfo = function () {\n\tfunction RestaurantInfo() {\n\t\t_classCallCheck(this, RestaurantInfo);\n\n\t\tthis.map = null;\n\t\tthis.restaurant = null;\n\t\t// this.db = new Storage();\n\n\t\tthis.dataWorker = new Worker('./js/dataWorker.js');\n\t\tthis.fetchRestaurantFromURL();\n\t}\n\n\t_createClass(RestaurantInfo, [{\n\t\tkey: 'postMessage',\n\t\tvalue: function postMessage(_ref) {\n\t\t\tvar _this = this;\n\n\t\t\tvar action = _ref.action,\n\t\t\t    input = _ref.input;\n\n\t\t\tthis.dataWorker.postMessage({ action: action, input: input });\n\t\t\tthis.dataWorker.onmessage = function (event) {\n\n\t\t\t\tif (!event.data) throw new Error('There is no data: ' + event);\n\n\t\t\t\tif (event.data.action === 'fetchRestaurantById') {\n\t\t\t\t\t_this.restaurant = event.data.result;\n\t\t\t\t\tif (!_this.restaurant) {\n\t\t\t\t\t\tconsole.error('There is no data');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\trequestAnimationFrame(function () {\n\t\t\t\t\t\treturn _this.initMap(_this.restaurant);\n\t\t\t\t\t});\n\t\t\t\t\trequestAnimationFrame(function () {\n\t\t\t\t\t\treturn _this.fillRestaurantHTML(_this.restaurant);\n\t\t\t\t\t});\n\t\t\t\t\trequestAnimationFrame(function () {\n\t\t\t\t\t\treturn _this.fillBreadcrumb(_this.restaurant);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (event.data.action === 'fetchReviews') {\n\t\t\t\t\trequestAnimationFrame(function () {\n\t\t\t\t\t\treturn _this.fillReviewsHTML(event.data.result);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (event.data.action === 'saveReview') {\n\t\t\t\t\tvar commentList = document.querySelector('#reviews-list');\n\t\t\t\t\tcommentList.prepend(_this.createReviewHTML(event.data.result));\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\t/**\n   * Get current restaurant from page URL.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantFromURL',\n\t\tvalue: function fetchRestaurantFromURL(callback) {\n\t\t\tif (this.restaurant) {\n\t\t\t\t// restaurant already fetched!\n\t\t\t\tcallback(null, this.restaurant);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar id = this.getParameterByName('id');\n\t\t\tif (!id) {\n\t\t\t\t// no id found in URL\n\t\t\t\tcallback('No restaurant id in URL', null);\n\t\t\t} else {\n\t\t\t\tthis.postMessage({\n\t\t\t\t\taction: 'fetchRestaurantById',\n\t\t\t\t\tinput: { id: parseInt(id) }\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'fillRestaurantHTML',\n\n\n\t\t/**\n   * Create restaurant HTML and add it to the webpage\n   */\n\t\tvalue: function fillRestaurantHTML() {\n\t\t\tvar restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.restaurant;\n\n\t\t\tvar name = document.getElementById('restaurant-name');\n\t\t\tname.innerHTML = restaurant.name;\n\n\t\t\tvar address = document.getElementById('restaurant-address');\n\t\t\taddress.innerHTML = restaurant.address;\n\n\t\t\tvar image = document.getElementById('restaurant-img');\n\t\t\timage.className = 'restaurant-img';\n\t\t\timage.src = _util2.default.imageUrlForRestaurant(restaurant, 600);\n\t\t\timage.alt = restaurant.name + ' - ' + restaurant.cuisine_type + ' Cuisine';\n\t\t\timage.srcset = _util2.default.imageUrlForRestaurant(restaurant, 1200) + ' 600w, ' + _util2.default.imageUrlForRestaurant(restaurant, 600) + ' 400w';\n\n\t\t\tvar cuisine = document.getElementById('restaurant-cuisine');\n\t\t\tcuisine.innerHTML = restaurant.cuisine_type;\n\n\t\t\t// fill operating hours\n\t\t\tif (restaurant.operating_hours) {\n\t\t\t\tthis.fillRestaurantHoursHTML();\n\t\t\t}\n\n\t\t\tthis.postMessage({\n\t\t\t\taction: 'fetchReviews',\n\t\t\t\tinput: { id: parseInt(restaurant.id) }\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'fillRestaurantHoursHTML',\n\n\n\t\t/**\n   * Create restaurant operating hours HTML table and add it to the webpage.\n   */\n\t\tvalue: function fillRestaurantHoursHTML() {\n\t\t\tvar operatingHours = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.restaurant.operating_hours;\n\n\t\t\tvar hours = document.getElementById('restaurant-hours');\n\t\t\tfor (var key in operatingHours) {\n\t\t\t\tvar row = document.createElement('tr');\n\n\t\t\t\tvar day = document.createElement('td');\n\t\t\t\tday.innerHTML = key;\n\t\t\t\trow.appendChild(day);\n\n\t\t\t\tvar time = document.createElement('td');\n\t\t\t\ttime.innerHTML = operatingHours[key];\n\t\t\t\trow.appendChild(time);\n\n\t\t\t\thours.appendChild(row);\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'fillReviewsHTML',\n\n\n\t\t/**\n   * Create all reviews HTML and add them to the webpage.\n   */\n\t\tvalue: function fillReviewsHTML() {\n\t\t\tvar _this2 = this;\n\n\t\t\tvar reviews = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n\t\t\treviews.reverse();\n\t\t\tvar container = document.getElementById('reviews-container');\n\t\t\tvar title = document.createElement('h3');\n\t\t\ttitle.innerHTML = 'Reviews';\n\t\t\tcontainer.appendChild(title);\n\n\t\t\tif (!reviews) {\n\t\t\t\tvar noReviews = document.createElement('p');\n\t\t\t\tnoReviews.innerHTML = 'No reviews yet!';\n\t\t\t\tcontainer.appendChild(noReviews);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar ul = document.getElementById('reviews-list');\n\t\t\treviews.forEach(function (review) {\n\t\t\t\tul.appendChild(_this2.createReviewHTML(review));\n\t\t\t});\n\t\t\tcontainer.appendChild(ul);\n\t\t}\n\t}, {\n\t\tkey: 'createReviewHTML',\n\n\n\t\t/**\n   * Create review HTML and add it to the webpage.\n   */\n\t\tvalue: function createReviewHTML(review) {\n\t\t\tvar li = document.createElement('li');\n\t\t\tvar name = document.createElement('p');\n\t\t\tname.innerHTML = review.name;\n\t\t\tli.appendChild(name);\n\n\t\t\tvar date = document.createElement('p');\n\t\t\tvar createdAt = new Date(review.createdAt);\n\t\t\tdate.innerHTML = createdAt.toDateString();\n\t\t\tli.appendChild(date);\n\n\t\t\tvar rating = document.createElement('p');\n\t\t\trating.innerHTML = 'Rating: ' + review.rating;\n\t\t\tli.appendChild(rating);\n\n\t\t\tvar comments = document.createElement('p');\n\t\t\tcomments.innerHTML = review.comments;\n\t\t\tli.appendChild(comments);\n\n\t\t\treturn li;\n\t\t}\n\t}, {\n\t\tkey: 'fillBreadcrumb',\n\n\n\t\t/**\n   * Add restaurant name to the breadcrumb navigation menu\n   */\n\t\tvalue: function fillBreadcrumb(restaurant) {\n\t\t\tvar breadcrumb = document.getElementById('breadcrumb');\n\t\t\tvar li = document.createElement('li');\n\t\t\tli.innerHTML = restaurant.name;\n\t\t\tli.setAttribute('aria-label', restaurant.name);\n\t\t\tli.setAttribute('aria-current', 'page');\n\t\t\tbreadcrumb.appendChild(li);\n\t\t}\n\t}, {\n\t\tkey: 'getParameterByName',\n\n\n\t\t/**\n   * Get a parameter by name from page URL.\n   */\n\t\tvalue: function getParameterByName(name, url) {\n\t\t\tif (!url) url = window.location.href;\n\t\t\tname = name.replace(/[\\[\\]]/g, '\\\\$&');\n\t\t\tvar regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),\n\t\t\t    results = regex.exec(url);\n\t\t\tif (!results) return null;\n\t\t\tif (!results[2]) return '';\n\t\t\treturn decodeURIComponent(results[2].replace(/\\+/g, ' '));\n\t\t}\n\t}, {\n\t\tkey: 'sendReview',\n\t\tvalue: function sendReview() {\n\t\t\tvar formData = {\n\t\t\t\trestaurant_id: parseInt(this.restaurant.id)\n\t\t\t};\n\t\t\tvar isDataValid = true;\n\t\t\tvar formDataFields = document.querySelectorAll(\".field\");\n\t\t\tformDataFields.forEach(function (field) {\n\t\t\t\t// TODO: You gotta sanitize this data man!\n\t\t\t\tif (field.value === '' || field.value === undefined || field.value === null || !field.value) isDataValid = false;\n\t\t\t\tformData[field.name] = field.value;\n\t\t\t});\n\n\t\t\tif (!isDataValid) return;\n\t\t\tthis.postMessage({\n\t\t\t\taction: 'saveReview',\n\t\t\t\tinput: { data: formData }\n\t\t\t});\n\t\t}\n\n\t\t/**\n  * Initialize Google map, called from HTML.\n  */\n\n\t}, {\n\t\tkey: 'initMap',\n\t\tvalue: function initMap(restaurant) {\n\t\t\tvar _this3 = this;\n\n\t\t\twindow.initMap = function () {\n\t\t\t\t_this3.map = new google.maps.Map(document.getElementById('map'), {\n\t\t\t\t\tzoom: 16,\n\t\t\t\t\tcenter: restaurant.latlng,\n\t\t\t\t\tscrollwheel: false\n\t\t\t\t});\n\t\t\t\t_this3.addMarkersToMap(restaurant);\n\t\t\t};\n\n\t\t\tvar script = document.createElement('script');\n\t\t\tscript.setAttribute('async', true);\n\t\t\tscript.setAttribute('defer', true);\n\t\t\tscript.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyCAGI5xQ4PXUpi6HNhM7fwIVzSzTVVJz5E&libraries=places&callback=initMap';\n\t\t\tdocument.getElementById('app-inside').appendChild(script);\n\t\t}\n\n\t\t/**\n   * Add markers for current restaurants to the map.\n   */\n\n\t}, {\n\t\tkey: 'addMarkersToMap',\n\t\tvalue: function addMarkersToMap(restaurant) {\n\t\t\tif (!google) return;\n\t\t\tvar marker = new google.maps.Marker({\n\t\t\t\tposition: restaurant.latlng,\n\t\t\t\ttitle: restaurant.name,\n\t\t\t\turl: './restaurant.html?id=' + restaurant.id,\n\t\t\t\tmap: this.map,\n\t\t\t\tanimation: google.maps.Animation.DROP });\n\t\t}\n\t}]);\n\n\treturn RestaurantInfo;\n}();\n\nexports.default = RestaurantInfo;\n\n\nwindow.restaurantInfo = new RestaurantInfo();\n\n},{\"./storage\":4,\"./util\":5}],4:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _idb = require('idb');\n\nvar _idb2 = _interopRequireDefault(_idb);\n\nvar _dataCache = require('./dataCache');\n\nvar _dataCache2 = _interopRequireDefault(_dataCache);\n\nvar _constants = require('./constants');\n\nvar _constants2 = _interopRequireDefault(_constants);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar COLLECTIONS = _constants2.default.COLLECTIONS;\n\n/*\n* Common database helper functions.\n*/\n\nvar Storage = function () {\n\tfunction Storage() {\n\t\t_classCallCheck(this, Storage);\n\n\t\tvar port = 1337; // Change this to your server port\n\t\t// Database URL.\n\t\tthis.DATABASE = {\n\t\t\tRESTAURANTS: 'http://0.0.0.0:' + port + '/restaurants',\n\t\t\tREVIEWS: 'http://0.0.0.0:' + port + '/reviews/'\n\t\t};\n\n\t\tthis.reloadInterval = 0;\n\t\tthis.reloadTimer = Date.now();\n\t\tthis.restaurants = [];\n\t\tthis.idbCache = new _dataCache2.default();\n\t\tthis.syncDataToApi();\n\t}\n\n\t/**\n  * Fetch all restaurants.\n  */\n\n\n\t_createClass(Storage, [{\n\t\tkey: 'fetchRestaurants',\n\t\tvalue: function fetchRestaurants(callback) {\n\t\t\tvar _this = this;\n\n\t\t\t// Allow reload local data every 5 minutes\n\t\t\tvar isTimeToReload = Date.now() - this.reloadTimer > this.reloadInterval ? true : false;\n\n\t\t\tif (isTimeToReload && navigator.onLine) {\n\t\t\t\tfetch(this.DATABASE.RESTAURANTS).then(function (response) {\n\t\t\t\t\tif (response.status === 200) {\n\t\t\t\t\t\tresponse.json().then(function (data) {\n\t\t\t\t\t\t\t_this.restaurants = data;\n\t\t\t\t\t\t\t_this.reloadInterval = 300;\n\t\t\t\t\t\t\t_this.idbCache.cacheData(COLLECTIONS.RESTAURANTS, data);\n\t\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback(_this.handleResponseError(response, 'api request'), null);\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.restaurants.length > 0) {\n\t\t\t\tcallback(null, this.restaurants);\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthis.idbCache.getCacheAll(COLLECTIONS.RESTAURANTS).then(function (data) {\n\t\t\t\t\tif (data.length > 0) {\n\t\t\t\t\t\t_this.restaurants = data;\n\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Fetch all restaurants.\n   */\n\n\t}, {\n\t\tkey: 'fetchReviews',\n\t\tvalue: function fetchReviews(id, callback) {\n\t\t\tvar _this2 = this;\n\n\t\t\t// check unsyced reviews\n\t\t\tthis.idbCache.getCacheAll(COLLECTIONS.UNSYNCED_REVIEWS).then(function (unsycedReviews) {\n\n\t\t\t\tif (!navigator.onLine) {\n\t\t\t\t\t_this2.idbCache.getCacheAll(COLLECTIONS.REVIEWS).then(function (reviews) {\n\t\t\t\t\t\tvar cachedReviews = [].concat(_toConsumableArray(reviews), _toConsumableArray(unsycedReviews));\n\t\t\t\t\t\tif (cachedReviews && cachedReviews.length > 0) {\n\t\t\t\t\t\t\tvar filteredReviews = cachedReviews.filter(function (review) {\n\t\t\t\t\t\t\t\treturn review.restaurant_id === id;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tcallback(null, filteredReviews);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcallback(null, []);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\n\t\t\t\t\t// Syced reviews if any unsyced\n\t\t\t\t\t// if(unsycedReviews && unsycedReviews.length > 0){\n\t\t\t\t\t// \tunsycedReviews.forEach((review) => {\n\t\t\t\t\t// \t\tthis.saveReview(review, (error, data) => {\n\t\t\t\t\t// \t\t\tif(error) console.error(error);\n\t\t\t\t\t// \t\t});\n\t\t\t\t\t// \t});\n\t\t\t\t\t// \tthis.idbCache.clearCache(COLLECTIONS.UNSYNCED_REVIEWS);\n\t\t\t\t\t// }\n\n\t\t\t\t\tvar reviewsPath = '?restaurant_id=' + id;\n\t\t\t\t\tfetch(_this2.DATABASE.REVIEWS + reviewsPath).then(function (response) {\n\t\t\t\t\t\tif (response.status < 400) {\n\t\t\t\t\t\t\tresponse.json().then(function (data) {\n\t\t\t\t\t\t\t\t_this2.idbCache.cacheData(COLLECTIONS.REVIEWS, data);\n\t\t\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcallback(_this2.handleResponseError(response, 'API request'), null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch(function (error) {\n\t\t\t\t\t\treturn callback(error, null);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Fetch a restaurant by its ID.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantById',\n\t\tvalue: function fetchRestaurantById(id, callback) {\n\t\t\tvar _this3 = this;\n\n\t\t\tif (!navigator.onLine) {\n\t\t\t\tthis.idbCache.getCacheById(COLLECTIONS.RESTAURANTS, id).then(function (response) {\n\t\t\t\t\tcallback(null, response);\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tvar path = '/' + id;\n\t\t\t\tfetch(this.DATABASE.RESTAURANTS + path).then(function (response) {\n\t\t\t\t\tif (response.status === 200) {\n\t\t\t\t\t\tresponse.json().then(function (data) {\n\t\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback(_this3.handleResponseError(response, 'api request'), null);\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Fetch restaurants by a cuisine type with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantByCuisine',\n\t\tvalue: function fetchRestaurantByCuisine(cuisine, callback) {\n\t\t\t// Fetch all restaurants\twith proper error handling\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Filter restaurants to have only given cuisine type\n\t\t\t\t\tvar results = restaurants.filter(function (r) {\n\t\t\t\t\t\treturn r.cuisine_type == cuisine;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, results);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t/**\n   * Fetch restaurants by a neighborhood with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantByNeighborhood',\n\t\tvalue: function fetchRestaurantByNeighborhood(neighborhood, callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Filter restaurants to have only given neighborhood\n\t\t\t\t\tvar results = restaurants.filter(function (r) {\n\t\t\t\t\t\treturn r.neighborhood == neighborhood;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, results);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t/**\n   * Fetch restaurants by a cuisine and a neighborhood with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchRestaurantByCuisineAndNeighborhood',\n\t\tvalue: function fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\tvar results = restaurants;\n\t\t\t\t\tif (cuisine != 'all') {\n\t\t\t\t\t\t// filter by cuisine\n\t\t\t\t\t\tresults = results.filter(function (r) {\n\t\t\t\t\t\t\treturn r.cuisine_type == cuisine;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (neighborhood != 'all') {\n\t\t\t\t\t\t// filter by neighborhood\n\t\t\t\t\t\tresults = results.filter(function (r) {\n\t\t\t\t\t\t\treturn r.neighborhood == neighborhood;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tcallback(null, results);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t/**\n   * Fetch all neighborhoods with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchNeighborhoods',\n\t\tvalue: function fetchNeighborhoods(callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Get all neighborhoods from all restaurants\n\t\t\t\t\tvar neighborhoods = restaurants.map(function (v, i) {\n\t\t\t\t\t\treturn restaurants[i].neighborhood;\n\t\t\t\t\t});\n\t\t\t\t\t// Remove duplicates from neighborhoods\n\t\t\t\t\tvar uniqueNeighborhoods = neighborhoods.filter(function (v, i) {\n\t\t\t\t\t\treturn neighborhoods.indexOf(v) == i;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, uniqueNeighborhoods);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Fetch all cuisines with proper error handling.\n   */\n\n\t}, {\n\t\tkey: 'fetchCuisines',\n\t\tvalue: function fetchCuisines(callback) {\n\t\t\t// Fetch all restaurants\n\t\t\tthis.fetchRestaurants(function (error, restaurants) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcallback(error, null);\n\t\t\t\t} else {\n\t\t\t\t\t// Get all cuisines from all restaurants\n\t\t\t\t\tvar cuisines = restaurants.map(function (v, i) {\n\t\t\t\t\t\treturn restaurants[i].cuisine_type;\n\t\t\t\t\t});\n\t\t\t\t\t// Remove duplicates from cuisines\n\t\t\t\t\tvar uniqueCuisines = cuisines.filter(function (v, i) {\n\t\t\t\t\t\treturn cuisines.indexOf(v) == i;\n\t\t\t\t\t});\n\t\t\t\t\tcallback(null, uniqueCuisines);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'toggleFavorite',\n\t\tvalue: function toggleFavorite(id, callback) {\n\t\t\tvar _this4 = this;\n\n\t\t\tthis.idbCache.getCacheById(COLLECTIONS.RESTAURANTS, id).then(function (response) {\n\t\t\t\tvar toogle = response.is_favorite === \"true\" ? \"false\" : \"true\";\n\t\t\t\tresponse.is_favorite = toogle;\n\t\t\t\treturn _this4.idbCache.setCache(COLLECTIONS.RESTAURANTS, response).then(function () {\n\t\t\t\t\tcallback(null, response);\n\t\t\t\t\tif (!navigator.onLine) {\n\t\t\t\t\t\t_this4.idbCache.setSyncAsPending(COLLECTIONS.RESTAURANTS, false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar path = '/' + id + '/?is_favorite=' + toogle;\n\t\t\t\t\t\treturn fetch(_this4.DATABASE.RESTAURANTS + path, { method: 'PUT' }).then(function (response) {\n\t\t\t\t\t\t\tif (response.status === 200) _this4.idbCache.setSyncAsPending(COLLECTIONS.RESTAURANTS, true);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}).catch(function (error) {\n\t\t\t\treturn callback(error, null);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'saveReview',\n\t\tvalue: function saveReview(data, callback) {\n\t\t\tvar _this5 = this;\n\n\t\t\tif (!navigator.onLine) {\n\t\t\t\treturn this.idbCache.setCache(COLLECTIONS.UNSYNCED_REVIEWS, data).then(function () {\n\t\t\t\t\t_this5.idbCache.setSyncAsPending(COLLECTIONS.REVIEWS, false);\n\t\t\t\t\tcallback(null, data);\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t} else {\n\n\t\t\t\treturn fetch(this.DATABASE.REVIEWS, {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tbody: JSON.stringify(data)\n\t\t\t\t}).then(function (response) {\n\t\t\t\t\tif (response.status < 400) {\n\t\t\t\t\t\tresponse.json().then(function (responseData) {\n\t\t\t\t\t\t\treturn _this5.idbCache.setCache(COLLECTIONS.REVIEWS, responseData).then(function () {\n\t\t\t\t\t\t\t\tcallback(null, responseData);\n\t\t\t\t\t\t\t\treturn _this5.idbCache.setSyncAsPending(COLLECTIONS.REVIEWS, true);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error('Error code ' + response.status);\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\treturn callback(error, null);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'syncDataToApi',\n\t\tvalue: function syncDataToApi() {\n\t\t\tvar _this6 = this;\n\n\t\t\tvar syncInterval = setInterval(function () {\n\t\t\t\tif (!navigator.onLine) return;\n\t\t\t\t_this6.idbCache.getCacheAll(COLLECTIONS.UNSYNCED_REVIEWS).then(function (unsycedReviews) {\n\t\t\t\t\t// Syced reviews if any unsyced\n\t\t\t\t\tif (unsycedReviews && unsycedReviews.length > 0) {\n\t\t\t\t\t\tunsycedReviews.forEach(function (review) {\n\t\t\t\t\t\t\t_this6.saveReview(review, function (error, data) {\n\t\t\t\t\t\t\t\tif (error) console.error(error);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t\t_this6.idbCache.clearCache(COLLECTIONS.UNSYNCED_REVIEWS);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, 3000);\n\t\t}\n\n\t\t/**\n   * Map marker for a restaurant.\n   */\n\n\t}, {\n\t\tkey: 'mapMarkerForRestaurant',\n\t\tvalue: function mapMarkerForRestaurant(restaurant, map) {\n\t\t\tif (!google) return;\n\t\t\tvar marker = new google.maps.Marker({\n\t\t\t\tposition: restaurant.latlng,\n\t\t\t\ttitle: restaurant.name,\n\t\t\t\turl: './restaurant.html?id=' + restaurant.id,\n\t\t\t\tmap: map,\n\t\t\t\tanimation: google.maps.Animation.DROP });\n\t\t\treturn marker;\n\t\t}\n\t}, {\n\t\tkey: 'handleResponseError',\n\t\tvalue: function handleResponseError(response, type) {\n\t\t\tswitch (response.status) {\n\t\t\t\tcase 400:\n\t\t\t\t\treturn new Error('Bed request');\n\t\t\t\tcase 404:\n\t\t\t\t\treturn new Error('Not found');\n\t\t\t\tcase 500:\n\t\t\t\t\treturn new Error('Internal server error');\n\t\t\t}\n\t\t}\n\t}]);\n\n\treturn Storage;\n}();\n\nexports.default = Storage;\n\n},{\"./constants\":1,\"./dataCache\":2,\"idb\":6}],5:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n// Utility functions\n\n\nvar Util = function () {\n\tfunction Util() {\n\t\t_classCallCheck(this, Util);\n\t}\n\n\t_createClass(Util, null, [{\n\t\tkey: 'snackbar',\n\n\n\t\t/**\n  *\n  */\n\t\tvalue: function snackbar(el, message) {\n\t\t\tvar color = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '#D9001F';\n\n\n\t\t\t// TODO\n\t\t\t// Create a element if the selected element does not existe\n\t\t\t// var newDiv = document.createElement(\"div\");\n\n\t\t\tif (!el) {\n\t\t\t\tconsole.log(new Error('Snackbar element not valid'));\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tel.innerHTML = message;\n\t\t\tel.setAttribute('class', 'showSnackbar');\n\t\t\tel.style.background = color;\n\t\t\tsetTimeout(function () {\n\t\t\t\tel.removeAttribute('class');\n\t\t\t}, 5500);\n\t\t}\n\n\t\t/**\n  *\n  */\n\n\t}, {\n\t\tkey: 'imgLazyLoader',\n\t\tvalue: function imgLazyLoader(target) {\n\t\t\tvar imgs = document.querySelectorAll(target);\n\n\t\t\tif (!window.IntersectionObserver) {\n\t\t\t\tconsole.log('No lazy loading for you :(');\n\t\t\t\timgs.forEach(function (img) {\n\t\t\t\t\treturn Util.preloadImage(img);\n\t\t\t\t});\n\t\t\t} else {\n\n\t\t\t\tvar onIntersection = function onIntersection(entries, obsr) {\n\t\t\t\t\tentries.forEach(function (entry) {\n\t\t\t\t\t\tif (entry.intersectionRatio > 0) {\n\t\t\t\t\t\t\tobsr.unobserve(entry.target);\n\t\t\t\t\t\t\trequestAnimationFrame(function () {\n\t\t\t\t\t\t\t\treturn Util.preloadImage(entry.target);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\tvar obsrOptions = {\n\t\t\t\t\trootMargin: '30px 0px',\n\t\t\t\t\tthreshold: [0.1]\n\t\t\t\t};\n\n\t\t\t\tvar observer = new IntersectionObserver(onIntersection, obsrOptions);\n\t\t\t\timgs.forEach(function (target) {\n\t\t\t\t\treturn observer.observe(target);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n  *\n  */\n\n\t}, {\n\t\tkey: 'preloadImage',\n\t\tvalue: function preloadImage(target) {\n\t\t\tif (!target.nodeName === 'IMG') return false;\n\t\t\ttarget.setAttribute('src', target.getAttribute('data-src'));\n\t\t\tconsole.log('Image loaded: ', target.getAttribute('data-src'));\n\t\t\treturn target;\n\t\t}\n\n\t\t/**\n   * Restaurant page URL.\n   */\n\n\t}, {\n\t\tkey: 'urlForRestaurant',\n\t\tvalue: function urlForRestaurant(restaurant) {\n\t\t\treturn './restaurant.html?id=' + restaurant.id;\n\t\t}\n\n\t\t/**\n   * Restaurant image URL.\n   */\n\n\t}, {\n\t\tkey: 'imageUrlForRestaurant',\n\t\tvalue: function imageUrlForRestaurant(restaurant, size) {\n\t\t\tvar img = restaurant.photograph;\n\t\t\treturn img ? '/img/' + img + '-' + size + '.jpg' : '/img/restaurant_placeholder.svg';\n\t\t}\n\t}]);\n\n\treturn Util;\n}();\n\nexports.default = Util;\n\n},{}],6:[function(require,module,exports){\n'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      if (request) {\n        request.onupgradeneeded = function(event) {\n          if (upgradeCallback) {\n            upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n          }\n        };\n      }\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n\n},{}]},{},[3])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9jb25zdGFudHMuanMiLCJqcy9kYXRhQ2FjaGUuanMiLCJqcy9yZXN0YXVyYW50X2luZm8uanMiLCJqcy9zdG9yYWdlLmpzIiwianMvdXRpbC5qcyIsIm5vZGVfbW9kdWxlcy9pZGIvbGliL2lkYi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FDQUEsSUFBTSxZQUFZO0FBQ2hCLGVBQWE7QUFDWixpQkFBYSxhQUREO0FBRVosYUFBUyxTQUZHO0FBR1osc0JBQWtCLGtCQUhOO0FBSVoseUJBQXFCO0FBSlQ7QUFERyxDQUFsQjs7a0JBU2UsUzs7Ozs7Ozs7Ozs7QUNUZjs7OztBQUNBOzs7Ozs7OztBQUVBLElBQU0sY0FBYyxvQkFBVSxXQUE5Qjs7QUFFQTs7OztJQUdxQixTO0FBRW5CLHNCQUFhO0FBQUE7O0FBQ2IsT0FBSyxNQUFMLEdBQWMsZUFBZDtBQUNBLE9BQUssSUFBTCxHQUFZLEtBQUssV0FBTCxDQUFpQixLQUFLLE1BQXRCLENBQVo7QUFDQSxPQUFLLGdCQUFMLENBQXNCLFlBQVksV0FBbEMsRUFBK0MsSUFBL0M7QUFDQSxPQUFLLGdCQUFMLENBQXNCLFlBQVksT0FBbEMsRUFBMkMsSUFBM0M7QUFDQTs7Ozs4QkFFVyxNLEVBQVE7QUFDbkIsVUFBTyxjQUFJLElBQUosQ0FBUyxNQUFULEVBQWlCLENBQWpCLEVBQW9CLFVBQUMsVUFBRCxFQUFnQjtBQUMxQyxZQUFPLFdBQVcsVUFBbEI7QUFDQyxVQUFLLENBQUw7QUFDQyxVQUFNLGNBQWMsV0FBVyxpQkFBWCxDQUE2QixZQUFZLFdBQXpDLEVBQXNELEVBQUMsU0FBUyxJQUFWLEVBQXRELENBQXBCO0FBQ0Esa0JBQVksV0FBWixDQUF3QixPQUF4QixFQUFpQyxJQUFqQzs7QUFFQSxVQUFNLFVBQVUsV0FBVyxpQkFBWCxDQUE2QixZQUFZLE9BQXpDLEVBQWtELEVBQUMsU0FBUyxJQUFWLEVBQWxELENB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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImNvbnN0IGNvbnN0YW50cyA9IHtcbiAgQ09MTEVDVElPTlM6IHtcbiAgXHRSRVNUQVVSQU5UUzogJ3Jlc3RhdXJhbnRzJyxcbiAgXHRSRVZJRVdTOiAncmV2aWV3cycsXG4gIFx0VU5TWU5DRURfUkVWSUVXUzogJ3Vuc3luY2VkX3Jldmlld3MnLFxuICBcdElTX0RBVEFfU1lOQ1JPTklaRUQ6ICdpc0RhdGFTeW5jcm9uemVkJyxcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjb25zdGFudHM7XG4iLCJpbXBvcnQgSURCIGZyb20gJ2lkYic7XG5pbXBvcnQgY29uc3RhbnRzIGZyb20gJy4vY29uc3RhbnRzJztcblxuY29uc3QgQ09MTEVDVElPTlMgPSBjb25zdGFudHMuQ09MTEVDVElPTlM7XG5cbi8qXG4qIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxuKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERhdGFDYWNoZSB7XG5cbiAgY29uc3RydWN0b3IoKXtcblx0XHR0aGlzLmRiTmFtZSA9IFwicmVzdGF1cmFudEFwcFwiO1xuXHRcdHRoaXMuX0lEQiA9IHRoaXMuc2V0RGF0YWJhc2UodGhpcy5kYk5hbWUpO1xuXHRcdHRoaXMuc2V0U3luY0FzUGVuZGluZyhDT0xMRUNUSU9OUy5SRVNUQVVSQU5UUywgdHJ1ZSk7XG5cdFx0dGhpcy5zZXRTeW5jQXNQZW5kaW5nKENPTExFQ1RJT05TLlJFVklFV1MsIHRydWUpO1xuXHR9XG5cblx0c2V0RGF0YWJhc2UoZGJOYW1lKSB7XG5cdFx0cmV0dXJuIElEQi5vcGVuKGRiTmFtZSwgMSwgKHVwZ3JhZGVkREIpID0+IHtcblx0XHRcdHN3aXRjaCh1cGdyYWRlZERCLm9sZFZlcnNpb24pe1xuXHRcdFx0XHRjYXNlIDA6XG5cdFx0XHRcdFx0Y29uc3QgcmVzdGF1cmFudHMgPSB1cGdyYWRlZERCLmNyZWF0ZU9iamVjdFN0b3JlKENPTExFQ1RJT05TLlJFU1RBVVJBTlRTLCB7a2V5UGF0aDogJ2lkJ30pO1xuXHRcdFx0XHRcdHJlc3RhdXJhbnRzLmNyZWF0ZUluZGV4KCdieS1pZCcsICdpZCcpO1xuXG5cdFx0XHRcdFx0Y29uc3QgcmV2aWV3cyA9IHVwZ3JhZGVkREIuY3JlYXRlT2JqZWN0U3RvcmUoQ09MTEVDVElPTlMuUkVWSUVXUywge2tleVBhdGg6ICdpZCd9KTtcblx0XHRcdFx0XHRyZXZpZXdzLmNyZWF0ZUluZGV4KCdieS1pZCcsICdyZXN0YXVyYW50X2lkJyk7XG5cblx0XHRcdFx0XHRjb25zdCB1bnN5bmNlZFJldmlld3MgPSB1cGdyYWRlZERCLmNyZWF0ZU9iamVjdFN0b3JlKENPTExFQ1RJT05TLlVOU1lOQ0VEX1JFVklFV1MsIHthdXRvSW5jcmVtZW50OiB0cnVlfSk7XG5cdFx0XHRcdFx0dW5zeW5jZWRSZXZpZXdzLmNyZWF0ZUluZGV4KCdieS1pZCcsICdyZXN0YXVyYW50X2lkJyk7XG5cblx0XHRcdFx0XHR1cGdyYWRlZERCLmNyZWF0ZU9iamVjdFN0b3JlKENPTExFQ1RJT05TLklTX0RBVEFfU1lOQ1JPTklaRUQsIHsga2V5UGF0aDogJ2NvbGxlY3Rpb24nIH0pO1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKCdEYXRhYmFzZSBhbmQgSW5kZXggY3JlYXRlZCcpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG5cdCAqIFNldCBsb2NhbCBkYXRhIHN5bmMgYXMgcGFuZGluZ1xuXHQgKi9cblx0c2V0U3luY0FzUGVuZGluZyhjb2xsZWN0aW9uLCBzdGF0dXMpIHtcblx0XHRyZXR1cm4gdGhpcy5fSURCLnRoZW4oZGIgPT4ge1xuXHRcdFx0Y29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihDT0xMRUNUSU9OUy5JU19EQVRBX1NZTkNST05JWkVELCAncmVhZHdyaXRlJyk7XG5cdFx0XHR0eC5vYmplY3RTdG9yZShDT0xMRUNUSU9OUy5JU19EQVRBX1NZTkNST05JWkVEKS5wdXQoeyBjb2xsZWN0aW9uLCBzdGF0dXMgfSk7XG5cdFx0fSk7XG5cdH1cblxuXG5cdGNhY2hlRGF0YShjb2xsZWN0aW9uLCBkYXRhID0gW10pe1xuXHRcdCAvLyBhZGQgcG9zdCB0aGUgbG9jYWwgREJcblx0XHR0aGlzLl9JREIudGhlbihkYiA9PiB7XG5cdFx0XHRjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKGNvbGxlY3Rpb24sICdyZWFkd3JpdGUnKTtcblx0XHRcdGNvbnN0IHJlYWR3cml0ZVN0b3JlID0gdHgub2JqZWN0U3RvcmUoY29sbGVjdGlvbik7XG5cdFx0XHRkYXRhLmZvckVhY2goKGl0ZW0pID0+IHJlYWR3cml0ZVN0b3JlLnB1dChpdGVtKSk7XG5cdFx0XHRyZXR1cm4gdHguY29tcGxldGU7XG5cdFx0fSk7XG5cdH1cblxuXG5cdHNldENhY2hlKGNvbGxlY3Rpb24sIGRhdGEpe1xuXHRcdHJldHVybiB0aGlzLl9JREIudGhlbihkYiA9PiB7XG5cdFx0XHRjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKGNvbGxlY3Rpb24sICdyZWFkd3JpdGUnKTtcblx0XHRcdHR4Lm9iamVjdFN0b3JlKGNvbGxlY3Rpb24pLnB1dChkYXRhKTtcbiAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcblx0XHR9KTtcblx0fVxuXG5cblx0Z2V0Q2FjaGVCeUlkKGNvbGxlY3Rpb24sIGlkID0gZmFsc2UpIHtcblx0XHRyZXR1cm4gdGhpcy5fSURCLnRoZW4oZGIgPT4ge1xuXHRcdFx0cmV0dXJuIGRiLnRyYW5zYWN0aW9uKGNvbGxlY3Rpb24pXG5cdFx0XHRcdC5vYmplY3RTdG9yZShjb2xsZWN0aW9uKS5pbmRleCgnYnktaWQnKS5nZXQocGFyc2VJbnQoaWQpKTtcblx0XHR9KTtcblx0fVxuXG5cblx0Z2V0Q2FjaGVBbGwoY29sbGVjdGlvbiwgaW5kZXggPSAnYnktaWQnKSB7XG5cdFx0cmV0dXJuIHRoaXMuX0lEQi50aGVuKGRiID0+IHtcblx0XHRcdHJldHVybiBkYi50cmFuc2FjdGlvbihjb2xsZWN0aW9uKVxuXHRcdFx0XHQub2JqZWN0U3RvcmUoY29sbGVjdGlvbilcblx0XHRcdFx0LmluZGV4KGluZGV4KVxuXHRcdFx0XHQuZ2V0QWxsKCk7XG5cdFx0fSkudGhlbihyZXN0YXVyYW50cyA9PiByZXN0YXVyYW50cyk7XG5cdH1cblxuXG5cdGRlbGV0ZUNhY2hlKGNvbGxlY3Rpb24sIGlkKSB7XG5cdFx0cmV0dXJuIHRoaXMuX0lEQi50aGVuKGRiID0+IHtcblx0XHRcdGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oY29sbGVjdGlvbiwgJ3JlYWR3cml0ZScpO1xuXHRcdFx0dHgub2JqZWN0U3RvcmUoY29sbGVjdGlvbikuZGVsZXRlKGlkKTtcblx0XHRcdHJldHVybiB0eC5jb21wbGV0ZTtcblx0XHR9KTtcblx0fVxuXG5cblx0Y2xlYXJDYWNoZShjb2xsZWN0aW9uKSB7XG5cdFx0cmV0dXJuIHRoaXMuX0lEQi50aGVuKGRiID0+IHtcblx0XHRcdGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oY29sbGVjdGlvbiwgJ3JlYWR3cml0ZScpO1xuXHRcdFx0dHgub2JqZWN0U3RvcmUoY29sbGVjdGlvbikuY2xlYXIoKTtcblx0XHRcdHJldHVybiB0eC5jb21wbGV0ZTtcblx0XHR9KTtcblx0fVxuXG5cbn1cbiIsImltcG9ydCBTdG9yYWdlIGZyb20gJy4vc3RvcmFnZSc7XG5pbXBvcnQgVXRpbCBmcm9tICcuL3V0aWwnO1xuXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJlc3RhdXJhbnRJbmZvIHtcblxuXHRjb25zdHJ1Y3RvcigpIHtcblx0XHR0aGlzLm1hcCA9IG51bGw7XG5cdFx0dGhpcy5yZXN0YXVyYW50ID0gbnVsbDtcblx0XHQvLyB0aGlzLmRiID0gbmV3IFN0b3JhZ2UoKTtcblxuXHRcdHRoaXMuZGF0YVdvcmtlciA9IG5ldyBXb3JrZXIoJy4vanMvZGF0YVdvcmtlci5qcycpO1xuXHRcdHRoaXMuZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgpO1xuXG5cdH1cblxuXG5cdHBvc3RNZXNzYWdlKHsgYWN0aW9uLCBpbnB1dCB9KSB7XG5cdFx0dGhpcy5kYXRhV29ya2VyLnBvc3RNZXNzYWdlKHsgYWN0aW9uLCBpbnB1dCB9KTtcblx0XHR0aGlzLmRhdGFXb3JrZXIub25tZXNzYWdlID0gKGV2ZW50KSA9PiB7XG5cblx0XHRcdGlmKCFldmVudC5kYXRhKSB0aHJvdyBuZXcgRXJyb3IoYFRoZXJlIGlzIG5vIGRhdGE6ICR7ZXZlbnR9YCk7XG5cblx0XHRcdGlmKGV2ZW50LmRhdGEuYWN0aW9uID09PSAnZmV0Y2hSZXN0YXVyYW50QnlJZCcpIHtcblx0XHRcdFx0dGhpcy5yZXN0YXVyYW50ID0gZXZlbnQuZGF0YS5yZXN1bHQ7XG5cdFx0XHRcdGlmICghdGhpcy5yZXN0YXVyYW50KSB7XG5cdFx0XHRcdFx0Y29uc29sZS5lcnJvcignVGhlcmUgaXMgbm8gZGF0YScpO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5pbml0TWFwKHRoaXMucmVzdGF1cmFudCkpO1xuXHRcdFx0XHRyZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5maWxsUmVzdGF1cmFudEhUTUwodGhpcy5yZXN0YXVyYW50KSk7XG5cdFx0XHRcdHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmZpbGxCcmVhZGNydW1iKHRoaXMucmVzdGF1cmFudCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZihldmVudC5kYXRhLmFjdGlvbiA9PT0gJ2ZldGNoUmV2aWV3cycpIHtcblx0XHRcdFx0cmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+ICB0aGlzLmZpbGxSZXZpZXdzSFRNTChldmVudC5kYXRhLnJlc3VsdCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZihldmVudC5kYXRhLmFjdGlvbiA9PT0gJ3NhdmVSZXZpZXcnKSB7XG5cdFx0XHRcdGNvbnN0IGNvbW1lbnRMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Jldmlld3MtbGlzdCcpO1xuXHRcdFx0XHRjb21tZW50TGlzdC5wcmVwZW5kKHRoaXMuY3JlYXRlUmV2aWV3SFRNTChldmVudC5kYXRhLnJlc3VsdCkpO1xuXHRcdFx0fVxuXG5cdFx0fTtcblx0fVxuXG5cdC8qKlxuXHQgKiBHZXQgY3VycmVudCByZXN0YXVyYW50IGZyb20gcGFnZSBVUkwuXG5cdCAqL1xuXHRmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKGNhbGxiYWNrKSB7XG5cdFx0aWYgKHRoaXMucmVzdGF1cmFudCkgeyAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcblx0XHRcdGNhbGxiYWNrKG51bGwsIHRoaXMucmVzdGF1cmFudCk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0Y29uc3QgaWQgPSB0aGlzLmdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcblx0XHRpZiAoIWlkKSB7IC8vIG5vIGlkIGZvdW5kIGluIFVSTFxuXHRcdFx0Y2FsbGJhY2soJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJywgbnVsbCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMucG9zdE1lc3NhZ2Uoe1xuXHRcdFx0XHRhY3Rpb246ICdmZXRjaFJlc3RhdXJhbnRCeUlkJyxcblx0XHRcdFx0aW5wdXQ6IHtpZDogcGFyc2VJbnQoaWQpfVxuXHRcdFx0fSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8qKlxuXHQgKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2Vcblx0ICovXG5cdGZpbGxSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50ID0gdGhpcy5yZXN0YXVyYW50KSB7XG5cdFx0Y29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcblx0XHRuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcblxuXHRcdGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1hZGRyZXNzJyk7XG5cdFx0YWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG5cblx0XHRjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xuXHRcdGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XG5cdFx0aW1hZ2Uuc3JjID0gVXRpbC5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgNjAwKTtcblx0XHRpbWFnZS5hbHQgPSBgJHtyZXN0YXVyYW50Lm5hbWV9IC0gJHtyZXN0YXVyYW50LmN1aXNpbmVfdHlwZX0gQ3Vpc2luZWA7XG5cdFx0aW1hZ2Uuc3Jjc2V0ID0gYCR7VXRpbC5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgMTIwMCl9IDYwMHcsICR7VXRpbC5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgNjAwKX0gNDAwd2A7XG5cblx0XHRjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xuXHRcdGN1aXNpbmUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5jdWlzaW5lX3R5cGU7XG5cblx0XHQvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xuXHRcdGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xuXHRcdFx0dGhpcy5maWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xuXHRcdH1cblxuXHRcdHRoaXMucG9zdE1lc3NhZ2Uoe1xuXHRcdFx0YWN0aW9uOiAnZmV0Y2hSZXZpZXdzJyxcblx0XHRcdGlucHV0OiB7aWQ6IHBhcnNlSW50KHJlc3RhdXJhbnQuaWQpfVxuXHRcdH0pO1xuXHR9O1xuXG5cdC8qKlxuXHQgKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuXHQgKi9cblx0ZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwob3BlcmF0aW5nSG91cnMgPSB0aGlzLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XG5cdFx0Y29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xuXHRcdGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xuXHRcdFx0Y29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblxuXHRcdFx0Y29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcblx0XHRcdGRheS5pbm5lckhUTUwgPSBrZXk7XG5cdFx0XHRyb3cuYXBwZW5kQ2hpbGQoZGF5KTtcblxuXHRcdFx0Y29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG5cdFx0XHR0aW1lLmlubmVySFRNTCA9IG9wZXJhdGluZ0hvdXJzW2tleV07XG5cdFx0XHRyb3cuYXBwZW5kQ2hpbGQodGltZSk7XG5cblx0XHRcdGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XG5cdFx0fVxuXHR9O1xuXG5cdC8qKlxuXHQgKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG5cdCAqL1xuXHRmaWxsUmV2aWV3c0hUTUwocmV2aWV3cyA9IFtdKSB7XG5cdFx0cmV2aWV3cy5yZXZlcnNlKCk7XG5cdFx0Y29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XG5cdFx0Y29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMycpO1xuXHRcdHRpdGxlLmlubmVySFRNTCA9ICdSZXZpZXdzJztcblx0XHRjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xuXG5cdFx0aWYgKCFyZXZpZXdzKSB7XG5cdFx0XHRjb25zdCBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG5cdFx0XHRub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG5cdFx0XHRjb250YWluZXIuYXBwZW5kQ2hpbGQobm9SZXZpZXdzKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0Y29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG5cdFx0cmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XG5cdFx0XHR1bC5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XG5cdFx0fSk7XG5cdFx0Y29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcblx0fTtcblxuXHQvKipcblx0ICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG5cdCAqL1xuXHRjcmVhdGVSZXZpZXdIVE1MKHJldmlldykge1xuXHRcdGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcblx0XHRjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHRcdG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XG5cdFx0bGkuYXBwZW5kQ2hpbGQobmFtZSk7XG5cblx0XHRjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHRcdGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKHJldmlldy5jcmVhdGVkQXQpO1xuXHRcdGRhdGUuaW5uZXJIVE1MID0gY3JlYXRlZEF0LnRvRGF0ZVN0cmluZygpO1xuXHRcdGxpLmFwcGVuZENoaWxkKGRhdGUpO1xuXG5cdFx0Y29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXHRcdHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcblx0XHRsaS5hcHBlbmRDaGlsZChyYXRpbmcpO1xuXG5cdFx0Y29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG5cdFx0Y29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xuXHRcdGxpLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcblxuXHRcdHJldHVybiBsaTtcblx0fTtcblxuXHQvKipcblx0ICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcblx0ICovXG5cdGZpbGxCcmVhZGNydW1iKHJlc3RhdXJhbnQpIHtcblx0XHRjb25zdCBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyZWFkY3J1bWInKTtcblx0XHRjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG5cdFx0bGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuXHRcdGxpLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHJlc3RhdXJhbnQubmFtZSk7XG5cdFx0bGkuc2V0QXR0cmlidXRlKCdhcmlhLWN1cnJlbnQnLCAncGFnZScpO1xuXHRcdGJyZWFkY3J1bWIuYXBwZW5kQ2hpbGQobGkpO1xuXHR9O1xuXG5cdC8qKlxuXHQgKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxuXHQgKi9cblx0Z2V0UGFyYW1ldGVyQnlOYW1lKG5hbWUsIHVybCkge1xuXHRcdGlmICghdXJsKVxuXHRcdFx0dXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG5cdFx0bmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcW1xcXV0vZywgJ1xcXFwkJicpO1xuXHRcdGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApLFxuXHRcdFx0cmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcblx0XHRpZiAoIXJlc3VsdHMpXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRpZiAoIXJlc3VsdHNbMl0pXG5cdFx0XHRyZXR1cm4gJyc7XG5cdFx0cmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcblx0fTtcblxuXG5cdHNlbmRSZXZpZXcoKSB7XG5cdFx0Y29uc3QgZm9ybURhdGEgPSB7XG5cdFx0XHRyZXN0YXVyYW50X2lkOiBwYXJzZUludCh0aGlzLnJlc3RhdXJhbnQuaWQpXG5cdFx0fTtcblx0XHRsZXQgaXNEYXRhVmFsaWQgPSB0cnVlO1xuXHRcdGNvbnN0IGZvcm1EYXRhRmllbGRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5maWVsZFwiKTtcblx0XHRmb3JtRGF0YUZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuXHRcdFx0Ly8gVE9ETzogWW91IGdvdHRhIHNhbml0aXplIHRoaXMgZGF0YSBtYW4hXG5cdFx0XHRpZihmaWVsZC52YWx1ZSA9PT0gJycgfHwgZmllbGQudmFsdWUgPT09IHVuZGVmaW5lZCB8fCBmaWVsZC52YWx1ZSA9PT0gbnVsbCB8fCAhZmllbGQudmFsdWUpIGlzRGF0YVZhbGlkID0gZmFsc2U7XG5cdFx0XHRmb3JtRGF0YVtmaWVsZC5uYW1lXSA9IGZpZWxkLnZhbHVlO1xuXHRcdH0pO1xuXG5cdFx0aWYoIWlzRGF0YVZhbGlkKSByZXR1cm47XG5cdFx0dGhpcy5wb3N0TWVzc2FnZSh7XG5cdFx0XHRhY3Rpb246ICdzYXZlUmV2aWV3Jyxcblx0XHRcdGlucHV0OiB7ZGF0YTogZm9ybURhdGF9XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0KiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG5cdCovXG5cdGluaXRNYXAocmVzdGF1cmFudCkge1xuXHRcdHdpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuXHRcdFx0dGhpcy5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuXHRcdFx0XHR6b29tOiAxNixcblx0XHRcdFx0Y2VudGVyOiByZXN0YXVyYW50LmxhdGxuZyxcblx0XHRcdFx0c2Nyb2xsd2hlZWw6IGZhbHNlXG5cdFx0XHR9KTtcblx0XHRcdHRoaXMuYWRkTWFya2Vyc1RvTWFwKHJlc3RhdXJhbnQpO1xuXHRcdH07XG5cblx0XHRjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcblx0XHRzY3JpcHQuc2V0QXR0cmlidXRlKCdhc3luYycsIHRydWUpO1xuXHRcdHNjcmlwdC5zZXRBdHRyaWJ1dGUoJ2RlZmVyJywgdHJ1ZSk7XG5cdFx0c2NyaXB0LnNyYyA9ICdodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvanM/a2V5PUFJemFTeUNBR0k1eFE0UFhVcGk2SE5oTTdmd0lWelN6VFZWSno1RSZsaWJyYXJpZXM9cGxhY2VzJmNhbGxiYWNrPWluaXRNYXAnO1xuXHRcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHAtaW5zaWRlJykuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcblx0fVxuXG5cblx0LyoqXG5cdCAqIEFkZCBtYXJrZXJzIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzIHRvIHRoZSBtYXAuXG5cdCAqL1xuXHRhZGRNYXJrZXJzVG9NYXAocmVzdGF1cmFudCkge1xuXHRcdGlmKCFnb29nbGUpIHJldHVybjtcblx0XHRjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcblx0XHRcdHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcblx0XHRcdHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXG5cdFx0XHR1cmw6IGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCxcblx0XHRcdG1hcDogdGhpcy5tYXAsXG5cdFx0XHRhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QfVxuXHRcdCk7XG5cdH07XG5cbn1cblxud2luZG93LnJlc3RhdXJhbnRJbmZvID0gbmV3IFJlc3RhdXJhbnRJbmZvKCk7XG4iLCJpbXBvcnQgSURCIGZyb20gJ2lkYic7XG5pbXBvcnQgRGF0YUNhY2hlIGZyb20gJy4vZGF0YUNhY2hlJztcbmltcG9ydCBjb25zdGFudHMgZnJvbSAnLi9jb25zdGFudHMnO1xuXG5jb25zdCBDT0xMRUNUSU9OUyA9IGNvbnN0YW50cy5DT0xMRUNUSU9OUztcblxuLypcbiogQ29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXG4qL1xuY2xhc3MgU3RvcmFnZSB7XG5cblx0Y29uc3RydWN0b3IoKSB7XG5cdFx0Y29uc3QgcG9ydCA9IDEzMzc7IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcblx0XHQvLyBEYXRhYmFzZSBVUkwuXG5cdFx0dGhpcy5EQVRBQkFTRSA9IHtcblx0XHRcdFJFU1RBVVJBTlRTOiBgaHR0cDovLzAuMC4wLjA6JHtwb3J0fS9yZXN0YXVyYW50c2AsXG5cdFx0XHRSRVZJRVdTOiBgaHR0cDovLzAuMC4wLjA6JHtwb3J0fS9yZXZpZXdzL2AsXG5cdFx0fVxuXG5cdFx0dGhpcy5yZWxvYWRJbnRlcnZhbCA9IDA7XG5cdFx0dGhpcy5yZWxvYWRUaW1lciA9IERhdGUubm93KCk7XG5cdFx0dGhpcy5yZXN0YXVyYW50cyA9IFtdO1xuXHRcdHRoaXMuaWRiQ2FjaGUgPSBuZXcgRGF0YUNhY2hlKCk7XG5cdFx0dGhpcy5zeW5jRGF0YVRvQXBpKCk7XG5cdH1cblxuXG5cdC8qKlxuXHQgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXG5cdCAqL1xuXHRmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XG5cdFx0Ly8gQWxsb3cgcmVsb2FkIGxvY2FsIGRhdGEgZXZlcnkgNSBtaW51dGVzXG5cdFx0Y29uc3QgaXNUaW1lVG9SZWxvYWQgPSAoRGF0ZS5ub3coKSAtIHRoaXMucmVsb2FkVGltZXIpID4gdGhpcy5yZWxvYWRJbnRlcnZhbCA/IHRydWUgOiBmYWxzZTtcblxuXHRcdGlmIChpc1RpbWVUb1JlbG9hZCAmJiBuYXZpZ2F0b3Iub25MaW5lKSB7XG5cdFx0XHRmZXRjaCh0aGlzLkRBVEFCQVNFLlJFU1RBVVJBTlRTKS50aGVuKHJlc3BvbnNlID0+IHtcblx0XHRcdFx0aWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG5cdFx0XHRcdFx0cmVzcG9uc2UuanNvbigpLnRoZW4oZGF0YSA9PiB7XG5cdFx0XHRcdFx0XHR0aGlzLnJlc3RhdXJhbnRzID0gZGF0YTtcblx0XHRcdFx0XHRcdHRoaXMucmVsb2FkSW50ZXJ2YWwgPSAzMDA7XG5cdFx0XHRcdFx0XHR0aGlzLmlkYkNhY2hlLmNhY2hlRGF0YShDT0xMRUNUSU9OUy5SRVNUQVVSQU5UUywgZGF0YSk7XG5cdFx0XHRcdFx0XHRjYWxsYmFjayhudWxsLCBkYXRhKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjYWxsYmFjayh0aGlzLmhhbmRsZVJlc3BvbnNlRXJyb3IocmVzcG9uc2UsICdhcGkgcmVxdWVzdCcpLCBudWxsKTtcblx0XHRcdFx0fVxuXHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4gY2FsbGJhY2soZXJyb3IsIG51bGwpKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRpZih0aGlzLnJlc3RhdXJhbnRzLmxlbmd0aCA+IDAgKSB7XG5cdFx0XHRjYWxsYmFjayhudWxsLCB0aGlzLnJlc3RhdXJhbnRzKTtcblx0XHRcdHJldHVybjtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5pZGJDYWNoZS5nZXRDYWNoZUFsbChDT0xMRUNUSU9OUy5SRVNUQVVSQU5UUykudGhlbihkYXRhID0+IHtcblx0XHRcdFx0aWYoZGF0YS5sZW5ndGggPiAwICkge1xuXHRcdFx0XHRcdHRoaXMucmVzdGF1cmFudHMgPSBkYXRhO1xuXHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIGRhdGEpO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdH1cblxuXHQvKipcblx0ICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxuXHQgKi9cblx0ZmV0Y2hSZXZpZXdzKGlkLCBjYWxsYmFjaykge1xuXHRcdC8vIGNoZWNrIHVuc3ljZWQgcmV2aWV3c1xuXHRcdHRoaXMuaWRiQ2FjaGUuZ2V0Q2FjaGVBbGwoQ09MTEVDVElPTlMuVU5TWU5DRURfUkVWSUVXUykudGhlbigodW5zeWNlZFJldmlld3MpID0+IHtcblxuXHRcdFx0aWYoIW5hdmlnYXRvci5vbkxpbmUpe1xuXHRcdFx0XHR0aGlzLmlkYkNhY2hlLmdldENhY2hlQWxsKENPTExFQ1RJT05TLlJFVklFV1MpLnRoZW4oKHJldmlld3MpID0+IHtcblx0XHRcdFx0XHRjb25zdCBjYWNoZWRSZXZpZXdzID0gWy4uLnJldmlld3MsIC4uLnVuc3ljZWRSZXZpZXdzXTtcblx0XHRcdFx0XHRpZihjYWNoZWRSZXZpZXdzICYmIGNhY2hlZFJldmlld3MubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdFx0Y29uc3QgZmlsdGVyZWRSZXZpZXdzID0gY2FjaGVkUmV2aWV3cy5maWx0ZXIoKHJldmlldykgPT4gcmV2aWV3LnJlc3RhdXJhbnRfaWQgPT09IGlkKTtcblx0XHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIGZpbHRlcmVkUmV2aWV3cyk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIFtdKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHQvLyBTeWNlZCByZXZpZXdzIGlmIGFueSB1bnN5Y2VkXG5cdFx0XHRcdC8vIGlmKHVuc3ljZWRSZXZpZXdzICYmIHVuc3ljZWRSZXZpZXdzLmxlbmd0aCA+IDApe1xuXHRcdFx0XHQvLyBcdHVuc3ljZWRSZXZpZXdzLmZvckVhY2goKHJldmlldykgPT4ge1xuXHRcdFx0XHQvLyBcdFx0dGhpcy5zYXZlUmV2aWV3KHJldmlldywgKGVycm9yLCBkYXRhKSA9PiB7XG5cdFx0XHRcdC8vIFx0XHRcdGlmKGVycm9yKSBjb25zb2xlLmVycm9yKGVycm9yKTtcblx0XHRcdFx0Ly8gXHRcdH0pO1xuXHRcdFx0XHQvLyBcdH0pO1xuXHRcdFx0XHQvLyBcdHRoaXMuaWRiQ2FjaGUuY2xlYXJDYWNoZShDT0xMRUNUSU9OUy5VTlNZTkNFRF9SRVZJRVdTKTtcblx0XHRcdFx0Ly8gfVxuXG5cdFx0XHRcdGNvbnN0IHJldmlld3NQYXRoID0gYD9yZXN0YXVyYW50X2lkPSR7aWR9YDtcblx0XHRcdFx0ZmV0Y2godGhpcy5EQVRBQkFTRS5SRVZJRVdTICsgcmV2aWV3c1BhdGgpLnRoZW4ocmVzcG9uc2UgPT4ge1xuXHRcdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMgPCA0MDApIHtcblx0XHRcdFx0XHRcdHJlc3BvbnNlLmpzb24oKS50aGVuKGRhdGEgPT4ge1xuXHRcdFx0XHRcdFx0XHR0aGlzLmlkYkNhY2hlLmNhY2hlRGF0YShDT0xMRUNUSU9OUy5SRVZJRVdTLCBkYXRhKTtcblx0XHRcdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgZGF0YSk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Y2FsbGJhY2sodGhpcy5oYW5kbGVSZXNwb25zZUVycm9yKHJlc3BvbnNlLCAnQVBJIHJlcXVlc3QnKSwgbnVsbCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KS5jYXRjaChlcnJvciA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xuXHRcdFx0fVxuXG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0ICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cblx0ICovXG5cdGZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIGNhbGxiYWNrKSB7XG5cdFx0aWYoIW5hdmlnYXRvci5vbkxpbmUpIHtcblx0XHRcdHRoaXMuaWRiQ2FjaGUuZ2V0Q2FjaGVCeUlkKENPTExFQ1RJT05TLlJFU1RBVVJBTlRTLCBpZCkudGhlbigocmVzcG9uc2UpID0+IHtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xuXHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4gY2FsbGJhY2soZXJyb3IsIG51bGwpKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29uc3QgcGF0aCA9IGAvJHtpZH1gO1xuXHRcdFx0ZmV0Y2godGhpcy5EQVRBQkFTRS5SRVNUQVVSQU5UUyArIHBhdGgpLnRoZW4ocmVzcG9uc2UgPT4ge1xuXHRcdFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcblx0XHRcdFx0XHRyZXNwb25zZS5qc29uKCkudGhlbihkYXRhID0+IHtcblx0XHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIGRhdGEpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNhbGxiYWNrKHRoaXMuaGFuZGxlUmVzcG9uc2VFcnJvcihyZXNwb25zZSwgJ2FwaSByZXF1ZXN0JyksIG51bGwpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KS5jYXRjaChlcnJvciA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cblx0ICovXG5cdGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1x0d2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcblx0XHR0aGlzLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuXHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gY3Vpc2luZSB0eXBlXG5cdFx0XHRcdGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblx0LyoqXG5cdCAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuXHQgKi9cblx0ZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuXHRcdHRoaXMuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBuZWlnaGJvcmhvb2Rcblx0XHRcdFx0Y29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cdC8qKlxuXHQgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuXHQgKi9cblx0ZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcblx0XHR0aGlzLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuXHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGxldCByZXN1bHRzID0gcmVzdGF1cmFudHM7XG5cdFx0XHRcdGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXG5cdFx0XHRcdFx0cmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXG5cdFx0XHRcdFx0cmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXHQvKipcblx0ICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG5cdCAqL1xuXHRmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcblx0XHR0aGlzLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuXHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuXHRcdFx0XHRjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpO1xuXHRcdFx0XHQvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcblx0XHRcdFx0Y29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSk7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cbiAgLyoqXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG4gIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICB0aGlzLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSk7XG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZUN1aXNpbmVzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG5cdHRvZ2dsZUZhdm9yaXRlKGlkLCBjYWxsYmFjaykge1xuXHRcdHRoaXMuaWRiQ2FjaGUuZ2V0Q2FjaGVCeUlkKENPTExFQ1RJT05TLlJFU1RBVVJBTlRTLCBpZCkudGhlbigocmVzcG9uc2UpID0+IHtcblx0XHRcdGNvbnN0IHRvb2dsZSA9IHJlc3BvbnNlLmlzX2Zhdm9yaXRlID09PSBcInRydWVcIiA/IFwiZmFsc2VcIiA6IFwidHJ1ZVwiO1xuXHRcdFx0cmVzcG9uc2UuaXNfZmF2b3JpdGUgPSB0b29nbGU7XG5cdFx0XHRyZXR1cm4gdGhpcy5pZGJDYWNoZS5zZXRDYWNoZShDT0xMRUNUSU9OUy5SRVNUQVVSQU5UUywgcmVzcG9uc2UpLnRoZW4oKCkgPT4ge1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG5cdFx0XHRcdGlmKCFuYXZpZ2F0b3Iub25MaW5lKSB7XG5cdFx0XHRcdFx0dGhpcy5pZGJDYWNoZS5zZXRTeW5jQXNQZW5kaW5nKENPTExFQ1RJT05TLlJFU1RBVVJBTlRTLCBmYWxzZSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29uc3QgcGF0aCA9IGAvJHtpZH0vP2lzX2Zhdm9yaXRlPSR7dG9vZ2xlfWA7XG5cdFx0XHRcdFx0cmV0dXJuIGZldGNoKHRoaXMuREFUQUJBU0UuUkVTVEFVUkFOVFMgKyBwYXRoLCB7IG1ldGhvZDogJ1BVVCcgfSkudGhlbigocmVzcG9uc2UpID0+IHtcblx0XHRcdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkgdGhpcy5pZGJDYWNoZS5zZXRTeW5jQXNQZW5kaW5nKENPTExFQ1RJT05TLlJFU1RBVVJBTlRTLCB0cnVlKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSlcblx0XHQuY2F0Y2goKGVycm9yKSA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xuXHR9XG5cblxuXHRzYXZlUmV2aWV3KGRhdGEsIGNhbGxiYWNrKSB7XG5cdFx0aWYoIW5hdmlnYXRvci5vbkxpbmUpIHtcblx0XHRcdHJldHVybiB0aGlzLmlkYkNhY2hlLnNldENhY2hlKENPTExFQ1RJT05TLlVOU1lOQ0VEX1JFVklFV1MsIGRhdGEpLnRoZW4oKCkgPT4ge1xuXHRcdFx0XHR0aGlzLmlkYkNhY2hlLnNldFN5bmNBc1BlbmRpbmcoQ09MTEVDVElPTlMuUkVWSUVXUywgZmFsc2UpO1xuXHRcdFx0XHRjYWxsYmFjayhudWxsLCBkYXRhKTtcblx0XHRcdH0pLmNhdGNoKChlcnJvcikgPT4gY2FsbGJhY2soZXJyb3IsIG51bGwpKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRyZXR1cm4gZmV0Y2godGhpcy5EQVRBQkFTRS5SRVZJRVdTLCB7XG5cdFx0XHRcdCBtZXRob2Q6ICdQT1NUJyxcblx0XHRcdFx0IGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpXG5cdFx0XHR9KVxuXHRcdFx0LnRoZW4oKHJlc3BvbnNlKSA9PiB7XG5cdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMgPCA0MDApIHtcblx0XHRcdFx0XHRyZXNwb25zZS5qc29uKCkudGhlbigocmVzcG9uc2VEYXRhKSA9PiB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdGhpcy5pZGJDYWNoZS5zZXRDYWNoZShDT0xMRUNUSU9OUy5SRVZJRVdTLCByZXNwb25zZURhdGEpLnRoZW4oKCkgPT4ge1xuXHRcdFx0XHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXNwb25zZURhdGEpO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdGhpcy5pZGJDYWNoZS5zZXRTeW5jQXNQZW5kaW5nKENPTExFQ1RJT05TLlJFVklFV1MsIHRydWUpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGBFcnJvciBjb2RlICR7cmVzcG9uc2Uuc3RhdHVzfWApO1xuXHRcdFx0XHR9XG5cdFx0XHR9KS5jYXRjaCgoZXJyb3IpID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSk7XG5cblx0XHR9XG5cdH1cblxuXG5cdHN5bmNEYXRhVG9BcGkoKSB7XG5cdFx0Y29uc3Qgc3luY0ludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuXHRcdFx0aWYoIW5hdmlnYXRvci5vbkxpbmUpIHJldHVybjtcblx0XHRcdHRoaXMuaWRiQ2FjaGUuZ2V0Q2FjaGVBbGwoQ09MTEVDVElPTlMuVU5TWU5DRURfUkVWSUVXUykudGhlbigodW5zeWNlZFJldmlld3MpID0+IHtcblx0XHRcdFx0Ly8gU3ljZWQgcmV2aWV3cyBpZiBhbnkgdW5zeWNlZFxuXHRcdFx0XHRpZih1bnN5Y2VkUmV2aWV3cyAmJiB1bnN5Y2VkUmV2aWV3cy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0dW5zeWNlZFJldmlld3MuZm9yRWFjaCgocmV2aWV3KSA9PiB7XG5cdFx0XHRcdFx0XHR0aGlzLnNhdmVSZXZpZXcocmV2aWV3LCAoZXJyb3IsIGRhdGEpID0+IHtcblx0XHRcdFx0XHRcdFx0aWYoZXJyb3IpIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0dGhpcy5pZGJDYWNoZS5jbGVhckNhY2hlKENPTExFQ1RJT05TLlVOU1lOQ0VEX1JFVklFV1MpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9LCAzMDAwKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXG5cdCAqL1xuXHRtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xuXHRcdGlmKCFnb29nbGUpIHJldHVybjtcblx0XHRjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcblx0XHRcdHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcblx0XHRcdHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXG5cdFx0XHR1cmw6IGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCxcblx0XHRcdG1hcDogbWFwLFxuXHRcdFx0YW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUH1cblx0XHQpO1xuXHRcdHJldHVybiBtYXJrZXI7XG5cdH1cblxuXG5cdGhhbmRsZVJlc3BvbnNlRXJyb3IocmVzcG9uc2UsIHR5cGUpe1xuXHRcdHN3aXRjaCAocmVzcG9uc2Uuc3RhdHVzKSB7XG5cdFx0XHRjYXNlIDQwMDpcblx0XHRcdFx0cmV0dXJuIG5ldyBFcnJvcignQmVkIHJlcXVlc3QnKTtcblx0XHRcdGNhc2UgNDA0OlxuXHRcdFx0XHRyZXR1cm4gbmV3IEVycm9yKCdOb3QgZm91bmQnKTtcblx0XHRcdGNhc2UgNTAwOlxuXHRcdFx0XHRyZXR1cm4gbmV3IEVycm9yKCdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InKTtcblx0XHR9XG5cdH1cblxufVxuXG5cbmV4cG9ydCBkZWZhdWx0IFN0b3JhZ2U7XG4iLCIvLyBVdGlsaXR5IGZ1bmN0aW9uc1xuXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFV0aWwge1xuXG5cdC8qKlxuXHQqXG5cdCovXG5cdHN0YXRpYyBzbmFja2JhcihlbCwgbWVzc2FnZSwgY29sb3IgPSAnI0Q5MDAxRicpIHtcblxuXHRcdC8vIFRPRE9cblx0XHQvLyBDcmVhdGUgYSBlbGVtZW50IGlmIHRoZSBzZWxlY3RlZCBlbGVtZW50IGRvZXMgbm90IGV4aXN0ZVxuXHRcdC8vIHZhciBuZXdEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG5cdFx0aWYoIWVsKSB7XG5cdFx0XHRjb25zb2xlLmxvZyhuZXcgRXJyb3IoJ1NuYWNrYmFyIGVsZW1lbnQgbm90IHZhbGlkJykpO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdGVsLmlubmVySFRNTCA9IG1lc3NhZ2U7XG5cdFx0ZWwuc2V0QXR0cmlidXRlKCdjbGFzcycsICdzaG93U25hY2tiYXInKTtcblx0XHRlbC5zdHlsZS5iYWNrZ3JvdW5kID0gY29sb3I7XG5cdFx0c2V0VGltZW91dCgoKSA9PiB7IGVsLnJlbW92ZUF0dHJpYnV0ZSgnY2xhc3MnKSB9LCA1NTAwKTtcblx0fVxuXG5cblx0LyoqXG5cdCpcblx0Ki9cblx0c3RhdGljIGltZ0xhenlMb2FkZXIodGFyZ2V0KSB7XG5cdFx0Y29uc3QgaW1ncyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGFyZ2V0KTtcblxuXHRcdGlmKCF3aW5kb3cuSW50ZXJzZWN0aW9uT2JzZXJ2ZXIpIHtcblx0XHRcdGNvbnNvbGUubG9nKCdObyBsYXp5IGxvYWRpbmcgZm9yIHlvdSA6KCcpO1xuXHRcdFx0aW1ncy5mb3JFYWNoKGltZyA9PiBVdGlsLnByZWxvYWRJbWFnZShpbWcpKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRjb25zdCBvbkludGVyc2VjdGlvbiA9IGZ1bmN0aW9uIChlbnRyaWVzLCBvYnNyKSB7XG5cdFx0XHRcdGVudHJpZXMuZm9yRWFjaChlbnRyeSA9PiB7XG5cdFx0XHRcdFx0aWYgKGVudHJ5LmludGVyc2VjdGlvblJhdGlvID4gMCkge1xuXHRcdFx0XHRcdFx0b2Jzci51bm9ic2VydmUoZW50cnkudGFyZ2V0KTtcblx0XHRcdFx0XHRcdHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiBVdGlsLnByZWxvYWRJbWFnZShlbnRyeS50YXJnZXQpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHQgIH0pO1xuXHRcdFx0fTtcblxuXHRcdFx0Y29uc3Qgb2Jzck9wdGlvbnMgPSB7XG5cdFx0XHRcdHJvb3RNYXJnaW46ICczMHB4IDBweCcsXG5cdCAgXHRcdHRocmVzaG9sZDogWzAuMV1cblx0XHRcdH1cblxuXHRcdFx0Y29uc3Qgb2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIob25JbnRlcnNlY3Rpb24sIG9ic3JPcHRpb25zKTtcblx0XHRcdGltZ3MuZm9yRWFjaCh0YXJnZXQgPT4gb2JzZXJ2ZXIub2JzZXJ2ZSh0YXJnZXQpKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0KlxuXHQqL1xuXHRzdGF0aWMgcHJlbG9hZEltYWdlKHRhcmdldCkge1xuXHRcdGlmKCF0YXJnZXQubm9kZU5hbWUgPT09ICdJTUcnKSByZXR1cm4gZmFsc2U7XG5cdFx0dGFyZ2V0LnNldEF0dHJpYnV0ZSgnc3JjJywgdGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1zcmMnKSk7XG5cdFx0Y29uc29sZS5sb2coJ0ltYWdlIGxvYWRlZDogJyx0YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXNyYycpKTtcblx0XHRyZXR1cm4gdGFyZ2V0O1xuXHR9XG5cblxuXHQvKipcblx0ICogUmVzdGF1cmFudCBwYWdlIFVSTC5cblx0ICovXG5cdHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcblx0XHRyZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XG5cdH1cblx0XG5cdC8qKlxuXHQgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cblx0ICovXG5cdHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2l6ZSkge1xuXHRcdGxldCBpbWcgPSByZXN0YXVyYW50LnBob3RvZ3JhcGg7XG5cdFx0cmV0dXJuIGltZyA/IChgL2ltZy8ke2ltZ30tJHtzaXplfS5qcGdgKSA6ICcvaW1nL3Jlc3RhdXJhbnRfcGxhY2Vob2xkZXIuc3ZnJztcblx0fVxuXG5cbn1cbiIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiB0b0FycmF5KGFycikge1xuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnIpO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICB9O1xuXG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG4gICAgdmFyIHJlcXVlc3Q7XG4gICAgdmFyIHAgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3QgPSBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3MpO1xuICAgICAgcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KS50aGVuKHJlc29sdmUsIHJlamVjdCk7XG4gICAgfSk7XG5cbiAgICBwLnJlcXVlc3QgPSByZXF1ZXN0O1xuICAgIHJldHVybiBwO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcbiAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UHJvcGVydGllcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcm94eUNsYXNzLnByb3RvdHlwZSwgcHJvcCwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHZhbCkge1xuICAgICAgICAgIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdLmFwcGx5KHRoaXNbdGFyZ2V0UHJvcF0sIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIEluZGV4KGluZGV4KSB7XG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFtcbiAgICAnbmFtZScsXG4gICAgJ2tleVBhdGgnLFxuICAgICdtdWx0aUVudHJ5JyxcbiAgICAndW5pcXVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnZ2V0JyxcbiAgICAnZ2V0S2V5JyxcbiAgICAnZ2V0QWxsJyxcbiAgICAnZ2V0QWxsS2V5cycsXG4gICAgJ2NvdW50J1xuICBdKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnb3BlbkN1cnNvcicsXG4gICAgJ29wZW5LZXlDdXJzb3InXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIEN1cnNvcihjdXJzb3IsIHJlcXVlc3QpIHtcbiAgICB0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XG4gICAgdGhpcy5fcmVxdWVzdCA9IHJlcXVlc3Q7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoQ3Vyc29yLCAnX2N1cnNvcicsIFtcbiAgICAnZGlyZWN0aW9uJyxcbiAgICAna2V5JyxcbiAgICAncHJpbWFyeUtleScsXG4gICAgJ3ZhbHVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEN1cnNvciwgJ19jdXJzb3InLCBJREJDdXJzb3IsIFtcbiAgICAndXBkYXRlJyxcbiAgICAnZGVsZXRlJ1xuICBdKTtcblxuICAvLyBwcm94eSAnbmV4dCcgbWV0aG9kc1xuICBbJ2FkdmFuY2UnLCAnY29udGludWUnLCAnY29udGludWVQcmltYXJ5S2V5J10uZm9yRWFjaChmdW5jdGlvbihtZXRob2ROYW1lKSB7XG4gICAgaWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgIEN1cnNvci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBjdXJzb3IgPSB0aGlzO1xuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgY3Vyc29yLl9jdXJzb3JbbWV0aG9kTmFtZV0uYXBwbHkoY3Vyc29yLl9jdXJzb3IsIGFyZ3MpO1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdChjdXJzb3IuX3JlcXVlc3QpLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIGN1cnNvci5fcmVxdWVzdCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gT2JqZWN0U3RvcmUoc3RvcmUpIHtcbiAgICB0aGlzLl9zdG9yZSA9IHN0b3JlO1xuICB9XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmNyZWF0ZUluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5jcmVhdGVJbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5pbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgW1xuICAgICduYW1lJyxcbiAgICAna2V5UGF0aCcsXG4gICAgJ2luZGV4TmFtZXMnLFxuICAgICdhdXRvSW5jcmVtZW50J1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAncHV0JyxcbiAgICAnYWRkJyxcbiAgICAnZGVsZXRlJyxcbiAgICAnY2xlYXInLFxuICAgICdnZXQnLFxuICAgICdnZXRBbGwnLFxuICAgICdnZXRLZXknLFxuICAgICdnZXRBbGxLZXlzJyxcbiAgICAnY291bnQnXG4gIF0pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdvcGVuQ3Vyc29yJyxcbiAgICAnb3BlbktleUN1cnNvcidcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAnZGVsZXRlSW5kZXgnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fdHggPSBpZGJUcmFuc2FjdGlvbjtcbiAgICB0aGlzLmNvbXBsZXRlID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIFRyYW5zYWN0aW9uLnByb3RvdHlwZS5vYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fdHgub2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fdHgsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhUcmFuc2FjdGlvbiwgJ190eCcsIFtcbiAgICAnb2JqZWN0U3RvcmVOYW1lcycsXG4gICAgJ21vZGUnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbXG4gICAgJ2Fib3J0J1xuICBdKTtcblxuICBmdW5jdGlvbiBVcGdyYWRlREIoZGIsIG9sZFZlcnNpb24sIHRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgICB0aGlzLm9sZFZlcnNpb24gPSBvbGRWZXJzaW9uO1xuICAgIHRoaXMudHJhbnNhY3Rpb24gPSBuZXcgVHJhbnNhY3Rpb24odHJhbnNhY3Rpb24pO1xuICB9XG5cbiAgVXBncmFkZURCLnByb3RvdHlwZS5jcmVhdGVPYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fZGIuY3JlYXRlT2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhVcGdyYWRlREIsICdfZGInLCBbXG4gICAgJ25hbWUnLFxuICAgICd2ZXJzaW9uJyxcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKFVwZ3JhZGVEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG4gICAgJ2RlbGV0ZU9iamVjdFN0b3JlJyxcbiAgICAnY2xvc2UnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIERCKGRiKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgfVxuXG4gIERCLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb24odGhpcy5fZGIudHJhbnNhY3Rpb24uYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhEQiwgJ19kYicsIFtcbiAgICAnbmFtZScsXG4gICAgJ3ZlcnNpb24nLFxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuICAgICdjbG9zZSdcbiAgXSk7XG5cbiAgLy8gQWRkIGN1cnNvciBpdGVyYXRvcnNcbiAgLy8gVE9ETzogcmVtb3ZlIHRoaXMgb25jZSBicm93c2VycyBkbyB0aGUgcmlnaHQgdGhpbmcgd2l0aCBwcm9taXNlc1xuICBbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddLmZvckVhY2goZnVuY3Rpb24oZnVuY05hbWUpIHtcbiAgICBbT2JqZWN0U3RvcmUsIEluZGV4XS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG4gICAgICAvLyBEb24ndCBjcmVhdGUgaXRlcmF0ZUtleUN1cnNvciBpZiBvcGVuS2V5Q3Vyc29yIGRvZXNuJ3QgZXhpc3QuXG4gICAgICBpZiAoIShmdW5jTmFtZSBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG5cbiAgICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZVtmdW5jTmFtZS5yZXBsYWNlKCdvcGVuJywgJ2l0ZXJhdGUnKV0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyk7XG4gICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTtcbiAgICAgICAgdmFyIG5hdGl2ZU9iamVjdCA9IHRoaXMuX3N0b3JlIHx8IHRoaXMuX2luZGV4O1xuICAgICAgICB2YXIgcmVxdWVzdCA9IG5hdGl2ZU9iamVjdFtmdW5jTmFtZV0uYXBwbHkobmF0aXZlT2JqZWN0LCBhcmdzLnNsaWNlKDAsIC0xKSk7XG4gICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgY2FsbGJhY2socmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gcG9seWZpbGwgZ2V0QWxsXG4gIFtJbmRleCwgT2JqZWN0U3RvcmVdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcbiAgICBpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xuICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwgPSBmdW5jdGlvbihxdWVyeSwgY291bnQpIHtcbiAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG4gICAgICB2YXIgaXRlbXMgPSBbXTtcblxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgaW5zdGFuY2UuaXRlcmF0ZUN1cnNvcihxdWVyeSwgZnVuY3Rpb24oY3Vyc29yKSB7XG4gICAgICAgICAgaWYgKCFjdXJzb3IpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XG5cbiAgICAgICAgICBpZiAoY291bnQgIT09IHVuZGVmaW5lZCAmJiBpdGVtcy5sZW5ndGggPT0gY291bnQpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICB2YXIgZXhwID0ge1xuICAgIG9wZW46IGZ1bmN0aW9uKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdvcGVuJywgW25hbWUsIHZlcnNpb25dKTtcbiAgICAgIHZhciByZXF1ZXN0ID0gcC5yZXF1ZXN0O1xuXG4gICAgICBpZiAocmVxdWVzdCkge1xuICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgaWYgKHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgICAgICAgdXBncmFkZUNhbGxiYWNrKG5ldyBVcGdyYWRlREIocmVxdWVzdC5yZXN1bHQsIGV2ZW50Lm9sZFZlcnNpb24sIHJlcXVlc3QudHJhbnNhY3Rpb24pKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24oZGIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEQihkYik7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGRlbGV0ZTogZnVuY3Rpb24obmFtZSkge1xuICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ2RlbGV0ZURhdGFiYXNlJywgW25hbWVdKTtcbiAgICB9XG4gIH07XG5cbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBleHA7XG4gICAgbW9kdWxlLmV4cG9ydHMuZGVmYXVsdCA9IG1vZHVsZS5leHBvcnRzO1xuICB9XG4gIGVsc2Uge1xuICAgIHNlbGYuaWRiID0gZXhwO1xuICB9XG59KCkpO1xuIl19\n"]}